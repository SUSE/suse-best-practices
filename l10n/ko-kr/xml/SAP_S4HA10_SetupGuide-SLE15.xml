<?xml version="1.0"?>
<?asciidoc-toc?><?asciidoc-numbered?><article
xmlns:xi="http://www.w3.org/2001/XInclude" xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" xml:base="SAP_S4HA10_SetupGuide-SLE15.xml" version="5.0" xml:lang="ko"><title>SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - 설정 가이드</title>
<info>

<date>2020-02-25</date>
<dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
    <dm:bugtracker>
        <dm:url>https://github.com/SUSE/suse-best-practices/issues/new</dm:url>
        <dm:product>SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - 설정 가이드 SLES15</dm:product>
    </dm:bugtracker>
</dm:docmanager>

<!--<title>SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - Setup Guide</title>-->
<!--<subtitle>SAP S/4 HANA 1809 High Availability Cluster</subtitle>-->
    <!-- <orgname>SUSE Best Practices</orgname>-->
    <productname>SUSE Linux Enterprise Server for SAP Applications</productname>
    <productnumber>15 </productnumber>

<author>
        <personname>
            <firstname>Fabian</firstname>
            <surname>Herschel, 특별 아키텍트 SAP, SUSE</surname>
        </personname>
        <!-- <personname>
            <firstname>Fabian</firstname>
            <surname>Herschel</surname>
            </personname>
            <affiliation>
            <jobtitle>Distinguished Architect SAP</jobtitle>
            <orgname>SUSE</orgname>
            </affiliation>-->
    </author>
    <author>
        <personname>
            <firstname>Bernd</firstname>
            <surname>Schubert, SAP 솔루션 아키텍트, SUSE</surname>
        </personname>
        <!-- <personname>
            <firstname>Bernd</firstname>
            <surname>Schubert</surname>
            </personname>
            <affiliation>
            <jobtitle>SAP Solution Architect</jobtitle>
            <orgname>SUSE</orgname>
            </affiliation>-->
        </author>

          <!--  <author>
        <personname>
            <firstname>Lars</firstname>
            <surname>Pinne, System Engineer, SUSE</surname>
        </personname>
        <!-\- <personname>
            <firstname><Lars</firstname>
            <surname>Pinne</surname>
            </personname>
            <affiliation>
            <jobtitle>System Engineer</jobtitle>
            <orgname>SUSE</orgname>
            </affiliation>-\->
    </author>-->

    <cover role="logos">
        <mediaobject>
                <imageobject>
                        <imagedata fileref="suse.svg" width=""/>
                </imageobject>
        </mediaobject>
        </cover>

<date><?dbtimestamp format="Y"?> 년 <?dbtimestamp format="B"?> 월 <?dbtimestamp format="d"?> 일</date>


<abstract>

        <para>SUSE® Linux Enterprise Server for SAP Applications는 여러 가지 측면에서 SAP* 응용 프로그램에 최적화되어 있습니다. 본 가이드는 S/4 HANA Enqueue Replication 2 High Availability Cluster 솔루션의 배포 방법을 설명합니다. 그리고 SUSE® Linux Enterprise Server for SAP Applications 15를 기준으로 작성되었습니다. 그러나 SUSE Linux Enterprise Server for SAP Applications 최신 서비스 팩에도 이 개념을 적용할 수 있습니다.
        </para>

    <para><emphasis role="strong">고지 사항</emphasis>: 본 문서는 SUSE 모범 사례 시리즈의 일부입니다. 이 시리즈의 모든 문서는 SUSE 직원 및 제3자가 자발적으로 기여하여 작성한 것입니다. 문서에서 별도로 설명하는 경우를 제외하고, 문서의 목적은 특정 작업을 수행하는 방법의 한 가지 예만을 제공하는 것입니다. 또한, SUSE는 문서에서 설명되는 작업이 해당 기능을 수행하는지 또는 의도하지 않은 결과가 제공되지 않는지를 확인할 수 없습니다. 본 문서의 모든 정보는 최대한 주의를 기울여 작성되었습니다. 그러나 이것이 문서의 정확성을 보장하지는 않습니다. 따라서 SUSE LLC, 그 계열사, 저자, 번역자 중 어느 누구도 있을 수 있는 오류나 그에 따른 결과에 책임을 지지 않는다고 명확히 진술할 필요가 있습니다.
    </para>

</abstract>
</info>
<section xml:id="id-about-this-guide">
<title>이 가이드 정보</title>
<section xml:id="id-introduction">
<title>소개</title>
<para>SUSE® Linux Enterprise Server for SAP Applications는 고가용성 SAP* 응용 프로그램을 실행하기 위한 최적의 플랫폼입니다. 여기에 중복 레이아웃의 기술 인프라를 사용하면 단일 오류 지점을 제거할 수 있습니다.</para>
<para>SAP* Business Suite는 대기업 및 중견기업을 위한 정교한 응용 프로그램 플랫폼입니다. 핵심 비즈니스 환경에는 최대한의 SAP* 응용 프로그램 가용성이 필요한 경우가 많습니다.</para>
<para>여기서 설명하는 클러스터 솔루션은 SAP* SAP S/4HANA ABAP Platform에서 사용할 수 있습니다.</para>
<para>SAP S/4HANA ABAP Platform은 SAP 비즈니스 응용 프로그램을 지원하기 위해 사용하는 일반 미들웨어 기능 스택입니다. SAP Enqueue Replication Server 2는 SAP S/4HANA ABAP Platform 스택의 가장 중요한 구성 요소 중 하나인 인큐(enqueue) 서비스를 위한 응용 프로그램 수준 중복을 구성합니다. SUSE Linux Enterprise Server for SAP Applications에 대한 예에서와 같이, 응용 프로그램 수준 중복과 고가용성 클러스터 솔루션을 결합하면 인큐 중복 메커니즘에서 최적의 효과를 달성할 수 있습니다. 수년간의 실제 운영을 통해 이 구성 요소는 다양한 규모 및 산업의 고객에서 높은 완성도가 입증되었습니다.</para>
</section>
<section xml:id="sec.resource">
<title>추가 문서 및 리소스</title>
<para>본 가이드의 여러 장에는 시스템 또는 인터넷에서 사용할 수 있는 추가 문서 리소스로 연결되는 링크가 수록되어 있습니다.</para>
<para>최신 제품 문서 업데이트는 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://documentation.suse.com/">https://documentation.suse.com/</link>을 참조하십시오.</para>
<para>SUSE Linux Enterprise Server 및 SAP와 관련한 추가 백서, 가이드 및 모범 사례 문서는 아래 SUSE 모범 사례 웹 페이지에서 확인 및 다운로드할 수 있습니다.</para>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://documentation.suse.com/sbp/sap-15/">https://documentation.suse.com/sbp/sap-15/</link></para>
<para>이 페이지에서는 SAP NetWeaver 및 SAP S/4HANA용 SAP HANA 시스템 복제 자동화 및 고가용성(HA) 시나리오에 대한 가이드도 제공됩니다.</para>
<para>고객 참조 자료, 브로셔 또는 전단 등의 추가 리소스는 아래 SUSE Linux Enterprise Server for SAP Applications 리소스 라이브러리에서 확인할 수 있습니다.</para>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/products/sles-for-sap/resource-library/">https://www.suse.com/products/sles-for-sap/resource-library/</link></para>
</section>
<section xml:id="id-errata">
<title>오류 정정</title>
<para>소규모 긴급 수정 및 중요 정보를 제 때 제공하기 위해 이 가이드에 대한 기술 정보 문서(TID)는 더 자주 업데이트, 관리 및 게시됩니다.</para>
<itemizedlist>
<listitem>
<para>SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - 설정 가이드 - 오류 정정(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/support/kb/doc/?id=7023714">https://www.suse.com/support/kb/doc/?id=7023714</link>)</para>
</listitem>
<listitem>
<para>이 가이드와 함께 기타 솔루션에 대한 SUSE SAP 모범 사례 가이드 오류 정정(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/support/kb/doc/?id=7023713">https://www.suse.com/support/kb/doc/?id=7023713</link>)도 확인하십시오.</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-feedback">
<title>피드백</title>
<para>여러 피드백 채널을 사용할 수 있습니다.</para>
<variablelist>
<varlistentry>
<term>버그 및 기능 향상 요청</term>
<listitem>
<para>제품과 관련하여 사용 가능한 서비스 및 지원 옵션에 대해서는 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="http://www.suse.com/support/">http://www.suse.com/support/</link>를 참조하십시오.</para>
</listitem>
</varlistentry>
</variablelist>
<para>제품 구성 요소의 버그를 보고하려면 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://scc.suse.com/support/">https://scc.suse.com/support/requests</link>로 이동하여 로그인한 후 <emphasis>새 SR(Service Request: 서비스 요청) 제출</emphasis>을 선택하십시오.</para>
<variablelist>
<varlistentry>
<term>메일</term>
<listitem>
<para>본 제품 문서에 대한 피드백이 있는 경우 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="mailto:doc-team@suse.com">doc-team@suse.com</link>으로 메일을 보내 주십시오. 문서의 문서 제목, 제품 버전 및 게시 날짜를 포함해야 합니다. 오류를 보고하거나 개선사항을 제안하려면 문제점에 대한 간략한 설명을 제공하고 해당 섹션 번호 및 페이지(또는 URL)를 참조하십시오.</para>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
<section xml:id="id-scope-of-this-document">
<title>본 문서의 범위</title>
<para>본 문서는 다음 작업 방법을 설명합니다.</para>
<itemizedlist>
<listitem>
<para>SAP Enqueue Replication Server 2를 포함한 SAP S/4HANA ABAP Platform용 SUSE Linux Enterprise High Availability 플랫폼의 계획 수립</para>
</listitem>
<listitem>
<para>Linux 고가용성 플랫폼 설정 및 SUSE Linux Enterprise에 SAP Enqueue Replication Server 2 등 기본 SAP S/4HANA ABAP Platform 설치</para>
</listitem>
<listitem>
<para>SAP가 인증한 방식으로 <emphasis role="strong">sap-suse-cluster-connector</emphasis> 버전 3을 통해 고가용성 클러스터와 SAP 컨트롤 프레임워크 통합</para>
</listitem>
</itemizedlist>
<note>
<para>본 가이드에서는 인큐 복제 버전 2에 대한 클러스터 아키텍처를 구현합니다. SAP S/4HANA ABAP Platform 버전 1809 이상의 경우 인큐 복제 버전 2가 기본 버전입니다.</para>
</note>
<para>본 가이드는 중앙 서비스의 고가용성을 중심으로 설명합니다. SAP HANA 시스템 복제의 경우 성능 최적화 또는 비용 최적화 시나리오용 가이드를 참조하십시오(<xref linkend="sec.resource"/> 참조).</para>
</section>
<section xml:id="id-overview">
<title>개요</title>
<para>본 문서는 Enqueue Replication 시나리오를 위해 SUSE Linux Enterprise Server for SAP Applications 15를 사용한 pacemaker 클러스터 설정 방법을 설명합니다. SAP S/4-HA-CLU 1.0 인증 사양 및 목표를 충족하는 것이 중점 사항입니다. 본 문서에서 설명하는 설정의 경우, ASCS 중앙 서비스 인스턴스 및 ERS 복제 인큐 인스턴스용으로 노드 2개가 사용됩니다. 이러한 두 노드는 SUSE Linux Enterprise High Availability 클러스터에서 제어됩니다. 세 번째 노드는 데이터베이스 및 PAS와 AAS 애플리케이션 서버 인스턴스를 실행하기 위한 용도로 사용됩니다. 추가적인 네 번째 노드는 NFS 서버로 사용됩니다.</para>
<para>설정 목표는 다음과 같습니다.</para>
<itemizedlist>
<listitem>
<para>SAP 시작 프레임워크인 <emphasis>sapstartsrv</emphasis>와 클러스터를 통합하여 유지보수 절차로 인해 클러스터의 안정성이 손상되지 않게 방지</para>
</listitem>
<listitem>
<para>RKS(Rolling Kernel Switch) 인식</para>
</listitem>
<listitem>
<para>표준 SAP 설치로 지원 프로세스 향상</para>
</listitem>
<listitem>
<para>SAP HACheckMaintenanceMode 및 HASetMaintenanceMode 지원을 구현하여 SAP 리소스에 대한 자동화된 HA 유지보수 모드 지원</para>
</listitem>
<listitem>
<para>허용되는 ASCS 및 ERS 인스턴스에서 3개 이상의 클러스터 노드 지원</para>
</listitem>
</itemizedlist>
<para>업데이트된 인증 SAP S/4-HA-CLU 1.0은 일부 테스트 절차를 재정의하고 특수 조건에서 클러스터의 새 동작 방법을 설명합니다. 이러한 변경 사항을 통해 클러스터 아키텍처를 개선하고 더 편리하게 사용 및 설정할 수 있도록 설계했습니다.</para>
<para>공유 SAP 리소스는 중앙 NFS 서버에 위치합니다.</para>
<para>SAP 인스턴스 자체가 공유 디스크에 설치되어 파일 시스템의 전환을 통해 원활하게 기능할 수 있습니다. 공유 디스크 설정을 사용하면 클러스터 펜싱 메커니즘인 STONITH에서도 SBD를 사용할 수 있습니다.</para>
<section xml:id="id-differences-to-previous-cluster-architectures">
<title>이전 클러스터 아키텍처와의 차이점</title>
<itemizedlist>
<listitem>
<para>여기서 설명하는 새로운 개념은 마스터-슬레이브 아키텍처를 사용하는 기존 스택과 다릅니다. 새로운 인증을 통해 기본 요소가 포함된 더 단순한 모델로 전환됩니다. 즉, 한 시스템에는 자체 리소스가 포함된 ASCS 인스턴스가 위치하고 다른 시스템에는 자체 리소스가 포함된 ERS 인스턴스가 위치합니다.</para>
</listitem>
<listitem>
<para>SAP S/4HANA의 경우 새로운 개념을 통해 리소스 오류 발생 후 ERS 측에서 ASCS를 시작할 필요가 없습니다. 새로운 인큐 아키텍처의 이름도 ENSA2입니다.</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-three-systems-or-more-for-ascs-ers-database-and-additional-sap-instances">
<title>ASCS, ERS, 데이터베이스 및 추가 SAP 인스턴스를 위한 3개 이상 시스템</title>
<para>이 문서는 SAP 분산 시스템을 3개 이상 시스템에 설치하는 방법을 설명합니다. 이 설정에서는 2개의 시스템만 클러스터 내에 위치합니다. 데이터베이스 및 SAP Dialog 인스턴스는 클러스터에 추가 노드를 추가하거나 기존 노드 중 하나에 데이터베이스를 설치하여 클러스터에 추가할 수 있습니다. 그러나 데이터베이스를 별도의 클러스터에 설치하는 것이 좋습니다. 3개 이상 노드를 위한 클러스터 구성은 이 문서의 끝부분에서 설명합니다. 클러스터 1개 내의 노드 개수는 2개 또는 홀수개여야 합니다.</para>
<note>
<para>이 가이드에서는 SAP S/4-HA-CLU 1.0 인증에 대한 설정을 중점적으로 설명하므로 여기서 자세하게 설명하는 클러스터는 SAP 인스턴스 ASCS 및 ERS만 다룹니다.</para>
</note>
<para>사용 중인 데이터베이스가 SAP HANA인 경우에는 자동화 솔루션인 SAPHanaSR을 사용하여 성능 최적화 시스템 복제 시나리오를 설정하는 것이 좋습니다. SAPHanaSR 자동화는 자체 노드 2개에 설정되어야 합니다. 이와 관련한 설정은 별도의 모범 사례 문서에서 설명되며 SUSE 모범 사례 웹 페이지에서 확인할 수 있습니다.</para>
<figure>
<title>인증 설정을 위한 3개 시스템</title>
<mediaobject>
<imageobject>
<imagedata fileref="sles4sap_nw740_3nodes.svg" width=""/>
</imageobject>
<textobject><phrase>SVG</phrase></textobject>
</mediaobject>
</figure>
<itemizedlist>
<title>클러스터 시스템 2 노드 시나리오</title>
<listitem>
<para>ASCS용 시스템 1개(valuga11)</para>
<itemizedlist>
<listitem>
<para>호스트 이름: sapen2as</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>ERS용 시스템 1개(valuga12)</para>
<itemizedlist>
<listitem>
<para>호스트 이름: sapen2er</para>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<itemizedlist>
<title>비클러스터 시스템</title>
<listitem>
<para>DB용이며 애플리케이션 서버로 작동하는 시스템 1개(valuga01)</para>
<itemizedlist>
<listitem>
<para>호스트 이름: sapen2db</para>
</listitem>
<listitem>
<para>호스트 이름: sapen2d1</para>
</listitem>
<listitem>
<para>호스트 이름: sapen2d2</para>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-high-availability-for-the-database">
<title>데이터베이스 고가용성</title>
<para>데이터베이스가 고가용성을 지원하도록 설계되지 않은 경우에는 필요에 따라 데이터베이스의 가용성을 늘릴 수 있습니다.</para>
<section xml:id="id-sap-hana-system-replication">
<title>SAP HANA 시스템 복제</title>
<para>이 문서에서 설명되는 완벽한 3 노드 시나리오 향상은 SAP HANA 시스템 복제(SR) 자동화를 구현하기 위한 것입니다.</para>
<figure>
<title>중앙 서비스용 클러스터 1개, SAP HANA SR용 1개</title>
<mediaobject>
<imageobject>
<imagedata fileref="sles4sap_nw740_cs+hanasr.svg" width=""/>
</imageobject>
<textobject><phrase>SVG</phrase></textobject>
</mediaobject>
</figure>
<table frame="all" rowsep="1" colsep="1">
<title>이 시나리오에서 예시로 사용되는 OS/데이터베이스 조합은 다음과 같습니다.</title>
<?dbhtml table-width="85%"?>
<?dbfo table-width="85%"?>
<?dblatex table-width="85%"?>
<tgroup cols="2">
<colspec colname="col_1" colwidth="180.625*"/>
<colspec colname="col_2" colwidth="180.625*"/>
<thead>
<row>
<entry align="center" valign="top" namest="col_1" nameend="col_2">SUSE Linux Enterprise Server for SAP Applications 15</entry>
</row>
</thead>
<tbody>
<row>
<entry align="center" valign="top"><para><emphasis role="strong">Intel X86_64</emphasis></para></entry>
<entry align="left" valign="top"><para>SAP HANA DATABASE 2.0</para></entry>
</row>
</tbody>
</tgroup>
</table>
<note>
<para>AMD64/Intel 64 기반 Linux에서의 SAP S/4HANA ABAP Platform 버전. SAP S/4HANA Server 1809에서 지원되는 OS와 데이터베이스의 조합에 대한 자세한 정보는 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://apps.support.sap.com/sap/support/pam">SAP PAM</link>의 SAP 제품 가용성 매트릭스에서 확인할 수 있습니다.</para>
</note>
</section>
</section>
<section xml:id="id-integration-of-sap-s4hana-into-the-cluster-using-the-cluster-connector">
<title>클러스터 커넥터를 사용하여 SAP S/4HANA를 클러스터에 통합</title>
<para><emphasis role="strong">sap_suse_cluster_connector</emphasis>를 사용하여 SAP 컨트롤 프레임워크를 통해 HA 클러스터를 통합하는 것은 특별한 관심사입니다. SAP Kernel versions 6.40 이후부터는 <emphasis role="strong">sapstartsrv</emphasis> 서비스가 SAP 인스턴스를 제어합니다. 고가용성 환경에서 SAP 인스턴스를 실행할 때 나타나는 전형적인 문제 중 하나는, SAP 관리자가 클러스터 소프트웨어에서 제공하는 인터페이스를 사용하지 않고 SAP 인스턴스의 상태(시작/중지)를 변경할 경우 클러스터 프레임워크가 이를 오류 상태로 인식하고 SAP 인스턴스를 시작하거나 중지하여 SAP 인스턴스를 이전 상태로 전환하는 것입니다. 이로 인해 SAP 유지보수 작업 중에 클러스터가 SAP 인스턴스의 상태를 변경하면 매우 위험한 상황이 발생할 수 있습니다. 업데이트된 새로운 솔루션을 사용하여 중앙 구성 요소인 <emphasis role="strong">sapstartsrv</emphasis>가 클러스터 소프트웨어에 상태 변경을 보고합니다. 이를 통해 앞서 설명한 위험한 상황을 방지할 수 있습니다. 자세한 내용은 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://blogs.sap.com/2014/05/08/using-sapvendorclusterconnector-for-interaction-between-cluster-framework-and-sapstartsrv/comment-page-1/">https://blogs.sap.com/2014/05/08/using-sapvendorclusterconnector-for-interaction-between-cluster-framework-and-sapstartsrv/comment-page-1/</link>의 블로그 게시글 “Using sap_vendor_cluster_connector for interaction between cluster framework and sapstartsrv”(클러스터 프레임워크와 sapstartsrv 간의 상호 작용에 sap_vendor_cluster_connector 사용)에서 확인할 수 있습니다.</para>
<note>
<para>SAP S/4HANA ABAP Platform 1809 이전 버전에서 업데이트한 경우에는 SAP 노트 2641019를 유의하여 읽고 클러스터를 조정하십시오.</para>
</note>
<figure>
<title>클러스터와 SAP 시작 프레임워크를 통합하기 위한 클러스터 커넥터</title>
<mediaobject>
<imageobject>
<imagedata fileref="sles4sap_clusterconnector.svg" width=""/>
</imageobject>
<textobject><phrase>SVG</phrase></textobject>
</mediaobject>
</figure>
<note>
<para>이 시나리오에서는 <emphasis role="strong">sap-suse-cluster-connector</emphasis>의 업데이트된 버전이 사용됩니다. 그리고 클러스터 프레임워크와 <emphasis role="strong">sapstartsrv</emphasis> 서비스 간 통신을 위해 API 버전 3이 구현됩니다.</para>
</note>
<para><emphasis role="strong">sap-suse-cluster-connector</emphasis> 새 버전을 사용하면 SAP 인스턴스를 시작, 중지 및 마이그레이션할 수 있습니다. 클러스터 소프트웨어와 <emphasis role="strong">sapstartsrv</emphasis>를 통합하면 명령줄 도구 <emphasis role="strong">sapcontrol</emphasis> 또는 SAP 관리 콘솔(SAP MMC 또는 SAP MC)을 사용하여 HA 설정 확인을 실행하는 옵션도 구현할 수 있습니다. 3.1.0 이상 버전부터는 SAP <emphasis role="strong">sapcontrol</emphasis> 명령으로 트리거된 클러스터 리소스의 유지보수 모드가 지원됩니다.</para>
</section>
<section xml:id="id-disks-and-partitions">
<title>디스크 및 파티션</title>
<para>모든 SAP 파일 시스템에는 NFS 상의 파일 시스템뿐만 아니라 XFS가 사용됩니다.</para>
<section xml:id="id-shared-disk-for-cluster-ascs-and-ers">
<title>클러스터 ASCS 및 ERS용 공유 디스크</title>
<para>2 노드 클러스터 예시에서는 ASCS 및 ERS 인스턴스용 디스크가 클러스터 노드 valuga11 및 valuga12에 공유 및 할당되어야 합니다. 디스크는 SAP 인스턴스용 파일 시스템을 위한 파티션뿐만 아니라 SBD로 사용되는 파티션도 제공합니다.</para>
<para>valuga11에서 공유 디스크를 위한 파일 시스템을 준비합니다. 공유 드라이브 /dev/disk/by-id/SUSE-Example-A에 다음과 같이 파티션 3개를 생성합니다.</para>
<itemizedlist>
<listitem>
<para>SBD용 파티션 1(/dev/disk/by-id/SUSE-Example-A-part1)(7MB)</para>
</listitem>
<listitem>
<para>XFS로 포맷된 첫 번째 파일 시스템(10GB)용 파티션 2(/dev/disk/by-id/SUSE-Example-A-part2)</para>
</listitem>
<listitem>
<para>XFS로 포맷된 두 번째 파일 시스템(10GB)용 파티션 3(/dev/disk/by-id/SUSE-Example-A-part3)</para>
</listitem>
</itemizedlist>
<para>파티션은 YaST 또는 사용 가능한 명령줄 도구를 사용하여 생성할 수 있습니다. 비대화식 설정에서는 다음 스크립트를 사용할 수 있습니다.</para>
<example>
<title>valuga11에서 SBD 및 ASCS/ERS용 파티션과 파일 시스템 생성</title>
<screen># parted -s /dev/disk/by-id/SUSE-Example-A print
# # we are on the 'correct' drive, right?
# parted -s /dev/disk/by-id/SUSE-Example-A mklabel gpt
# parted -s /dev/disk/by-id/SUSE-Example-A mkpart primary 1049k 8388k
# parted -s /dev/disk/by-id/SUSE-Example-A mkpart primary 8389k 10.7G
# parted -s /dev/disk/by-id/SUSE-Example-A mkpart primary 10.7G 21.5G
# mkfs.xfs /dev/disk/by-id/SUSE-Example-A-part2
# mkfs.xfs /dev/disk/by-id/SUSE-Example-A-part3</screen>
</example>
<para>이러한 파일 시스템에서는 일반 파티션을 사용하여 클러스터 구성을 최대한 단순하게 유지하는 것이 좋습니다. 그러나 별도의 볼륨 그룹에 이러한 파일 시스템을 배치할 수도 있습니다. 이 경우에는 논리 볼륨 그룹 및 일부 경우 MD-Raid 장치를 제어하려면 더 많은 클러스터 리소스를 추가해야 합니다. 그러나 이런 설정에 대한 설명은 이 가이드의 범위를 벗어납니다.</para>
<para>valuga11에서 공유 디스크를 파티셔닝한 후에는 valuga12에서 파티션 테이블 재스캔을 요청해야 합니다.</para>
<screen># partprobe; fdisk -l /dev/disk/by-id/SUSE-Example-A</screen>
<para>SAP를 설치하는 중에 valuga11에 /usr/sap/EN2/ASCS00를, 그리고 valuga12에 /usr/sap/EN2/ERS10을 마운트해야 합니다.</para>
<itemizedlist>
<listitem>
<para>valuga11: /dev/disk/by-id/SUSE-Example-A-part2 /usr/sap/EN2/ASCS00</para>
</listitem>
<listitem>
<para>valuga12: /dev/disk/by-id/SUSE-Example-A-part3 /usr/sap/EN2/ERS10</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-disk-for-db-and-dialog-instances-hana-db">
<title>DB 및 Dialog 인스턴스용 디스크(HANA DB)</title>
<para>데이터베이스 서버용 디스크가 valuga01에 할당됩니다. 기본 및 보조 애플리케이션 서버용 디스크rk valuga01에 할당됩니다.</para>
<itemizedlist>
<title>valuga01</title>
<listitem>
<para>XFS로 포맷된 데이터베이스(160GB)용 파티션 (/dev/disk/by-id/SUSE-Example-B-part1)</para>
</listitem>
<listitem>
<para>XFS로 포맷된 PAS 인스턴스(10GB)용 파티션 2(/dev/disk/by-id/SUSE-Example-B-part2)</para>
</listitem>
<listitem>
<para>XFS로 포맷된 AAS 인스턴스(10GB)용 파티션 3(/dev/disk/by-id/SUSE-Example-B-part3)</para>
</listitem>
</itemizedlist>
<para>파티션은 YaST 또는 사용 가능한 명령줄 도구를 사용하여 생성할 수 있습니다. 비대화식 설정에서는 다음 스크립트를 사용할 수 있습니다.</para>
<example>
<title>valuga01 기반 DB 및 App Server용 파티션과 파일 시스템 생성</title>
<screen># parted -s /dev/disk/by-id/SUSE-Example-B print
# # we are on the 'correct' drive, right?
# parted -s /dev/disk/by-id/SUSE-Example-B mklabel gpt
# parted -s /dev/disk/by-id/SUSE-Example-B mkpart primary 1049k 160G
# parted -s /dev/disk/by-id/SUSE-Example-B mkpart primary 160G 170G
# parted -s /dev/disk/by-id/SUSE-Example-B mkpart primary 170G 180G
# mkfs.xfs /dev/disk/by-id/SUSE-Example-B-part1
# mkfs.xfs /dev/disk/by-id/SUSE-Example-B-part2
# mkfs.xfs /dev/disk/by-id/SUSE-Example-B-part3</screen>
</example>
<itemizedlist>
<title>OS 또는 클러스터(선택 사항)를 사용하여 마운트하려면</title>
<listitem>
<para>valuga01: /dev/disk/by-id/SUSE-Example-B-part1 /hana</para>
</listitem>
<listitem>
<para>valuga01: /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D01</para>
</listitem>
<listitem>
<para>valuga01: /dev/disk/by-id/SUSE-Example-B-part3 /usr/sap/EN2/D02</para>
</listitem>
</itemizedlist>
<note>
<para>D01: NetWeaver 7.5 이후부터 기본 애플리케이션 서버 인스턴스 디렉토리의 이름이 'D&lt;Instance_Number&gt;'로 변경되었습니다.</para>
</note>
<itemizedlist>
<title>NFS 서버</title>
<listitem>
<para>192.168.1.1:/data/export/S4_HA_CLU_10/EN2/sapmnt /sapmnt</para>
</listitem>
<listitem>
<para>192.168.1.1:/data/export/S4_HA_CLU_10/EN2/SYS /usr/sap/EN2/SYS</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>미디어</title>
<listitem>
<para>192.168.1.1:/Landscape /var/lib/Landscape</para>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="id-ip-addresses-and-virtual-names">
<title>IP 주소 및 가상 이름</title>
<para><emphasis>/etc/hosts</emphasis> 파일에 다음 주소 확인 중 하나 이상이 포함되었는지 확인하십시오. 없는 경우 해당 항목을 추가하십시오.</para>
<screen>192.168.1.100  valuga01
192.168.1.103  valuga11
192.168.1.104  valuga12

192.168.1.112  sapen2as
192.168.1.113  sapen2er
192.168.1.114  sapen2db
192.168.1.110  sapen2d1
192.168.1.111  sapen2d2</screen>
</section>
<section xml:id="id-mount-points-and-nfs-shares">
<title>마운트 지점 및 NFS 공유</title>
<para>현재 설정에서는 <emphasis>/usr/sap</emphasis> 디렉토리가 루트 파일 시스템의 일부입니다. 또한, 해당 영역을 위한 전용 파일 시스템을 생성하고 시스템 부팅 중에 <emphasis>/usr/sap</emphasis>를 마운트할 수도 있습니다. <emphasis>/usr/sap</emphasis>에는 SAP 제어 파일 <emphasis>sapservices</emphasis> 및 <emphasis role="strong">saphostagent</emphasis>가 있으므로, 이 디렉토리가 클러스터 노드 사이의 공유 파일 시스템에 위치해서는 안 됩니다.</para>
<para>SAP 리소스를 실행해야 하는 모든 노드에 디렉토리 구조를 생성해야 합니다. SYS 디렉토리는 모든 노드에 대한 NFS 공유에 있게 됩니다.</para>
<itemizedlist>
<listitem>
<para>마운트 지점을 생성하고 모든 노드에 NFS 공유를 마운트합니다.</para>
</listitem>
</itemizedlist>
<example>
<title>모든 노드에 NFS 공유 마운트</title>
<screen># mkdir -p /sapmnt /var/lib/Landscape
# mkdir -p /usr/sap/EN2/{ASCS00,D01,D02,ERS10,SYS}
# mount -t nfs 192.168.1.1:/data/export/S4_HA_CLU_10/EN2/sapmnt    /sapmnt
# mount -t nfs 192.168.1.1:/data/export/S4_HA_CLU_10/EN2/SYS /usr/sap/EN2/SYS
# mount -t nfs 192.168.1.1:/Landscape /var/lib/Landscape</screen>
</example>
<itemizedlist>
<listitem>
<para>HANA의 경우: valuga01에 데이터베이스용 마운트 지점 생성:</para>
</listitem>
</itemizedlist>
<screen># mkdir /hana
# mount /dev/disk/by-id/SUSE-Example-B-part1 /hana/
# mkdir -p /hana/{shared,data,log}
# mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D01
# mount /dev/disk/by-id/SUSE-Example-B-part3 /usr/sap/EN2/D02</screen>
<para>현재 설정에서는 클러스터를 통해 NFS 공유를 제어하지 않습니다. 그러므로 이러한 파일 시스템을 <emphasis>/etc/fstab</emphasis>에 추가하여 다음 시스템 부팅 중에 파일 시스템을 마운트해야 합니다.</para>
<figure>
<title>NFS 공유 포함 파일 시스템 레이아웃</title>
<mediaobject>
<imageobject>
<imagedata fileref="sles4sap_ap1809_fs.svg" width=""/>
</imageobject>
<textobject><phrase>SVG</phrase></textobject>
</mediaobject>
</figure>
<para>SAP 분산 설치용 서버 3개를 준비합니다. 서버 1(valuga01)은 SAP HANA 데이터베이스를 설치하기 위해 사용됩니다. 서버 1(valuga01)은 PAS SAP 인스턴스를 설치하기 위해 사용됩니다. 서버 1(valuga01)은 AAS SAP 인스턴스를 설치하기 위해 사용됩니다. 서버 2(valuga11)는 ASCS SAP 인스턴스를 설치하기 위해 사용됩니다. 서버 3(valuga12)은 ERS SAP 인스턴스를 설치하기 위해 사용됩니다.</para>
<itemizedlist>
<listitem>
<para>인스턴스 및 데이터베이스 파일 시스템을 특정 노드 1개에 마운트:</para>
</listitem>
</itemizedlist>
<example>
<title>SAP S/4HANA용 여러 파일 시스템을 서로 다른 노드에 마운트</title>
<screen>(ASCS   valuga11) # mount /dev/disk/by-id/SUSE-Example-A-part2 /usr/sap/EN2/ASCS00
(ERS    valuga12) # mount /dev/disk/by-id/SUSE-Example-A-part3 /usr/sap/EN2/ERS10
(DB     valuga01) # mount /dev/disk/by-id/SUSE-Example-B-part1 /hana/
(Dialog valuga01) # mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D01
(Dialog valuga01) # mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D02</screen>
</example>
<itemizedlist>
<listitem>
<para>그 결과, <emphasis>/usr/sap/EN2/</emphasis> 디렉토리는 다음과 같아야 합니다.</para>
</listitem>
</itemizedlist>
<screen># ls -la /usr/sap/EN2/
total 0
drwxr-xr-x 1 en2adm sapsys 70 28. Mar 17:26 ./
drwxr-xr-x 1 root   sapsys 58 28. Mar 16:49 ../
drwxr-xr-x 7 en2adm sapsys 58 28. Mar 16:49 ASCS00/
drwxr-xr-x 1 en2adm sapsys  0 28. Mar 15:59 D02/
drwxr-xr-x 1 en2adm sapsys  0 28. Mar 15:59 D01/
drwxr-xr-x 1 en2adm sapsys  0 28. Mar 15:59 ERS10/
drwxr-xr-x 5 en2adm sapsys 87 28. Mar 17:21 SYS/</screen>
<note>
<para>디렉토리 및 파일의 소유자는 SAP 설치 중에 변경됩니다. 기본적으로 모든 디렉토리 및 파일은 <emphasis>root</emphasis>의 소유입니다.</para>
</note>
</section>
</section>
<section xml:id="id-sap-installation">
<title>SAP 설치</title>
<para>SAP 분산 시스템을 설치하기 위한 전체 절차는 다음과 같습니다.</para>
<orderedlist numeration="arabic">
<title>작업</title>
<listitem>
<para>Linux 사용자 및 그룹 번호 체계 계획</para>
</listitem>
<listitem>
<para>중앙 서비스를 위한 ASCS 인스턴스 설치</para>
</listitem>
<listitem>
<para>복제된 인큐 시나리오를 가져오기 위해 ERS 설치</para>
</listitem>
<listitem>
<para>클러스터 인수를 위한 ASCS 및 ERS 설치 준비</para>
</listitem>
<listitem>
<para>데이터베이스 설치</para>
</listitem>
<listitem>
<para>기본 애플리케이션 서버 인스턴스(PAS) 설치</para>
</listitem>
<listitem>
<para>추가 애플리케이션 서버 인스턴스(AAS) 설치</para>
</listitem>
</orderedlist>
<para>결과적으로 SAP 분산 설치는 다음과 같습니다.</para>
<figure>
<title>SAP 시스템 분산 설치</title>
<mediaobject>
<imageobject>
<imagedata fileref="sles4sap_nw740_distInstall.svg" width=""/>
</imageobject>
<textobject><phrase>SVG</phrase></textobject>
</mediaobject>
</figure>
<section xml:id="id-linux-user-and-group-number-scheme">
<title>Linux 사용자 및 그룹 번호 체계</title>
<para>SAP 소프트웨어 프로비저닝 관리자(SWPM)가 사용할 Linux 사용자 ID 또는 그룹 ID를 요청할 때마다 다음 테이블을 예시로 참조하십시오.</para>
<screen>Group sapinst      1001
Group sapsys       1002
Group dbhshm       1003

User  en2adm       2001
User  sapadm       2002
User  dbhadm       2003</screen>
</section>
<section xml:id="id-installing-ascs-on-valuga11">
<title>valuga11에 ASCS 설치</title>
<para>설치 프로그램이 확인 및 사용할 수 있어야 하므로 나중에 클러스터에서 사용할 서비스 IP 주소를 일시적으로 로컬 IP 주소로 설정합니다. 각 설치 단계에서 올바른 가상 호스트 이름을 사용하는지 확인합니다. 해당하는 경우, <emphasis>/dev/disk/by-id/SUSE-Example-A-part2</emphasis> 및 <emphasis>/var/lib/Landscape/</emphasis>와 같은 파일 시스템을 마운트합니다.</para>
<screen># ip a a 192.168.1.112/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-A-part2 /usr/sap/EN2/ASCS00
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2as</screen>
<itemizedlist>
<listitem>
<para>SWPM 제품 설치 경로:</para>
<itemizedlist>
<listitem>
<para>SAP S/4HANA Server 1809 설치 → SAP HANA DATABASE → 설치 → Application Server ABAP → 고가용성 시스템 → ASCS 인스턴스</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>SID EN2 사용</para>
</listitem>
<listitem>
<para>인스턴스 번호 00 사용</para>
</listitem>
<listitem>
<para>FQDN을 사용하여 선택 취소</para>
</listitem>
<listitem>
<para>모든 비밀번호: &lt;use-your-secure-pwd&gt; 사용</para>
</listitem>
<listitem>
<para>파라미터 검토 중에 가상 이름 <emphasis role="strong">sapen2as</emphasis>가 사용되는지 재확인</para>
</listitem>
<listitem>
<para>설치 중에 권한과 관련한 오류가 발생하면 ASCS 디렉토리의 소유권 변경</para>
</listitem>
</itemizedlist>
<screen># chown -R en2adm:sapsys /usr/sap/EN2/ASCS00</screen>
</section>
<section xml:id="id-installing-ers-on-valuga12">
<title>valuga12에 ERS 설치</title>
<para>설치 프로그램이 확인 및 사용할 수 있어야 하므로 나중에 클러스터에서 사용할 서비스 IP 주소를 일시적으로 로컬 IP 주소로 설정합니다. 각 설치 단계에서 올바른 가상 호스트 이름을 사용하는지 확인합니다.</para>
<screen># ip a a 192.168.1.113/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-A-part3 /usr/sap/EN2/ERS10
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2er</screen>
<itemizedlist>
<listitem>
<para>SWPM 제품 설치 경로:</para>
<itemizedlist>
<listitem>
<para>SAP S/4HANA Server 1809 설치 → SAP HANA DATABASE → 설치 → Application Server ABAP → 고가용성 시스템 → ERS 인스턴스</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>인스턴스 번호 10 사용</para>
</listitem>
<listitem>
<para>FQDN을 사용하여 선택 취소</para>
</listitem>
<listitem>
<para>파라미터 검토 중에 가상 이름 <emphasis role="strong">sapen2er</emphasis>이 사용되는지 재확인</para>
</listitem>
<listitem>
<para>설치 중에 권한과 관련한 오류가 발생하면 ERS 디렉토리의 소유권 변경</para>
</listitem>
</itemizedlist>
<screen># chown -R en2adm:sapsys /usr/sap/EN2/ERS10</screen>
<itemizedlist>
<listitem>
<para>ASCS 인스턴스를 수동으로 중지/시작하라는 메시지가 표시되면 en2adm 사용자로 valuga11에 로그인하고 'sapcontrol'을 호출합니다.</para>
</listitem>
</itemizedlist>
<screen># sapcontrol -nr 00 -function Stop    # to stop the ASCS
# sapcontrol -nr 00 -function Start   # to start the ASCS</screen>
</section>
<section xml:id="id-subsequent-steps-for-ascs-and-ers">
<title>ASCS 및 ERS의 후속 단계</title>
<para>설치 후에는 ASCS 및 ERS 인스턴스에서 여러 후속 단계를 수행할 수 있습니다.</para>
<section xml:id="id-stopping-ascs-and-ers">
<title>ASCS 및 ERS 중지</title>
<para>ASCS 및 ERS 인스턴스를 중지하려면 아래 명령을 사용합니다. <emphasis>valuga11</emphasis>에서 다음을 수행합니다.</para>
<screen># su - en2adm
# sapcontrol -nr 00 -function Stop
# sapcontrol -nr 00 -function StopService</screen>
<para><emphasis>valuga12</emphasis>에서 다음을 수행합니다.</para>
<screen># su - en2adm
# sapcontrol -nr 10 -function Stop
# sapcontrol -nr 10 -function StopService</screen>
</section>
<section xml:id="id-maintaining-sapservices">
<title>sapservices 관리</title>
<para>두 클러스터 노드 모두에서 <emphasis>/usr/sap/sapservices</emphasis>에 두 항목(ASCS 및 ERS)이 모두 있는지 확인합니다. 이를 통해 <emphasis role="strong">sapstartsrv</emphasis> 클라이언트가 다음과 같이 서비스를 시작할 수 있습니다.</para>
<para><emphasis>en2adm</emphasis> 사용자로 다음 명령 입력:</para>
<screen># sapcontrol -nr 10 -function StartService EN2</screen>
<para><emphasis>/usr/sap/sapservices</emphasis> 파일은 다음과 같이 표시됩니다. 일반적으로 인스턴스당 라인 1개가 표시됩니다.</para>
<screen>#!/bin/sh
LD_LIBRARY_PATH=/usr/sap/EN2/ASCS00/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH; /usr/sap/EN2/ASCS00/exe/sapstartsrv pf=/usr/sap/EN2/SYS/profile/EN2_ASCS00_sapen2as -D -u en2adm
LD_LIBRARY_PATH=/usr/sap/EN2/ERS10/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH; /usr/sap/EN2/ERS10/exe/sapstartsrv pf=/usr/sap/EN2/ERS10/profile/EN2_ERS10_sapen2er -D -u en2adm</screen>
<para>항목이 없으면 <emphasis role="strong">pf=</emphasis>&lt;profile-of-the-sap-instance&gt; 및 <emphasis role="strong">-reg</emphasis> 옵션으로 sapstartsrv를 사용하여 등록할 수 있습니다.</para>
<screen># LD_LIBRARY_PATH=/usr/sap/hostctrl/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH
# /usr/sap/hostctrl/exe/sapstartsrv \
 pf=/usr/sap/&lt;SID&gt;/SYS/profile/&lt;SID&gt;_ERS&lt;instanceNumberErs&gt;_&lt;virtHostNameErs&gt; \
 -reg
# /usr/sap/hostctrl/exe/sapstartsrv \
 pf=/usr/sap/&lt;SID&gt;/SYS/profile/&lt;SID&gt;_ASCS&lt;instanceNumberAscs&gt;_&lt;virtHostNameAscs&gt; \
 -reg</screen>
</section>
<section xml:id="id-integrating-the-cluster-framework-using-sap-suse-cluster-connector">
<title>sap-suse-cluster-connector를 사용하여 클러스터 프레임워크 통합</title>
<para>SUSE 리포지토리에서 <emphasis role="strong">sap-suse-cluster-connector</emphasis> 패키지 버전 3.1.0 설치:</para>
<screen># zypper in sap-suse-cluster-connector</screen>
<note>
<para><emphasis role="strong">sap-suse-cluster-connector</emphasis> 패키지에는 3.x.x 버전(SAP API 3)이 포함되어 있습니다. <emphasis role="strong">sap-suse-cluster-connector</emphasis> 패키지의 3.0.x 버전은 SUSE SAP API 버전 3을 구현합니다. SAP RKS(Rolling Kernel Switch) 및 ASCS 마이그레이션 등의 새로운 기능은 이 새 버전에서만 지원됩니다. <emphasis role="strong">sap-suse-cluster-connector</emphasis> 패키지의 버전 3.1.x는 SAP 도구에서 트리거된 클러스터 리소스의 유지보수 모드도 지원합니다.</para>
</note>
<para>ERS 및 ASCS 인스턴스의 경우, <emphasis>/usr/sap/EN2/SYS/profile/</emphasis> 프로파일 디렉토리에서 EN2_ASCS00_sapen2as 및 EN2_ERS10_sapen2er 인스턴스 프로파일을 편집합니다.</para>
<para><emphasis role="strong">sapstartsrv</emphasis> 서비스에 HA 스크립트 커넥터 라이브러리를 로드하고 <emphasis role="strong">sap-suse-cluster-connector</emphasis> 커넥터를 사용하도록 명령합니다.</para>
<screen>service/halib = $(DIR_CT_RUN)/saphascriptco.so
service/halib_cluster_connector = /usr/bin/sap_suse_cluster_connector</screen>
<para><emphasis>en2adm</emphasis> 사용자를 unix 사용자 그룹 <emphasis>haclient</emphasis>에 추가합니다.</para>
<screen># usermod -a -G haclient en2adm</screen>
</section>
<section xml:id="id-adapting-sap-profiles-to-match-the-sap-s4-ha-clu-1-0-certification">
<title>SAP 프로파일을 조정하여 SAP S/4-HA-CLU 1.0 인증 일치</title>
<para>ASCS 인스턴스의 경우, 인큐 서버(Enqueue Server 2)에 대한 시작 명령을 <emphasis>Restart_Program_xx</emphasis>에서 <emphasis>Start_Program_xx</emphasis>로 변경합니다. 이렇게 하면 SAP 시작 프레임워크가 인큐 프로세스를 자체적으로 다시 시작하지 <emphasis role="strong">않습니다 </emphasis>. 이러한 재시작은 잠금 손실을 초래합니다.</para>
<para>파일 <emphasis role="strong">/usr/sap/EN2/SYS/profile/EN2_ASCS00_sapen2as</emphasis></para>
<screen>Start_Program_01 = local $(_ENQ) pf=$(_PF)</screen>
<para>선택 사항으로 서비스 재시작 횟수를 제한할 수 있습니다(ASCS의 경우, 이로 인해 메시지 서버의 재시작이 제한됨).</para>
<para>ERS 인스턴스의 경우, 인큐 복제 서버(Enqueue Replicator 2)에 대한 시작 명령을 <emphasis>Restart_Program_xx</emphasis>에서 <emphasis>Start_Program_xx</emphasis>로 변경합니다.</para>
<para>파일 <emphasis role="strong">/usr/sap/EN2/SYS/profile/EN2_ERS10_sapen2er</emphasis></para>
<screen>Start_Program_00 = local $(_ENQR) pf=$(_PF) NR=$(SCSID)</screen>
</section>
<section xml:id="id-starting-ascs-and-ers">
<title>ASCS 및 ERS 시작</title>
<para>ASCS 및 ERS 인스턴스를 시작하려면 아래 명령을 사용합니다.</para>
<para><emphasis>valuga11</emphasis>에서 다음을 수행합니다.</para>
<screen># su - en2adm
# sapcontrol -nr 00 -function StartService EN2
# sapcontrol -nr 00 -function Start</screen>
<para><emphasis>valuga12</emphasis>에서 다음을 수행합니다.</para>
<screen># su - en2adm
# sapcontrol -nr 10 -function StartService EN2
# sapcontrol -nr 10 -function Start</screen>
</section>
</section>
<section xml:id="id-installing-database-on-valuga01">
<title>valuga01에 데이터베이스 설치</title>
<para>HANA DB의 HW 요구 사항은 매우 엄격합니다. 저장소 크기 조정은 여러 지표에 따라 달라집니다. <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html">SAP HANA 하드웨어 디렉토리</link> 및 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html">SAP HANA TDI</link>에서 지원되는 구성을 확인하십시오.</para>
<screen># ip a a 192.168.1.114/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-B-part1 /hana
# mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D01
# mount /dev/disk/by-id/SUSE-Example-B-part3 /usr/sap/EN2/D02
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2db</screen>
<itemizedlist>
<listitem>
<para>SWPM 제품 설치 경로:</para>
<itemizedlist>
<listitem>
<para>SAP S/4HANA Server 1809 설치 → SAP HANA DATABASE → 설치 → Application Server ABAP → 고가용성 시스템 → 데이터베이스 인스턴스</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>프로파일 디렉토리 /sapmnt/EN2/profile</para>
</listitem>
<listitem>
<para>FQDN을 사용하여 선택 취소</para>
</listitem>
<listitem>
<para>데이터베이스 파라미터: Database ID(DBSID)는 DBH, 데이터베이스 호스트는 sapen2db, 인스턴스 번호는 00</para>
</listitem>
<listitem>
<para>데이터베이스 시스템 ID 입력 인스턴스 번호는 00, SAP 마운트 디렉토리는 /sapmnt/EN2/profile</para>
</listitem>
<listitem>
<para>계정 파라미터: 사용자 지정 값이 필요한 경우 변경</para>
</listitem>
<listitem>
<para>정리: <emphasis role="strong">예</emphasis>를 선택하고 <literal>sapinst</literal> 그룹에서 운영 체제 사용자 제거</para>
</listitem>
<listitem>
<para>파라미터 검토 중에 가상 이름 <emphasis role="strong">sapen2db</emphasis>이 사용되는지 재확인</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-install-the-primary-application-server-pas-on-valuga01">
<title>valuga01에 기본 애플리케이션 서버(PAS) 설치</title>
<screen># ip a a 192.168.1.110/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D01
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2d1</screen>
<itemizedlist>
<listitem>
<para>SWPM 제품 설치 경로:</para>
<itemizedlist>
<listitem>
<para>SAP S/4HANA Server 1809 설치 → SAP HANA DATABASE → 설치 → Application Server ABAP → 고가용성 시스템 → 기본 애플리케이션 서버 인스턴스</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>인스턴스 번호 01 사용</para>
</listitem>
<listitem>
<para>FQDN을 사용하여 선택 취소</para>
</listitem>
<listitem>
<para>이 예시 설정에서는 기본 보안 스토어 키가 사용됨</para>
</listitem>
<listitem>
<para>Diagnostic Agent를 설치하지 않음</para>
</listitem>
<listitem>
<para>SLD 없음</para>
</listitem>
<listitem>
<para>파라미터 검토 중에 가상 이름 <emphasis role="strong">sapen2d1</emphasis>이 사용되는지 재확인</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-installing-an-additional-application-server-aas-on-valuga01">
<title>valuga01에 추가 애플리케이션 서버(AAS) 설치</title>
<screen># ip a a 192.168.1.111/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-B-part3 /usr/sap/EN2/D02
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2d2</screen>
<itemizedlist>
<listitem>
<para>SWPM 제품 설치 경로:</para>
<itemizedlist>
<listitem>
<para>SAP S/4HANA Server 1809 설치 → SAP HANA DATABASE → 설치 → Application Server ABAP → 고가용성 시스템 → 추가 애플리케이션 서버 인스턴스</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>인스턴스 번호 02 사용</para>
</listitem>
<listitem>
<para>FQDN을 사용하여 선택 취소</para>
</listitem>
<listitem>
<para>Diagnostic Agent를 설치하지 않음</para>
</listitem>
<listitem>
<para>파라미터 검토 중에 가상 이름 <emphasis role="strong">sapen2d2</emphasis>가 사용되는지 재확인</para>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="id-implementing-the-cluster">
<title>클러스터 구현</title>
<para>클러스터를 구현하기 위한 주요 절차는 다음과 같습니다.</para>
<orderedlist numeration="arabic">
<title>작업</title>
<listitem>
<para>OS 준비 및 클러스터 소프트웨어 설치</para>
</listitem>
<listitem>
<para>corosync 및 리소스 관리자 등 클러스터 베이스 구성</para>
</listitem>
<listitem>
<para>클러스터 리소스 구성</para>
</listitem>
<listitem>
<para>SBD를 위해 클러스터 타이밍 특별 조정</para>
</listitem>
</orderedlist>
<note>
<para>클러스터 설정을 계속 진행하기 전에 다음 동작 수행: 먼저 모든 SAP 인스턴스를 중지합니다. 그리고 클러스터 노드에서 (수동으로 추가한) IP 주소를 제거합니다. 마지막으로 나중에 클러스터에서 제어할 파일 시스템의 마운트를 해제합니다.</para>
</note>
<note>
<para>SBD 장치/파티션을 사전에 생성해야 합니다. 사용할 장치/파티션을 재확인하십시오! 이 설정 가이드에서는 <emphasis>/dev/disk/by-id/SUSE-Example-A-part1</emphasis> 파티션이 SBD에 사용하도록 이미 예약되어 있습니다.</para>
</note>
<section xml:id="id-os-preparation-and-cluster-software-installation">
<title>OS 준비 및 클러스터 소프트웨어 설치</title>
<itemizedlist>
<listitem>
<para><emphasis role="strong">chrony</emphasis>를 설정하고 <emphasis role="strong">yast2</emphasis>로 활성화합니다.</para>
</listitem>
<listitem>
<para>RPM 패턴 <emphasis role="strong">ha_sles</emphasis>를 양쪽 클러스터 노드에 설치합니다.</para>
<screen># zypper in -t pattern ha_sles</screen>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-configuring-the-cluster-base">
<title>클러스터 베이스 구성</title>
<itemizedlist>
<title>작업</title>
<listitem>
<para>YaST 또는 대화식 명령줄 도구 <emphasis role="strong">ha-cluster-init</emphasis>을 사용하여 클러스터 베이스를 구성할 수 있습니다. 아래 예시에서는 명령줄 마법사를 사용합니다.</para>
</listitem>
<listitem>
<para>첫 번째 시스템에 watchdog 장치를 설치 및 구성합니다.</para>
</listitem>
</itemizedlist>
<para>소프트웨어 기반 솔루션을 배포하는 대신, 하드웨어 기반 watchdog 장치를 사용하는 것이 좋습니다. 다음 예시에서는 소프트웨어 장치가 사용되지만 하드웨어 장치로 편리하게 조정할 수 있습니다.</para>
<screen># modprobe softdog
# echo softdog &gt; /etc/modules-load.d/watchdog.conf
# systemctl restart systemd-modules-load
# lsmod | egrep "(wd|dog|i6|iT|ibm)"</screen>
<itemizedlist>
<listitem>
<para>첫 번째 시스템에 클러스터 스택 설치 및 구성</para>
</listitem>
</itemizedlist>
<screen># ha-cluster-init -u -s  /dev/disk/by-id/SUSE-Example-A-part1</screen>
<itemizedlist>
<listitem>
<para>두 번째 노드 조인</para>
</listitem>
</itemizedlist>
<para>두 번째 노드에서 준비 단계를 일부 수행합니다.</para>
<screen># modprobe softdog
# echo softdog &gt; /etc/modules-load.d/watchdog.conf
# systemctl restart systemd-modules-load
# lsmod | egrep "(wd|dog|i6|iT|ibm)"</screen>
<para>YaST 또는 대화식 명령줄 도구 <emphasis role="strong">ha-cluster-join</emphasis>을 사용하여 클러스터 베이스를 구성할 수 있습니다. 아래 예시에서는 명령줄 마법사를 사용합니다.</para>
<screen># ha-cluster-join -c valuga11</screen>
<itemizedlist>
<listitem>
<para><emphasis>crm_mon -1r</emphasis> 출력은 다음과 같아야 합니다.</para>
</listitem>
</itemizedlist>
<screen>Stack: corosync
Current DC: valuga11 (version 1.1.18+20180430.b12c320f5-1.14-b12c320f5) - partition with quorum
Last updated: Mon Jan 28 13:10:37 2019
Last change: Wed Jan 23 09:52:57 2019 by root via cibadmin on valuga11

2 nodes configured
1 resource configured

Online: [ valuga11 valuga12 ]

stonith-sbd     (stonith:external/sbd): Started valuga11</screen>
</section>
<section xml:id="id-configuring-cluster-resources">
<title>클러스터 리소스 구성</title>
<para>SAP S/4HANA에서 더 이상 마스터-슬레이브 구조를 사용하지 <emphasis role="strong">않으려면</emphasis> 변경된 SAPInstance 리소스 구성이 필요합니다. 클러스터와 더 유사한 구조로 바꿔서 전체 마스터-슬레이브가 <emphasis role="strong">아닌</emphasis> ASCS 및 ERS 인스턴스 자체를 시작 및 중지하십시오.</para>
<para>새 ENSA2 버전에서는 동일한 호스트에서 ASCS 인스턴스를 시작할 수 있습니다. 더 이상 ERS 인스턴스를 따를 필요가 없습니다. ERS 인스턴스에서 네트워크를 통해 ASCS 인스턴스로 인큐 잠금 테이블이 전달됩니다. 다른 노드를 사용할 수 없는 경우에는 ERS 인스턴스가 실행 중인 동일한 호스트에서 ASCS 인스턴스가 시작됩니다.</para>
<figure>
<title>리소스 및 제약 조건</title>
<mediaobject>
<imageobject>
<imagedata fileref="sles4sap_s4hana1809_resources.svg" width=""/>
</imageobject>
<textobject><phrase>SVG</phrase></textobject>
</mediaobject>
</figure>
<para>이러한 개념의 또다른 장점은 SAP 인스턴스 디렉토리에서 공유 (NFS) 파일 시스템이 아닌 네이티브 (마운트 가능) 파일 시스템을 사용할 수 있다는 것입니다.</para>
<section xml:id="id-preparing-the-cluster-for-adding-the-resources">
<title>리소스를 추가할 수 있도록 클러스터 준비</title>
<para>클러스터가 부분 정의 리소스를 시작하지 않도록 하려면 클러스터를 유지보수 모드로 설정합니다. 이렇게 하면 모든 모니터링 작업이 비활성화됩니다.</para>
<para><emphasis>root</emphasis> 사용자로 다음 명령 입력:</para>
<screen># crm configure property maintenance-mode="true"</screen>
</section>
<section xml:id="id-configuring-the-resources-for-the-ascs-instance">
<title>ASCS 인스턴스용 리소스 구성</title>
<para>먼저, 파일 시스템, IP 주소 및 SAP 인스턴스를 위한 리소스를 구성합니다. 특정 환경에 따라 파라미터를 조정해야 합니다.</para>
<example>
<title>ASCS 기본</title>
<screen>primitive rsc_fs_EN2_ASCS00 Filesystem \
  params device="/dev/disk/by-id/SUSE-Example-A-part2" directory="/usr/sap/EN2/ASCS00" \
         fstype=xfs \
  op start timeout=60s interval=0 \
  op stop timeout=60s interval=0 \
  op monitor interval=20s timeout=40s
primitive rsc_ip_EN2_ASCS00 IPaddr2 \
  params ip=192.168.1.112 \
  op monitor interval=10s timeout=20s
primitive rsc_sap_EN2_ASCS00 SAPInstance \
  operations $id=rsc_sap_EN2_ASCS00-operations \
  op monitor interval=11 timeout=60 on-fail=restart \
  params InstanceName=EN2_ASCS00_sapen2as \
     START_PROFILE="/usr/sap/EN2/SYS/profile/EN2_ASCS00_sapen2as" \
     AUTOMATIC_RECOVER=false \
  meta resource-stickiness=5000</screen>
</example>
<example>
<title>ASCS 그룹</title>
<screen>group grp_EN2_ASCS00 \
  rsc_ip_EN2_ASCS00 rsc_fs_EN2_ASCS00 rsc_sap_EN2_ASCS00 \
        meta resource-stickiness=3000</screen>
</example>
<para>원하는 텍스트 편집기를 사용하여 <emphasis>txt</emphasis> 파일(예: <emphasis>crm_ascs.txt</emphasis>)을 생성합니다. 이 파일에 예시 2개(기본 및 그룹)를 추가하고 구성을 클러스터 관리자 구성에 로드합니다.</para>
<para><emphasis>root</emphasis> 사용자로 다음 명령 입력:</para>
<screen># crm configure load update crm_ascs.txt</screen>
</section>
<section xml:id="id-configuring-the-resources-for-the-ers-instance">
<title>ERS 인스턴스용 리소스 구성</title>
<para>두 번째로, 파일 시스템, IP 주소 및 SAP 인스턴스를 위한 리소스를 구성합니다. 특정 환경에 따라 파라미터를 조정해야 합니다.</para>
<para>특정 파라미터 <emphasis>IS_ERS=true</emphasis>는 ERS 인스턴스에 대해서만 설정해야 합니다.</para>
<example>
<title>ERS 기본</title>
<screen>primitive rsc_fs_EN2_ERS10 Filesystem \
  params device="/dev/disk/by-id/SUSE-Example-A-part3" directory="/usr/sap/EN2/ERS10" fstype=xfs \
  op start timeout=60s interval=0 \
  op stop timeout=60s interval=0 \
  op monitor interval=20s timeout=40s
primitive rsc_ip_EN2_ERS10 IPaddr2 \
  params ip=192.168.1.113 \
  op monitor interval=10s timeout=20s
primitive rsc_sap_EN2_ERS10 SAPInstance \
  operations $id=rsc_sap_EN2_ERS10-operations \
  op monitor interval=11 timeout=60 on-fail=restart \
  params InstanceName=EN2_ERS10_sapen2er \
         START_PROFILE="/usr/sap/EN2/SYS/profile/EN2_ERS10_sapen2er" \
         AUTOMATIC_RECOVER=false IS_ERS=true</screen>
</example>
<example>
<title>ERS 그룹</title>
<screen>group grp_EN2_ERS10 \
  rsc_ip_EN2_ERS10 rsc_fs_EN2_ERS10 rsc_sap_EN2_ERS10</screen>
</example>
<para>원하는 텍스트 편집기를 사용하여 <emphasis>txt</emphasis> 파일(예: <emphasis>crm_ers.txt</emphasis>)을 생성합니다. 이 파일에 예시 2개(기본 및 그룹)를 추가하고 구성을 클러스터 관리자 구성에 로드합니다.</para>
<para><emphasis>root 사용자로</emphasis></para>
<screen># crm configure load update crm_ers.txt</screen>
</section>
<section xml:id="id-configuring-the-colocation-constraints-between-ascs-and-ers">
<title>ASCS와 ERS 간 코로케이션 제약 조건 구성</title>
<para>ENSA1 구성과 비교하여, ASCS와 ERS 인스턴스 사이의 제약 조건이 변경되었습니다. 다른 노드를 사용할 수 있는 경우 ASCS 인스턴스는 ERS 인스턴스를 실행 중인 클러스터 노드에서 시작하지 않아야 합니다. 현재 ENSA2 설정은 네트워크 상에서 잠금 테이블을 재동기화할 수 있습니다.</para>
<para>ASCS 인스턴스가 ERS 노드 상의 클러스터에 의해 시작되었으면 ERS 인스턴스를 다른 클러스터 노드(col_sap_EN2_no_both)로 이동해야 합니다. 이 제약 사항은 ERS 인스턴스가 잠금을 다시 재동기화하여 추가적인 인수에 클러스터를 사용할 수 있도록 하기 위해 필요합니다.</para>
<example>
<title>위치 제약 조건</title>
<screen>colocation col_sap_EN2_no_both -5000: grp_EN2_ERS10 grp_EN2_ASCS00
order ord_sap_EN2_first_start_ascs Optional: rsc_sap_EN2_ASCS00:start \
      rsc_sap_EN2_ERS10:stop symmetrical=false</screen>
</example>
<para>텍스트 편집기를 사용하여 <emphasis>txt</emphasis> 파일(예: <emphasis>crm_col.txt</emphasis>)을 생성합니다. 이 파일에 두 제약 조건을 추가하고 구성을 클러스터 관리자 구성에 로드합니다.</para>
<para><emphasis>root</emphasis> 사용자로 다음 명령 입력:</para>
<screen># crm configure load update crm_col.txt</screen>
</section>
<section xml:id="id-activating-the-cluster">
<title>클러스터 활성화</title>
<para>마지막 단계는 클러스터 유지보수 모드를 종료하고 클러스터가 이미 실행 중인 리소스를 감지하도록 허용하는 것입니다.</para>
<para><emphasis>root</emphasis> 사용자로 다음 명령 입력:</para>
<screen># crm configure property maintenance-mode="false"</screen>
</section>
</section>
</section>
<section xml:id="id-administration">
<title>관리</title>
<section xml:id="id-dos-and-donts">
<title>권장 작업 및 금지 작업</title>
<note>
<para>각 테스트를 수행하기 전, 클러스터가 유휴 상태이고 마이그레이션 제약 조건이 활성화되지 않았으며 리소스 오류 메시지가 표시되지 않았는지 확인합니다. 클린 설정으로 각 절차를 시작합니다.</para>
</note>
<section xml:id="id-migrating-the-ascs-instance">
<title>ASCS 인스턴스 마이그레이션</title>
<para>ASCS SAP 인스턴스를 <emphasis role="strong">마이그레이션</emphasis>하려면, SAP 관리 콘솔 등 SAP 도구를 사용해야 합니다. 이를 통해 <emphasis role="strong">sapstartsrv</emphasis>를 트리거하고 sap-suse-cluster-connector를 사용하여 ASCS 인스턴스를 마이그레이션할 수 있습니다. <emphasis>en2adm</emphasis> 사용자로 아래 명령을 실행하여 ASCS를 마이그레이션할 수 있습니다. 이 작업을 수행하면 항상 ASCS가 ERS 측으로 마이그레이션되고 SAP 인큐 잠금이 유지됩니다.</para>
<para><emphasis>en2adm</emphasis> 사용자로 다음 명령 입력:</para>
<screen># sapcontrol -nr 00 -function HAFailoverToNode ""</screen>
</section>
<section xml:id="id-never-block-resources">
<title>리소스 차단 금지</title>
<para>SAP S/4-HA-CLU 1.0에서는 <emphasis role="strong">더 이상 리소스의 수동 제어를 차단할 수 없습니다</emphasis>. 즉, 더 이상 <emphasis>/etc/sap_suse_cluster_connector</emphasis>에서 <emphasis>BLOCK_RESOURCES</emphasis> 변수를 사용할 수 없습니다.</para>
</section>
<section xml:id="id-always-use-unique-instance-numbers">
<title>항상 고유 인스턴스 번호 사용</title>
<para>현재 클러스터로 제어되는 모든 SAP <emphasis role="strong">인스턴스 번호는 고유해야 합니다</emphasis>. D00처럼 서로 다른 시스템에서 실행되는 여러 dialog 인스턴스가 필요한 경우, 인스턴스가 클러스터에 의해 제어되지 않아야 합니다.</para>
</section>
<section xml:id="id-setting-the-cluster-to-maintenance-mode">
<title>클러스터를 유지보수 모드로 설정</title>
<para>클러스터를 유지보수 모드로 설정하는 절차는 <emphasis>root</emphasis> 또는 <emphasis>sidadm</emphasis> 사용자로 수행할 수 있습니다.</para>
<para><emphasis>root</emphasis> 사용자로 다음 명령 입력:</para>
<screen># crm configure property maintenance-mode="true"</screen>
<para><emphasis>en2adm</emphasis> 사용자로 다음 명령 입력(전체 경로가 필요함):</para>
<screen># /usr/sbin/crm configure property maintenance-mode="true"</screen>
</section>
<section xml:id="id-stopping-the-cluster-maintenance">
<title>클러스터 유지보수 중지</title>
<para>클러스터의 유지보수 모드를 종료하는 절차는 <emphasis>root</emphasis> 사용자로 수행할 수 있습니다. 다음 명령 입력:</para>
<screen># crm configure property maintenance-mode="false"</screen>
</section>
<section xml:id="id-starting-the-resource-maintenance-mode">
<title>리소스 유지보수 모드 시작</title>
<para>리소스 유지보수 모드를 시작하는 절차는 <emphasis>en2adm</emphasis> 사용자로 수행할 수 있습니다. 이 작업을 수행하면 ASCS 및 ERS 클러스터 리소스가 <emphasis role="strong">비관리</emphasis>로 설정됩니다.</para>
<para><emphasis>en2adm</emphasis> 사용자로 다음 명령 입력:</para>
<screen># sapcontrol -nr 00 -function HASetMaintenanceMode 1</screen>
</section>
<section xml:id="id-stopping-the-resource-maintenance-mode">
<title>리소스 유지보수 모드 중지</title>
<para>리소스 유지보수 모드를 종료하는 절차는 <emphasis>en2adm</emphasis> 사용자로 수행할 수 있습니다. 이 작업을 수행하면 ASCS 및 ERS 클러스터 리소스가 <emphasis role="strong">관리</emphasis>로 설정됩니다.</para>
<para><emphasis>en2adm</emphasis> 사용자로 다음 명령 입력:</para>
<screen># sapcontrol -nr 00 -function HASetMaintenanceMode 0</screen>
</section>
<section xml:id="id-cleaning-up-resources">
<title>리소스 정리</title>
<para><emphasis role="strong">리소스 오류를 정리</emphasis>할 수도 있습니다. ASCS 오류는 자동으로 삭제되어 설정된 시간 이후에 장애 복구가 수행됩니다. 기타 모든 리소스의 경우 오류를 포함한 상태를 정리할 수 있습니다.</para>
<para><emphasis>root</emphasis> 사용자로 다음 명령 입력:</para>
<screen># crm resource cleanup RESOURCE-NAME</screen>
</section>
</section>
<section xml:id="id-testing-the-cluster">
<title>클러스터 테스트</title>
<para>클러스터로 실제 운영을 진행하기 전에 최소한 다음 테스트를 수행하기를 강력히 권장합니다.</para>
<section xml:id="id-checking-product-names-with-hagetfailoverconfig">
<title>HAGetFailoverConfig를 사용하여 제품 이름 확인</title>
<para>SUSE 클러스터 솔루션의 이름이 <emphasis role="strong">sapcontrol</emphasis> 또는 SAP 관리 콘솔의 출력에 표시되는지 확인합니다. 이 테스트에서는 SAP NetWeaver 클러스터 통합의 상태를 확인합니다.</para>
<para><emphasis>en2adm</emphasis> 사용자로 다음 명령 입력:</para>
<screen># sapcontrol -nr 00 -function HAGetFailoverConfig</screen>
</section>
<section xml:id="id-running-sap-checks-using-hacheckconfig-and-hacheckfailoverconfig">
<title>HACheckConfig 및 HACheckFailoverConfig를 사용한 SAP 확인 실행</title>
<para>HA 구성 테스트를 통과하고 오류 메시지가 표시되지 않는지 확인합니다.</para>
<para><emphasis>en2adm</emphasis> 사용자로 다음 명령 입력:</para>
<screen># sapcontrol -nr 00 -function HACheckConfig
# sapcontrol -nr 00 -function HACheckFailoverConfig</screen>
</section>
<section xml:id="id-manually-migrating-ascs">
<title>ASCS 수동 마이그레이션</title>
<para>HA 도구를 사용한 ASCS 인스턴스 수동 마이그레이션이 원활하게 수행되는지 확인합니다.</para>
<para><emphasis>root</emphasis> 사용자로 다음 명령 실행:</para>
<screen># crm resource migrate rsc_sap_EN2_ASCS00 force
## wait until the ASCS is been migrated to the ERS host
# crm resource unmigrate rsc_sap_EN2_ASCS00</screen>
</section>
<section xml:id="id-migrating-ascs-using-hafailovertonode">
<title>HAFailoverToNode를 사용한 ASCS 마이그레이션</title>
<para>sapcontrol과 같은 SAP 도구를 사용한 ASCS 인스턴스 이동이 원활하게 수행되는지 확인합니다.</para>
<para><emphasis>en2adm</emphasis> 사용자로 다음 명령 입력:</para>
<screen># sapcontrol -nr 00 -function HAFailoverToNode ""</screen>
</section>
<section xml:id="id-test-ascs-migration-after-os-failure">
<title>OS 오류 이후 ASCS 마이그레이션 테스트</title>
<para>노드에서 오류가 발생한 후 ASCS 인스턴스가 올바르게 이동하는지 확인합니다. 이 테스트에서는 노드의 하드 재부팅이 즉시 트리거됩니다.</para>
<para><emphasis>root</emphasis> 사용자로 다음 명령 입력:</para>
<screen>## on the ASCS host
# echo b &gt;/proc/sysrq-trigger</screen>
</section>
<section xml:id="id-restarting-ascs-in-place-using-stop-and-start">
<title>중지 및 시작을 사용하여 제 위치에서 ASCS 다시 시작</title>
<para>SAP 리소스의 제 위치에서 다시 시작이 올바르게 처리되는지 확인합니다. SAP 인스턴스는 다른 노드로 장애 조치되지 않아야 하며, 중지했던 동일한 노드에서 시작해야 합니다.</para>
<para><emphasis>en2adm</emphasis> 사용자로 다음을 수행:</para>
<screen>## example for ASCS
# sapcontrol -nr 00 -function Stop
## wait till the ASCS is completely down
# sapcontrol -nr 00 -function Start</screen>
</section>
<section xml:id="id-automated-restart-of-the-ascs-instance-simulating-rolling-kernel-switch">
<title>ASCS 인스턴스의 자동 재시작(Rolling Kernel Switch 시뮬레이션)</title>
<para>다음 테스트에서는 클러스터 솔루션이 유지보수 절차 중 ASCS 인스턴스를 다시 시작하지 않는지 확인하는 합니다. 또한, RKS 절차 중 ASCS 인스턴스가 다시 시작되는 동안 잠금이 손실되지 않는지도 확인해야 합니다. 클러스터 솔루션은 ASCS 인스턴스의 재시작이 예상된 것이었는지를 인식해야 합니다. 장애 또는 오류는 보고되거나 계산되지 않아야 합니다.</para>
<para>선택 사항으로, 잠금을 설정하고 유지보수 절차 이후에도 존재하는지 확인할 수 있습니다. 이는 여러 가지 방법으로 수행할 수 있습니다. 한 가지 예시 테스트는 다음과 같이 수행할 수 있습니다.</para>
<orderedlist numeration="arabic">
<listitem>
<para>SAP 시스템에 로그인한 후 SU01 트랜잭션을 엽니다.</para>
</listitem>
<listitem>
<para>새 사용자를 만듭니다. 잠금을 확인할 트랜잭션을 종료하지 마십시오.</para>
</listitem>
<listitem>
<para>SAP MC/MMC를 사용하여 이용할 수 있는 잠금이 있는지 확인합니다.</para>
</listitem>
<listitem>
<para>ASCS 인스턴스 항목을 열고 <emphasis>인큐 잠금</emphasis>으로 이동합니다.</para>
</listitem>
<listitem>
<para>SM12 트랜잭션에서 잠금을 확인할 수도 있습니다.</para>
</listitem>
</orderedlist>
<para>짧은 시간 내에 이 테스트를 여러 번 수행합니다. 아래 예시에서는 ASCS 인스턴스가 5회 다시 시작됩니다.</para>
<para><emphasis>en2adm</emphasis> 사용자로 다음 스크립트를 생성하여 실행:</para>
<screen>$ cat ascs_restart.sh
#!/bin/bash
for lo in 1 2 3 4 5; do
  echo LOOP "$lo - Restart ASCS00"
  sapcontrol -host sapen2as -nr 00 -function StopWait 120 1
  sleep 1
  sapcontrol -host sapen2as -nr 00 -function StartWait 120 1
  sleep 1
done</screen>
<screen>$ bash ascs_restart.sh</screen>
</section>
<section xml:id="id-rolling-kernel-switch-procedure">
<title>Rolling Kernel Switch 절차</title>
<para>RKS(rolling kernel switch)는 시스템 중단 없이 ABAP 시스템의 커널을 교환할 수 있도록 해주는 자동화된 절차입니다. RKS 동안 시스템의 모든 인스턴스 및 일반적으로 모든 SAP 시작 서비스(sapstartsrv)가 다시 시작됩니다.</para>
<orderedlist numeration="arabic">
<listitem>
<para>SAP 노트 953653에서 새 커널 패치가 현재 실행 중인 커널과 호환되는 RKS인지를 확인하십시오.</para>
</listitem>
<listitem>
<para>SAP 노트 2077934 - HA 환경에서 Rolling kernel switch 확인</para>
</listitem>
<listitem>
<para>SAP 서비스 마켓 플레이스에서 새 커널을 다운로드합니다.</para>
</listitem>
<listitem>
<para>현재 중앙 커널 디렉토리를 백업합니다.</para>
</listitem>
<listitem>
<para>새 커널 아카이브를 중앙 커널 디렉토리로 추출합니다.</para>
</listitem>
<listitem>
<para>SAP MMC, 시스템 개요(SM51 트랜잭션) 또는 명령줄을 통해 RKS를 시작합니다.</para>
</listitem>
<listitem>
<para>SAP MC / MMC 또는 <emphasis role="strong">sapcontrol</emphasis>을 사용하여 SAP 인스턴스의 버전을 모니터링 및 확인합니다.</para>
</listitem>
</orderedlist>
<para><emphasis>en2adm</emphasis> 사용자로 다음 명령 입력:</para>
<screen>## sapcontrol [-user &lt;sidadm psw&gt;] -host &lt;host&gt; -nr &lt;INSTANCE_NR&gt; -function UpdateSystem 120 300 1
# sapcontrol -user en2adm &lt;use-your-secure-pwd&gt; -host sapen2as -nr 00 -function UpdateSystem 120 300 1
# sapcontrol -nr 00 -function GetSystemUpdateList -host sapen2as \
  -user en2adm &lt;use-your-secure-pwd&gt;
# sapcontrol -nr 00 -function GetVersionInfo -host sapen2as \
  -user en2adm &lt;use-your-secure-pwd&gt;
# sapcontrol -nr 10 -function GetVersionInfo -host sapen2er \
  -user en2adm &lt;use-your-secure-pwd&gt;
# sapcontrol -nr 01 -function GetVersionInfo -host sapen2d1 \
  -user en2adm &lt;use-your-secure-pwd&gt;
# sapcontrol -nr 02 -function GetVersionInfo -host sapen2d2 \
  -user en2adm &lt;use-your-secure-pwd&gt;</screen>
</section>
<section xml:id="id-additional-tests">
<title>추가 테스트</title>
<para>이미 수행한 테스트 외에도 다음을 수행해야 합니다.</para>
<itemizedlist>
<listitem>
<para>메시지 서버 프로세스의 복구 가능 및 복구 불가 중단을 확인합니다.</para>
</listitem>
<listitem>
<para>SAP 인큐 서버 프로세스의 복구 불가 중단을 확인합니다.</para>
</listitem>
<listitem>
<para>SAP Enqueue Replication Server 2의 중단을 확인합니다.</para>
</listitem>
<listitem>
<para>sapstartsrv의 중단 및 재시작을 확인합니다.</para>
</listitem>
<listitem>
<para>업그레이드의 시뮬레이션을 확인합니다.</para>
</listitem>
<listitem>
<para>클러스터 리소스 오류의 시뮬레이션을 확인합니다.</para>
</listitem>
</itemizedlist>
</section>
</section>
</section>
<section xml:id="multicluster">
<title>SAP S/4HANA를 위한 다중 노드 클러스터 설정</title>
<para><emphasis role="strong">다중 노드 클러스터</emphasis> 설정이란 노드가 3개 이상인 클러스터 구성을 의미합니다. 시작점에 따라 ASCS / ERS 고가용성 설정을 위해 2 노드 클러스터 설정을 확장하거나 3개 이상 노드로 직접 시작할 수 있습니다. 아래 예시는 다중 노드 클러스터의 설정 및 기존 2 노드 클러스터 쌍의 확장을 보여줍니다. 그리고 주요 구성 변경 사항 및 새 클러스터 멤버 노드의 기본 준비사항도 제공됩니다.</para>
<para>3 노드 클러스터를 설정하기 위한 작업 목록은 2 노드 클러스터의 작업 목록과 유사합니다. 그러나 디스크리스 SBD 설정을 위한 일부 세부 정보가 여기에 다르게 설명되어 있습니다.</para>
<section xml:id="id-extend-an-existing-two-node-cluster-configuration">
<title>기존 2 노드 클러스터 구성 확장</title>
<orderedlist numeration="arabic">
<title>작업</title>
<listitem>
<para>현재 클러스터 백업</para>
</listitem>
<listitem>
<para>OS 설치 새 노드</para>
</listitem>
<listitem>
<para>기존 노드 패치</para>
</listitem>
<listitem>
<para>새 노드의 운영 체제 준비</para>
</listitem>
<listitem>
<para>SAP 준비</para>
</listitem>
<listitem>
<para>새 노드에 클러스터 소프트웨어 설치</para>
</listitem>
<listitem>
<para>클러스터 조인</para>
</listitem>
<listitem>
<para>새 클러스터 구성 테스트</para>
</listitem>
</orderedlist>
<section xml:id="id-backup-of-the-current-cluster">
<title>현재 클러스터 백업</title>
<para><emphasis role="strong">현재 클러스터를 백업</emphasis>하려면 다음을 수행합니다.</para>
<informalexample>
<itemizedlist>
<listitem>
<para>다음을 포함하여 시스템 백업</para>
<itemizedlist>
<listitem>
<para>클러스터 구성</para>
</listitem>
<listitem>
<para>corosync.conf</para>
</listitem>
<listitem>
<para>중요하고 사용자 지정되지만 기본이 아닌 모든 데이터 및 구성</para>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<para>시스템은 SUSE 모범 사례 문서 <emphasis>SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - 설정 가이드</emphasis>에 설명된 대로 구성됩니다.</para>
<para><emphasis role="strong">클러스터 구성을 백업</emphasis>하려면, 클러스터 노드 중 하나로 이동하여 <emphasis>crm</emphasis> 및 <emphasis>crm report</emphasis> 명령으로 클러스터 구성을 보호합니다.</para>
<screen># crm configure save 2node.txt</screen>
<para><emphasis role="strong">기존 /etc/corosync/corosync.conf</emphasis> 및 복구에 중요한 기타 모든 파일을 백업합니다. 이 예시는 백업을 수행하기 위한 한 가지 방법입니다. 중요한 점은 <emphasis role="strong">외부</emphasis> 대상을 사용하는 것입니다.</para>
<screen># tar cvf /&lt;path to an <emphasis role="strong">external</emphasis> storage&gt;/bck_2nodes_configuration.tar \
      /etc/corosync/corosync.conf \
      2node.txt \
      &lt;add your additional files here&gt;</screen>
</informalexample>
</section>
<section xml:id="id-os-installation-of-the-new-cluster-node-member">
<title>새 클러스터 노드 멤버의 OS 설치</title>
<para>설치를 자동화하여 노드 전체에서 시스템 설정을 동일하게 유지하는 것이 좋습니다. 자동화된 설정 이후에 수행하는 추가 단계를 문서화하십시오. 예시에서는 AutoYaST 구성 파일로 시스템을 배포하고 기본 구성을 수행하는 후속 단계 스크립트를 실행합니다.</para>
</section>
<section xml:id="id-patching-existing-nodes">
<title>기존 노드 패치</title>
<para>해당하는 경우 최신 업데이트 및 패치를 기존 노드에 설치합니다. 또는, SUSE Manager에서 제공하는 리포지토리와 같은 고정 리포지토리를 사용하는 경우 새 시스템을 동일한 리포지토리에 추가하여 기존 노드와 동일한 패치 수준을 유지하도록 하십시오.</para>
<para>회사의 규칙에 따라 <emphasis role="strong">zypper patch</emphasis> 또는 <emphasis role="strong">zypper update</emphasis>를 사용합니다.</para>
<itemizedlist>
<listitem>
<para>사용 가능한 최신 패치를 설치하여 시스템 안정성과 강화 수준을 보장하는 것이 좋습니다. 버그 수정과 보안 패치는 예기치 않은 중단을 방지하고 시스템의 취약성을 보완하는 데 도움이 됩니다.</para>
</listitem>
</itemizedlist>
<para>다음과 같은 다양한 방법이 있습니다.</para>
<screen># zypper patch --category security
<emphasis role="marked"> or
# zypper patch --severity important
</emphasis> or
# zypper patch
## or
# zypper update</screen>
</section>
<section xml:id="id-preparing-the-new-nodes-operating-system">
<title>새 노드의 운영 체제 준비</title>
<example>
<title>유효한 DNS, 시간 동기화, 네트워크 설정 확인</title>
<itemizedlist>
<listitem>
<para>DNS가 작동 중인지 확인:</para>
<screen># ping &lt;hostname&gt;</screen>
</listitem>
<listitem>
<para><emphasis role="strong">chrony</emphasis>를 설정(<emphasis role="strong">yast2</emphasis>를 사용하는 것이 가장 좋음)하고 활성화:</para>
<screen># yast ntp-client</screen>
</listitem>
<listitem>
<para>네트워크 설정 확인:</para>
<screen># ip r</screen>
</listitem>
</itemizedlist>
</example>
<para>유효하지 않거나 기본이 아닌 경로가 구성되어 있으면 오류가 발생할 수 있습니다.</para>
<itemizedlist>
<listitem>
<para>기존 노드 등 새 시스템을 패치하고 시스템의 패치 수준이 동일하고 모든 필수 재부팅이 수행되었는지 확인합니다.</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-installing-cluster-software-on-the-new-node">
<title>새 노드에 클러스터 소프트웨어 설치</title>
<example>
<title>패키지 설치</title>
<itemizedlist>
<listitem>
<para><emphasis role="strong">ha_sles</emphasis> 패턴을 새 클러스터 노드에 설치:</para>
<screen># zypper in -t pattern ha_sles</screen>
</listitem>
<listitem>
<para>SUSE 리포지토리에서 <emphasis role="strong">sap-suse-cluster-connector</emphasis> 패키지 버전 3.1.0 설치:</para>
<screen># zypper in sap-suse-cluster-connector</screen>
</listitem>
</itemizedlist>
</example>
<para>모든 필수 패키지를 설치한 후 설치된 패키지 버전을 비교합니다.</para>
<example>
<title>모든 노드의 소프트웨어 패키지 및 버전이 동일한지 확인</title>
<itemizedlist>
<listitem>
<para>기존 클러스터 노드에서:</para>
<screen># rpm -qa | sort &gt;rpm_valuga11.log</screen>
</listitem>
<listitem>
<para>새 노드에서:</para>
<screen># rpm -qa | sort &gt;rpm_valuga13.log</screen>
</listitem>
<listitem>
<para>파일을 한 노드에서 다른 노드로 복사한 후 두 버전 비교:</para>
<screen># vimdiff rpm_valuga13.log rpm_valuga11.log</screen>
</listitem>
</itemizedlist>
</example>
<note>
<para>서로 다른 경우 먼저 수정한 후 계속 진행합니다.</para>
</note>
<example>
<title>새 시스템에 watchdog 장치를 설치 및 구성합니다.</title>
<para>소프트웨어 기반 솔루션을 배포하는 대신, 하드웨어 기반 watchdog 장치를 사용하는 것이 좋습니다. 다음 예시에서는 소프트웨어 장치가 사용되지만 하드웨어 장치로 편리하게 조정할 수 있습니다.</para>
<screen># modprobe softdog
# echo softdog &gt; /etc/modules-load.d/watchdog.conf
# systemctl restart systemd-modules-load
# lsmod | egrep "(wd|dog|i6|iT|ibm)"</screen>
</example>
<note>
<para>기존 노드 2개에 연결된 동일한 SBD 디스크에 새 노드가 연결되었는지 확인합니다. 새 노드의 SBD 구성이 기존 노드 2개의 SBD 구성과 완전히 동일한지 확인합니다.</para>
</note>
<screen># sbd -d /dev/disk/by-id/SUSE-Example-A-part1 dump</screen>
</section>
<section xml:id="id-preparing-the-sap-installation-on-the-new-node">
<title>새 노드에 SAP 설치 준비</title>
<para>SL Toolset의 일부인 SWPM 2.0(SP4 이상)을 통해 SAP는 기존 SAP 시스템에 맞게 새 설치 서버를 준비하는 모든 필수 단계를 수행할 수 있는 새 옵션을 제공합니다. 이러한 새 옵션은 나중에 클러스터 환경에서 ASCS 또는 ERS를 실행할 수 있는 새 호스트를 준비하는 데 도움이 됩니다.</para>
<para>SAP 리소스를 실행해야 하는 디렉토리 구조를 생성해야 합니다. SYS 디렉토리는 모든 노드에 대한 NFS 공유에 있습니다.</para>
<itemizedlist>
<listitem>
<para>마운트 지점을 생성하고 추가된 새 노드(valuga13)에 NFS 공유 마운트:</para>
</listitem>
</itemizedlist>
<example>
<title>valuga13에 NFS 공유 마운트</title>
<screen># mkdir -p /sapmnt /var/lib/Landscape
# mkdir -p /usr/sap/EN2/{ASCS00,ERS10,SYS}
# mount -t nfs 192.168.1.1:/data/export/S4_HA_CLU_10/EN2/sapmnt    /sapmnt
# mount -t nfs 192.168.1.1:/data/export/S4_HA_CLU_10/EN2/SYS /usr/sap/EN2/SYS
# mount -t nfs 192.168.1.1:/Landscape /var/lib/Landscape</screen>
</example>
<para>이 디렉토리는 항상 사용할 수 있어야 하므로 부팅 중에 마운트되게 해야 합니다. 이는 해당 정보를 /etc/fstab에 추가하여 수행할 수 있습니다.</para>
<para>다음 단계에서 필요한 정보: - 프로파일 디렉토리 - SAP 시스템 관리자 비밀번호 - sapadm의 UID</para>
<screen># cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst</screen>
<itemizedlist>
<listitem>
<para>SWPM 제품 설치 경로:</para>
<itemizedlist>
<listitem>
<para>SAP S/4HANA Server 1809 설치 → SAP HANA DATABASE → 설치 → Application Server ABAP → 고가용성 시스템 → 추가 호스트 준비</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>프로파일 디렉토리로 /sapmnt/EN2/profile 사용</para>
</listitem>
<listitem>
<para>모든 비밀번호: &lt;use-your-secure-pwd&gt;</para>
</listitem>
<listitem>
<para>sapadm의 UID: 2002</para>
</listitem>
</itemizedlist>
<example>
<title>SAP 준비 단계 후 후속 단계 절차</title>
<itemizedlist>
<listitem>
<para><emphasis>en2adm</emphasis> 사용자를 unix 사용자 그룹 <emphasis>haclient</emphasis>에 추가합니다.</para>
<screen># usermod -a -G haclient en2adm</screen>
</listitem>
<listitem>
<para><emphasis>/usr/sap/sapservices</emphasis> 파일을 생성하거나 기존 클러스터 노드 중 하나에서 복사합니다.</para>
<note>
<para>이 작업은 각 인스턴스에 수행해야 합니다. <emphasis role="strong">pf=</emphasis>&lt;profile-of-the-sap-instance&gt; 및 <emphasis role="strong">-reg</emphasis> 파라미터로 sapstartsrv를 호출합니다.</para>
</note>
<para>ASCS 및 ERS SAP 인스턴스를 등록하는 명령:</para>
<screen>##  create them with sapstartsrv
# LD_LIBRARY_PATH=/usr/sap/hostctrl/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH
# /usr/sap/hostctrl/exe/sapstartsrv pf=/usr/sap/&lt;SID&gt;/SYS/profile/&lt;SID&gt;_ERS&lt;instanceNumberErs&gt;_&lt;virtHostNameErs&gt; -reg
# /usr/sap/hostctrl/exe/sapstartsrv pf=/usr/sap/&lt;SID&gt;/SYS/profile/&lt;SID&gt;_ASCS&lt;instanceNumberAscs&gt;_&lt;virtHostNameAscs&gt; -reg</screen>
</listitem>
<listitem>
<para>또는 파일을 복사</para>
<screen># scp -p valuga11:/usr/sap/sapservices /usr/sap/</screen>
</listitem>
<listitem>
<para>마지막으로 파일 확인</para>
<screen># cat /usr/sap/sapservices
#!/bin/sh
LD_LIBRARY_PATH=/usr/sap/EN2/ASCS00/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH; /usr/sap/EN2/ASCS00/exe/sapstartsrv pf=/usr/sap/EN2/SYS/profile/EN2_ASCS00_sapen2as -D -u en2adm
LD_LIBRARY_PATH=/usr/sap/EN2/ERS10/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH; /usr/sap/EN2/ERS10/exe/sapstartsrv pf=/usr/sap/EN2/SYS/profile/EN2_ERS10_sapen2er -D -u en2adm</screen>
</listitem>
</itemizedlist>
</example>
<example>
<title>새 노드를 클러스터에 추가</title>
<para>SBD stonith 메소드가 두 노드에 대해 제 위치에 있는 경우 SBD 장치를 사용할 수 있는지 확인합니다. 기존 클러스터가 지원되는 다른 stonith 메커니즘을 사용하는 경우에는 새 클러스터 노드에서도 해당 방식을 확인합니다.</para>
<screen># sbd -d /dev/disk/by-id/SUSE-Example-A-part1 dump</screen>
<itemizedlist>
<listitem>
<para><emphasis>sleha-join</emphasis>으로 클러스터 조인</para>
</listitem>
</itemizedlist>
<screen># sleha-join -c valuga11</screen>
<para>새 노드가 클러스터에 조인되면 새로운 환경에 맞춰 구성을 조정해야 합니다. 조인이 성공했는지 다시 확인하고 <emphasis>/etc/corosync/corosync.conf</emphasis>를 확인합니다.</para>
<screen># grep votes -n2 /etc/corosync/corosync.conf</screen>
<para><emphasis role="strong">expected_votes</emphasis> 및 <emphasis role="strong">two_node</emphasis> 값은 모든 노드에서 다음과 같아야 합니다.</para>
<itemizedlist>
<listitem>
<para>expected_votes: 3</para>
</listitem>
<listitem>
<para>two_node: 0</para>
</listitem>
</itemizedlist>
<para>클러스터 구성을 수정하고 <emphasis>crm</emphasis>을 사용하여 새 코로케이션 규칙 설정:</para>
<screen># crm configure delete col_sap_EN2_no_both
# crm configure colocation ASCS00_ERS10_separated_EN2 -5000: grp_EN2_ERS10 grp_EN2_ASCS00</screen>
</example>
</section>
<section xml:id="id-test-the-new-cluster-configuration">
<title>새 클러스터 구성 테스트</title>
<para>특정 테스트를 실행하여 새 구성이 예상대로 작동하는지 확인하는 것이 매우 좋습니다. 테스트 목록은 위의 2 노드 클러스터 기본 설정에서 확인할 수 있습니다.</para>
</section>
</section>
<section xml:id="id-pros-and-cons-for-odd-and-even-numbers-of-cluster-nodes">
<title>홀수 및 짝수 개수 클러스터 노드의 장점 및 단점</title>
<para>다른 설치 설정에서는 특정 사용 사례 및 인프라 요구 사항이 있습니다. 아래는 특수 구성의 몇 가지 장점 및 단점에 대한 설명입니다.</para>
<itemizedlist>
<listitem>
<para>2 노드 클러스터 및 2개 위치</para>
<itemizedlist>
<listitem>
<para>장점: 모든 위치에서 모든 노드의 대칭적인 분배</para>
</listitem>
<listitem>
<para>단점: 모든 2 노드 클러스터에서는 디스크리스 SBD 기능이 허용되지 않음</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>2 노드 클러스터 및 3개 이상 위치</para>
<itemizedlist>
<listitem>
<para>장점: 해당 위치에서 SBD 장치를 제공할 수 있음(HA 자체여야 함)</para>
</listitem>
<listitem>
<para>장점: 클러스터가 서로 다른 위치의 3개 SBD 장치와 작동할 수 있음</para>
</listitem>
<listitem>
<para>단점: 모든 2 노드 클러스터에서는 디스크리스 SBD 기능이 허용되지 않음</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>3 노드 클러스터 및 2개 위치</para>
<itemizedlist>
<listitem>
<para>장점: 인프라의 복잡성 감소</para>
</listitem>
<listitem>
<para>장점:디스크리스 SBD 기능이 허용됨</para>
</listitem>
<listitem>
<para>단점: “사전 선택” 위치(2개 노드 + 1개 노드)</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>3 노드 클러스터 및 3개 위치</para>
<itemizedlist>
<listitem>
<para>장점: 모든 위치에서 모든 노드의 대칭적인 분배</para>
</listitem>
<listitem>
<para>장점:디스크리스 SBD 기능이 허용됨</para>
</listitem>
<listitem>
<para>단점: 인프라 계획 시 더 많은 노력이 필요하며 복잡성 증가</para>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="id-references">
<title>참조 문서</title>
<para>자세한 내용은 아래 문서를 참조하십시오.</para>
<section xml:id="id-pacemaker">
<title>Pacemaker</title>
<itemizedlist>
<listitem>
<para>Pacemaker 1.1 Configuration Explained: <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://clusterlabs.org/pacemaker/doc/en-US/Pacemaker/1.1/html/Pacemaker_Explained/">https://clusterlabs.org/pacemaker/doc/en-US/Pacemaker/1.1/html/Pacemaker_Explained/</link></para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-related-suse-tid">
<title>관련 SUSE TID</title>
<itemizedlist>
<listitem>
<para>SUSE SAP 모범 사례 가이드 오류 정정(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/support/kb/doc/?id=7023713">https://www.suse.com/support/kb/doc/?id=7023713</link>)</para>
</listitem>
<listitem>
<para>SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - 설정 가이드(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/support/kb/doc/?id=7023714">https://www.suse.com/support/kb/doc/?id=7023714</link>)</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-related-sap-notes">
<title>관련 SAP 노트</title>
<itemizedlist>
<listitem>
<para>953653 - Rolling Kernel Switch (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/953653">https://launchpad.support.sap.com/#/notes/953653</link>)</para>
</listitem>
<listitem>
<para>1092448 - IBM XL C/C++ runtime environment for Linux on system p (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1092448">https://launchpad.support.sap.com/#/notes/1092448</link>)</para>
</listitem>
<listitem>
<para>1153713 - Problems with SAP Management Console (Java) (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1153713">https://launchpad.support.sap.com/#/notes/1153713</link>)</para>
</listitem>
<listitem>
<para>1552925 - Linux: High Availability Cluster Solutions (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1552925">https://launchpad.support.sap.com/#/notes/1552925</link>)</para>
</listitem>
<listitem>
<para>1619879 - licensing of HA/DR/cluster → invalid license (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1619879">https://launchpad.support.sap.com/#/notes/1619879</link>)</para>
</listitem>
<listitem>
<para>1763512 - Support details for SUSE Linux Enterprise for SAP Applications (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1763512">https://launchpad.support.sap.com/#/notes/1763512</link>)</para>
</listitem>
<listitem>
<para>1984787 - SUSE LINUX Enterprise Server 12: Installation notes (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1984787">https://launchpad.support.sap.com/#/notes/1984787</link>)</para>
</listitem>
<listitem>
<para>2077934 - Rolling kernel switch in HA environments (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2077934">https://launchpad.support.sap.com/#/notes/2077934</link>)</para>
</listitem>
<listitem>
<para>2235581 - SAP HANA: Supported Operating Systems (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2235581">https://launchpad.support.sap.com/#/notes/2235581</link>)</para>
</listitem>
<listitem>
<para>2254173 - Linux: Rolling Kernel Switch in Pacemaker based NetWeaver HA environments (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2254173">https://launchpad.support.sap.com/#/notes/2254173</link>)</para>
</listitem>
<listitem>
<para>2369910 - SAP Software on Linux: General information (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2369910">https://launchpad.support.sap.com/#/notes/2369910</link>)</para>
</listitem>
<listitem>
<para>2464065 - Check of automatic maintenance mode for HA solutions (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2464065">https://launchpad.support.sap.com/#/notes/2464065</link>)</para>
</listitem>
<listitem>
<para>2578899 - SUSE Linux Enterprise Server 15: Installation Note (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2578899">https://launchpad.support.sap.com/#/notes/2578899</link>)</para>
</listitem>
<listitem>
<para>2630416 - Support for Standalone Enqueue Server 2 (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2630416">https://launchpad.support.sap.com/#/notes/2630416</link>)</para>
</listitem>
<listitem>
<para>2641019 - Installation of ENSA2 and update from ENSA1 to ENSA2 in SUSE HA environment (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2641019">https://launchpad.support.sap.com/#/notes/2641019</link>)</para>
</listitem>
<listitem>
<para>2684254 - SAP HANA DB: Recommended OS settings for SLES 15 / SLES for SAP Applications 15 (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2684254">https://launchpad.support.sap.com/#/notes/2684254</link>)</para>
</listitem>
<listitem>
<para>2711036 - Usage of the Standalone Enqueue Server 2 in an HA Environment (<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2711036">https://launchpad.support.sap.com/#/notes/2711036</link>)</para>
</listitem>
</itemizedlist>
<?pdfpagebreak?>
</section>
</section>
<section xml:id="id-appendix">
<title>부록</title>
<section xml:id="id-crm-configuration">
<title>CRM 구성</title>
<para>아래는 SAP 시스템 EN2용 전체 crm 구성입니다. 이 예시는 2 노드 클러스터용입니다. 다중 노드 클러스터에서는 <emphasis role="strong">node 3: valuga13</emphasis>과 같은 추가 노드 항목이 있습니다. </para>
<screen>node 1: valuga11
node 2: valuga12
primitive rsc_fs_EN2_ASCS00 Filesystem \
    params device="/dev/disk/by-id/SUSE-Example-A-part2" \
    directory="/usr/sap/EN2/ASCS00" \
    fstype=xfs \
    op start timeout=60s interval=0 \
    op stop timeout=60s interval=0 \
    op monitor interval=20s timeout=40s
primitive rsc_fs_EN2_ERS10 Filesystem \
    params device="/dev/disk/by-id/SUSE-Example-A-part3" \
    directory="/usr/sap/EN2/ERS10" \
    fstype=xfs \
    op start timeout=60s interval=0 \
    op stop timeout=60s interval=0 \
    op monitor interval=20s timeout=40s
primitive rsc_ip_EN2_ASCS00 IPaddr2 \
    params ip=192.168.1.112 \
    op monitor interval=10s timeout=20s
primitive rsc_ip_EN2_ERS10 IPaddr2 \
    params ip=192.168.1.113 \
    op monitor interval=10s timeout=20s
primitive rsc_sap_EN2_ASCS00 SAPInstance \
    operations $id=rsc_sap_EN2_ASCS00-operations \
    op monitor interval=11 timeout=60 on-fail=restart \
    params InstanceName=EN2_ASCS00_sapen2as \
    START_PROFILE="/sapmnt/EN2/profile/EN2_ASCS00_sapen2as" \
    AUTOMATIC_RECOVER=false \
    meta resource-stickiness=5000
primitive rsc_sap_EN2_ERS10 SAPInstance \
    operations $id=rsc_sap_EN2_ERS10-operations \
    op monitor interval=11 timeout=60 on-fail=restart \
    params InstanceName=EN2_ERS10_sapen2er \
    START_PROFILE="/sapmnt/EN2/profile/EN2_ERS10_sapen2er" \
    AUTOMATIC_RECOVER=false IS_ERS=true
primitive stonith-sbd stonith:external/sbd \
    params pcmk_delay_max=30s
group grp_EN2_ASCS00 rsc_ip_EN2_ASCS00 rsc_fs_EN2_ASCS00 \
    rsc_sap_EN2_ASCS00 \
    meta resource-stickiness=3000
group grp_EN2_ERS10 rsc_ip_EN2_ERS10 rsc_fs_EN2_ERS10 \
    rsc_sap_EN2_ERS10
colocation col_sap_EN2_not_both -5000: grp_EN2_ERS10 grp_EN2_ASCS00
order ord_sap_EN2_first_ascs Optional: rsc_sap_EN2_ASCS00:start \
    rsc_sap_EN2_ERS10:stop symmetrical=false
property cib-bootstrap-options: \
    have-watchdog=true \
    cluster-infrastructure=corosync \
    cluster-name=hacluster \
    stonith-enabled=true \
    placement-strategy=balanced
rsc_defaults rsc-options: \
    resource-stickiness=1 \
    migration-threshold=3
op_defaults op-options: \
    timeout=600 \
    record-pending=true</screen>
</section>
<section xml:id="id-corosync-configuration-of-the-two-node-cluster">
<title>2 노드 클러스터의 Corosync 구성</title>
<para>아래는 Corosync 구성입니다.</para>
<screen>valuga11:~ # cat /etc/corosync/corosync.conf
# Read the corosync.conf.5 manual page
totem {
    version: 2
    secauth: on
    crypto_hash: sha1
    crypto_cipher: aes256
    cluster_name: hacluster
    clear_node_high_bit: yes
    token: 5000
    token_retransmits_before_loss_const: 10
    join: 60
    consensus: 6000
    max_messages: 20
    interface {
        ringnumber: 0
        mcastport: 5405
        ttl: 1
    }

    transport: udpu
}

logging {
    fileline: off
    to_stderr: no
    to_logfile: no
    logfile: /var/log/cluster/corosync.log
    to_syslog: yes
    debug: off
    timestamp: on
    logger_subsys {
        subsys: QUORUM
        debug: off
    }

}

nodelist {
    node {
        ring0_addr: 192.168.1.103
        nodeid: 1
    }

    node {
        ring0_addr: 192.168.1.104
        nodeid: 2
    }

}

quorum {

    # Enable and configure quorum subsystem (default: off)
    # see also corosync.conf.5 and votequorum.5
    provider: corosync_votequorum
    expected_votes: 2
    two_node: 1
}</screen>
</section>
<section xml:id="id-corosync-configuration-of-the-multi-node-cluster">
<title>다중 노드 클러스터의 Corosync 구성</title>
<screen>        # Please read the corosync.conf.5 manual page
        totem {
                version: 2
                secauth: on
                crypto_hash: sha1
                crypto_cipher: aes256
                cluster_name: hacluster
                clear_node_high_bit: yes
                token: 5000
                token_retransmits_before_loss_const: 10
                join: 60
                consensus: 6000
                max_messages: 20
                interface {
                        ringnumber: 0
                        mcastport: 5405
                        ttl: 1
                }

                transport: udpu
        }

        logging {
                fileline: off
                to_stderr: no
                to_logfile: no
                logfile: /var/log/cluster/corosync.log
                to_syslog: yes
                debug: off
                timestamp: on
                logger_subsys {
                        subsys: QUORUM
                        debug: off
                }

        }

        nodelist {
                node {
                        ring0_addr: 192.168.1.103
                        nodeid: 1
                }

                node {
                        ring0_addr: 192.168.1.104
                        nodeid: 2
                }

                node {
                        ring0_addr: 192.168.1.105
                        nodeid: 3
                }

        }

        quorum {

                # Enable and configure quorum subsystem (default: off)
                # see also corosync.conf.5 and votequorum.5
                provider: corosync_votequorum
                expected_votes: 3
                two_node: 0
        }</screen>
</section>
</section>
<section xml:id="id-legal-notice">
<title>사용권 고지사항</title>
<para>저작권 © 2006–2020 SUSE LLC 및 제공자. All rights reserved. </para>
<para>GNU 무료 설명서 라이선스, 버전 1.2 또는 (사용자 선택에 따라) 버전 1.3의 조항에 따라 본 문서를 복사, 배포 및/또는 수정하는 권한이 허가됩니다. 그리고 각 항목에는 본 저작권 표시 및 라이선스가 설명된 고정(Invariant) 섹션이 있습니다. 라이선스 버전 1.2의 복사본은 “GNU 무료 설명서 라이선스” 섹션에 포함되어 있습니다.</para>
<para>SUSE, SUSE 로고 및 YaST는 미국과 기타 국가에서 SUSE LLC의 등록 상표입니다. SUSE 상표는 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/company/legal/">https://www.suse.com/company/legal/</link>을 참조하십시오.</para>
<para>Linux는 Linus Torvalds의 등록 상표입니다. 본 문서에 언급된 기타 모든 이름 또는 상표는 해당 소유주의 상표 또는 등록 상표일 수 있습니다.</para>
<para>본 문서는 “SUSE 모범 사례”라는 문서 시리즈 중 일부입니다. 시리즈의 각 문서는 SUSE 직원 및 제3자가 자발적으로 기여하여 작성되었습니다. 문서의 목적은 특정 작업을 수행하는 방법의 한 가지 예만을 제공하는 것입니다.</para>
<para>또한, SUSE는 문서에서 설명되는 작업이 해당 기능을 수행하는지 또는 의도하지 않은 결과가 제공되지 않는지를 확인할 수 없습니다.</para>
<para>본 문서의 모든 정보는 최대한 주의를 기울여 작성되었습니다. 그러나 이것이 문서의 정확성을 보장하지는 않습니다. 따라서 SUSE LLC, 그 계열사, 저자, 번역자 중 어느 누구도 있을 수 있는 오류나 그에 따른 결과에 책임을 지지 않는다고 명확히 진술할 필요가 있습니다. 아래에 명시된 내용은 문서를 게시할 때 준수해야 할 라이선스에 대한 주의를 환기하기 위한 것입니다.</para>
<?pdfpagebreak?>
</section>
<xi:include href="license-gfdl.xml"/>
</article>
