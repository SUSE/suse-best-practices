<?xml version="1.0"?>
<?asciidoc-toc?><?asciidoc-numbered?><article
xmlns:xi="http://www.w3.org/2001/XInclude" xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" xml:base="SLES4SAP-hana-sr-guide-PerfOpt-15_AWS.xml" version="5.0" xml:lang="ko"><title>AWS 클라우드용 SAP HANA 고가용성 클러스터 - 설정 가이드(v15)</title>
<info>

<date>2020-11-11</date>
<dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
    <dm:bugtracker>
        <dm:url>https://github.com/SUSE/suse-best-practices/issues/new</dm:url>
        <dm:product>SAP HANA 시스템 복제 수직 확장 - AWS(SLES15 SP1) 기반 성능 최적화 시나리오</dm:product>
    </dm:bugtracker>
</dm:docmanager>

<!--<title>SAP HANA System Replication Scale-Up - Performance Optimized Scenario</title>-->
<!--<subtitle></subtitle>-->
    <!-- <orgname>SUSE Best Practices</orgname>-->
    <productname>SUSE Linux Enterprise Server for SAP Applications</productname>
    <productnumber>15 SP1</productnumber>

<author>
        <personname>
            <firstname>Fabian</firstname>
            <surname>Herschel, 특별 아키텍트 SAP, SUSE</surname>
        </personname>
    </author>
<author>
        <personname>
            <firstname>Bernd</firstname>
            <surname>Schubert, SAP 솔루션 아키텍트, SUSE</surname>
        </personname>
</author>
<author>
    <personname>
        <firstname>Lars</firstname>
        <surname>Pinne, 시스템 엔지니어, SUSE</surname>
    </personname>
</author>
<author>
    <personname>
        <firstname>Guilherme G.</firstname>
        <surname>Felix, 클라우드 지원 엔지니어, AWS</surname>
    </personname>
</author>

    <cover role="logos">
        <mediaobject>
                <imageobject>
                        <imagedata fileref="suse.svg" width=""/>
                </imageobject>
        </mediaobject>
        </cover>

<date>2020-11-11</date>


<abstract>

    <para>SUSE® Linux Enterprise Server for SAP Applications는 여러 가지 측면에서 SAP* 응용 프로그램에 최적화되어 있습니다. 본 가이드는 성능 최적화 시나리오에서 SAP HANA 시스템 복제를 위한 SUSE Linux Enterprise Server for SAP Applications의 설치 및 사용자 정의에 대한 자세한 정보를 제공합니다. 그리고 이미 설치되어 작동 중인 SAP HANA를 시스템 복제와 통합하는 단계를 집중적으로 설명합니다.</para>

    <para><emphasis role="strong">고지 사항</emphasis>: 본 문서는 SUSE 모범 사례 시리즈의 일부입니다. 이 시리즈의 모든 문서는 SUSE 직원 및 제3자가 자발적으로 기여하여 작성한 것입니다. 문서에서 별도로 설명하는 경우를 제외하고, 문서의 목적은 특정 작업을 수행하는 방법의 한 가지 예만을 제공하는 것입니다. 또한, SUSE는 문서에서 설명되는 작업이 해당 기능을 수행하는지 또는 의도하지 않은 결과가 제공되지 않는지를 확인할 수 없습니다. 본 문서의 모든 정보는 최대한 주의를 기울여 작성되었습니다. 그러나 이것이 문서의 정확성을 보장하지는 않습니다. 따라서 SUSE LLC, 그 계열사, 저자, 번역자 중 어느 누구도 있을 수 있는 오류나 그에 따른 결과에 책임을 지지 않는다고 명확히 진술할 필요가 있습니다.
    </para>

</abstract>
</info>
<section xml:id="pre.hana-sr">
<title>이 가이드 정보</title>
<section xml:id="id-introduction">
<title>소개</title>
<para>SUSE® Linux Enterprise Server for SAP Applications는 여러 가지 측면에서 SAP* 응용 프로그램에 최적화되어 있습니다. 본 가이드는 성능 최적화 시나리오에서 SAP HANA 시스템 복제를 위한 SUSE Linux Enterprise Server for SAP Applications의 설치 및 사용자 정의에 대한 자세한 정보를 제공합니다.</para>
<para>“SAP HANA에 대한 SAP 고객의 투자”는 최근 실시된 Pierre Audoin Consultants(PAC)의 시장 연구에서 확인할 수 있습니다. 독일의 경우 기업 중 절반은 SAP 환경에서 SAP HANA가 지배적인 데이터베이스 플랫폼이 될 것으로 예상합니다. “SAP HANA*가 제공하는 SAP Business Suite*” 시나리오는 이미 구체적으로 자주 논의되고 있습니다.</para>
<para>SUSE는 SAP HANA를 지원하는 권장 운영 체제인 SUSE Linux Enterprise Server for SAP Applications를 제공함으로써 이러한 발전에 동참하고 있습니다. SAP 및 하드웨어 파트너와의 협력을 통해 SUSE는 고가용성 SAP HANA 시스템 복제를 고객이 사용할 수 있도록 해주는 리소스 에이전트 두 개를 제공합니다.</para>
<section xml:id="id-abstract">
<title>요약</title>
<para>본 가이드에서는 고가용성 솔루션 시나리오인 “SAP HANA 수직 확장 시스템 복제 성능 최적화”에 기반한 SUSE Linux Enterprise Server for SAP Applications의 계획, 설정 및 기본 테스트를 설명합니다.</para>
<para>응용 프로그램의 관점에서 다루는 내용은 다음과 같습니다.</para>
<itemizedlist>
<listitem>
<para>일반 시스템 복제</para>
</listitem>
<listitem>
<para>보조 사이트 읽기를 지원하는 시스템 복제</para>
</listitem>
<listitem>
<para>다중 계층(체인) 시스템 복제</para>
</listitem>
<listitem>
<para>다중 대상 시스템 복제</para>
</listitem>
<listitem>
<para>위의 모든 시스템을 위한 다중 테넌트 데이터베이스 컨테이너</para>
</listitem>
</itemizedlist>
<para>인프라의 관점에서 다루는 내용은 다음과 같습니다.</para>
<itemizedlist>
<listitem>
<para>AWS 고유의 펜싱이 포함된 2노드 클러스터</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-scale-up-versus-scale-out">
<title>수직 확장 대 수평 확장</title>
<para>첫 번째 시나리오 세트에는 <emphasis>수직 확장</emphasis> 솔루션의 아키텍처 및 개발이 포함됩니다.</para>
<figure>
<title>클러스터에서 SAP HANA 시스템 복제 수직 확장</title>
<mediaobject>
<imageobject>
<imagedata fileref="hana_sr_in_cluster.svg" width="70.0%"/>
</imageobject>
<textobject><phrase>hana sr in cluster</phrase></textobject>
</mediaobject>
</figure>
<para>이러한 시나리오를 위해 SUSE는 수직 확장 리소스 에이전트 패키지인 <literal>SAPHanaSR</literal>을 개발했습니다. 시스템 복제는 한 컴퓨터에서 다른 컴퓨터로 데이터베이스 데이터를 복제하여 데이터베이스 장애를 보상합니다(단일 상자 복제).</para>
<para>두 번째 시나리오 세트에는 <emphasis>수평 확장</emphasis> 솔루션의 아키텍처 및 개발이 포함됩니다(다중 상자 복제). 이러한 시나리오를 위해 SUSE는 수평 확장 리소스 에이전트 패키지인 <literal>SAPHanaSR-ScaleOut</literal>을 개발했습니다.</para>
<figure>
<title>클러스터에서 SAP HANA 시스템 복제 수평 확장</title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Cluster.svg" width="70.0%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Cluster</phrase></textobject>
</mediaobject>
</figure>
<para>이 작동 모드에서는 내부 SAP HANA 고가용성(HA) 메커니즘 및 리소스 에이전트가 함께 작동하거나 서로 조율되어야 합니다. 수평 확장을 위한 SAP HANA 시스템 복제 자동화에 대한 설명은 문서 웹 페이지(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://documentation.suse.com/sbp/sap-15/">https://documentation.suse.com/sbp/sap-15/</link>)에서 제공되는 별도의 문서에서 확인할 수 있습니다. 수평 확장 관련 문서의 이름은 <emphasis>“SAP HANA 시스템 복제 수평 확장 - 성능 최적화 시나리오”</emphasis>입니다.</para>
</section>
<section xml:id="id-scale-up-scenarios-and-resource-agents">
<title>수직 확장 시나리오 및 리소스 에이전트</title>
<para>SUSE는 SAP HANA 데이터베이스 인스턴스를 실제로 확인하는 <literal>SAPHana</literal> 리소스 에이전트(RA)를 사용한 수직 확장 시나리오를 구현했습니다. 이 RA는 마스터/슬레이브 리소스로 구성됩니다. 수직 확장 시나리오에서는 기본 모드에서 실행되는 SAP HANA 데이터베이스를 마스터가 관리합니다. 슬레이브는 동기화(보조) 상태에서 작동하는 인스턴스를 관리합니다.</para>
<para>클러스터 구성을 최대한 간소화하기 위해 SUSE는 <literal>SAPHanaTopology</literal> 리소스 에이전트도 개발했습니다. 이 RA는 SUSE Linux Enterprise Server for SAP Applications 클러스터의 모든 노드에서 실행되며 SAP HANA 시스템 복제의 상태 및 구성에 대한 정보를 수집합니다. 그리고 일반(상태 비저장) 클론으로 설계됩니다.</para>
<para>수직 확장을 위한 SAP HANA 시스템 복제는 다음 시나리오 또는 사용 사례에서 지원됩니다.</para>
<itemizedlist>
<listitem>
<para><emphasis role="strong">성능 최적화(</emphasis><emphasis>A ⇒ B</emphasis>). 이 시나리오 및 설정은 <emphasis role="strong">이 문서에서 설명</emphasis>합니다.</para>
<figure>
<title>클러스터에서 SAP HANA 시스템 복제 수직 확장 - 성능 최적화</title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleUP-perfOpt.svg" width="100.0%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleUP perfOpt</phrase></textobject>
</mediaobject>
</figure>
<para>성능 최적화 시나리오에서 SAP HANA RDBMS 사이트 A는 두 번째 노드의 SAP HANA RDBMS 사이트 B와 동기화됩니다. 두 번째 노드에서 HANA RDBMS는 테이블을 사전에 로드하도록 구성되므로 일반적으로 인수 시간이 매우 짧습니다.</para>
<para>SAP HANA 성능 최적화 시나리오의 한 가지 주요 이점은 보조 데이터베이스 사이트에서 읽기 액세스가 가능하다는 점입니다. 이러한 <emphasis role="strong">읽기 지원</emphasis> 시나리오를 지원하기 위해, 두 번째 가상 IP 주소가 클러스터에 추가되어 시스템 복제의 보조 역할에 바인딩됩니다.</para>
</listitem>
<listitem>
<para><emphasis role="strong">비용 최적화</emphasis>(<emphasis>A ⇒ B, Q</emphasis>). 이 시나리오 및 설정에 대한 설명은 문서 웹 사이트(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://documentation.suse.com/sbp/sap-15/">https://documentation.suse.com/sbp/sap-15/</link>)의 다른 문서에서 확인할 수 있습니다. <emphasis>비용 최적화</emphasis> 관련 문서의 이름은 <emphasis>“SAP HANA SR 비용 최적화 인프라 설정”</emphasis>입니다.</para>
<figure>
<title>클러스터에서 SAP HANA 시스템 복제 수직 확장 - 비용 최적화</title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleUP-costOpt2.svg" width="100.0%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleUP costOpt2</phrase></textobject>
</mediaobject>
</figure>
<para>비용 최적화 시나리오에서는 두 번째 노드가 비생산적 SAP HANA RDBMS 시스템(예: QAS 또는 TST)에서도 사용됩니다. 인수가 필요한 경우에는 비생산적 시스템부터 중지해야 합니다. 이 노드의 생산적 보조 시스템은 시스템 리소스 사용이 제한되어야 하므로 테이블 사전 로드 기능은 꺼진 상태여야 합니다. 성능 최적화 사용 사례에서보다 인수하는 시간이 더 오래 걸릴 수 있습니다.</para>
<para>비용 최적화 시나리오에서 보조는 메모리 사용 감소 구성으로 실행되어야 합니다. 이러한 이유로 이 시나리오에서는 <emphasis>읽기 지원</emphasis>을 사용하지 않아야 합니다.</para>
</listitem>
<listitem>
<para><emphasis role="strong">다중 계층</emphasis>(<emphasis>A ⇒ B → C</emphasis>) 및 <emphasis role="strong">다중 대상</emphasis>(<emphasis>B ⇐ A ⇒ C</emphasis>).</para>
<figure>
<title>클러스터에서 SAP HANA 시스템 복제 수직 확장 - 성능 최적화 체인</title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleUP-Chain.svg" width="100.0%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleUP Chain</phrase></textobject>
</mediaobject>
</figure>
<para><emphasis>다중 계층</emphasis> 시스템 복제에는 추가 대상이 있습니다. 이전에는 이 세 번째 측면이 보조에 연결되어야 했습니다(체인 토폴로지). 현재 SAP HANA 버전에서는 SAP에서 <emphasis>다중 대상 토폴로지</emphasis>도 허용합니다.</para>
<figure>
<title>클러스터에서 SAP HANA 시스템 복제 수직 확장 - 성능 최적화 다중 대상</title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleUP-MultiTarget.svg" width="100.0%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleUP MultiTarget</phrase></textobject>
</mediaobject>
</figure>
<para>다중 계층 및 다중 대상 시스템은 이 문서의 설명과 같이 구현됩니다. 첫 번째 복제 쌍(A 및 B)만 클러스터 자체에 의해 처리됩니다. 일반 성능 최적화 시나리오와의 주요 차이점은 자동 등록을 꺼야 한다는 점입니다.</para>
</listitem>
<listitem>
<para><emphasis role="strong">다중 테넌트</emphasis> 또는 MDC.</para>
<para>다중 테넌트는 위의 모든 시나리오 및 사용 사례에서 지원됩니다. 이 시나리오는 SAP HANA SPS09 이후부터 지원됩니다. 클러스터의 관점에서 설정 및 구성은 다중 테넌트 및 단일 컨테이너에서와 동일합니다. 그러므로 이 두 유형의 시나리오 모두에 위의 문서를 사용할 수 있습니다.</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-the-concept-of-the-performance-optimized-scenario">
<title>성능 최적화 시나리오의 개념</title>
<para>노드 1(노드 또는 데이터베이스 인스턴스)의 기본 SAP HANA에서 장애가 발생하는 경우 클러스터는 먼저 인수 프로세스를 시작합니다. 이를 통해 보조 사이트에서 이미 로드된 데이터를 사용할 수 있습니다. 일반적으로 인수는 로컬 재시작보다 속도가 훨씬 빠릅니다.</para>
<para>이 리소스 처리 프로세스를 자동화하려면 SAPHanaSR에 포함된 SAP HANA 리소스 에이전트를 사용하십시오. 생산적 데이터베이스의 시스템 복제는 SAPHana 및 SAPHanaTopology를 사용하여 자동화됩니다.</para>
<para>기본 사이트의 서비스가 손실된 시점까지 SAP HANA 시스템 복제가 동기화된 경우 클러스터는 보조 사이트로의 인수만을 허용합니다. 이를 통해 기본 사이트에서 처리된 마지막 커밋을 보조 사이트에서 사용할 수 있습니다.</para>
<para>SAP는 SAP HANA와 외부 소프트웨어(예: 클러스터 프레임워크) 사이의 인터페이스를 향상했습니다. 이러한 향상에는 서비스 또는 시스템 복제 채널에 대한 상태 변경과 같은 특수 이벤트 발생 시 SAP HANA 호출 구현이 포함됩니다. 이러한 호출을 HA/DR 제공자라고도 부릅니다. 이 인터페이스는 python으로 SAP HANA 후크를 구현하여 사용할 수 있습니다. SUSE는 SAP HANA 후크를 포함하는 등 SAPHanaSR 패키지를 향상하여 클러스터 인터페이스를 최적화했습니다. 이 문서에서 설명하는 SAP HANA 후크를 사용하면 SAP HANA 시스템 복제가 중단되는 경우 즉시 클러스터에 통지할 수 있습니다. 클러스터는 SAP HANA 후크 상태뿐만 아니라 시스템 복제 상태를 정기적으로 폴링합니다.</para>
<para>자동화 수준은 <literal>AUTOMATED_REGISTER</literal> 파라미터를 설정하여 설정할 수 있습니다. 자동화 등록이 활성화된 경우, 클러스터는 이전에 장애가 발생한 기본 사이트를 자동으로 등록하여 새 보조 사이트를 가져옵니다.</para>
<important>
<para>솔루션은 HAWK 또는 기타 클러스터 클라이언트 명령을 사용하여 수동으로 기본 또는 보조 인스턴스를 '마이그레이션'하도록 설계되지 않았습니다. 이 문서의 <emphasis>관리</emphasis> 섹션에서는 SAP 및 클러스터 명령을 사용하여 기본 사이트에서 보조 사이트로 ‘마이그레이션’하는 방법에 대한 설명이 제공됩니다.</para>
</important>
</section>
<section xml:id="id-customers-receive-complete-package">
<title>고객에게 제공되는 전체 패키지</title>
<para>고객은 SAPHana 및 SAPHanaTopology 리소스 에이전트를 사용하여 SAP HANA 시스템 복제를 클러스터에 통합할 수 있습니다. 이러한 방법은 회사가 필요한 예산을 대폭 절감하는 동시에 중단이 발생하지 않고 비즈니스에 중요한 SAP 시스템뿐만 아니라 SAP HANA 데이터베이스를 사용할 수 있는 장점이 있습니다. SUSE는 모범 사례 문서와 함께 확장 솔루션을 제공합니다.</para>
<para>SAP HANA 고가용성 솔루션을 보유하고 있지 않은 하드웨어 파트너 및 SAP도 SUSE가 제공하는 이러한 개발로부터 혜택을 볼 수 있습니다.</para>
</section>
</section>
<section xml:id="id-additional-documentation-and-resources">
<title>추가 문서 및 리소스</title>
<para>본 추가 문서의 각 장에는 시스템 또는 인터넷에서 사용할 수 있는 추가 문서 리소스로 연결되는 링크가 수록되어 있습니다.</para>
<para>최신 문서 업데이트는 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="http://documentation.suse.com/">http://documentation.suse.com/</link>에서 확인할 수 있습니다.</para>
<para>SUSE Linux Enterprise Server for SAP Applications 모범 사례 웹 사이트(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://documentation.suse.com/sbp/sap-15/">https://documentation.suse.com/sbp/sap-15/</link>)에서는 다양한 백서, 모범 사례, 설정 가이드 및 기타 리소스를 확인할 수 있습니다.</para>
<para>SUSE는 SAP 및 고가용성에 대한 블로그 게시글도 #TowardsZeroDowntime 해시태그를 사용하여 게시합니다. 자세한 내용은 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/c/tag/TowardsZeroDowntime/">https://www.suse.com/c/tag/TowardsZeroDowntime/</link>을 참조하십시오.</para>
</section>
<section xml:id="id-errata">
<title>오류 정정</title>
<para>소규모 긴급 수정 및 중요 정보를 제 때 제공하기 위해 이 설정 가이드에 대한 기술 정보 문서(TID)는 더 자주 업데이트, 관리 및 게시됩니다.</para>
<itemizedlist>
<listitem>
<para>SAP HANA SR 성능 최적화 시나리오 - 설정 가이드 - 오류 정정(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/support/kb/doc/?id=7023882">https://www.suse.com/support/kb/doc/?id=7023882</link>)</para>
</listitem>
<listitem>
<para>클러스터 모니터링 도구에 SOK 상태 표시 문제 해결(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/support/kb/doc/?id=7023526">https://www.suse.com/support/kb/doc/?id=7023526</link> - <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/c/lets-flip-the-flags-is-my-sap-hana-database-in-sync-or-not/">https://www.suse.com/c/lets-flip-the-flags-is-my-sap-hana-database-in-sync-or-not/</link>에서 블로그 글도 확인)</para>
</listitem>
</itemizedlist>
<para>이 가이드와 함께 기타 솔루션에 대한 SUSE SAP 모범 사례 가이드 오류 정정(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/support/kb/doc/?id=7023713">https://www.suse.com/support/kb/doc/?id=7023713</link>)도 확인하십시오.</para>
</section>
<section xml:id="id-feedback">
<title>피드백</title>
<para>여러 피드백 채널을 사용할 수 있습니다.</para>
<variablelist>
<varlistentry>
<term>버그 및 기능 향상 요청</term>
<listitem>
<para>제품과 관련하여 사용 가능한 서비스 및 지원 옵션에 대해서는 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="http://www.suse.com/support/">http://www.suse.com/support/</link>를 참조하십시오.</para>
</listitem>
</varlistentry>
</variablelist>
<para>제품 구성 요소의 버그를 보고하려면 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://scc.suse.com/support/">https://scc.suse.com/support/requests</link>로 이동하여 로그인한 후 <emphasis>새 SR(Service Request: 서비스 요청) 제출</emphasis>을 선택하십시오.</para>
<variablelist>
<varlistentry>
<term>메일</term>
<listitem>
<para>본 제품 문서에 대한 피드백이 있는 경우 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="mailto:doc-team@suse.com">doc-team@suse.com</link>으로 메일을 보내 주십시오. 문서의 문서 제목, 제품 버전 및 게시 날짜를 포함해야 합니다. 오류를 보고하거나 개선사항을 제안하려면 문제점에 대한 간략한 설명을 제공하고 해당 섹션 번호 및 페이지(또는 URL)를 참조하십시오.</para>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
<section xml:id="cha.hana-sr.scenario">
<title>지원되는 시나리오 및 필수 구성 요소</title>
<para><literal>SAPHanaSR</literal> 리소스 에이전트 소프트웨어 패키지에서는 다음 구성 및 파라미터에 한해 수직 확장(단일 상자 대 단일 상자) 시스템 복제를 지원합니다.</para>
<itemizedlist>
<listitem>
<para>2노드 클러스터</para>
</listitem>
<listitem>
<para>클러스터에는 유효한 STONITH 메서드가 포함되어야 합니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<listitem>
<para>SUSE Linux Enterprise 15 High Availability Extension에서 지원하는 AWS STONITH 메커니즘은 SAPHanaSR을 통해 지원됩니다.</para>
</listitem>
<listitem>
<para>각 클러스터 노드는 동일한 AWS 리전 내의 서로 다른 가용 영역(AZ)에 위치합니다.</para>
</listitem>
<listitem>
<para>오버레이 IP 주소는 가상 프라이빗 클라우드(VPC) CIDR 외부의 IP여야 합니다.</para>
</listitem>
<listitem>
<para><emphasis>&lt;sid&gt;adm</emphasis>과 같은 기술 사용자 및 그룹은 Linux 시스템에 로컬로 정의되어 있습니다.</para>
</listitem>
<listitem>
<para>오버레이 IP 주소 및 클러스터 노드의 이름 확인은 모든 클러스터 노드에서 로컬로 수행되어야 합니다.</para>
</listitem>
<listitem>
<para>NTP 등 클러스터 노드 간 시간 동기화가 필요합니다.</para>
</listitem>
<listitem>
<para>두 SAP HANA 인스턴스(기본 및 보조) 모두 동일한 SAP 식별자(SID) 및 인스턴스 번호를 갖습니다.</para>
</listitem>
<listitem>
<para>클러스터 노드가 다른 데이터 센터 또는 데이터 센터 영역에 설치된 경우에는 SUSE Linux Enterprise High Availability Extension 클러스터 제품의 요구사항을 충족하는 환경이어야 합니다. 노드 사이의 네트워크 지연 및 권장 최대 거리에 특히 유의해야 합니다. 이러한 권장 사항은 SUSE Linux Enterprise High Availability Extension의 제품 설명서를 참조하십시오.</para>
</listitem>
<listitem>
<para>인수 후 장애가 발생한 기본 인스턴스를 자동 등록할 수 있습니다.</para>
</listitem>
<listitem>
<para>SAP HANA Replication은 <emphasis role="strong">SYNC</emphasis> 또는 <emphasis role="strong">SYNCMEM</emphasis>으로 설정되어야 하며, <emphasis role="strong">ASYNC</emphasis>는 클러스터에서 지원되지 않습니다.</para>
</listitem>
<listitem>
<para>SAP HANA Replication 모드는 <emphasis>logreplay</emphasis>, <emphasis>logreplay_readaccess</emphasis> 또는 <emphasis>delta_datashipping</emphasis>으로 설정할 수 있습니다.</para>
<itemizedlist>
<listitem>
<para>장애가 발생한 기본 인스턴스의 자동 등록을 끈 구성으로 프로젝트를 시작하는 것이 좋습니다. <literal>AUTOMATED_REGISTER="false"</literal> 설정이 기본값입니다. 이러한 경우에는 인수 후 장애가 발생한 기본 인스턴스를 수동으로 등록해야 합니다. SAP HANA Cockpit 또는 <emphasis>hdbnsutil</emphasis> 등의 SAP 도구를 사용하십시오.</para>
</listitem>
<listitem>
<para>최적의 자동화를 위해서는 <literal>AUTOMATED_REGISTER="true"</literal>를 사용하는 것이 좋습니다.</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>시스템 재부팅 동안 SAP HANA 인스턴스 자동 시작을 꺼야 합니다.</para>
</listitem>
<listitem>
<para>다중 테넌트(MDC) 데이터베이스가 지원됩니다.</para>
<itemizedlist>
<listitem>
<para>다중 테넌트 데이터베이스는 기타 설정(성능 기반, 비용 최정화 및 다중 계층)과 조합하여 사용할 수 있습니다.</para>
</listitem>
<listitem>
<para>MDC 구성에서 SAP HANA RDBMS는 모든 데이터베이스 컨테이너가 포함된 단일 시스템으로 취급됩니다. 그러므로 클러스터 인수는 개별 데이터베이스 컨테이너의 상태와 관계없이 전체 RDBMS 상태에 따라 결정됩니다.</para>
</listitem>
<listitem>
<para>SAP HANA 1.0의 경우, 프로덕션 중 테넌트를 중지하고 클러스터가 인수할 수 있도록 하려면 SPS10 rev3, SPS11 또는 그 이상 버전이 필요합니다. 그 이전의 SAP HANA 버전에서는 테넌트가 중지되면 시스템 복제를 실패로 표시합니다.</para>
</listitem>
<listitem>
<para>테넌트가 강하게 분리된 경우, 다중 테넌트 데이터베이스에서 테스트를 수행하면 다른 테스트 절차가 수행될 수 있습니다. 예를 들어, <emphasis>HDB kill</emphasis>을 사용하여 전체 SAP HANA 인스턴스를 종료할 수 없습니다. 왜냐하면 테넌트가 다른 Linux 사용자 UID로 실행되기 때문입니다. &lt;sidadm&gt;을 사용하여 기타 테넌트 사용자 프로세스를 종료할 수 없습니다.</para>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<para>최소한으로 SAPHanaSR 버전 0.153이 있어야 하며 최상으로는 SUSE Linux Enterprise Server for SAP Applications 15 SP1 이상이 필요합니다. 설명된 모든 설정에서는 SPS09(095) 이후부터 SAP HANA 1.0이 지원됩니다. 알려진 모든 SPS 버전에서는 SAP HANA 2.0이 지원됩니다.</para>
<important>
<para>유효한 STONITH 메서드가 없는 경우에는 전체 클러스터가 지원되지 않고 올바르게 작동하지 않습니다.</para>
</important>
<para>다른 시나리오를 구현해야 하는 경우에는 SUSE를 사용한 개념 증명(PoC)을 정의하십시오. 이 PoC는 시나리오에서 기존 솔루션의 테스트를 집중적으로 다룹니다. 위에서 언급된 대부분의 제한은 세밀한 테스트가 필요하기 때문입니다.</para>
<para>SAP HANA뿐만 아니라 SAP 호스트 에이전트를 시스템에 설치해야 합니다.</para>
</section>
<section xml:id="cha.hana-sr.scope">
<title>본 문서의 범위</title>
<para>본 문서에서는 시스템 복제 시나리오에서 SAP HANA를 제어하기 위한 클러스터 설정 방법을 설명합니다. 그리고 이미 설치되어 작동 중인 SAP HANA를 시스템 복제와 통합하는 단계를 집중적으로 설명합니다.</para>
<para>여기서 설명하는 예시 설정에서는 한 AWS 리전의 두 가용 영역에 SAP HANA HA 클러스터를 구축합니다. 가용 영역 1은 “A”이고 가용 영역 2는 “B”이며, SUSE Linux Enterprise Server for SAP Applications 15 SP1 시스템 두 개에 설치됩니다.</para>
<figure>
<title>SAP HANA SR을 사용한 클러스터 - 성능 최적화</title>
<mediaobject>
<imageobject>
<imagedata fileref="AWS-SAPHana-Scale-Up.svg" width="100.0%"/>
</imageobject>
<textobject><phrase>AWS SAPHana 수직 확장</phrase></textobject>
</mediaobject>
</figure>
<para>본 가이드는 클러스터의 수동 설정을 중심으로 세부 정보를 설명하고 사용자가 자체 자동화를 구축할 수 있는 기회를 제공합니다.</para>
<para>기본 설정의 7단계는 다음과 같습니다.</para>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase0.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase0</phrase></textobject>
</mediaobject>
</informalfigure>
<itemizedlist>
<listitem>
<para>계획 수립(<xref linkend="id-planning-the-installation"/> 참조)</para>
</listitem>
<listitem>
<para>운영 체제 설치(<xref linkend="id-operating-system-setup"/> 참조)</para>
</listitem>
<listitem>
<para>데이터베이스 설치(<xref linkend="cha.s4s.hana-install"/> 참조)</para>
</listitem>
<listitem>
<para>SAP HANA 시스템 복제 설정(<xref linkend="id-setting-up-sap-hana-system-replication"/> 참조</para>
</listitem>
<listitem>
<para>SAP HANA HA/DR 공급자 후크(<xref linkend="id-setting-up-sap-hana-hadr-providers"/> 참조)</para>
</listitem>
<listitem>
<para>클러스터 구성(<xref linkend="id-configuring-the-cluster"/> 참조)</para>
</listitem>
<listitem>
<para>테스트(<xref linkend="cha.s4s.test-cluster"/> 참조)</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-planning-the-installation">
<title>설치 계획 수립</title>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase1.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase1</phrase></textobject>
</mediaobject>
</informalfigure>
<para>SAP HANA 클러스터 설정에 성공하려면 설치 계획이 반드시 필요합니다.</para>
<para>시작하기 전 필요한 사항:</para>
<itemizedlist>
<listitem>
<para>AWS 인프라 및 아키텍처 이해하기</para>
</listitem>
<listitem>
<para>(선택 사항) SUSE 제공 소프트웨어: 유효한 SUSE 구독 및 업데이트 채널에 대한 액세스</para>
</listitem>
<listitem>
<para>SAP 제공 소프트웨어: SAP HANA 설치 미디어</para>
</listitem>
<listitem>
<para>다른 가용 영역에 위치한 AWS EC2 인스턴스 두 개</para>
</listitem>
<listitem>
<para>입력이 완료된 파라미터 시트(아래 참조)</para>
</listitem>
</itemizedlist>
<table frame="all" rowsep="1" colsep="1">
<title>본 문서에서 사용되는 파라미터</title>
<?dbhtml table-width="100%"?>
<?dbfo table-width="100%"?>
<?dblatex table-width="100%"?>
<tgroup cols="3">
<colspec colname="col_1" colwidth="106.25*"/>
<colspec colname="col_2" colwidth="106.25*"/>
<colspec colname="col_3" colwidth="106.25*"/>
<thead>
<row>
<entry align="left" valign="top">파라미터</entry>
<entry align="left" valign="top">값</entry>
<entry align="left" valign="top">역할</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para>클러스터 노드 1</para></entry>
<entry align="left" valign="top"><para><phrase role="underline">suse01</phrase>, <phrase role="underline">192.168.1.11,192.168.1.12</phrase></para></entry>
<entry align="left" valign="top"><para>클러스터 노드 이름 및 IP 주소</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>클러스터 노드 2</para></entry>
<entry align="left" valign="top"><para><phrase role="underline">suse02</phrase>, <phrase role="underline">192.168.2.11,192.168.2.12</phrase></para></entry>
<entry align="left" valign="top"><para>클러스터 노드 이름 및 IP 주소</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>SID</para></entry>
<entry align="left" valign="top"><para><phrase role="underline">HA1</phrase></para></entry>
<entry align="left" valign="top"><para>SAP 식별자</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>인스턴스 번호</para></entry>
<entry align="left" valign="top"><para><phrase role="underline">10</phrase></para></entry>
<entry align="left" valign="top"><para>SAP HANA 데이터베이스 번호. 시스템 복제를 위해서는 인스턴스 번호+1도 차단됩니다.</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>네트워크 마스크</para></entry>
<entry align="left" valign="top"><para><phrase role="underline">255.255.255.0</phrase></para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>가상 IP주소</para></entry>
<entry align="left" valign="top"><para><phrase role="underline">10.0.0.1</phrase></para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>저장소</para></entry>
<entry align="left" valign="top"> </entry>
<entry align="left" valign="top"><para>HDB 데이터 및 로그 파일용 저장소는 “로컬”로 연결됩니다(공유 방식이 아닌 노드당).</para></entry>
</row>
</tbody>
</tgroup>
</table>
<note>
<para>AWS에서 SAP HANA 수직 확장 클러스터를 배포하기 위해 선호되는 방법은 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://docs.aws.amazon.com/launchwizard/latest/userguide/launch-wizard-sap.html">AWS Launch Wizard for SAP</link>를 사용하는 것입니다. 그러나 SAP HANA 수직 확장을 수동으로 설치하려면 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://docs.aws.amazon.com/sap/latest/sap-hana/welcome.html">AWS SAP HANA 안내</link> 문서에서 권장되는 저장소 구성 및 파일 시스템 등 자세한 설치 지침을 참조하십시오.</para>
</note>
<section xml:id="id-aws-requirements-for-suse-linux-enterprise-server-clusters">
<title>SUSE Linux Enterprise Server 클러스터를 위한 AWS 요구사항</title>
<para>SUSE Linux Enterprise Server pacemaker 클러스터는 AWS 리전에서 실행됩니다.</para>
<para>AWS 리전은 독립적인 여러 가용 영역(AZ)으로 구성되며, 이는 AWS 리전에서 중복 전원, 네트워킹 및 연결성을 가지고 있는 하나 이상의 독립 데이터 센터입니다. AZ에서 고객은 단일 데이터 센터에서 운영할 때보다 가용성, 내결함성, 확장성이 뛰어난 프로덕션 응용 프로그램 및 데이터베이스를 운영할 수 있습니다. AWS 리전의 모든 AZ는 AZ 간에 지연 시간이 짧은 고처리량 네트워킹을 제공하는 완전 복제, 전용 메트로 광섬유를 거쳐 지연 시간이 짧은 고대역폭 네트워킹으로 상호 연결되어 있습니다. AZ 간 모든 트래픽은 암호화됩니다. 네트워크 성능은 AZ 간 동기식 복제를 완수하기에 충분합니다.</para>
<para>AWS 가상 프라이빗 네트워크(VPC)는 AWS 리전 내의 모든 AZ에 걸쳐 있으므로 다음이 필요합니다.</para>
<itemizedlist>
<listitem>
<para>SAP HANA 클러스터를 구현하기 위해 리전 내에서 가용 영역 두 개를 선택합니다.</para>
</listitem>
<listitem>
<para>SUSE Linux Enterprise High Availability Extension 클러스터의 노드 두 개를 호스팅할 서브넷 하나를 두 AZ에서 식별합니다.</para>
</listitem>
<listitem>
<para>두 서브넷에 연결된 하나 이상의 라우팅 테이블을 사용합니다.</para>
</listitem>
<listitem>
<para>선택 사항으로 VPC에서 이름을 관리하는 Route53 프라이빗 호스팅 이름 지정 영역을 호스팅합니다.</para>
</listitem>
<listitem>
<para>클러스터의 모든 구성 요소 및 AWS 서비스는 동일한 Amazon 계정에 있어야 합니다. 다른 계정의 라우팅 테이블(공유 VPC 설정)과 같은 네트워킹 구성 요소를 사용하는 것은 지원되지 않습니다. 다중 계정 환경이 필요한 경우에는 AWS 담당자에게 문의하여 교차 계정/VPC 액세스를 위한 Transit GateWay를 구현하는 것이 좋습니다.</para>
</listitem>
</itemizedlist>
<para>SAP HANA 서비스용 가상 IP 주소는 AWS 오버레이 IP 주소가 됩니다. 오버레이 IP 주소는 인스턴스가 위치한 가용 영역과 관계없이 네트워크 트래픽을 인스턴스로 전송할 수 있는 AWS 고유의 라우팅 테이블 항목입니다. SUSE Linux Enterprise High Availability Extension 클러스터는 필요한 경우 이 VPC 라우팅 테이블 항목을 업데이트합니다.</para>
<para>오버레이 IP 주소는 VPC CIDR 범위와 달라야 합니다. VPC 내의 모든 SAP 시스템 구성 요소는 이 오버레이 IP 주소를 통해 AWS EC2 인스턴스에 도달할 수 있습니다.</para>
<para>AWS 가상 프라이빗 네트워크(VPC) 게이트웨이는 트래픽을 오버레이 IP 주소로 라우팅할 수 없으므로 온프레미스 사용자 및 클라이언트(예: SAP HANA Studio)는 오버레이 IP 주소에 도달할 수 없습니다. 이러한 한계를 극복하려면 AWS의 다음 오버레이 IP 설명서를 참조하여 온프레미스 클라이언트 및 사용자를 위해 오버레이 IP 주소로 네이티브 AWS 서비스를 사용하는 방법을 알아보십시오.</para>
<itemizedlist>
<listitem>
<para>SAP on AWS High Availability with Overlay IP Address Routing: <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://docs.aws.amazon.com/sap/latest/sap-hana/sap-ha-overlay-ip.html">https://docs.aws.amazon.com/sap/latest/sap-hana/sap-ha-overlay-ip.html</link></para>
</listitem>
</itemizedlist>
<para>클러스터 구현을 시작하기 전에 충족해야 하는 조건은 다음과 같습니다.</para>
<itemizedlist>
<listitem>
<para>AWS 계정이 있어야 함</para>
</listitem>
<listitem>
<para>관리자 권한 또는 다음 권한이 있는 AWS 사용자가 있어야 함:</para>
<itemizedlist>
<listitem>
<para>VPC 보안 그룹 생성 또는 수정</para>
</listitem>
<listitem>
<para>AWS VPC 라우팅 테이블 수정</para>
</listitem>
<listitem>
<para>IAM 정책을 생성하여 IAM 역할에 연결</para>
</listitem>
<listitem>
<para>EC2 인스턴스 생성 및 수정</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>아키텍처 이해하기:</para>
<itemizedlist>
<listitem>
<para>AWS 리전 및 AWS 이름 파악</para>
</listitem>
<listitem>
<para>VPC 및 AWS VPC ID 파악</para>
</listitem>
<listitem>
<para>VPC에서 사용할 가용 영역 파악</para>
</listitem>
<listitem>
<para>각 AZ의 VPC 서브넷 보유:</para>
<itemizedlist>
<listitem>
<para>두 서브넷에 묵시적으로 또는 명시적으로 연결된 하나 이상의 라우팅 테이블 보유</para>
</listitem>
<listitem>
<para>두 VPC 서브넷에 가용 IP 주소 보유</para>
</listitem>
<listitem>
<para>두 서브넷 간 네트워크 트래픽 허용</para>
</listitem>
<listitem>
<para>서브넷에서 발신 인터넷 액세스 허용</para>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<para>부록의 체크리스트를 사용하여 필요한 모든 정보를 메모한 후 설치를 시작하십시오.</para>
</section>
<section xml:id="id-security-groups">
<title>보안 그룹</title>
<para>다음 포트 및 프로토콜은 두 클러스터 노드 간 통신을 허용하도록 구성해야 합니다.</para>
<itemizedlist>
<listitem>
<para>인바운드 UDP용 포트 5405: 클러스터의 통신 레이어에 필요합니다(corosync).</para>
</listitem>
<listitem>
<para>인바운드 TCP용 포트 7630: SUSE “HAWK” 웹 GUI에서 사용됩니다.</para>
</listitem>
</itemizedlist>
<para>아웃바운드 네트워크 통신에는 제한이 없는 것으로 가정합니다.</para>
</section>
<section xml:id="id-creating-an-aws-ec2-instance">
<title>AWS EC2 인스턴스 만들기</title>
<para>SUSE Linux Enterprise High Availability Extension 클러스터를 구축하기 위해 EC2 인스턴스 두 개를 만듭니다.</para>
<para>EC2 인스턴스는 다른 가용 영역에 위치하여 서로 독립적이어야 하며, SAP HANA의 인증 하드웨어 디렉토리에 따라 인증된 SAP HANA 인스턴스 중 하나인 것이 좋습니다. SAP HANA 인증 하드웨어 디렉토리: <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Amazon%20Web%20Services">https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Amazon%20Web%20Services</link></para>
<para>AMI(Amazon Machine Image)에서 사용할 수 있는 옵션은 다음 두 가지입니다.</para>
<itemizedlist>
<listitem>
<para>이 솔루션을 위한 필수 SUSE 구독 및 모든 고가용성 구성 요소가 이미 포함된 AWS Marketplace AMI <emphasis>“SUSE Linux Enterprise Server for SAP Applications 15 SP1”</emphasis>을 사용합니다.</para>
</listitem>
<listitem>
<para>“SUSE Linux Enterprise Server for SAP” AMI를 사용합니다. AMI 목록에서 <emphasis>“suse-sles-sap-15-sp1-byos”</emphasis>를 찾습니다. 사용 가능한 BYOS (Bring Your Own Subscription) AMI가 몇 가지 있습니다. 유효한 SUSE 구독이 있다면 이 AMI를 사용하십시오. SUSE의 SMT(Subscription Management Tool) 또는 SUSE Manager를 사용하거나 SUSE Customer Center에서 직접 시스템을 등록하십시오.</para>
</listitem>
</itemizedlist>
<para>모든 EC2 인스턴스를 가용 영역(AZ)별 서브넷으로 시작하십시오. 서브넷은 서로 통신할 수 있어야 합니다.</para>
<note>
<para>AWS에서는 표준 <emphasis>“SUSE Linux Enterprise Server”</emphasis>에서 <emphasis>“SUSE Linux Enterprise Server for SAP Applications”</emphasis>로 마이그레이션할 수 없습니다. 그러므로 SUSE Linux Enterprise High Availability Extension이 포함된 “SLES for SAP” AMI를 사용하십시오.</para>
</note>
</section>
<section xml:id="id-changing-host-names">
<title>호스트 이름 변경</title>
<para>EC2 인스턴스에는 자동으로 생성되는 호스트 이름이 있으며, 이러한 자동 생성 호스트 이름은 반드시 변경해야 합니다. SAP 노트 611361을 참조하여 SAP 요구사항을 준수하는 호스트 이름을 선택하십시오.</para>
<para>호스트 이름을 변경하려면 <emphasis>/etc/cloud/cloud.cfg</emphasis>를 편집하고 호스트 이름이 유지되도록 <emphasis>preserve_hostname</emphasis> 옵션을 <emphasis>true</emphasis>로 변경합니다.</para>
<example>
<title>cloud.cfg 파일에서 변경된 옵션</title>
<screen>preserve_hostname: true</screen>
</example>
<note>
<para>SUSE Linux Enterprise를 실행하는 EC2 인스턴스의 기본 호스트 이름을 변경하는 방법에 대해 알아보려면 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://aws.amazon.com/premiumsupport/knowledge-center/linux-static-hostname-suse/">https://aws.amazon.com/premiumsupport/knowledge-center/linux-static-hostname-suse/</link>에서 AWS의 공개 문서를 참조하십시오.</para>
</note>
</section>
<section xml:id="id-tagging-the-ec2-instances">
<title>EC2 인스턴스 태그 지정</title>
<para>AWS EC2 STONITH 에이전트는 AWS 리소스 태그를 사용하여 EC2 인스턴스를 식별합니다.</para>
<para>AWS 명령줄 인터페이스(CLI) 또는 콘솔을 통해 두 개의 EC2 인스턴스에 <emphasis>pacemaker</emphasis> 같이 임의로 선택한 태그와 <emphasis>uname</emphasis> 명령으로 확인한 호스트 이름을 지정합니다. 두 인스턴스에 동일한 태그(예: <emphasis>pacemaker</emphasis>) 및 개별 호스트 이름을 사용하십시오.</para>
<para>EC2 인스턴스에 태그를 추가하는 방법은 AWS 문서: * Amazon EC2 리소스에 태그 지정(Documentation: * Tagging your Amazon EC2 resources: <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html</link>)을 참조하십시오.</para>
<para>EC2 인스턴스에 태그가 지정된 후의 예시 스크린샷을 참조하십시오. 주요 pacemaker 및 호스트 이름을 사용한 태그가 생성되었습니다. 이 예시에서 호스트 이름은 <emphasis>suse-node52</emphasis>입니다.</para>
<figure>
<title>EC2 인스턴스 태그 지정</title>
<mediaobject>
<imageobject>
<imagedata fileref="tagEC2Instance.png" width="60%"/>
</imageobject>
<textobject><phrase>tagEC2Inst</phrase></textobject>
</mediaobject>
</figure>
<para>클러스터의 두 EC2 인스턴스 부분에 태그가 지정되었는지 확인합니다.</para>
<note>
<para>클러스터 관리 리소스에 지정되는 모든 AWS 태그에는 ASCII 문자만 사용하십시오.</para>
</note>
</section>
<section xml:id="id-aws-roles-and-policies">
<title>AWS 역할 및 정책</title>
<para>SAP HANA 데이터베이스 EC2 인스턴스는 SUSE Linux Enterprise Server 클러스터 소프트웨어와 에이전트를 실행합니다. 클러스터가 올바르게 작동하려면 특정 AWS IAM 권한이 필요합니다.</para>
<para>모든 SAP HANA <emphasis>클러스터</emphasis>를 위한 새로운 IAM 역할을 만들고 이 IAM 역할을 클러스터의 두 EC2 인스턴스 부분에 연결합니다. 다음 IAM 정책을 이 IAM 역할에 연결합니다.</para>
<section xml:id="id-aws-data-provider-policy">
<title>AWS 데이터 공급자 정책</title>
<para>모든 클러스터 노드가 SAP 시스템에서 작동합니다. AWS 기반 SAP 시스템에서는 <emphasis>“AWS Data Provider for SAP”</emphasis>를 설치해야 합니다. 데이터 제공자에는 AWS 리소스에서 정보를 끌어오기 위한 정책이 필요합니다.</para>
<para><emphasis>“AWS Data Provider for SAP”</emphasis>는 AWS 계정당 정책을 하나만 가질 수 있으므로 아래에 표시된 정책은 모든 SAP 시스템에서 사용할 수 있습니다. 그러므로 이전에 <emphasis>“AWS Data Provider for SAP”</emphasis>용으로 생성한 기존 정책을 사용하거나 정책을 새로 만들 수 있습니다.</para>
<para><emphasis>“AWS Data Provider for SAP”</emphasis> IAM 정책에는 EC2 인스턴스별 권한이 포함되지 않습니다. 이 IAM 정책을 두 클러스터 인스턴스의 IAM 역할에 연결합니다.</para>
<example>
<title>AWS Data Provider for SAP용 IAM 정책</title>
<screen>{
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "EC2:DescribeInstances",
                "EC2:DescribeVolumes"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": "cloudwatch:GetMetricStatistics",
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::aws-sap-data-provider/config.properties"
        }
    ]
}</screen>
</example>
<para>AWS Data Provider for SAP에 필요한 권한에 대한 자세한 정보는 AWS 공개 문서: * AWS Data Provider for SAP(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://docs.aws.amazon.com/sap/latest/general/aws-data-provider.html">https://docs.aws.amazon.com/sap/latest/general/aws-data-provider.html</link>)를 참조하십시오.</para>
<section xml:id="id-ec2-stonith-iam-permissions">
<title>EC2 STONITH IAM 권한</title>
<para>클러스터의 EC2 인스턴스 부분에는 펜싱 작업의 일환으로 클러스터 내의 다른 노드로 API 호출을 시작 및 중지하기 위한 권한이 필요합니다. 다음 내용이 포함되고 이름(예: <emphasis>EC2-stonith-policy</emphasis>)이 지정된 IAM 정책을 만들고 클러스터 IAM 역할에 연결합니다.</para>
<example>
<title>EC2 STONITH용 IAM 정책</title>
<screen>{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "Stmt1424870324000",
            "Effect": "Allow",
            "Action": [
                "ec2:DescribeInstances",
                "ec2:DescribeTags"
            ],
            "Resource": "*"
        },
        {
            "Sid": "Stmt1424870324001",
            "Effect": "Allow",
            "Action": [
                "ec2:RebootInstances",
                "ec2:StartInstances",
                "ec2:StopInstances"
            ],
            "Resource": [
                "arn:aws:ec2:region-name:account-id:instance/instance-a",
                "arn:aws:ec2:region-name:account-id:instance/instance-b"

            ]
        }
    ]
}</screen>
</example>
<para>이 정책을 사용하면 EC2 STONITH 에이전트가 올바르게 작동하기 위해 적절한 API를 호출할 수 있습니다. 위의 예에서, 다음 변수를 적절한 이름으로 변경합니다.</para>
<itemizedlist>
<listitem>
<para>region-name : 해당 AWS 리전의 이름</para>
</listitem>
<listitem>
<para>account-id : 정책이 사용되고 있는 AWS 계정의 번호</para>
</listitem>
<listitem>
<para>instance-a and instance-b : 클러스터에 참여하고 있는 두 EC2 인스턴스의 ID</para>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="id-overlay-ip-resource-agent-iam-policy">
<title>오버레이 IP 리소스 에이전트 IAM 정책</title>
<para>오버레이 IP 리소스 에이전트에는 AWS 선택 라우팅 테이블의 라우팅 테이블 항목을 변경하기 위한 권한이 있어야 합니다. 다음과 같이 <emphasis>Manage-Overlay-IP-Policy</emphasis>와 같은 이름을 갖는 IAM 정책을 생성하여 클러스터 인스턴스의 IAM 정책에 연결하십시오.</para>
<example>
<title>AWS IP 리소스 에이전트용 IAM 정책</title>
<screen>{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": "ec2:ReplaceRoute",
            "Resource": "arn:aws:ec2:region-name:account-id:route-table/rtb-XYZ"
        },
        {
            "Sid": "VisualEditor1",
            "Effect": "Allow",
            "Action": "ec2:DescribeRouteTables",
            "Resource": "*"
        }
    ]
}</screen>
</example>
<para>이 정책을 사용하면 오버레이 IP 주소가 구성된 라우팅 테이블을 에이전트가 업데이트할 수 있습니다. 위의 예에서, 다음 변수를 적절한 이름으로 변경합니다.</para>
<itemizedlist>
<listitem>
<para>region-name : 해당 AWS 리전의 이름</para>
</listitem>
<listitem>
<para>account-id : 정책이 사용되고 있는 AWS 계정의 번호</para>
</listitem>
<listitem>
<para>rtb-XYZ : 클러스터가 구성할 VPC 라우팅 테이블 식별자. 다중 라우팅 테이블을 사용해야 하는 경우에는 더 많은 라우팅 테이블 ID를 리소스 절에 추가할 수 있습니다.</para>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="id-adding-overlay-ip-addresses-to-routing-tables">
<title>라우팅 테이블에 오버레이 IP 주소 추가</title>
<para>서브넷에 지정된 VPC 라우팅 테이블에 오버레이 IP 주소를 라우팅 항목으로 수동으로 추가합니다. IP 주소는 SAP HANA 클러스터의 가상 서비스 IP 주소입니다. 오버레이 IP 주소는 VPC의 CIDR 범위 밖에 있어야 합니다.</para>
<para>오버레이 IP 주소를 추가하려면:</para>
<itemizedlist>
<listitem>
<para>AWS 콘솔을 사용해 “VPC”를 검색하십시오.</para>
</listitem>
<listitem>
<para>올바른 VPC ID를 선택합니다.</para>
</listitem>
<listitem>
<para>왼쪽 열에서 “[라우팅 테이블]”을 클릭합니다.</para>
</listitem>
<listitem>
<para>SAP EC2 인스턴스 및 응용 프로그램 서버 중 하나의 서브넷에서 사용되는 라우팅 테이블을 선택합니다.</para>
</listitem>
<listitem>
<para>“경로” 탭을 클릭합니다.</para>
</listitem>
<listitem>
<para>“편집”을 클릭합니다.</para>
</listitem>
<listitem>
<para>목록 끝으로 스크롤하여 “다른 경로 추가”를 클릭합니다.</para>
</listitem>
<listitem>
<para>SAP HANA 데이터베이스의 오버레이 IP 주소를 추가합니다. /32를 필터로 사용하십시오(예: 192.168.10.1/32). ENI(Elastic Network Interface) 이름을 기존 인터페이스 중 하나에 추가합니다. 리소스 에이전트는 나중에 이 항목을 자동으로 수정합니다.</para>
</listitem>
<listitem>
<para>“[저장]”을 클릭하여 변경 사항을 저장합니다.</para>
</listitem>
</itemizedlist>
<note>
<para>서비스 사용자 또는 클라이언트가 있는 VPC의 모든 서브넷에 라우팅 항목이 포함된 VPC 라우팅 테이블을 상속해야 합니다. 필요한 경우 더 많은 라우팅 테이블을 추가합니다. 라우팅 테이블 상속에 대한 자세한 내용은 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html">http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html</link>에서 AWS VPC 문서를 확인하십시오.</para>
</note>
</section>
</section>
<section xml:id="id-operating-system-setup">
<title>운영 체제 설정</title>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase2.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase2</phrase></textobject>
</mediaobject>
</informalfigure>
<para>본 섹션에서는 운영 체제 설치 중에 고려해야 하는 정보를 설명합니다.</para>
<para>본 문서의 범위에서는 먼저 SUSE Linux Enterprise Server for SAP Applications를 설치 및 구성합니다. 그리고 시스템 복제가 포함된 SAP HANA 데이터베이스를 설정합니다. 마지막으로 클러스터 포함 자동화를 설정 및 구성합니다.</para>
<section xml:id="id-configuring-system-logging">
<title>시스템 로깅 구성</title>
<para>SUSE는 SUSE 클러스터에서 <literal>rsyslogd</literal>를 사용하여 로깅하는 것을 권장합니다. 최신 AMI에서는 이것이 기본 구성이지만, 일부 AWS AMI에서는 아직 <literal>syslogd</literal> 로깅을 사용할 수도 있습니다.</para>
<para>모든 클러스터 노드에서 <emphasis>root</emphasis>로 다음 명령을 실행합니다.</para>
<example>
<title>SLES15 rsyslog 설치</title>
<screen>suse01:~&gt; zypper install rsyslog</screen>
<para>설치된 패키지에 따라 아래 예시와 같이 충돌이 발생할 수 있습니다.</para>
<screen>suse01:~ # zypper install rsyslog
Refreshing service 'SMT-http_smt-ec2_susecloud_net'.
Refreshing service 'cloud_update'.
Loading repository data...
Reading installed packages...
Resolving package dependencies...
Problem: syslog-ng-3.6.4-11.1.x86_64 conflicts with namespace:otherproviders(syslog)
provided by rsyslog-8.24.0-3.16.1.x86_64
 Solution 1: deinstallation of syslog-ng-3.6.4-11.1.x86_64
 Solution 2: do not install rsyslog-8.24.0-3.16.1.x86_64
Choose from above solutions by number or cancel [1/2/c] (c):</screen>
</example>
<para>“솔루션 1: syslog-ng 설치 제거”를 선택한 후 두 노드를 재부팅합니다.</para>
<para>추가적으로 일부 클러스터 구성 요소의 경우 이벤트를 올바르게 로깅하기 위해서는 <literal>ha_logd</literal>가 필요하므로 부팅 시에 시작하도록 설정되어야 합니다.</para>
<example>
<title>자동으로 시작하도록 logd 활성화</title>
<screen>suse01:~&gt; systemctl enable --now logd</screen>
</example>
</section>
<section xml:id="id-configuring-the-aws-cli-in-the-ec2-instances">
<title>EC2 인스턴스에서 AWS CLI 구성</title>
<para>SUSE Linux Enterprise Server 에이전트는 AWS API를 호출하기 위한 기본 도구로 AWS 명령줄 인터페이스(CLI)를 사용합니다.</para>
<para>즉, 두 인스턴스에서 <emphasis>root</emphasis> 사용자에 대해 생성해야 하는 AWS CLI 프로파일을 사용합니다. SUSE 리소스 에이전트에는 텍스트 형식으로 출력을 생성하는 프로파일이 필요합니다.</para>
<para>AWS CLI 프로파일의 이름은 임의로 지정할 수 있습니다. 아래 예시에서 선택한 이름은 <emphasis>cluster</emphasis>입니다. 인스턴스의 리전도 추가해야 합니다. 아래 예시에서 <emphasis>region-name</emphasis>이라는 문자열을 대상 리전으로 교체하십시오.</para>
<para>이러한 프로파일을 생성하는 한 가지 방법은 다음과 같은 내용으로 <emphasis>/root/.aws/config</emphasis> 파일을 만드는 것입니다.</para>
<example>
<title>AWS CLI 구성 파일</title>
<screen>[default]
region = region-name
[profile cluster]
region = region-name
output = text</screen>
</example>
<para>다른 방법은 다음과 같이 <literal>aws configure</literal> CLI 명령을 사용하는 것입니다.</para>
<example>
<title>AWS CLI 프로파일 만들기</title>
<screen># aws configure
AWS Access Key ID [None]:
AWS Secret Access Key [None]:
Default region name [None]: <emphasis>region-name</emphasis>
Default output format [None]:

# aws configure --profile cluster
AWS Access Key ID [None]:
AWS Secret Access Key [None]:
Default region name [None]: region-name
Default output format [None]: text</screen>
</example>
<para>이 명령 시퀀스는 <emphasis>기본</emphasis> 프로파일 및 <emphasis>클러스터</emphasis> 프로파일을 생성합니다.</para>
</section>
<section xml:id="id-configuring-http-proxies">
<title>HTTP 프록시 구성</title>
<para>시스템에 투명한 인터넷 액세스가 구축된 경우에는 이 작업은 필요 없습니다. 리소스 에이전트는 AWS CLI(명령줄 인터페이스) 명령을 실행합니다. 이러한 명령은 HTTP/HTTPS 요청을 인터넷의 액세스 포인트로 전송합니다. 일반적으로 이러한 액세스 포인트와는 직접 통신할 수 있습니다. 투명한 인터넷 액세스를 제공하지 않는 시스템은 HTTP/HTTPS 프록시를 제공해야 합니다. 프록시 액세스 구성은 AWS 문서에 자세히 설명되어 있습니다.</para>
<para>루트 사용자의 <emphasis>.bashrc</emphasis> 및 <emphasis>/etc/sysconfig/pacemaker</emphasis> 파일에 다음과 같은 환경 변수를 추가하십시오.</para>
<example>
<title>프록시용 환경 변수</title>
<screen>export HTTP_PROXY=http://a.b.c.d:n
export HTTPS_PROXY=http://a.b.c.d:m
export NO_PROXY=169.254.169.254</screen>
</example>
<para>인증이 필요한 경우 위의 변수 대신 다음 환경 변수를 추가하십시오.</para>
<example>
<title>인증이 포함된 프록시용 환경 변수</title>
<screen>export HTTP_PROXY=http://username:password@a.b.c.d:n
export HTTPS_PROXY=http://username:password@a.b.c.d:m
export NO_PROXY=169.254.169.254</screen>
</example>
<para>프록시 시스템을 구성하기 위한 옵션도 있으며, 이와 관련한 정보는 SUSE 지원 기술 문서: - SUSE Linux Enterprise : 수동 프록시 설정 방법(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/support/kb/doc/?id=000017441">https://www.suse.com/support/kb/doc/?id=000017441</link>)에서 확인할 수 있습니다.</para>
<section xml:id="id-verifying-http-proxy-settings">
<title>HTTP 프록시 설정 확인</title>
<para>EC2 인스턴스는 EC2 메타데이터 서버 URL(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="http://169.254.169.254/latest/meta-data">http://169.254.169.254/latest/meta-data</link>)과 통신할 수 있습니다.</para>
<para>잘못 구성하면 SUSE 등록 및 EC2 STONITH 에이전트에서 문제가 발생하게 됩니다.</para>
</section>
<section xml:id="id-configuring-the-operating-system-for-sap-hana">
<title>SAP HANA를 위한 운영 체제 구성</title>
<para>SAP HANA의 모든 요구사항을 충족하는 SUSE Linux Enterprise Server for SAP Applications의 기본 설치 가이드는 다음 SAP 노트에서 확인할 수 있습니다.</para>
<itemizedlist>
<listitem>
<para>2578899 SUSE LINUX Enterprise Server 15: 설치 노트</para>
</listitem>
<listitem>
<para>2684254 SAP HANA DB: SLES 15 / SLES for SAP Applications 15용 권장 OS 설정</para>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="id-managing-networking-for-cluster-instances">
<title>클러스터 인스턴스를 위한 네트워킹 관리</title>
<section xml:id="id-adding-a-second-ip-for-each-cluster-instance">
<title>각 클러스터 인스턴스에 보조 IP 추가</title>
<para>corosync에는 중복 통신 링이 필요하므로 클러스터를 구성하려면 클러스터 인스턴스당 IP 주소 두 개가 필요합니다.</para>
<para>중복 corosync 링 구성을 사용하면 기본 IP 주소를 통해 서로 통신하는 도중 문제가 발생하는 경우 클러스터 노드가 보조 IP 주소를 사용하여 서로 통신할 수 있습니다. 따라서 불필요한 클러스터 장애 조치 및 스플릿 브레인 상황이 방지됩니다.</para>
<para>보조 IP 주소 할당 방법은 AWS 문서(<link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/MultipleIP.html#assignIP-existing">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/MultipleIP.html#assignIP-existing</link>)를 참조하십시오.</para>
<para>AWS에서 보조 IP 주소를 클러스터 인스턴스에 연결한 후에는 클러스터 인스턴스에 보조 IP 주소를 구성해야 합니다. 아래와 같이 <emphasis>/etc/sysconfig/network/ifcfg-eth0</emphasis> 파일을 업데이트합니다. XX.XX.XX.XX를 새로운 보조 IP 주소로 바꾸고 ‘XX’를 두 자리 숫자 서브넷 마스크로 바꿉니다.</para>
<example>
<title>보조 IP 주소 구성</title>
<screen>IPADDR_1="XX.XX.XX.XX/XX"
LABEL_1="1"</screen>
</example>
<para>클러스터 인스턴스가 재부팅되면 시스템이 파일을 읽고 보조 IP 주소를 추가합니다. 추가적으로, 루트로 아래 명령을 실행하면 재부팅하지 않고 IP 주소를 클러스터 인스턴스 네트워크 스택에 추가할 수 있습니다.</para>
<example>
<title>보조 IP 주소 구성</title>
<screen>ip address add XX.XX.XX.XX/XX dev eth0</screen>
</example>
<para><emphasis>XX.XX.XX.XX</emphasis>를 새로운 보조 IP 주소로 바꾸고 <emphasis>XX</emphasis>를 2자리 숫자 서브넷 마스크로 바꿉니다.</para>
</section>
<section xml:id="id-disabling-the-sourcedestination-check-for-the-cluster-instances">
<title>클러스터 인스턴스의 소스/대상 확인 비활성화</title>
<para>소스/대상 확인을 비활성화해야 합니다. 이 작업은 AWS CLI를 사용하는 스크립트 또는 AWS 콘솔을 통해 수행할 수 있습니다.</para>
<para>클러스터의 일부인 두 EC2 인스턴스에서 다음 명령을 1회 실행해야 합니다.</para>
<example>
<title>AWS CLI를 사용하여 소스/대상 확인 비활성화</title>
<screen># aws ec2 modify-instance-attribute --instance-id EC2-instance --no-source-dest-check</screen>
</example>
<para><emphasis>EC2-instance</emphasis> 변수를 두 클러스터 AWS EC2 인스턴스의 EC2 인스턴스 ID로 바꿉니다.</para>
<para>이 명령이 실행되는 시스템에는 다음 정책이 포함된 역할이 일시적으로 필요합니다.</para>
<example>
<title>소스/대상 확인을 변경해야 하는 IAM 정책</title>
<screen>{
   "Version": "2012-10-17",
   "Statement": [
   {
      "Sid": "Stmt1424870324000",
      "Effect": "Allow",
      "Action": [ "ec2:ModifyInstanceAttribute" ],
      "Resource": [
      "arn:aws:ec2:region-name:account-id:instance/instance-a",
      "arn:aws:ec2:region-name:account-id:instance/instance-b"
      ]
   }
   ]
}</screen>
</example>
<para>다음과 같은 개별 파라미터를 적절한 값으로 교체하십시오.</para>
<itemizedlist>
<listitem>
<para>region-name : 해당 AWS 리전의 이름</para>
</listitem>
<listitem>
<para>account-id : 정책이 사용되고 있는 AWS 계정의 번호</para>
</listitem>
<listitem>
<para>instance-a and instance-b : 클러스터에 참여하고 있는 두 EC2 인스턴스의 ID</para>
</listitem>
</itemizedlist>
<para>소스/대상 확인은 AWS 콘솔에서도 비활성화할 수 있습니다. 이를 위해서는 두 EC2 인스턴스에서 콘솔을 사용하여 다음 작업을 수행합니다(아래 참조).</para>
<figure>
<title>콘솔에서 소스/대상 확인 비활성화</title>
<mediaobject>
<imageobject>
<imagedata fileref="SourceDestinationCheck.png" width=""/>
</imageobject>
<textobject><phrase>SourceDestinationCheck</phrase></textobject>
</mediaobject>
</figure>
</section>
<section xml:id="id-avoiding-deletion-of-cluster-managed-ip-address-from-the-network-interface">
<title>네트워크 인터페이스에서 클러스터 관리 IP 주소 삭제 방지</title>
<para>SUSE Linux Enterprise Server에서는 EC2 인스턴스에서 자동으로 네트워크 인터페이스를 구성하는 스크립트가 포함된 <literal>cloud-netconfig-ec2</literal> 패키지가 함께 제공됩니다.</para>
<para>이 패키지는 네트워크 인터페이스에서 클러스터 에이전트가 관리하는 보조 IP 주소를 제거할 수 있습니다. 이로 인해 클러스터 서비스 사용자에게 서비스 중단이 발생할 수 있습니다. 모든 클러스터 노드에서 아래 작업을 수행하십시오.</para>
<para>다음 명령으로 <literal>cloud-netconfig-ec2</literal> 패키지가 설치되어 있는지 확인합니다.</para>
<example>
<title>cloud-netconfig-ec2 설치 여부 확인</title>
<screen># zypper info cloud-netconfig-ec2</screen>
</example>
<para>이 패키지가 설치된 경우, <emphasis>/etc/sysconfig/network/ifcfg-eth0</emphasis> 파일을 업데이트하고 다음 라인을 <emphasis role="strong">no</emphasis> 설정으로 변경합니다. 아직 패키지가 설치되지 않은 경우 다음 라인을 추가합니다.</para>
<example>
<title>CLOUD_NETCONFIG_MANAGE 비활성화</title>
<screen>CLOUD_NETCONFIG_MANAGE='no'</screen>
</example>
</section>
</section>
</section>
<section xml:id="cha.s4s.hana-install">
<title>두 클러스터 노드 모두에 SAP HANA 데이터베이스 설치</title>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase3.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase3</phrase></textobject>
</mediaobject>
</informalfigure>
<para>이 문서는 설치된 SAP HANA와 pacemaker 클러스터에 이미 설정된 시스템 복제의 통합을 중점적으로 다루지만 이 섹션에서는 테스트 환경을 요약 설명합니다. 항상 SAP의 공식 문서를 사용하여 SAP HANA를 설치하고 시스템 복제를 설정하십시오.</para>
<itemizedlist>
<title>준비</title>
<listitem>
<para>SAP Marketplace에서 제공되는 SAP 설치 및 설정 설명서를 정독합니다.</para>
</listitem>
<listitem>
<para>SAP Marketplace에서 SAP HANA 소프트웨어를 다운로드합니다.</para>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>동작</title>
<listitem>
<para>SAP HANA Server 설치 가이드에 설명된 대로 SAP HANA 데이터베이스를 설치합니다.</para>
</listitem>
<listitem>
<para>SAP 호스트 에이전트가 모든 클러스터 노드에 설치되었는지 확인합니다. SAP 서비스가 설치되지 않은 경우 지금 설치합니다.</para>
</listitem>
<listitem>
<para>데이터베이스 2개 모두가 작동 중이고 이러한 데이터베이스의 모든 프로세스가 올바르게 실행 중인지 확인합니다.</para>
</listitem>
</orderedlist>
<para>Linux 사용자 <emphasis>&lt;sid&gt;adm</emphasis>로 명령줄 도구 <emphasis>HDB</emphasis>를 사용하여 실행 중인 HANA 프로세스에 대한 개요를 살펴볼 수 있습니다. <literal>HDB</literal> <literal>info</literal>의 출력은 아래 출력과 유사해야 합니다.</para>
<screen>suse02:ha1adm&gt; HDB info
USER          PID     PPID  ... COMMAND
ha1adm      13017    ... -sh
ha1adm      13072    ...  \_ /bin/sh /usr/sap/HA1/HDB10/HDB info
ha1adm      13103    ...      \_ ps fx -U ha1adm -o user:8,pid:8,ppid:8,pcpu:5,vsz:10,rss:10,args
ha1adm       9268    ... hdbrsutil  --start --port 31003 --volume 2 --volumesuffix mnt00001/hdb00002.00003 --identifier 1580897137
ha1adm       8911    ... hdbrsutil  --start --port 31001 --volume 1 --volumesuffix mnt00001/hdb00001 --identifier 1580897100
ha1adm       8729    ... sapstart pf=/hana/shared/HA1/profile/HA1_HDB10_suse02
ha1adm       8738    ...  \_ /usr/sap/HA1/HDB10/suse02/trace/hdb.sapHA1_HDB10 -d -nw -f /usr/sap/HA1/HDB10/suse02/daemon.ini pf=/usr/sap/HA1/SYS/profile/HA1_HDB10_suse02
ha1adm       8756    ...      \_ hdbnameserver
ha1adm       9031    ...      \_ hdbcompileserver
ha1adm       9034    ...      \_ hdbpreprocessor
ha1adm       9081    ...      \_ hdbindexserver -port 31003
ha1adm       9084    ...      \_ hdbxsengine -port 31007
ha1adm       9531    ...      \_ hdbwebdispatcher
ha1adm       8574    ... /usr/sap/HA1/HDB10/exe/sapstartsrv pf=/hana/shared/HA1/profile/HA1_HDB10_suse02 -D -u ha1adm</screen>
</section>
<section xml:id="id-setting-up-sap-hana-system-replication">
<title>SAP HANA 시스템 복제 설정</title>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase4.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase4</phrase></textobject>
</mediaobject>
</informalfigure>
<para>자세한 정보는 SAP HANA 관리 가이드의 <emphasis>시스템 복제 설정</emphasis> 섹션에서 확인할 수 있습니다.</para>
<para><emphasis role="strong">절차</emphasis></para>
<orderedlist numeration="arabic">
<listitem>
<para>기본 데이터베이스 백업.</para>
</listitem>
<listitem>
<para>기본 데이터베이스 활성화.</para>
</listitem>
<listitem>
<para>보조 데이터베이스 등록.</para>
</listitem>
<listitem>
<para>시스템 복제 확인.</para>
</listitem>
</orderedlist>
<section xml:id="id-backing-up-the-primary-database">
<title>기본 데이터베이스 백업</title>
<para>SAP HANA 관리 가이드의 <emphasis>SAP HANA 데이터베이스 백업 및 복구</emphasis> 섹션의 설명을 따라 기본 데이터베이스를 백업합니다. SQL 명령이 포함된 예시가 제공됩니다. 사용자는 사용하는 백업 인프라에 맞게 이러한 백업 명령을 조정해야 합니다.</para>
<example>
<title>1회의 단일 백업 호출을 통한 시스템 데이터베이스 및 모든 테넌트의 간단한 백업</title>
<para><emphasis>&lt;sidadm&gt;</emphasis> 사용자로 다음 명령 입력:</para>
<screen>hdbsql -u SYSTEM -d SYSTEMDB \
   "BACKUP DATA FOR FULL SYSTEM USING FILE ('backup')"</screen>
<para>다음과 같은 출력(또는 유사 출력)이 제공됨:</para>
<screen>0 rows affected (overall time 15.352069 sec; server time 15.347745 sec)</screen>
</example>
<example>
<title>단일 컨테이너(비MDC) 데이터베이스를 위한 간단한 백업</title>
<para><emphasis>&lt;sidadm&gt;</emphasis> 사용자로 다음 명령 입력:</para>
<screen>hdbsql -i &lt;instanceNumber&gt; -u &lt;dbuser&gt; \
   "BACKUP DATA USING FILE ('backup')"</screen>
</example>
<important>
<para>올바르게 백업하지 않으면 SAP HANA를 시스템 복제 구성으로 가져올 수 없습니다.</para>
</important>
</section>
<section xml:id="id-enabling-primary-node">
<title>기본 노드 활성화</title>
<para>Linux 사용자 <emphasis>&lt;sid&gt;adm</emphasis>으로 기본 노드에서 시스템 복제를 활성화합니다. 사이트 이름(예: WDF)을 정의해야 합니다. 이 사이트 이름은 시스템 복제를 통해 연결된 모든 SAP HANA 데이터베이스에서 고유해야 합니다. 즉, 보조 사이트는 이름이 달라야 합니다.</para>
<note>
<para>“primary” 및 “secondary”와 같은 문자열을 사이트 이름으로 사용하지 마십시오.</para>
</note>
<example>
<title>기본 사이트 활성화</title>
<para><literal>-sr_enable</literal> 옵션을 사용하여 기본 사이트를 활성화합니다.</para>
<screen>suse01:~&gt; hdbnsutil -sr_enable --name=WDF
checking local nameserver:
checking for active nameserver ...
nameserver is running, proceeding ...
configuring ini files ...
successfully enabled system as primary site ...
done.</screen>
</example>
<example>
<title>기본 사이트에서 SR 구성 확인</title>
<para><literal>hdbnsutil -sr_stateConfiguration</literal> 명령을 사용하여 기본 사이트를 확인합니다.</para>
<screen>suse01:~&gt; hdbnsutil -sr_stateConfiguration --sapcontrol=1
SAPCONTROL-OK: &lt;begin&gt;
mode=primary
site id=1
site name=WDF
SAPCONTROL-OK: &lt;end&gt;
done.</screen>
</example>
<para>모드가 “none”에서 “primary”로 변경되며 이제 사이트가 사이트 이름 및 사이트 ID를 갖습니다.</para>
</section>
<section xml:id="id-registering-the-secondary-node">
<title>보조 노드 등록</title>
<para>보조 사이트에서 SAP HANA 데이터베이스 인스턴스를 중지한 후 인스턴스를 시스템 복제를 위해 등록할 수 있습니다. 원하는 방법을 사용하여 인스턴스(예: <literal>HDB</literal> 또는 <literal>sapcontrol</literal>)를 중지합니다. 데이터베이스 인스턴스가 중지되면 <literal>hdbnsutil</literal>을 사용하여 인스턴스를 등록할 수 있습니다. 다시 한 번, Linux 사용자 <emphasis>&lt;sid&gt;adm</emphasis>:을 사용합니다.</para>
<example>
<title>보조 사이트 중지</title>
<para>보조 사이트를 중지하려면 <emphasis>HDB</emphasis> 명령줄 도구를 사용할 수 있습니다.</para>
<screen>suse02:~&gt; HDB stop</screen>
</example>
<example>
<title>기본 사이트에서 보조 사이트로 KEY 및 KEY-DATA 파일 복사</title>
<para>SAP HANA 2.0부터 시스템 복제는 암호화되어 실행됩니다. 그러므로 키 파일을 기본 사이트에서 보조 사이트로 복사해야 합니다.</para>
<screen>cd /usr/sap/&lt;SID&gt;/SYS/global/security/rsecssfs
rsync -va {,&lt;node1-siteB&gt;:}$PWD/data/SSFS_&lt;SID&gt;.DAT
rsync -va {,&lt;node1-siteB&gt;:}$PWD/key/SSFS_&lt;SID&gt;.KEY</screen>
</example>
<example>
<title>보조 사이트 등록</title>
<para>보조 사이트는 <literal>hdbnsutil -sr_register …​</literal>를 호출하여 등록할 수 있습니다.</para>
<screen>...
suse02:~&gt; hdbnsutil -sr_register --name=ROT \
     --remoteHost=suse01 --remoteInstance=10 \
     --replicationMode=sync --operationMode=logreplay
adding site ...
checking for inactive nameserver ...
nameserver suse02:30001 not responding.
collecting information ...
updating local ini files ...
done.</screen>
</example>
<para>이 사례에서는 <emphasis>remoteHost</emphasis>가 기본 노드이며 <emphasis>remoteInstance</emphasis>는 데이터베이스 인스턴스 번호(여기서는 10)입니다.</para>
<para>이제 데이터베이스 인스턴스를 다시 시작하고 시스템 복제 상태를 확인합니다. 보조 노드에서 모드는 “SYNC” 또는 “SYNCMEM” 중 하나여야 합니다. ”ASYNC”도 가능한 복제 모드이지만, <emphasis role="strong">자동화된 클러스터 인수에서는 지원되지 않습니다</emphasis>. 모드는 보조 사이트 등록 중에 정의한 <emphasis role="strong">sync</emphasis> 옵션에 따라 다릅니다.</para>
<example>
<title>보조 사이트 시작 및 SR 구성 확인</title>
<para>새 보조 사이트를 시작하려면 <emphasis>HDB</emphasis> 명령줄 도구를 사용할 수 있습니다. 그리고 <literal>hdbnsutil -sr_stateConfiguration</literal>을 사용하여 SR 구성을 확인합니다.</para>
<screen>suse02:~&gt; HDB start
...
suse02:~&gt; hdbnsutil -sr_stateConfiguration --sapcontrol=1
SAPCONTROL-OK: &lt;begin&gt;
mode=sync
site id=2
site name=ROT
active primary site=1
primary masters=suse01
SAPCONTROL-OK: &lt;end&gt;
done.</screen>
</example>
<para>전체 SAP HANA 클러스터의 복제 상태를 확인하려면 기본 노드에서 <emphasis>&lt;sid&gt;adm</emphasis> 사용자로 다음 명령을 사용합니다:</para>
<example>
<title>시스템 복제 상태 세부 정보 확인</title>
<para>python 스크립트 <emphasis>systemReplicationStatus.py</emphasis>는 현재 시스템 복제에 대한 세부 정보를 제공합니다.</para>
<screen>suse01:~&gt; HDBSettings.sh systemReplicationStatus.py --sapcontrol=1
...
site/2/SITE_NAME=ROT1
site/2/SOURCE_SITE_ID=1
site/2/REPLICATION_MODE=SYNC
site/2/REPLICATION_STATUS=ACTIVE
site/1/REPLICATION_MODE=PRIMARY
site/1/SITE_NAME=WDF1
local_site_id=1
...</screen>
</example>
</section>
<section xml:id="id-manually-testing-sap-hana-sr-takeover">
<title>SAP HANA SR 인수의 수동 테스트</title>
<para>SAP HANA 시스템 복제를 클러스터로 통합하기 전, 반드시 수동 인수를 수행해야 합니다. 클러스터를 제외하고 테스트를 수행하여 기본 작동(인수 및 등록)이 올바르게 수행되는지 확인합니다.</para>
<itemizedlist>
<listitem>
<para>노드 1에서 SAP HANA 중지</para>
</listitem>
<listitem>
<para>SAP HANA를 노드 2로 인수</para>
</listitem>
<listitem>
<para>노드 1을 보조로 등록</para>
</listitem>
<listitem>
<para>노드 1에서 SAP HANA 시작</para>
</listitem>
<listitem>
<para>동기화 상태가 활성화될 때까지 대기</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-optional-manually-re-establishing-sap-hana-sr-to-original-state">
<title>선택 사항: SAP HANA SR을 원래 상태로 수동으로 다시 설정</title>
<para>시스템을 원래 상태로 되돌리기:</para>
<itemizedlist>
<listitem>
<para>노드 2에서 SAP HANA 중지</para>
</listitem>
<listitem>
<para>SAP HANA를 노드 1로 인수</para>
</listitem>
<listitem>
<para>노드 2를 보조로 등록</para>
</listitem>
<listitem>
<para>노드 2에서 SAP HANA 시작</para>
</listitem>
<listitem>
<para>동기화 상태가 활성화될 때까지 대기</para>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="id-setting-up-sap-hana-hadr-providers">
<title>SAP HANA HA/DR 제공자 설정</title>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase5.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase5</phrase></textobject>
</mediaobject>
</informalfigure>
<para>이 단계는 보조가 동기화되지 않은 경우 클러스터에 즉시 통지하기 위한 필수 단계입니다. 보조가 동기화되지 않는 시점에 HA/DR 제공자 인터페이스를 사용하여 SAP HANA가 후크를 호출합니다. 이는 일반적으로 대기 중인 첫 번째 커밋이 릴리스되는 경우입니다. 시스템 복제가 다시 수행되면 SAP HANA가 후크를 다시 호출합니다.</para>
<para><emphasis role="strong">절차</emphasis></para>
<orderedlist numeration="arabic">
<listitem>
<para>python 후크 SAPHanaSR 구현.</para>
</listitem>
<listitem>
<para>시스템 복제 작동 모드 구성.</para>
</listitem>
<listitem>
<para><emphasis>&lt;sidadm&gt;</emphasis>이 클러스터에 액세스하도록 허용.</para>
</listitem>
<listitem>
<para>SAP HANA 시작.</para>
</listitem>
<listitem>
<para>후크 통합 테스트.</para>
</listitem>
</orderedlist>
<section xml:id="id-implementing-the-python-hook-saphanasr">
<title>python 후크 SAPHanaSR 구현</title>
<para>이 단계는 두 사이트 모두에서 수행되어야 합니다. SAP HANA를 중지한 후 <emphasis>global.ini</emphasis> 파일을 변경하고 시작하는 동안에 SAP HANA를 HA/DR 후크 스크립트에 통합해야 합니다.</para>
<itemizedlist>
<listitem>
<para>HA/DR 후크 스크립트를 읽기/쓰기 가능 디렉토리에 설치합니다.</para>
</listitem>
<listitem>
<para>후크를 <emphasis>global.ini</emphasis> 파일에 통합(오프라인에서 수행할 수 있도록 SAP HANA를 중지해야 함)합니다.</para>
</listitem>
<listitem>
<para>시작하는 동안 후크의 통합을 확인합니다.</para>
</listitem>
</itemizedlist>
<para>SAPHanaSR 패키지에서 제공되는 후크를 사용합니다(0.153 버전부터 사용 가능). 선택 사항으로 원하는 디렉토리(예: <emphasis>/hana/share/myHooks</emphasis>)에 복사합니다. 후크는 모든 SAP HANA 클러스터 노드에서 사용할 수 있어야 합니다.</para>
<example>
<title>SAP HANA 중지</title>
<para><emphasis>HDB</emphasis> 또는 <literal>sapcontrol</literal>을 사용하여 SAP HANA를 중지합니다.</para>
<screen>sapcontrol -nr &lt;instanceNumber&gt; -function StopSystem</screen>
</example>
<example>
<title>global.ini를 통한 SAPHanaSR 추가</title>
<screen>[ha_dr_provider_SAPHanaSR]
provider = SAPHanaSR
path = /usr/share/SAPHanaSR
execution_order = 1

[trace]
ha_dr_saphanasr = info</screen>
</example>
</section>
<section xml:id="id-configuring-system-replication-operation-mode">
<title>시스템 복제 작동 모드 구성</title>
<para>시스템이 SAPHanaSR 대상으로 연결된 경우에는 <emphasis>global.ini</emphasis> 파일에서 작동 모드를 정의하는 항목을 찾을 수 있습니다. 현재 사용할 수 있는 모드는 다음과 같습니다:</para>
<itemizedlist>
<listitem>
<para><emphasis>delta_datashipping</emphasis></para>
</listitem>
<listitem>
<para><emphasis>logreplay</emphasis></para>
</listitem>
<listitem>
<para><emphasis>logreplay_readaccess</emphasis></para>
</listitem>
</itemizedlist>
<para>반대 방향으로 인수 및 재등록될 때까지는 기본 사이트에 작업 모드에 대한 항목이 없습니다. 사용할 수 있는 첫 번째 작동 모드는 <emphasis>delta_datashipping</emphasis>였습니다. 현재 HA용으로 선호되는 모드는 <emphasis>logreplay</emphasis> 또는 <emphasis>logreplay_readaccess</emphasis>입니다. <emphasis>logreplay</emphasis> 작동 모드를 사용하여 SAP HANA 시스템 복제에서 보조 사이트를 상시 대기 시스템으로 설정합니다. 모든 작동 모드에 대한 자세한 내용은 “SAP HNA를 위한 시스템 복제 수행 방법”과 같은 SAP 문서에서 확인할 수 있습니다.</para>
<example>
<title>작동 모드 확인</title>
<para>양쪽 <emphasis>global.ini</emphasis> 파일 모두를 확인하고 필요한 경우 작동 모드를 추가합니다.</para>
<variablelist>
<varlistentry>
<term>섹션</term>
<listitem>
<para>[ system_replication ]</para>
</listitem>
</varlistentry>
<varlistentry>
<term>항목</term>
<listitem>
<para>operation_mode = logreplay</para>
</listitem>
</varlistentry>
</variablelist>
<para><emphasis>global.ini</emphasis> 경로: /hana/shared/&lt;SID&gt;/global/hdb/custom/config/</para>
<screen>[system_replication]
operation_mode = logreplay</screen>
</example>
</section>
<section xml:id="id-allowing-sidadm-to-access-the-cluster">
<title>&lt;sidadm&gt;이 클러스터에 액세스하도록 허용</title>
<para>현재 SAPHanaSR python 후크 버전에서는 <literal>sudo</literal> 명령을 사용하여 <emphasis>&lt;sidadm&gt;</emphasis> 사용자가 클러스터 특성에 액세스하도록 허용할 수 있습니다. Linux에서는 <literal>visudo</literal>를 사용하여 <emphasis>/etc/sudoers</emphasis> 구성 파일을 vi 편집기에서 시작할 수 있습니다.</para>
<para><emphasis>&lt;sidadm&gt;</emphasis> 사용자는 <literal>hana_&lt;sid&gt;_site_srHook_*</literal> 클러스터 특성을 설정할 수 있어야 합니다. SAP HANA 시스템 복제 후크는 암호를 사용하지 않고 액세스할 수 있어야 합니다. 다음 예시는 sudo 액세스를 필요한 특성으로만 설정하도록 제한합니다.</para>
<para><emphasis role="strong">소문자</emphasis> SAP 시스템 ID(예: <literal>ha1</literal>)로 &lt;sid&gt;를 바꿉니다.</para>
<example>
<title>sudo 권한 /etc/sudoers 파일의 항목</title>
<para>&lt;sidadm&gt; 사용자가 srHook를 사용할 수 있도록 해주는 기본 sudoers 항목.</para>
<screen># SAPHanaSR-ScaleUp entries for writing srHook cluster attribute
&lt;sidadm&gt; ALL=(ALL) NOPASSWD: /usr/sbin/crm_attribute -n hana_&lt;sid&gt;_site_srHook_*</screen>
<para>고수준의 보안을 충족하는 보다 구체적인 sudoers 항목: 모든 <emphasis role="strong">Cmnd_Alias</emphasis> 항목은 단일 라인 항목으로 각각 정의되어야 합니다. 다음 예시에서 라인에는 문서 서식에 따라 강제로 줄 바꿈이 포함될 수 있습니다. 예시의 Cmnd_Alias 항목에는 <emphasis>&lt;sidadm&gt;</emphasis> 사용자를 위한 라인 한 개 및 주석을 위한 라인 한 개 이상을 포함하여 별도의 라인 네 개가 있습니다.</para>
<screen># SAPHanaSR-ScaleUp entries for writing srHook cluster attribute
Cmnd_Alias SOK_SITEA   = /usr/sbin/crm_attribute -n hana_&lt;sid&gt;_site_srHook_&lt;siteA&gt; -v SOK   -t crm_config -s SAPHanaSR
Cmnd_Alias SFAIL_SITEA = /usr/sbin/crm_attribute -n hana_&lt;sid&gt;_site_srHook_&lt;siteA&gt; -v SFAIL -t crm_config -s SAPHanaSR
Cmnd_Alias SOK_SITEB   = /usr/sbin/crm_attribute -n hana_&lt;sid&gt;_site_srHook_&lt;siteB&gt; -v SOK   -t crm_config -s SAPHanaSR
Cmnd_Alias SFAIL_SITEB = /usr/sbin/crm_attribute -n hana_&lt;sid&gt;_site_srHook_&lt;siteB&gt; -v SFAIL -t crm_config -s SAPHanaSR
&lt;sidadm&gt; ALL=(ALL) NOPASSWD: SOK_SITEA, SFAIL_SITEA, SOK_SITEB, SFAIL_SITEB</screen>
</example>
</section>
</section>
<section xml:id="id-configuring-the-cluster">
<title>클러스터 구성</title>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase6.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase6</phrase></textobject>
</mediaobject>
</informalfigure>
<para>이 장에서는 SUSE Linux Enterprise High Availability Extension 클러스터 소프트웨어의 구성에 대해 설명하고, 이는 SUSE Linux Enterprise Server for SAP Applications 및 SAP HANA 데이터베이스 통합의 일부입니다.</para>
<orderedlist numeration="arabic">
<title>동작</title>
<listitem>
<para>기본적인 클러스터 구성</para>
</listitem>
<listitem>
<para>클러스터 속성 및 리소스 구성</para>
</listitem>
</orderedlist>
<section xml:id="id-installation">
<title>설치</title>
<para>AWS “SLES for SAP” AMI에는 모든 High Availability Extension 패키지가 이미 설치되어 있습니다.</para>
<para>패키지를 모두 업데이트하여 최신 클러스터 패키지 버전 및 AWS 에이전트를 설치하십시오.</para>
<example>
<title>최신 패치로 SUSE Linux 업데이트</title>
<screen>suse01:~&gt; zypper update</screen>
</example>
</section>
<section xml:id="id-configuring-the-basic-cluster">
<title>기본 클러스터 구성</title>
<para>첫 번째 단계는 기본 클러스터 프레임워크를 설정하는 것입니다.</para>
<section xml:id="id-configuring-corosync">
<title>Corosync 구성</title>
<para>기본적으로 클러스터 서비스(pacemaker)는 비활성화되고 부팅 중에 시작되지 않습니다. 그러므로 이 시점에서는 클러스터가 실행 중이 아니어야 합니다. 그러나 이전에 pacemaker를 구성하고 현재 실행 중인 경우에는 다음 명령을 사용하여 “중지”를 진행합니다.</para>
<example>
<title>클러스터 중지</title>
<screen>suse01:~ # systemctl stop pacemaker</screen>
</example>
<para>클러스터 서비스(pacemaker) 상태를 다음을 통해 확인할 수 있습니다.</para>
<example>
<title>클러스터 상태 확인</title>
<screen>suse01:~ # systemctl status pacemaker</screen>
</example>
</section>
<section xml:id="id-creating-keys">
<title>키 만들기</title>
<para>노드 1에서 모든 클러스터 통신을 암호화하기 위해 사용되는 corosync 비밀 키를 만드십시오.</para>
<example>
<title>corosync 보안 키 만들기</title>
<screen>suse01:~# corosync-keygen</screen>
</example>
<para>새 키 파일이 <emphasis>/etc/corosync/authkey</emphasis>에 생성되고 이 파일을 노드 2의 동일한 위치로 복사해야 합니다. 키 파일을 생성하여 두 번째 노드로 전송한 후에는 두 노드의 권한 및 소유권이 동일한지 확인하십시오.</para>
<example>
<title>corosync 키 파일의 권한 및 소유권 확인</title>
<screen>suse01:~ # ls -l /etc/corosync/authkey
-r-------- 1 root root 128 Oct 23 10:51 /etc/corosync/authkey</screen>
</example>
</section>
<section xml:id="id-creating-the-corosync-configuration-file">
<title>Corosync 구성 파일 만들기</title>
<para>corosync 구성 파일은 각 클러스터 노드에 연결된 두 IP 주소를 사용합니다. 두 노드에 대한 기본 IP 주소가 더 이상 서로 통신할 수 없는 경우 두 IP 구성은 보조 IP를 사용합니다.</para>
<para>모든 클러스터 노드에는 로컬 구성 파일 <emphasis>“/etc/corosync/corosync.conf”</emphasis>가 있어야 하며, 이 파일의 <emphasis>interface</emphasis> 및 <emphasis>nodelist</emphasis> 섹션에 관련 정보가 있습니다. 나머지 항목은 특정 구현에 필요한 경우 구성할 수 있습니다.</para>
<para>AWS에는 특정 corosync 구성이 필요하며, 이는 아래 예시와 같이 구성할 수 있습니다.</para>
<note>
<para>다음 구성을 <emphasis>/etc/corosync/corosync.conf</emphasis> 파일의 예로 사용하는 경우. 아래 파일에서 IP 주소를 바꾸십시오.</para>
</note>
<example>
<title>샘플 corosyc.conf 파일</title>
<screen># Read the corosync.conf.5 manual page
totem {
   version: 2
   rrp_mode: passive
   token: 30000
   consensus: 36000
   token_retransmits_before_loss_const: 6
   secauth: on
   crypto_hash: sha1
   crypto_cipher: aes256
   clear_node_high_bit: yes
   interface {
      ringnumber: 0
      bindnetaddr: ip-local-node
      mcastport: 5405
      ttl: 1
   }
   transport: udpu
}
logging {
   fileline: off
   to_logfile: yes
   to_syslog: yes
   logfile: /var/log/cluster/corosync.log
   debug: off
   timestamp: on
   logger_subsys {
      subsys: QUORUM
      debug: off
   }
}
nodelist {
   node {
     ring0_addr: ip-node-1-a
     ring1_addr: ip-node-1-b # redundant ring
     nodeid: 1
   }
   node {
     ring0_addr: ip-node-2-a
     ring1_addr: ip-node-2-b # redundant ring
     nodeid: 2
   }
}
quorum {
# Enable and configure quorum subsystem (default: off)
# see also corosync.conf.5 and votequorum.5
   provider: corosync_votequorum
   expected_votes: 2
   two_node: 1
}</screen>
</example>
<para>위의 샘플 파일에서 <emphasis>ip-node-1-a</emphasis>, <emphasis>ip-node-1-b</emphasis>, <emphasis>ip-node-2-a</emphasis>, <emphasis>ip-node-2-b</emphasis> 및 <emphasis>ip-local-node</emphasis> 변수를 바꿉니다.</para>
<itemizedlist>
<listitem>
<para><emphasis role="strong"><phrase role="underline">ip-local-node</phrase></emphasis>: 파일을 구성 중인 노드의 IP 주소를 사용합니다. 이 IP는 클러스터 노드와 다릅니다.</para>
</listitem>
<listitem>
<para><emphasis role="strong"><phrase role="underline">ip-node-1-a</phrase></emphasis>: 클러스터 노드 node-1의 기본 IP 주소</para>
</listitem>
<listitem>
<para><emphasis role="strong"><phrase role="underline">ip-node-1-b</phrase></emphasis>: 클러스터 노드 node-1의 보조 IP 주소</para>
</listitem>
<listitem>
<para><emphasis role="strong"><phrase role="underline">ip-node-2-a</phrase></emphasis>: 클러스터 노드 node-2의 기본 IP 주소</para>
</listitem>
<listitem>
<para><emphasis role="strong"><phrase role="underline">ip-node-2-b</phrase></emphasis>: 클러스터 노드 node-2의 보조 IP 주소</para>
</listitem>
</itemizedlist>
<para><emphasis>crypto_cipher</emphasis> 및 <emphasis>crypto_hash</emphasis>용으로 선택한 설정은 AWS의 클러스터에 적합합니다. 그리고 강력한 클러스터 통신 암호화가 필요한 경우에는 SUSE 문서에 따라 수정할 수 있습니다.</para>
<note>
<para><phrase role="underline">hacluster</phrase> 사용자의 암호를 변경해야 합니다.</para>
</note>
</section>
<section xml:id="id-checking-the-cluster-for-the-first-time">
<title>처음으로 클러스터 확인</title>
<para>이제 두 노드에서 처음으로 클러스터를 확인하고 클러스터를 시작합니다.</para>
<example>
<title>두 클러스터 노드에서 클러스터 시작</title>
<screen>suse01:~ # systemctl status pacemaker
suse02:~ # systemctl status pacemaker
suse01:~ # systemctl start pacemaker
suse02:~ # systemctl start pacemaker</screen>
</example>
<para><literal>crm_mon</literal>으로 클러스터 상태를 확인합니다. <literal>-r</literal> 옵션을 사용하면 구성되었지만 중지된 리소스를 살펴볼 수도 있습니다. 그러나 지금 단계에서 <literal>crm_mon</literal>을 실행하면 서비스가 표시되지 않아야 합니다.</para>
<example>
<title>crm_mon 사용한 클러스터 상태 확인</title>
<screen># crm_mon -r</screen>
</example>
<para>이 명령은 “비어 있는” 클러스터를 보여주며 아래와 같은 컴퓨터 출력을 제공합니다. 현재 가장 관심이 있는 정보는 “온라인” 상태의 노드가 있다는 것과 “partition with quorum” 메시지입니다.</para>
<example>
<title>처음 시작 후 클러스터 상태</title>
<screen>Stack: corosync
Current DC: prihana (version 1.1.19+20181105.ccd6b5b10-3.19.1-1.1.19+20181105.ccd6b5b10) - partition with quorum
Last updated: Mon Sep 28 18:36:16 2020
Last change: Mon Sep 28 18:36:09 2020 by root via crm_attribute on suse01

2 nodes configured

2 nodes configured
0 resources configured

Online: [ suse01 suse02 ]

No resources</screen>
</example>
<para>Corosync의 중복 링 구성은 다음 명령으로 확인할 수 있습니다.</para>
<example>
<title>Corosync 중복 링 상태</title>
<screen>corosync-cfgtool -s</screen>
<para>이 작업을 수행하면 중복 corosync 링으로 구성되고 IP 주소가 172.16.100.179 및 172.16.100.138인 클러스터 노드에 대하여 다음과 같은 결과가 표시됩니다.</para>
<screen>Printing ring status.
Local node ID 1
RING ID 0
        id      = 172.16.100.179
        status  = ring 0 active with no faults
RING ID 1
        id      = 172.16.100.138
        status  = ring 1 active with no faults</screen>
</example>
<note>
<para>시스템 충돌이 발생한 후 재부팅하여 노드가 클러스터에 자동으로 다시 조인하도록 하는 것은 권장되지 않습니다. 클러스터를 다시 조인하기 전에 충돌의 근본 원인을 자세히 조사 및 분석하십시오.</para>
</note>
</section>
</section>
<section xml:id="id-configuring-cluster-properties-and-resources">
<title>클러스터 속성 및 리소스 구성</title>
<para>이 섹션에서는 SUSE Linux Enterprise High Availability Extension 설명서의 <emphasis>클러스터 리소스 구성 및 관리(명령줄)</emphasis> 섹션의 설명과 같이 <literal>crm configure</literal> 셸을 사용하여 제약, 리소스, 부트스트랩 및 STONITH를 구성하는 방법을 설명합니다.</para>
<para><literal>crm</literal> 명령을 사용하여 CRM에 객체를 추가합니다. 다음 예시를 로컬 파일에 복사하고 파일을 편집한 후 구성을 CIB로 로드합니다.</para>
<screen>suse01:~ # vi crm-fileXX
suse01:~ # crm configure load update crm-fileXX</screen>
<section xml:id="id-cluster-bootstrap-and-more">
<title>클러스터 부트스트랩 등</title>
<para>첫 번째 예시는 클러스터 부트스트랩 옵션, 리소스 및 작동 기본값을 정의합니다.</para>
<screen>suse01:~ # vi crm-bs.txt
# enter the following to the file crm-bs.txt
property $id="cib-bootstrap-options" \
   stonith-enabled="true" \
   stonith-action="off" \
   stonith-timeout="600s"
rsc_defaults $id="rsc-options" \
   resource-stickiness="1000" \
   migration-threshold="5000"
op_defaults $id="op-options" \
   timeout="600"</screen>
<note>
<para>일부 기존 SUSE 버전에서 <emphasis>stonith-action</emphasis> 파라미터를 사용하려면 <literal>stonith-action="poweroff"</literal>로 변경해야 할 수 있습니다.</para>
</note>
<para>펜싱 작업의 경우 <emphasis>poweroff</emphasis>로 설정하면 EC2 STONITH 에이전트가 EC2 인스턴스를 종료합니다. 이는 AWS 플랫폼에서 스플릿 브레인 상황을 방지하는 데 도움이 됩니다.</para>
<para>이제 구성을 클러스터에 추가합니다.</para>
<screen>suse01:~ # crm configure load update crm-bs.txt</screen>
</section>
<section xml:id="id-stonith-device">
<title>STONITH 장치</title>
<para>다음 구성 부분에서는 AWS EC2 STONITH 리소스를 정의합니다.</para>
<screen>suse01::~ # vi aws-stonith.txt
# enter the following to the file aws-stonith.txt
primitive res_AWS_STONITH stonith:external/ec2 \
    op start interval=0 timeout=180 \
    op stop interval=0 timeout=180 \
    op monitor interval=300 timeout=60 \
    meta target-role=Started \
    params tag=pacemaker profile=cluster pcmk_delay_max=15</screen>
<para><emphasis>“tag=pacemaker”</emphasis> 항목은 EC2 인스턴스에 대해 선택한 태그와 일치해야 합니다. 이 태그의 값에는 <literal>uname -n</literal> 명령으로 반환된 호스트 이름이 포함됩니다. 프로파일의 이름(이 예에서는 “cluster”)은 이전에 AWS CLI에서 구성한 프로파일과 일치해야 합니다.</para>
<para>이 파일의 이름을 예를 들어 <emphasis>aws-stonith.txt</emphasis>로 지정한 후 이 파일을 구성에 추가합니다. <emphasis>root</emphasis> 사용자로 다음 명령을 실행해야 합니다.</para>
<screen>suse01:~ # crm configure load update aws-stonith.txt</screen>
<para>AWS에서 지원되는 SUSE 클러스터를 실행하려면 유효한 STONITH 메서드가 필요합니다.</para>
<note>
<para>이 문서의 <emphasis>문제 해결</emphasis> 섹션에 설명된 STONITH 테스트를 실행하여 두 노드에서 STONITH를 확인합니다.</para>
</note>
</section>
<section xml:id="id-configuring-the-overlay-ip-address">
<title>오버레이 IP 주소 구성</title>
<para>이 단계에서는 AWS VPC 라우팅 테이블의 리소스 ID와 오버레이 IP 주소가 필요합니다. 다음과 같은 내용으로 파일을 만듭니다.</para>
<screen>suse01:~ # vi aws-move-ip.txt
# enter the following to the file aws-move-ip.txt
primitive res_AWS_IP ocf:suse:aws-vpc-move-ip \
   params ip=overlay-ip-address routing_table=rtb-table interface=eth0 profile=cluster \
   op start interval=0 timeout=180 \
   op stop interval=0 timeout=180 \
   op monitor interval=60 timeout=60</screen>
<para>다음과 같은 개별 파라미터를 적절한 값으로 교체하십시오.</para>
<itemizedlist>
<listitem>
<para><emphasis>overlay-ip-address</emphasis>: 사용할 오버레이 IP 주소</para>
</listitem>
<listitem>
<para><emphasis>rtb-table</emphasis>: AWS VPC 라우팅 테이블 리소스 ID - VPC 라우팅 테이블을 2개 이상 사용하는 경우에는 쉼표(,)를 구분 기호로 사용하십시오(아래 참조).</para>
</listitem>
<listitem>
<para><emphasis>interface</emphasis> : Linux의 네트워크 인터페이스 식별자</para>
</listitem>
<listitem>
<para><emphasis>profile</emphasis>: 프로파일의 이름(이 예에서는 “cluster”)은 이전에 AWS CLI에서 구성한 프로파일과 일치해야 합니다.</para>
</listitem>
</itemizedlist>
<para>수퍼 유저로 다음 명령을 실행하여 이 파일을 클러스터 구성으로 로드합니다.</para>
<screen>suse01:~ # crm configure load update aws-move-ip.txt</screen>
<para>선택 사항으로, 다음 예와 같이 쉼표(,)로 구분된 기본 구성에 여러 라우팅 테이블을 지정할 수 있습니다.</para>
<screen>suse01:~ # vi aws-move-ip.txt
# enter the following to the file aws-move-ip.txt
primitive res_AWS_IP ocf:suse:aws-vpc-move-ip \
   params ip=overlay-ip-address routing_table=rtb-table-1,rtb-table-2,rtb-table-N interface=eth0 profile=cluster \
   op start interval=0 timeout=180 \
   op stop interval=0 timeout=180 \
   op monitor interval=60 timeout=60</screen>
<note>
<para>이 문서의 <emphasis>문제 해결</emphasis> 섹션에서 설명되는 IP 테스트를 실행하여 두 노드에서 IP를 확인합니다. 지금 구성에 문제가 있는지 확인하면 클러스터를 성공적으로 시작할 수 있는 가능성이 향상됩니다.</para>
</note>
</section>
<section xml:id="id-saphanatopology">
<title>SAPHanaTopology</title>
<para>다음으로 필요한 리소스 그룹을 정의한 후 HANA 인스턴스를 시작할 수 있습니다. 예를 들어, <emphasis>crm-saphanatop.txt</emphasis>와 같이 변경 사항을 텍스트 파일로 준비한 후 다음 명령으로 로드합니다.</para>
<para><literal>crm configure load update crm-saphanatop.txt</literal></para>
<screen># vi crm-saphanatop.txt
# enter the following to crm-saphanatop.txt
primitive rsc_SAPHanaTopology_HA1_HDB10 ocf:suse:SAPHanaTopology \
        op monitor interval="10" timeout="600" \
        op start interval="0" timeout="600" \
        op stop interval="0" timeout="300" \
        params SID="HA1" InstanceNumber="10"
clone cln_SAPHanaTopology_HA1_HDB10 rsc_SAPHanaTopology_HA1_HDB10 \
        meta clone-node-max="1" interleave="true"</screen>
<para>모든 파라미터에 대한 자세한 정보는 다음 명령으로 확인 가능합니다.</para>
<para><literal>man ocf_suse_SAPHanaTopology</literal></para>
<para>다시 한 번 구성을 클러스터에 추가합니다.</para>
<screen>suse01:~ # crm configure load update crm-saphanatop.txt</screen>
<para>여기서 가장 중요한 파라미터는 SID와 InstanceNumber이며, 이는 SAP 컨텍스트에서 자동으로 설명됩니다. 이러한 파라미터외에도 시간 제한 값 또는 작동(시작, 모니터링, 중지)은 일반적으로 조정이 가능합니다.</para>
</section>
<section xml:id="id-saphana">
<title>SAPHana</title>
<para>다음 단계로, 필요한 리소스 그룹을 정의한 후 HANA 인스턴스를 시작할 수 있습니다. 예를 들어, <emphasis>crm-saphana.txt</emphasis>와 같이 변경 사항을 텍스트 파일로 편집한 후 다음 명령으로 로그합니다.</para>
<para><literal>crm configure load update crm-saphana.txt</literal></para>
<table frame="all" rowsep="1" colsep="1">
<title>다양한 시나리오에 일반적인 리소스 에이전트 파라미터 설정</title>
<?dbhtml table-width="99%"?>
<?dbfo table-width="99%"?>
<?dblatex table-width="99%"?>
<tgroup cols="4">
<colspec colname="col_1" colwidth="218.79*"/>
<colspec colname="col_2" colwidth="67.32*"/>
<colspec colname="col_3" colwidth="67.32*"/>
<colspec colname="col_4" colwidth="67.32*"/>
<thead>
<row>
<entry align="left" valign="top">파라미터</entry>
<entry align="left" valign="top">성능 최적화</entry>
<entry align="left" valign="top">비용 최적화</entry>
<entry align="left" valign="top">다중 계층</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para>PREFER_SITE_TAKEOVER</para></entry>
<entry align="left" valign="top"><para>참</para></entry>
<entry align="left" valign="top"><para>거짓</para></entry>
<entry align="left" valign="top"><para>거짓 / 참</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>AUTOMATED_REGISTER</para></entry>
<entry align="left" valign="top"><para>거짓 / 참</para></entry>
<entry align="left" valign="top"><para>거짓 / 참</para></entry>
<entry align="left" valign="top"><para>거짓</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>DUPLICATE_PRIMARY_TIMEOUT</para></entry>
<entry align="left" valign="top"><para>7200</para></entry>
<entry align="left" valign="top"><para>7200</para></entry>
<entry align="left" valign="top"><para>7200</para></entry>
</row>
</tbody>
</tgroup>
</table>
<table frame="all" rowsep="1" colsep="1">
<title>중요 리소스 에이전트 파라미터 설명</title>
<?dbhtml table-width="100%"?>
<?dbfo table-width="100%"?>
<?dblatex table-width="100%"?>
<tgroup cols="2">
<colspec colname="col_1" colwidth="178.5*"/>
<colspec colname="col_2" colwidth="246.4999*"/>
<thead>
<row>
<entry align="left" valign="top">파라미터</entry>
<entry align="left" valign="top">설명</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para>PREFER_SITE_TAKEOVER</para></entry>
<entry align="left" valign="top"><para>RA가 장애가 발생한 기본 인스턴스를 로컬로 다시 시작하는 대신 보조 인스턴스로 인수할 것인지 여부를 정의합니다.</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>AUTOMATED_REGISTER</para></entry>
<entry align="left" valign="top"><para>이전 기본 인스턴스가 새 기본 인스턴스의 보조로 자동 등록되는지 여부를 정의합니다. 이 파라미터를 사용하면 시스템 복제 자동화 수준을 조정할 수 있습니다.</para>
<para><literal>false</literal>로 설정하면 이전 기본 인스턴스를 수동으로 등록해야 합니다. 클러스터는 이중 기본 인스턴스 작동 상황을 방지하기 위해 등록될 때까지 이 SAP HANA RDBMS를 시작하지 않습니다.</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>DUPLICATE_PRIMARY_TIMEOUT</para></entry>
<entry align="left" valign="top"><para>이중 기본 인스턴스 상황이 발생하는 경우 기본 인스턴스 타임스탬프 사이에 필요한 시간 차이입니다. 시간 차이가 시간 간격보다 작은 경우 클러스터는 인스턴스 한 개 또는 둘 다를 “대기” 상태로 유지합니다. 이를 통해 관리자는 장애 조치에 대응할 수 있습니다. 이전 기본 사이트의 모든 노드에서 충돌이 발생한 경우, 시간 차이가 경과한 후 이전 기본 사이트가 등록됩니다. SAP HANA RDBMS에서만 충돌이 발생한 경우에는 이전 기본 사이트가 즉시 등록됩니다. 새 기본 사이트에 등록된 후에는 시스템 복제로 인해 모든 데이터가 덮어써집니다.</para></entry>
</row>
</tbody>
</tgroup>
</table>
<para>모든 파라미터에 대한 자세한 정보는 다음 명령으로 확인할 수 있습니다.</para>
<para><literal>man ocf_suse_SAPHana</literal></para>
<screen># vi crm-saphana.txt
# enter the following to crm-saphana.txt
primitive rsc_SAPHana_HA1_HDB10 ocf:suse:SAPHana \
        op start interval="0" timeout="3600" \
        op stop interval="0" timeout="3600" \
        op promote interval="0" timeout="3600" \
        op monitor interval="60" role="Master" timeout="700" \
        op monitor interval="61" role="Slave" timeout="700" \
        params SID="HA1" InstanceNumber="10" PREFER_SITE_TAKEOVER="true" \
        DUPLICATE_PRIMARY_TIMEOUT="7200" AUTOMATED_REGISTER="false"
ms msl_SAPHana_HA1_HDB10 rsc_SAPHana_HA1_HDB10 \
        meta clone-max="2" clone-node-max="1" interleave="true"</screen>
<para>구성을 클러스터에 추가합니다.</para>
<screen>suse01:~ # crm configure load update crm-saphana.txt</screen>
<para>여기서도 가장 중요한 파라미터는 SID 및 InstanceNumber입니다. 이러한 파라미터 외에도 작업의 시간 제한 값(시작, 승격, 모니터링, 중지)은 일반적으로 조정이 가능합니다.</para>
</section>
<section xml:id="id-constraints">
<title>제약 사항</title>
<para>두 가지 제약 사항은 클라이언트 데이터베이스에 액세스하기 위한 오버레이 IP 주소를 올바르게 설정하고 두 가지 리소스 에이전트인 SAPHana와 SAPHanaTopology 사이의 시작 순서를 구성하는 것입니다.</para>
<screen># vi crm-cs.txt
# enter the following to crm-cs.txt

colocation col_saphana_ip_HA1_HDB10 2000: res_AWS_IP:Started \
    msl_SAPHana_HA1_HDB10:Master
order ord_SAPHana_HA1_HDB10 Optional: cln_SAPHanaTopology_HA1_HDB10 \
    msl_SAPHana_HA1_HDB10</screen>
<para>파일을 클러스터에 로드합니다.</para>
<screen>suse01:~ # crm configure load update crm-cs.txt</screen>
</section>
<section xml:id="id-activeactive-read-enabled-scenario">
<title>활성/활성 읽기 지원 시나리오</title>
<para>이 단계는 선택 사항입니다. 보조 사이트에서 읽기가 지원되는 활성/활성 SAP HANA 시스템 복제가 있는 경우에는 필요한 두 번째 가상 IP 주소를 클러스터로 통합할 수 있습니다. 이 작업은 두 번째 가상 IP 주소 리소스 및 주소 바인딩 위치 제약 조건을 보조 사이트에 추가하여 수행할 수 있습니다.</para>
<screen># vi crm-re.txt
# enter the following to crm-re.txt

primitive res_AWS_IP_readenabled ocf:suse:aws-vpc-move-ip \
   params ip=readenabled-overlay-ip-address routing_table=rtb-table interface=eth0 profile=cluster \
   op start interval=0 timeout=180 \
   op stop interval=0 timeout=180 \
   op monitor interval=60 timeout=60
colocation col_saphana_ip_HA1_HDB10_readenabled 2000: \
    res_AWS_IP_readenabled:Started msl_SAPHana_HA1_HDB10:Slave</screen>
</section>
</section>
</section>
<section xml:id="cha.s4s.test-cluster">
<title>클러스터 테스트</title>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase7.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase7</phrase></textobject>
</mediaobject>
</informalfigure>
<para>테스트 목록은 이 문서의 향후 업데이트에서 향상될 예정입니다.</para>
<para>모든 클러스터 테스트는 매우 중요합니다. 고객이 예상하여 작성한 모든 테스트 사례를 구현하여 모두 통과하는지 확인합니다. 그렇지 않으면 프로덕션 중에 프로젝트가 실패할 수 있습니다.</para>
<para>별도로 설명되는 경우를 제외하고, 테스트 필수 구성 요소가 부팅되고 클러스터의 일반 멤버 및 HANA RDBMS가 실행 중이어야 합니다. 시스템 복제가 동기화 중(SOK)입니다.</para>
<section xml:id="id-test-cases-for-semi-automation">
<title>반자동화를 위한 테스트 사례</title>
<para>다음 테스트 설명에서는 다음 값을 사용합니다.</para>
<para><literal>PREFER_SITE_TAKEOVER="true"</literal> 및 <literal>AUTOMATED_REGISTER="false"</literal></para>
<note>
<para>다음 테스트는 순차적으로 실행하도록 설계되었으며, 진행 중인 테스트의 종료 상태에 따라 달라집니다.</para>
</note>
<section xml:id="id-test-stop-primary-database-on-site-a-node-1">
<title>테스트: 사이트 A에서 기본 데이터베이스 중지(노드 1)</title>
<example>
<title>STOP_PRIMARY_SITE_A 테스트</title>
<itemizedlist>
<title>구성 요소:</title>
<listitem>
<para>기본 데이터베이스</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>설명:</title>
<listitem>
<para>기본 HANA 데이터베이스는 정상 클러스터 작업 중에 중지됩니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>테스트 절차:</title>
<listitem>
<para><emphasis>&lt;sid&gt;adm</emphasis>으로서 기본 HANA 데이터베이스를 정상적으로 중지합니다.</para>
<screen>suse01# HDB stop</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>복구 절차:</title>
<listitem>
<para>기존 기본 사이트(노드 1)를 <emphasis>&lt;sid&gt;adm</emphasis>으로 인수 후 새 기본 사이트(노드 2)와 함께 수동으로 등록합니다.</para>
<screen>suse01# hdbnsutil -sr_register --remoteHost=suse02 --remoteInstance=10 \
          --replicationMode=sync --operationMode=logreplay \
          --name=WDF</screen>
</listitem>
<listitem>
<para>노드 1에서 HANA 데이터베이스(현재 보조 사이트)를 <emphasis>root</emphasis>로 다시 시작합니다.</para>
<screen>suse01# crm resource refresh rsc_SAPHana_HA1_HDB10 suse01</screen>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>예상되는 결과:</title>
<listitem>
<para>클러스터가 중지된 기본 HANA 데이터베이스(노드 1)를 감지하고 리소스를 실패로 표시합니다.</para>
</listitem>
<listitem>
<para>클러스터는 보조 HANA 데이터베이스(노드 2)를 승격하여 기본 사이트로 인수합니다.</para>
</listitem>
<listitem>
<para>클러스터는 IP 주소를 새 기본 사이트(노드 2)로 마이그레이션합니다.</para>
</listitem>
<listitem>
<para>잠시 후에 클러스터에 중지된 기본 사이트(노드 1)의 sync_state가 SFAIL로 표시됩니다.</para>
</listitem>
<listitem>
<para>AUTOMATED_REGISTER=“false”이므로 클러스터는 장애가 발생한 HANA 데이터베이스를 다시 시작하지 않거나 새 기본 사이트에 등록하지 않습니다.</para>
</listitem>
<listitem>
<para>수동 등록 및 리소스 새로 고침 후 시스템 복제 쌍이 동기화 중(SOK)으로 표시됩니다.</para>
</listitem>
<listitem>
<para>“실패한 작업” 클러스터는 다음 복구 절차 후에 정리됩니다.</para>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="id-test-stop-primary-database-on-site-b-node-2">
<title>테스트: 사이트 B에서 기본 데이터베이스 중지(노드 2)</title>
<example>
<title>STOP_PRIMARY_DB_SITE_B 테스트</title>
<itemizedlist>
<title>구성 요소:</title>
<listitem>
<para>기본 데이터베이스</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>설명:</title>
<listitem>
<para>기본 HANA 데이터베이스는 정상 클러스터 작업 중에 중지됩니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>테스트 절차:</title>
<listitem>
<para><emphasis>&lt;sid&gt;adm</emphasis>으로서 데이터베이스를 정상적으로 중지합니다.</para>
<screen>suse02# HDB stop</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>복구 절차:</title>
<listitem>
<para>기존 기본 사이트(노드 2)를 <emphasis>&lt;sid&gt;adm</emphasis>으로 인수 후 새 기본 사이트(노드 1)와 함께 수동으로 등록합니다.</para>
<screen>suse02# hdbnsutil -sr_register --remoteHost=suse01 --remoteInstance=10 \
               --replicationMode=sync --operationMode=logreplay \
               --name=ROT</screen>
</listitem>
<listitem>
<para>노드 1에서 HANA 데이터베이스(현재 보조 사이트)를 <emphasis>root</emphasis>로 다시 시작합니다.</para>
<screen>suse02# crm resource refresh rsc_SAPHana_HA1_HDB10 suse02</screen>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>예상되는 결과:</title>
<listitem>
<para>클러스터가 중지된 기본 HANA 데이터베이스(노드 2)를 감지하고 리소스를 실패로 표시합니다.</para>
</listitem>
<listitem>
<para>클러스터는 보조 HANA 데이터베이스(노드 1)를 승격하여 기본 사이트로 인수합니다.</para>
</listitem>
<listitem>
<para>클러스터는 IP 주소를 새 기본 사이트(노드 1)로 마이그레이션합니다.</para>
</listitem>
<listitem>
<para>잠시 후에 클러스터에 중지된 기본 사이트(노드 2)의 sync_state가 SFAIL로 표시됩니다.</para>
</listitem>
<listitem>
<para>AUTOMATED_REGISTER=“false”이므로 클러스터는 장애가 발생한 HANA 데이터베이스를 다시 시작하지 않거나 새 기본 사이트에 등록하지 않습니다.</para>
</listitem>
<listitem>
<para>수동 등록 및 리소스 새로 고침 후 시스템 복제 쌍이 동기화 중(SOK)으로 표시됩니다.</para>
</listitem>
<listitem>
<para>“실패한 작업” 클러스터는 다음 복구 절차 후에 정리됩니다.</para>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="id-test-crash-primary-database-on-site-a-node-1">
<title>테스트: 사이트 A에서 기본 데이터베이스 충돌(노드 1)</title>
<example>
<title>CRASH_PRIMARY_DB_SITE_A 테스트</title>
<itemizedlist>
<title>구성 요소:</title>
<listitem>
<para>기본 데이터베이스</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>설명:</title>
<listitem>
<para>기본 데이터베이스 시스템의 전체 분석을 시뮬레이션합니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>테스트 절차:</title>
<listitem>
<para><emphasis>&lt;sid&gt;adm</emphasis>으로서 신호를 사용하여 기본 데이터베이스 시스템을 종료합니다.</para>
<screen>suse01# HDB kill-9</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>복구 절차:</title>
<listitem>
<para>기존 기본 사이트(노드 1)를 <emphasis>&lt;sid&gt;adm</emphasis>으로 인수 후 새 기본 사이트(노드 2)와 함께 수동으로 등록합니다.</para>
<screen>suse01# hdbnsutil -sr_register --remoteHost=suse02 --remoteInstance=10 \
               --replicationMode=sync  --operationMode=logreplay \
               --name=WDF</screen>
</listitem>
<listitem>
<para>노드 1에서 HANA 데이터베이스(현재 보조 사이트)를 <emphasis>root</emphasis>로 다시 시작합니다.</para>
<screen>suse01# crm resource refresh rsc_SAPHana_HA1_HDB10 suse01</screen>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>예상되는 결과:</title>
<listitem>
<para>클러스터가 중지된 기본 HANA 데이터베이스(노드 1)를 감지하고 리소스를 실패로 표시합니다.</para>
</listitem>
<listitem>
<para>클러스터는 보조 HANA 데이터베이스(노드 2)를 승격하여 기본 사이트로 인수합니다.</para>
</listitem>
<listitem>
<para>클러스터는 IP 주소를 새 기본 사이트(노드 2)로 마이그레이션합니다.</para>
</listitem>
<listitem>
<para>잠시 후에 클러스터에 중지된 기본 사이트(노드 1)의 sync_state가 SFAIL로 표시됩니다.</para>
</listitem>
<listitem>
<para>AUTOMATED_REGISTER=“false”이므로 클러스터는 장애가 발생한 HANA 데이터베이스를 다시 시작하지 않거나 새 기본 사이트에 등록하지 않습니다.</para>
</listitem>
<listitem>
<para>수동 등록 및 리소스 새로 고침 후 시스템 복제 쌍이 동기화 중(SOK)으로 표시됩니다.</para>
</listitem>
<listitem>
<para>“실패한 작업” 클러스터는 다음 복구 절차 후에 정리됩니다.</para>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="id-test-crash-primary-database-on-site-b-node-2">
<title>테스트: 사이트 B에서 기본 데이터베이스 충돌(노드 2)</title>
<example>
<title>CRASH_PRIMARY_DB_SITE_B 테스트</title>
<itemizedlist>
<title>구성 요소:</title>
<listitem>
<para>기본 데이터베이스</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>설명:</title>
<listitem>
<para>기본 데이터베이스 시스템의 전체 분석을 시뮬레이션합니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>테스트 절차:</title>
<listitem>
<para><emphasis>&lt;sid&gt;adm</emphasis>으로서 신호를 사용하여 기본 데이터베이스 시스템을 종료합니다.</para>
<screen>suse02# HDB kill-9</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>복구 절차:</title>
<listitem>
<para>기존 기본 사이트(노드 2)를 <emphasis>&lt;sid&gt;adm</emphasis>으로 인수 후 새 기본 사이트(노드 1)와 함께 수동으로 등록합니다.</para>
<screen>suse02# hdbnsutil -sr_register --remoteHost=suse01 --remoteInstance=10 \
               --replicationMode=sync  --operationMode=logreplay \
               --name=ROT</screen>
</listitem>
<listitem>
<para>노드 1에서 HANA 데이터베이스(현재 보조 사이트)를 <emphasis>root</emphasis>로 다시 시작합니다.</para>
<screen>suse02# crm resource refresh rsc_SAPHana_HA1_HDB10 suse02</screen>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>예상되는 결과:</title>
<listitem>
<para>클러스터가 중지된 기본 HANA 데이터베이스(노드 2)를 감지하고 리소스를 실패로 표시합니다.</para>
</listitem>
<listitem>
<para>클러스터는 보조 HANA 데이터베이스(노드 1)를 승격하여 기본 사이트로 인수합니다.</para>
</listitem>
<listitem>
<para>클러스터는 IP 주소를 새 기본 사이트(노드 1)로 마이그레이션합니다.</para>
</listitem>
<listitem>
<para>잠시 후에 클러스터에 중지된 기본 사이트(노드 2)의 sync_state가 SFAIL로 표시됩니다.</para>
</listitem>
<listitem>
<para>AUTOMATED_REGISTER=“false”이므로 클러스터는 장애가 발생한 HANA 데이터베이스를 다시 시작하지 않거나 새 기본 사이트에 등록하지 않습니다.</para>
</listitem>
<listitem>
<para>수동 등록 및 리소스 새로 고침 후 시스템 복제 쌍이 동기화 중(SOK)으로 표시됩니다.</para>
</listitem>
<listitem>
<para>“실패한 작업” 클러스터는 다음 복구 절차 후에 정리됩니다.</para>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="id-test-crash-primary-node-on-site-a-node-1">
<title>테스트: 사이트 A에서 기본 노드 충돌(노드 1)</title>
<example>
<title>CRASH_PRIMARY_NODE_SITE_A 테스트</title>
<itemizedlist>
<title>구성 요소:</title>
<listitem>
<para>기본 사이트의 클러스터 노드</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>설명:</title>
<listitem>
<para>기본 HANA 데이터베이스가 실행되는 기본 사이트 노드의 충돌을 시뮬레이션합니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>테스트 절차:</title>
<listitem>
<para>'fast-reboot’ 시스템 요청을 전송하여 기본 노드에서 충돌을 유발합니다.</para>
<screen>suse01# echo 'b' &gt; /proc/sysrq-trigger</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>복구 절차:</title>
<listitem>
<para>클러스터 프레임워크를 시작합니다.</para>
<screen>suse01# systemctl start pacemaker</screen>
</listitem>
<listitem>
<para>기존 기본 사이트(노드 1)를 <emphasis>&lt;sid&gt;adm</emphasis>으로 인수 후 새 기본 사이트(노드 2)와 함께 수동으로 등록합니다.</para>
<screen>suse01# hdbnsutil -sr_register --remoteHost=suse02 --remoteInstance=10 \
               --replicationMode=sync  --operationMode=logreplay \
               --name=WDF</screen>
</listitem>
<listitem>
<para>노드 1에서 HANA 데이터베이스(현재 보조 사이트)를 <emphasis>root</emphasis>로 다시 시작합니다.</para>
<screen>suse01# crm resource refresh rsc_SAPHana_HA1_HDB10 suse01</screen>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>예상되는 결과:</title>
<listitem>
<para>클러스터가 장애가 발생한 노드(노드 1)를 감지하고 이를 UNCLEAN으로 선언한 후 보조 노드(노드 2)를 “partition WITHOUT quorum” 상태로 설정합니다.</para>
</listitem>
<listitem>
<para>클러스터가 장애 발생 노드(노드 1)를 펜싱합니다.</para>
</listitem>
<listitem>
<para>클러스터가 장애 발생 노드(노드 1)을 OFFLINE으로 선언합니다.</para>
</listitem>
<listitem>
<para>클러스터는 보조 HANA 데이터베이스(노드 2)를 승격하여 기본 사이트로 인수합니다.</para>
</listitem>
<listitem>
<para>클러스터는 IP 주소를 새 기본 사이트(노드 2)로 마이그레이션합니다.</para>
</listitem>
<listitem>
<para>잠시 후에 클러스터에 중지된 기본 사이트(노드 2)의 sync_state가 SFAIL로 표시됩니다.</para>
</listitem>
<listitem>
<para>AUTOMATED_REGISTER=“false”이므로 클러스터는 장애가 발생한 HANA 데이터베이스를 다시 시작하지 않거나 새 기본 사이트에 등록하지 않습니다.</para>
</listitem>
<listitem>
<para>수동 등록 및 리소스 새로 고침 후 시스템 복제 쌍이 동기화 중(SOK)으로 표시됩니다.</para>
</listitem>
<listitem>
<para>“실패한 작업” 클러스터는 다음 복구 절차 후에 정리됩니다.</para>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="id-test-crash-primary-node-on-site-b-node-2">
<title>테스트: 사이트 B에서 기본 노드 충돌(노드 2)</title>
<example>
<title>CRASH_PRIMARY_NODE_SITE_B 테스트</title>
<itemizedlist>
<title>구성 요소:</title>
<listitem>
<para>보조 사이트의 클러스터 노드</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>설명:</title>
<listitem>
<para>기본 HANA 데이터베이스가 실행되는 보조 사이트 노드의 충돌을 시뮬레이션합니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>테스트 절차:</title>
<listitem>
<para>'fast-reboot’ 시스템 요청을 전송하여 보조 노드에서 충돌을 유발합니다.</para>
<screen>suse02# echo 'b' &gt; /proc/sysrq-trigger</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>복구 절차:</title>
<listitem>
<para>클러스터 프레임워크를 시작합니다.</para>
<screen>suse02# systemctl start pacemaker</screen>
</listitem>
<listitem>
<para>기존 기본 사이트(노드 2)를 <emphasis>&lt;sid&gt;adm</emphasis>으로 인수 후 새 기본 사이트(노드 1)와 함께 수동으로 등록합니다.</para>

<screen>suse02# hdbnsutil -sr_register --remoteHost=suse01 --remoteInstance=10 \
               --replicationMode=sync  --operationMode=logreplay \
               --name=ROT</screen>
</listitem>
<listitem>
<para>노드 2에서 HANA 데이터베이스(현재 보조 사이트)를 <emphasis>root</emphasis>로 다시 시작합니다.</para>
<screen>suse02# crm resource refresh rsc_SAPHana_HA1_HDB10 suse02</screen>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>예상되는 결과:</title>
<listitem>
<para>클러스터가 장애가 발생한 보조 노드(노드 2)를 감지하고 이를 UNCLEAN으로 선언한 후 기본 노드(노드 1)를 “partition WITHOUT quorum” 상태로 설정합니다.</para>
</listitem>
<listitem>
<para>클러스터가 장애 발생 보조 노드(노드 2)를 펜싱합니다.</para>
</listitem>
<listitem>
<para>클러스터가 장애 발생 보조 노드(노드 2)을 OFFLINE으로 선언합니다.</para>
</listitem>
<listitem>
<para>클러스터는 보조 HANA 데이터베이스(노드 1)를 승격하여 기본 사이트로 인수합니다.</para>
</listitem>
<listitem>
<para>클러스터는 IP 주소를 새 기본 사이트(노드 1)로 마이그레이션합니다.</para>
</listitem>
<listitem>
<para>잠시 후에 클러스터에 중지된 보조 사이트(노드 2)의 sync_state가 SFAIL로 표시됩니다.</para>
</listitem>
<listitem>
<para>AUTOMATED_REGISTER=“false”이므로 클러스터는 장애가 발생한 HANA 데이터베이스를 다시 시작하지 않거나 새 기본 사이트에 등록하지 않습니다.</para>
</listitem>
<listitem>
<para>수동 등록 및 리소스 새로 고침 후 시스템 복제 쌍이 동기화 중(SOK)으로 표시됩니다.</para>
</listitem>
<listitem>
<para>“실패한 작업” 클러스터는 다음 복구 절차 후에 정리됩니다.</para>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="id-test-stop-the-secondary-database-on-site-b-node-2">
<title>테스트: 사이트 B에서 보조 데이터베이스 중지(노드 2)</title>
<example>
<title>STOP_SECONDARY_DB_SITE_B 테스트</title>
<itemizedlist>
<title>구성 요소:</title>
<listitem>
<para>보조 HANA 데이터베이스</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>설명:</title>
<listitem>
<para>보조 HANA 데이터베이스는 정상 클러스터 작업 중에 중지됩니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>테스트 절차:</title>
<listitem>
<para><emphasis>&lt;sid&gt;adm</emphasis>으로서 보조 HANA 데이터베이스를 정상적으로 중지합니다.</para>
<screen>suse02# HDB stop</screen>
</listitem>
</itemizedlist>
<itemizedlist>
<title>복구 절차:</title>
<listitem>
<para><emphasis>root</emphasis>로 보조 HANA 데이터베이스(노드 2)의 장애가 발생한 리소스 상태를 새로 고칩니다.</para>
<screen>suse02# crm resource refresh rsc_SAPHana_HA1_HDB10 suse02</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>예상되는 결과:</title>
<listitem>
<para>클러스터가 중지된 보조 데이터베이스(노드 2)를 감지하고 리소스를 실패로 표시합니다.</para>
</listitem>
<listitem>
<para>클러스터가 중단된 시스템 복제를 감지하고 이를 실패(SFAIL)로 표시합니다.</para>
</listitem>
<listitem>
<para>클러스터가 동일한 노드(노드 2)에서 보조 HANA 데이터베이스를 다시 시작합니다.</para>
</listitem>
<listitem>
<para>클러스터가 시스템 복제가 동기화 중임을 다시 감지하고 이를 ok(SOK)로 표시합니다.</para>
</listitem>
<listitem>
<para>“실패한 작업” 클러스터는 다음 복구 절차 후에 정리됩니다.</para>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="id-test-crash-the-secondary-database-on-site-b-node-2">
<title>테스트: 사이트 B에서 보조 데이터베이스 충돌(노드 2)</title>
<example>
<title>CRASH_SECONDARY_DB_SITE_B 테스트</title>
<itemizedlist>
<title>구성 요소:</title>
<listitem>
<para>보조 HANA 데이터베이스</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>설명:</title>
<listitem>
<para>보조 데이터베이스 시스템의 전체 분석을 시뮬레이션합니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>테스트 절차:</title>
<listitem>
<para><emphasis>&lt;sid&gt;adm</emphasis>으로서 신호를 사용하여 보조 데이터베이스 시스템을 종료합니다.</para>
<screen>suse02# HDB kill-9</screen>
</listitem>
</itemizedlist>
<itemizedlist>
<title>복구 절차:</title>
<listitem>
<para><emphasis>root</emphasis>로 보조 HANA 데이터베이스(노드 2)의 장애가 발생한 리소스 상태를 정리합니다.</para>
<screen>suse02# crm resource refresh rsc_SAPHana_HA1_HDB10 suse02</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>예상되는 결과:</title>
<listitem>
<para>클러스터가 중지된 보조 데이터베이스(노드 2)를 감지하고 리소스를 실패로 표시합니다.</para>
</listitem>
<listitem>
<para>클러스터가 중단된 시스템 복제를 감지하고 이를 실패(SFAIL)로 표시합니다.</para>
</listitem>
<listitem>
<para>클러스터가 동일한 노드(노드 2)에서 보조 HANA 데이터베이스를 다시 시작합니다.</para>
</listitem>
<listitem>
<para>클러스터가 시스템 복제가 동기화 중임을 다시 감지하고 이를 ok(SOK)로 표시합니다.</para>
</listitem>
<listitem>
<para>“실패한 작업” 클러스터는 다음 복구 절차 후에 정리됩니다.</para>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="id-test-crash-the-secondary-node-on-site-b-node2">
<title>테스트: 사이트 B에서 보조 노드 충돌(노드 2)</title>
<example>
<title>CRASH_SECONDARY_NODE_SITE_B 테스트</title>
<itemizedlist>
<title>구성 요소:</title>
<listitem>
<para>보조 사이트의 클러스터 노드</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>설명:</title>
<listitem>
<para>보조 HANA 데이터베이스가 실행되는 보조 사이트 노드의 충돌을 시뮬레이션합니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>테스트 절차:</title>
<listitem>
<para>'fast-reboot’ 시스템 요청을 전송하여 보조 노드에서 충돌을 유발합니다.</para>
<screen>suse02# echo 'b' &gt; /proc/sysrq-trigger</screen>
</listitem>
</itemizedlist>
<itemizedlist>
<title>복구 절차:</title>
<listitem>
<para>클러스터 프레임워크를 시작합니다.</para>
<screen>suse02# systemctl start pacemaker</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>예상되는 결과:</title>
<listitem>
<para>클러스터가 장애가 발생한 보조 노드(노드 2)를 감지하고 이를 UNCLEAN으로 선언한 후 기본 노드(노드 1)를 “partition WITHOUT quorum” 상태로 설정합니다.</para>
</listitem>
<listitem>
<para>클러스터가 장애 발생 보조 노드(노드 2)를 펜싱합니다.</para>
</listitem>
<listitem>
<para>클러스터가 장애 발생 보조 노드(노드 2)을 OFFLINE으로 선언합니다.</para>
</listitem>
<listitem>
<para>잠시 후에 클러스터에 중지된 보조 사이트(노드 2)의 sync_state가 SFAIL로 표시됩니다.</para>
</listitem>
<listitem>
<para>펜싱된 노드(노드 2)가 클러스터에 다시 합류하면 이전 보조 HANA 데이터베이스가 자동으로 시작됩니다.</para>
</listitem>
<listitem>
<para>클러스터가 시스템 복제가 동기화 중임을 다시 감지하고 이를 ok(SOK)로 표시합니다.</para>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="id-test-failure-of-replication-lan">
<title>테스트: 복제 LAN의 장애</title>
<para>구성 요소: 복제 LAN</para>
<para>설명: 이 테스트는 AWS에 해당하지 않습니다. 별도의 복제 LAN이 없습니다.</para>
</section>
</section>
<section xml:id="id-test-cases-for-full-automation">
<title>완전 자동화를 위한 테스트 사례</title>
<para>다음 테스트 설명에서는 다음 값을 사용합니다.</para>
<para><literal>PREFER_SITE_TAKEOVER="true"</literal> 및 <literal>AUTOMATED_REGISTER="true"</literal></para>
<note>
<para>다음 테스트는 순차적으로 실행하도록 설계되었으며, 진행 중인 테스트의 종료 상태에 따라 달라집니다.</para>
</note>
<section xml:id="id-test-stop-primary-database-on-site-a">
<title>테스트: 사이트 A에서 기본 데이터베이스 중지</title>
<example>
<title>STOP_PRIMARY_DB_SITE_A 테스트</title>
<itemizedlist>
<title>구성 요소:</title>
<listitem>
<para>기본 데이터베이스</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>설명:</title>
<listitem>
<para>기본 HANA 데이터베이스는 정상 클러스터 작업 중에 중지됩니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>테스트 절차:</title>
<listitem>
<para><emphasis>&lt;sid&gt;adm</emphasis>으로서 기본 HANA 데이터베이스를 정상적으로 중지합니다.</para>
<screen>suse01# HDB stop</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>복구 절차:</title>
<listitem>
<para>필요하지 않은 경우 모든 사항이 자동화됩니다.</para>
</listitem>
<listitem>
<para>루트로서 노드 1에서 클러스터 리소스를 새로 고칩니다.</para>
<screen>suse01# crm resource refresh rsc_SAPHana_HA1_HDB10 suse01</screen>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>예상되는 결과:</title>
<listitem>
<para>클러스터가 중지된 기본 HANA 데이터베이스(노드 1)를 감지하고 리소스를 실패로 표시합니다.</para>
</listitem>
<listitem>
<para>클러스터는 보조 HANA 데이터베이스(노드 2)를 승격하여 기본 사이트로 인수합니다.</para>
</listitem>
<listitem>
<para>클러스터는 IP 주소를 새 기본 사이트(노드 2)로 마이그레이션합니다.</para>
</listitem>
<listitem>
<para>잠시 후에 클러스터에 중지된 기본 사이트(노드 1)의 sync_state가 SFAIL로 표시됩니다.</para>
</listitem>
<listitem>
<para>AUTOMATED_REGISTER=“true”이므로 클러스터는 장애가 발생한 HANA 데이터베이스를 다시 시작하고 새 기본 사이트에 등록합니다.</para>
</listitem>
<listitem>
<para>자동 등록 및 리소스 새로 고침 후 시스템 복제 쌍이 동기화 중(SOK)으로 표시됩니다.</para>
</listitem>
<listitem>
<para>“실패한 작업” 클러스터는 다음 복구 절차 후에 정리됩니다.</para>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="id-test-crash-the-primary-node-on-site-b-node-2">
<title>테스트: 사이트 B에서 기본 노드 충돌(노드 2)</title>
<example>
<title>CRASH_PRIMARY_NODE_SITE_B 테스트</title>
<itemizedlist>
<title>구성 요소:</title>
<listitem>
<para>B 사이트의 클러스터 노드</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>설명:</title>
<listitem>
<para>기본 HANA 데이터베이스가 실행되는 사이트 B의 충돌을 시뮬레이션합니다.</para>
</listitem>
</itemizedlist>
<itemizedlist>
<title>테스트 절차:</title>
<listitem>
<para>'fast-reboot’ 시스템 요청을 전송하여 보조 노드에서 충돌을 유발합니다.</para>
<screen>suse02# echo 'b' &gt; /proc/sysrq-trigger</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>복구 절차:</title>
<listitem>
<para>클러스터 프레임워크를 시작합니다.</para>
<screen>suse02# systemctl start pacemaker</screen>
</listitem>
<listitem>
<para><emphasis>root</emphasis>로 노드 2에서 클러스터 리소스를 새로 고칩니다.</para>
<screen>suse02# crm resource refresh rsc_SAPHana_HA1_HDB10 suse02</screen>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>예상되는 결과:</title>
<listitem>
<para>클러스터가 장애가 발생한 기본 노드(노드 2)를 감지하고 이를 UNCLEAN으로 선언한 후 기본 노드(노드 2)를 “partition WITHOUT quorum” 상태로 설정합니다.</para>
</listitem>
<listitem>
<para>클러스터가 장애 발생 기본 노드(노드 2)를 펜싱합니다.</para>
</listitem>
<listitem>
<para>클러스터가 장애 발생 기본 노드(노드 2)을 OFFLINE으로 선언합니다.</para>
</listitem>
<listitem>
<para>클러스터는 보조 HANA 데이터베이스(노드 1)를 승격하여 기본 사이트로 인수합니다.</para>
</listitem>
<listitem>
<para>클러스터는 IP 주소를 새 기본 사이트(노드 1)로 마이그레이션합니다.</para>
</listitem>
<listitem>
<para>잠시 후에 클러스터에 중지된 보조 사이트(노드 2)의 sync_state가 SFAIL로 표시됩니다.</para>
</listitem>
<listitem>
<para>펜싱된 노드(노드 2)가 클러스터에 다시 합류하면 이전 기본 노드가 보조가 됩니다.</para>
</listitem>
<listitem>
<para>AUTOMATED_REGISTER=“true”이므로 클러스터는 장애가 발생한 HANA 데이터베이스를 다시 시작하고 새 기본 사이트에 등록합니다.</para>
</listitem>
<listitem>
<para>클러스터가 시스템 복제가 동기화 중임을 다시 감지하고 이를 ok(SOK)로 표시합니다.</para>
</listitem>
</orderedlist>
</example>
</section>
</section>
</section>
<section xml:id="cha.hana-sr.administrate">
<title>관리</title>
<section xml:id="id-dos-and-donts">
<title>권장 작업 및 금지 작업</title>
<para>프로젝트에서 수행해야 할 사항은 다음과 같습니다.</para>
<itemizedlist>
<listitem>
<para>STONITH를 정의한 후 기타 리소스를 클러스터에 추가합니다.</para>
</listitem>
<listitem>
<para>집중적인 테스트를 수행합니다.</para>
</listitem>
<listitem>
<para>SAPHana 및 SAPHanaTopology 작업의 시간 제한을 조정합니다.</para>
</listitem>
<listitem>
<para>PREFER_SITE_TAKEOVER="true", AUTOMATED_REGISTER="false" 및 DUPLICATE_PRIMARY_TIMEOUT="7200" 값으로 시작합니다.</para>
</listitem>
</itemizedlist>
<para>프로젝트에서 다음과 같은 작업은 하지 않는 것이 좋습니다.</para>
<itemizedlist>
<listitem>
<para>노드를 대기로 설정한 후 다시 온라인으로 전환하거나 마스터/슬레이브 리소스 중지/시작과 같이 클러스터 구성을 빠르게 변경/다시 변경</para>
</listitem>
<listitem>
<para>호스트, 사용자 및 그룹에 대해 불안정한 이름을 사용하거나 적절한 시간 동기화 없이 클러스터 생성</para>
</listitem>
<listitem>
<para>클론, 마스터/슬레이브 또는 IP 리소스에 대한 위치 규칙 추가. 이 설정 가이드에 설명된 위치 규칙만 허용됩니다.</para>
</listitem>
<listitem>
<para>crm-shell, HAWK 또는 기타 도구에서의 리소스 “마이그레이션” 또는 “이동”. 그러면 클라이언트 선호 위치 규칙을 추가하게 되므로 이러한 작업은 엄격하게 금지됩니다.</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="id-monitoring-and-tools">
<title>모니터링 및 도구</title>
<para>클러스터 상태 요청을 위해 High Availability Web Console(HAWK), SAP HANA Studio 및 다른 명령줄 도구를 사용할 수 있습니다.</para>
<section xml:id="id-hawk-cluster-status-and-more">
<title>HAWK – 클러스터 상태 등</title>
<para>인터넷 브라우저를 사용하여 클러스터 상태를 확인할 수 있습니다.</para>
<figure>
<title>HAWK에서의 클러스터 상태</title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleUp-HAWK-Status-SLE12.png" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleUp HAWK Status SLE12</phrase></textobject>
</mediaobject>
</figure>
<para>위의 설명과 같이 ha-cluster-init을 사용하여 클러스터를 설정하고 모든 패키지를 설치하면 시스템은 매우 유용한 웹 인터페이스를 제공합니다. 이 그래픽 웹 인터페이스를 사용하면 전체 클러스터 상태의 개요를 살펴보거나 관리 작업을 수행하거나 리소스 및 클러스터 부트스트랩 파라미터를 구성할 수 있습니다. 이러한 강력한 사용자 인터페이스에 대한 설명서 전문은 제품 설명서를 참조하십시오.</para>
</section>
<section xml:id="id-sap-hana-studio">
<title>SAP HANA Studio</title>
<para>데이터베이스별 관리 및 확인은 SAP HANA 스튜디오를 통해 수행할 수 있습니다.</para>
<figure>
<title>SAP HANA Studio – 환경</title>
<mediaobject>
<imageobject>
<imagedata fileref="hana_studio_landscape.png" width="100%"/>
</imageobject>
<textobject><phrase>hana studio landscape</phrase></textobject>
</mediaobject>
</figure>
</section>
<section xml:id="id-cluster-command-line-tools">
<title>클러스터 명령줄 도구</title>
<para>간략한 개요는 <literal>crm_mon</literal>을 호출하여 확인할 수 있습니다. <literal>-r</literal> 옵션을 사용해도 중지되었지만 이미 구성된 리소스가 표시됩니다. <literal>-1</literal> 옵션은 <literal>crm_mon</literal>이 주기적이 아닌 한 번 상태를 출력하도록 명령합니다.</para>
<screen>Stack: corosync
Current DC: suse01 (version 1.1.19+20181105.ccd6b5b10-3.19.1-1.1.19+20181105.ccd6b5b10) - partition with quorum
Last updated: Mon Sep 28 18:36:16 2020
Last change: Mon Sep 28 18:36:09 2020 by root via crm_attribute on prihana

2 nodes configured
6 resources configured

Online: [ suse01 suse02 ]

Full list of resources:

 res_AWS_STONITH        (stonith:external/ec2): Started suse01
 res_AWS_IP     (ocf::suse:aws-vpc-move-ip):    Started suse01
 Clone Set: cln_SAPHanaTopology_HDB_HDB00 [rsc_SAPHanaTopology_HDB_HDB00]
     Started: [ suse01 suse02 ]
 Master/Slave Set: msl_SAPHana_HDB_HDB00 [rsc_SAPHana_HDB_HDB00]
     Masters: [ suse01 ]
     Slaves: [ suse02 ]</screen>
<para>자세한 내용은 설명서 페이지 crm_mon(8)을 참조하십시오.</para>
</section>
<section xml:id="id-saphanasr-command-line-tools">
<title>SAPHanaSR 명령줄 도구</title>
<para>일부 SAPHana 또는 SAPHanaTopology 리소스 에이전트 내부 값을 표시하려면, <literal>SAPHanaSR-showAttr</literal> 프로그램을 호출할 수 있습니다. 내부 값, 저장소 위치 및 파라미터 이름은 이 문서의 다음 버전에서 변경될 수 있습니다. <literal>SAPHanaSR-showAttr</literal> 명령은 항상 올바른 저장소 위치에서 값을 가져옵니다.</para>
<para><literal>crm_attribute</literal>와 같은 클러스터 명령을 사용하여 클러스터에서 직접 값을 가져오지 마십시오. 그러한 명령을 사용하면, 속성을 다른 저장소 또는 클러스터 외부로 이동해야 할 때 메서드가 중단됩니다. 우선 <emphasis>SAPHanaSR-showAttr</emphasis>은 테스트 프로그램이며 자동 시스템 모니터링에 사용할 수 없습니다.</para>
<screen> suse01:~ # SAPHanaSR-showAttr
 Host \ Attr clone_state remoteHost roles       ... site    srmode sync_state ...
 ---------------------------------------------------------------------------------
 suse01      PROMOTED    suse02     4:P:master1:... WDF      sync  PRIM       ...
 suse02      DEMOTED     suse01     4:S:master1:... ROT      sync  SOK        ...</screen>
<para><literal>SAPHanaSR-showAttr</literal>는 <emphasis role="strong">script</emphasis>와 같은 기타 출력 형식도 지원합니다. 스크립트 형식의 목적은 실행 중인 파일을 허용하는 것입니다. 0.153 버전부터 SAPHanaSR 패키지는 <literal>SAPHanaSR-filter</literal> 필터 엔진도 제공합니다. <literal>SAPHanaSR-showAttr</literal>과 함께 출력 형식 스크립트 및 <literal>SAPHanaSR-filter</literal>를 사용하면 다음과 같은 효과적인 쿼리를 정의할 수 있습니다.</para>
<screen>suse01:~ # SAPHanaSR-showAttr --format=script | \
   SAPHanaSR-filter --search='remote'
Thu Feb  6 12:28:10 2020; Hosts/suse01/remoteHost=suse02
Thu Feb  6 12:28:10 2020; Hosts/suse02/remoteHost=suse01</screen>
<para><literal>SAPHanaSR-replay-archive</literal>는 <literal>hb_report</literal>(<literal>crm_report</literal>) 아카이브에서 SAPHanaSR 속성 값을 분석할 수 있습니다. 이를 통해 사후 분석을 수행할 수 있습니다.</para>
<para>예시에서, 관리자는 <literal>HDB kill-9</literal> 명령을 사용하여 기본 SAP HANA 인스턴스를 종료했습니다. 이 작업은 오후 9:10 경에 수행되었습니다.</para>
<screen>suse01:~ # hb_report -f 19:00
INFO: suse01# The report is saved in ./hb_report-1-11-11-2019.tar.bz2
INFO: suse01# Report timespan: 11/11/19 19:00:00 - 11/11/19 21:05:33
INFO: suse01# Thank you for taking time to create this report.
suse01:~ # SAPHanaSR-replay-archive --format=script \
    ./hb_report-1-11-11-2019.tar.bz2 | \
    SAPHanaSR-filter --search='roles' --filterDouble
Mon Nov 11 20:38:01 2019; Hosts/suse01/roles=4:P:master1:master:worker:master
Mon Nov 11 20:38:01 2019; Hosts/suse02/roles=4:S:master1:master:worker:master
Mon Nov 11 21:11:37 2019; Hosts/suse01/roles=1:P:master1::worker:
Mon Nov 11 21:12:43 2019; Hosts/suse02/roles=4:P:master1:master:worker:master</screen>
<para>위의 예시에서 속성에 따르면 처음에 suse01이 기본 (4:P)를 실행하고 suse02는 보조 (4:S)가 실행되었습니다.</para>
<para>21:11(CET)에는 suse01에서 기본이 갑자기 종료되어 1:P로 감소했습니다.</para>
<para>클러스터가 참가하여 인수가 시작되었습니다. 21:12(CET)에는 이전 보조가 새로 실행 중인 마스터로 감지(4:S에서 4:P로 변경)되었습니다.</para>
</section>
<section xml:id="id-sap-hana-landscapehostconfiguration">
<title>SAP HANA LandscapeHostConfiguration</title>
<para>SAPHana 데이터베이스의 상태를 확인하고 클러스터가 응답하는지 여부를 살펴보려면 Linux 사용자 <emphasis>&lt;sid&gt;adm</emphasis>으로 호출할 수 있는 <emphasis role="strong">landscapeHostConfiguration</emphasis> 스크립트를 사용하면 됩니다.</para>
<screen>suse01:~&gt; HDBSettings.sh landscapeHostConfiguration.py
| Host   | Host   | ... NameServer   | NameServer  | IndexServer | IndexServer |
|        | Active | ... Config Role  | Actual Role | Config Role | Actual Role |
| ------ | ------ | ... ------------ | ----------- | ----------- | ----------- |
| suse01 | yes    | ... master 1     | master      | worker      | master      |

overall host status: ok</screen>
<para>SAP HA 지침에 따라 SAPHana 리소스 에이전트를 반환 코드를 다음과 같이 해석합니다.</para>
<table frame="all" rowsep="1" colsep="1">
<title>반환 코드 해석</title>
<?dbhtml table-width="100%"?>
<?dbfo table-width="100%"?>
<?dblatex table-width="100%"?>
<tgroup cols="2">
<colspec colname="col_1" colwidth="63.75*"/>
<colspec colname="col_2" colwidth="361.25*"/>
<thead>
<row>
<entry align="left" valign="top">반환 코드</entry>
<entry align="left" valign="top">해석</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para>4</para></entry>
<entry align="left" valign="top"><para>SAP HANA 데이터베이스가 정상적으로 실행됩니다. 클러스터는 이를 올바르게 실행 중인 데이터베이스로 해석합니다.</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>3</para></entry>
<entry align="left" valign="top"><para>SAP HANA 데이터베이스가 정보 상태로 실행됩니다. 클러스터는 이를 올바르게 실행 중인 데이터베이스로 해석합니다.</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>2</para></entry>
<entry align="left" valign="top"><para>SAP HANA 데이터베이스가 경고 상태로 실행됩니다. 클러스터는 이를 올바르게 실행 중인 데이터베이스로 해석합니다.</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>1</para></entry>
<entry align="left" valign="top"><para>SAP HANA 데이터베이스가 작동하지 않습니다. 데이터베이스가 작동 중이어야 하고 의도적으로 작동을 중지하지 않는 경우 인수가 트리거될 수 있습니다.</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>0</para></entry>
<entry align="left" valign="top"><para>내부 스크립트 오류 - 무시 예정.</para></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
</section>
<section xml:id="id-maintenance">
<title>유지보수</title>
<para>운영 체제 또는 SUSE Linux Enterprise High Availability Extension의 업데이트를 받아보려면 로컬 SUSE 관리자 또는 Repository Mirroring Tool(SMT)에 시스템을 등록하거나 SUSE Customer Center를 통해 원격으로 시스템을 등록하는 것이 좋습니다.</para>
<section xml:id="id-updating-the-operating-system-and-cluster">
<title>운영 체제 및 클러스터 업데이트</title>
<para>클러스터 소프트웨어가 포함된 SUSE Linux Enterprise Server for SAP Applications 패키지를 업데이트하려면 SUSE Linux Enterprise High Availability Extension 제품 설명서에 정의된 롤링 업데이트 절차를 따르십시오. SUSE Linux Enterprise High Availability 관리 가이드의 <emphasis>클러스터 업그레이드 및 소프트웨어 패키지 업데이트</emphasis> 섹션에 자세히 설명되어 있습니다.</para>
</section>
<section xml:id="id-updating-sap-hana-seamless-sap-hana-maintenance">
<title>SAP HANA 업데이트 - 원활한 SAP HANA 유지보수</title>
<para>시스템 복제에서 SAP HNA 데이터베이스 시스템을 업데이트하려면 정의된 SAP 절차를 따라야 합니다. 이 섹션에서는 시스템 복제를 다시 자동화하기 위한 업데이트 절차 전 및 후에 수행되어야 하는 단계를 설명합니다.</para>
<para>SUSE는 클러스터에서 SAP HANA 유지보수 프로세스를 최적화했습니다. 향상된 절차에서는 마스터-슬레이브-리소스만 유지보수로 설정하고 클러스터의 나머지 부분(SAPHanaTopology 클론 및 IPaddr2 vIP 리소스)은 활성으로 유지합니다. 업데이트된 절차를 사용하면 오버레이 IP 주소가 실행 중인 기본을 자동으로 따르므로 클러스터에서 SAP HANA를 원활하게 유지보수할 수 있습니다.</para>
<para>SAP HANA 데이터베이스 시스템에서 수행할 유지보수 작업에 클러스터가 응답하지 않도록 준비합니다. 마스터-슬레이브-리소스를 관리되지 않도록 설정하고 클러스터 노드를 유지보수 모드로 설정합니다.</para>
<example>
<title>기본 SAP HANA 업데이트 절차</title>
<variablelist>
<varlistentry>
<term>업데이트 전 작업</term>
<listitem>
<para>&lt;master-slave-resource&gt;의 경우 유지보수 모드 설정:</para>
<screen>crm resource maintenance &lt;master-slave-resource&gt;</screen>
<para>가이드에서 &lt;master-slave-resource&gt;는 <literal>msl_SAPHana_HA1_HDB10</literal>입니다.</para>
</listitem>
</varlistentry>
<varlistentry>
<term>업데이트</term>
<listitem>
<para>두 SAP HANA 데이터베이스 시스템에 대한 SAP 업데이트를 처리합니다. 이 절차에 대한 설명은 SAP가 제공합니다.</para>
</listitem>
</varlistentry>
<varlistentry>
<term>업데이트 후 작업</term>
<listitem>
<para>유지보수 후에는 기본/보조 역할이 서로 바뀝니다. 그러므로 클러스터가 이러한 상태를 저장하지 않도록 설정하고 업데이트된 SAP HANA 데이터베이스 시스템을 다시 프로브합니다.</para>
<screen>crm resource refresh &lt;master-slave-resource&gt;</screen>
<para>SAP HANA 업데이트가 두 사이트에서 완료되면 클러스터에 유지보수 프로세스가 종료되었음을 통지합니다. 이를 통해 클러스터가 SAP를 다시 제어 및 모니터링할 수 있습니다.</para>
<screen>crm resource maintenance &lt;master-slave-resource&gt; off</screen>
</listitem>
</varlistentry>
</variablelist>
</example>
</section>
<section xml:id="id-migrating-an-sap-hana-primary">
<title>SAP HANA 기본 마이그레이션</title>
<para>다음 절차에서는 기본이 노드 1에서, 보조가 노드 2에서 실행되는 것으로 가정합니다. 목표는 노드의 역할을 “교환”하여 기본이 node2에서 실행되고 보조가 node1에서 실행되도록 하는 것입니다.</para>
<para>역할을 교환하기 위해서는 다른 메서드가 사용됩니다. 다음 절차는 네이티브 HANA 명령을 통해 클러스터에 역할 교환을 “수락”하도록 통지하는 방법을 보여줍니다.</para>
<example>
<title>SAP 도구 집합을 사용한 SAP HANA 기본 마이그레이션</title>
<variablelist>
<varlistentry>
<term>이동 전</term>
<listitem>
<para>&lt;master-slave-resource&gt;를 유지보수로 설정합니다. 이는 모든 클러스터 노드에서 수행할 수 있습니다.</para>
<screen>crm resource maintenance &lt;master-slave-resource-name&gt;</screen>
</listitem>
</varlistentry>
</variablelist>
<variablelist>
<varlistentry>
<term>수동 인수 프로세스</term>
<listitem>
<itemizedlist>
<listitem>
<para>기본 SAP HANA 데이터베이스 시스템을 중지합니다. <emphasis>&lt;sid&gt;adm</emphasis> 사용자로서 node1에서 예시의 명령을 입력합니다.</para>
<screen>HDB stop</screen>
</listitem>
<listitem>
<para>보조 SAP HANA 데이터베이스 시스템에서 인수 프로세스를 시작합니다. <emphasis>&lt;sid&gt;adm</emphasis> 사용자로서 node2에서 예시의 명령을 입력합니다.</para>
<screen>hdbnsutil -sr_takeover</screen>
</listitem>
<listitem>
<para>이전 기본을 새 보조로 등록합니다. <emphasis>&lt;sid&gt;adm</emphasis> 사용자로서 node1에서 예시의 명령을 입력합니다.</para>
<screen>hdbnsutil -sr_register --remoteHost=suse02 --remoteInstance=10 \
 --replicationMode=sync --name=WDF \
 --operationMode=logreplay</screen>
</listitem>
<listitem>
<para>새 보조 SAP HANA 데이터베이스 시스템을 시작합니다. <emphasis>&lt;sid&gt;adm</emphasis> 사용자로서 node1에서 예시의 명령을 입력합니다.</para>
<screen>HDB start</screen>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>마이그레이션 후</term>
<listitem>
<itemizedlist>
<listitem>
<para><emphasis>SAPHanaSR-showAttr</emphasis>에 SAP HANA 시스템이 두 개 모두 다시 시작된 것으로 표시될 때까지 잠시 기다립니다(필드 역할이 숫자 4로 시작해야 함). 새 보조의 역할은 “S”(보조의 경우)여야 합니다.</para>
</listitem>
<listitem>
<para>클러스터에 이전 마스터-슬레이브 역할을 삭제하고 장애가 발생한 마스터를 다시 모니터링하도록 명령합니다. 명령은 <emphasis>root</emphasis> 사용자로 모든 클러스터 노드에서 실행할 수 있습니다</para>
<screen>crm resource refresh master-slave-resource-name</screen>
</listitem>
<listitem>
<para>&lt;master-slave-resource&gt;를 관리됨 상태로 다시 설정합니다. 명령은 <emphasis>root</emphasis> 사용자로 모든 클러스터 노드에서 실행할 수 있습니다</para>
<screen>crm resource maintenance &lt;master-slave-resource-name&gt; off</screen>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</example>
<para>이제 클러스터에서 마이그레이션의 부분 자동화를 사용하는 방법에 대해 설명하겠습니다. <emphasis>SAPHanaSR-showAttr</emphasis> 및 <emphasis>SAPHanaSR-filter</emphasis>를 사용하는 속성의 경우 패키지 버전이 0.153 이상인 SAPHanaSR이 필요합니다.</para>
<example>
<title>클러스터 도구 집합을 사용한 SAP HANA 기본 이동</title>
<itemizedlist>
<listitem>
<para><emphasis role="strong">force</emphasis> 옵션을 사용하여 이 노드 규칙에서 “이동”을 생성합니다.</para>
<screen>crm resource move &lt;master-slave-resource-name&gt; <emphasis role="strong">force</emphasis></screen>
<para>“이동”(<emphasis role="strong">force</emphasis>) 규칙으로 인해 클러스터가 현재 기본을 <emphasis role="strong">중지</emphasis>합니다. 다음으로 시스템 복제가 이전에 동기화 중인 경우 보조 사이트에서 <emphasis role="strong">promote</emphasis>을 실행합니다. 시스템 복제의 상태가 동기화 중이 아닌(SFAIL) 경우에는 기본을 마이그레이션하지 않아야 합니다.</para>
<important>
<para><emphasis role="strong">force</emphasis> 옵션을 사용하지 않고 마이그레이션하면 이전 기본이 중지되지 않고 인수가 수행되게 됩니다. <emphasis role="strong">force</emphasis> 옵션을 사용하여 마이그레이션하십시오.</para>
</important>
<note>
<para>crm 리소스 명령 <literal>move</literal>의 이전 이름은 <literal>migrate</literal>였습니다. <literal>migrate</literal> 명령은 아직 유효하지만 이미 폐기된 것으로 알려져 있습니다.</para>
</note>
</listitem>
<listitem>
<para>보조가 새 기본 역할로 완전히 인수될 때까지 기다리십시오. <emphasis>SAPHanaSR-showAttr</emphasis> 명령줄 도구를 사용하여 이를 확인하고 새 기본의 “역할” 속성을 살펴봅니다. “<emphasis role="strong">4:P</emphasis>”로 시작해야 합니다.</para>
<screen>suse01:~ # SAPHanaSR-showAttr --format=script | \
   SAPHanaSR-filter --search='roles'
Mon Nov 11 20:38:50 2019; Hosts/suse01/roles=<emphasis role="strong">1:P</emphasis>:master1::worker:
Mon Nov 11 20:38:50 2019; Hosts/suse02/roles=<emphasis role="strong">4:P</emphasis>:master1:master:worker:master</screen>
</listitem>
<listitem>
<para><literal>AUTOMATED_REGISTER=“true”</literal>로 설정한 경우에는 이 단계를 건너뛸 수 있습니다. 그렇지 않으면 지금 기존 기본을 등록해야 합니다. <emphasis>&lt;sid&gt;adm</emphasis> 사용자로서 node1에서 예시의 명령을 입력합니다.</para>
<screen>hdbnsutil -sr_register --remoteHost=suse02 --remoteInstance=10 \
    --replicationMode=sync --operationMode=logreplay \
    --name=WDF</screen>
</listitem>
<listitem>
<para>리소스의 금지 명령을 제거하여 클러스터가 새 보조를 시작하도록 허용합니다.</para>
<screen>crm resource clear &lt;master-slave-resource-name&gt;</screen>
<note>
<para><literal>crm</literal> 리소스 명령 <literal>clear</literal>의 이전 이름은 <literal>unmigrate</literal>였습니다. <literal>unmigrate</literal> 명령은 아직 유효하지만 이미 폐기된 것으로 알려져 있습니다.</para>
</note>
</listitem>
<listitem>
<para>새 보조가 시작될 때까지 기다리십시오. <emphasis>SAPHanaSR-showAttr</emphasis> 명령줄 도구를 사용하여 이를 확인하고 새 기본의 “역할” 속성을 살펴봅니다. “<emphasis role="strong">4: S</emphasis>”로 시작해야 합니다.</para>
<screen>suse01:~ # SAPHanaSR-showAttr --format=script | \
   SAPHanaSR-filter --search='roles'
Mon Nov 11 20:38:50 2019; Hosts/suse01/roles=<emphasis role="strong">4:S</emphasis>:master1::worker:
Mon Nov 11 20:38:50 2019; Hosts/suse02/roles=<emphasis role="strong">4:P</emphasis>:master1:master:worker:master</screen>
</listitem>
</itemizedlist>
</example>
</section>
</section>
</section>
<section xml:id="app.hana-sr.information">
<title>유용한 링크, 설명서 및 SAP 노트</title>
<section xml:id="id-suse-best-practices-and-more">
<title>SUSE 모범 사례 등</title>
<variablelist>
<varlistentry>
<term>블로그 시리즈 #towardsZeroDowntime</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/c/tag/towardszerodowntime/">https://www.suse.com/c/tag/towardszerodowntime/</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>SUSE Linux Enterprise 기반 SAP를 위한 모범 사례</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://documentation.suse.com/sbp/sap-15/">https://documentation.suse.com/sbp/sap-15/</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>2014년 블로그 - SAP HANA®의 안전 작동: SUSE의 고가용성 솔루션 확장</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="http://scn.sap.com/community/hana-in-memory/blog/2014/04/04/fail-safe-operation-of-sap-hana-suse-extends-its-high-availability-solution">http://scn.sap.com/community/hana-in-memory/blog/2014/04/04/fail-safe-operation-of-sap-hana-suse-extends-its-high-availability-solution</link></para>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="id-suse-product-documentation">
<title>SUSE 제품 문서</title>
<variablelist>
<varlistentry>
<term>SAP 제품 설명서 및 문서</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://documentation.suse.com/">https://documentation.suse.com/</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>SAP용 SLES의 최신 온라인 문서</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://documentation.suse.com/sles-sap/15-SP1/">https://documentation.suse.com/sles-sap/15-SP1/</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>SUSE Linux Enterprise High Availability Extension의 최신 온라인 문서</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://documentation.suse.com/sle-ha/15-SP1/">https://documentation.suse.com/sle-ha/15-SP1/</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>SUSE Linux Enterprise Server 조정 가이드</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://documentation.suse.com/sles/15-SP1/html/SLES-all/book-sle-tuning.html">https://documentation.suse.com/sles/15-SP1/html/SLES-all/book-sle-tuning.html</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>SUSE Linux Enterprise Server 저장소 관리 가이드</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://documentation.suse.com/sles/15-SP1/html/SLES-all/book-storage.html">https://documentation.suse.com/sles/15-SP1/html/SLES-all/book-storage.html</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>릴리스 정보</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/releasenotes">https://www.suse.com/releasenotes</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>TID 올바른 다중 경로 시간 제한 예측</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="http://www.suse.com/support/kb/doc.php?id=7008216">http://www.suse.com/support/kb/doc.php?id=7008216</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>TID 올바른 Watchdog 커널 모듈 로드 방법</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="http://www.suse.com/support/kb/doc.php?id=7016880">http://www.suse.com/support/kb/doc.php?id=7016880</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>TID NUMA 머신에서 파일 시스템 성능 문제 해결</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="http://www.suse.com/support/kb/doc.php?id=7008919">http://www.suse.com/support/kb/doc.php?id=7008919</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>TID SLES에서 메모리 오버커밋</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/support/kb/doc.php?id=7002775">https://www.suse.com/support/kb/doc.php?id=7002775</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>SLES 기술 정보</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/products/server/technical-information/">https://www.suse.com/products/server/technical-information/</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>XFS 파일 시스템</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/communities/conversations/xfs-the-file-system-of-choice/">https://www.suse.com/communities/conversations/xfs-the-file-system-of-choice/</link></para>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="id-manual-pages">
<title>설명서 페이지</title>
<variablelist>
<varlistentry>
<term>crm</term>
<listitem>
<para>crm.8</para>
</listitem>
</varlistentry>
<varlistentry>
<term>crm_simulate</term>
<listitem>
<para>crm_simulate.8</para>
</listitem>
</varlistentry>
<varlistentry>
<term>cs_clusterstate</term>
<listitem>
<para>cs_clusterstate.8</para>
</listitem>
</varlistentry>
<varlistentry>
<term>ocf_suse_SAPHana</term>
<listitem>
<para>ocf_suse_SAPHana.7</para>
</listitem>
</varlistentry>
<varlistentry>
<term>ocf_suse_SAPHanaTopology</term>
<listitem>
<para>ocf_suse_SAPHanaTopology.7</para>
</listitem>
</varlistentry>
<varlistentry>
<term>sbd</term>
<listitem>
<para>sbd.8</para>
</listitem>
</varlistentry>
<varlistentry>
<term>stonith_sbd</term>
<listitem>
<para>stonith_sbd.7</para>
</listitem>
</varlistentry>
<varlistentry>
<term>SAPHanaSR</term>
<listitem>
<para>SAPHanaSR.7</para>
</listitem>
</varlistentry>
<varlistentry>
<term>SAPHanaSR-showAttr</term>
<listitem>
<para>SAPHanaSR-showAttr.8</para>
</listitem>
</varlistentry>
<varlistentry>
<term>SAPHanaSR-replay-archive</term>
<listitem>
<para>SAPHanaSR-replay-archive.8</para>
</listitem>
</varlistentry>
<varlistentry>
<term>SAPHanaSR_manitenance_examples</term>
<listitem>
<para>SAPHanaSR_manitenance_examples.8</para>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="id-sap-product-documentation">
<title>SAP 제품 문서</title>
<variablelist>
<varlistentry>
<term>SAP HANA 설치 및 업데이트 가이드</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="http://help.sap.com/hana/SAP_HANA_Server_Installation_Guide_en.pdf">http://help.sap.com/hana/SAP_HANA_Server_Installation_Guide_en.pdf</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>SAP HANA 관리 가이드</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf">http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf</link></para>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="id-sap-notes">
<title>SAP 노트</title>
<variablelist>
<varlistentry>
<term>2578899 - SUSE Linux Enterprise Server 15: 설치 노트</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2578899">https://launchpad.support.sap.com/#/notes/2578899</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>2684254 - SAP HANA DB: SLES 15 / SLES for SAP Applications 15용 권장 OS 설정</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2684254">https://launchpad.support.sap.com/#/notes/2684254</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>1876398 - HANA SP6에서 시스템 복제를 위한 네트워크 구성</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1876398">https://launchpad.support.sap.com/#/notes/1876398</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>611361 - SAP 서버의 호스트 이름</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/611361">https://launchpad.support.sap.com/#/notes/611361</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>1275776 - SAP 환경을 위한 SLES 준비</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1275776">https://launchpad.support.sap.com/#/notes/1275776</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>1514967 - SAP HANA: 센트럴 노트</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1514967">https://launchpad.support.sap.com/#/notes/1514967</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>1523337 - SAP In-Memory Database 1.0: 센트럴 노트</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1523337">https://launchpad.support.sap.com/#/notes/1523337</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>2380229 - SAP HANA Platform 2.0 - 센트럴 노트</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/2380229">https://launchpad.support.sap.com/#/notes/2380229</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>1501701 - 단일 컴퓨팅 장치 성능 및 크기 조정</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1501701">https://launchpad.support.sap.com/#/notes/1501701</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>1944799 - SLES 운영 체제 설치를 위한 SAP HANA 가이드라인</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1944799">https://launchpad.support.sap.com/#/notes/1944799</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>1890444 - CPU 절전 모드로 인한 HANA 시스템 속도 저하</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1890444">https://launchpad.support.sap.com/#/notes/1890444</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>1888072 - SAP HANA DB: strcmp sse42에서 인덱스 서버 충돌</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1888072">https://launchpad.support.sap.com/#/notes/1888072</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>1846872 - HANA에서 보고된 “장치에 여유 공간 없음” 오류</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://launchpad.support.sap.com/#/notes/1846872">https://launchpad.support.sap.com/#/notes/1846872</link></para>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="id-reference">
<title>참조</title>
<para>자세한 정보는 아래 문서에서 확인할 수 있습니다.</para>
<variablelist>
<varlistentry>
<term>Pacemaker 프로젝트 문서</term>
<listitem>
<para><link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://clusterlabs.org/pacemaker/doc/">https://clusterlabs.org/pacemaker/doc/</link></para>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
<section xml:id="app.hana-sr.example">
<title>예시 및 체크리스트</title>
<section xml:id="id-example-cluster-configuration">
<title>예시 클러스터 구성</title>
<para>다음 전체 <literal>crm</literal> 구성은 SID HA1 및 인스턴스 번호 10이 포함된 SAP HANA 데이터베이스 및 2노드 클러스터(suse01, suse02)를 위한 구성입니다. 예시에서 가상 IP 주소는 192.168.10.15입니다.</para>
<screen>node suse01
node suse02

primitive rsc_SAPHanaTopology_HA1_HDB10 ocf:suse:SAPHanaTopology \
        operations $id="rsc_sap2_HA1_HDB10-operations" \
        op monitor interval="10" timeout="300" \
        op start interval="0" timeout="300" \
        op stop interval="0" timeout="300" \
        params SID="HA1" InstanceNumber="10"
primitive rsc_SAPHana_HA1_HDB10 ocf:suse:SAPHana \
        operations $id="rsc_sap_HA1_HDB10-operations" \
        op monitor interval="61" role="Slave" timeout="700" \
        op start interval="0" timeout="3600" \
        op stop interval="0" timeout="3600" \
        op promote interval="0" timeout="3600" \
        op monitor interval="60" role="Master" timeout="700" \
        params SID="HA1" InstanceNumber="10" PREFER_SITE_TAKEOVER="true"
DUPLICATE_PRIMARY_TIMEOUT="7200" AUTOMATED_REGISTER=“false“
primitive res_AWS_STONITH stonith:external/ec2 \
        op start interval=0 timeout=180 \
        op stop interval=0 timeout=180 \
        op monitor interval=300 timeout=60 \
        meta target-role=Started \
        params tag=pacemaker profile=cluster
primitive rsc_ip_HA1_HDB10 ocf:suse:aws-vpc-move-ip \
        params ip=192.168.10.15 routing_table=rtb-XYZ interface=eth0 profile=cluster \
        op start interval=0 timeout=180 \
        op stop interval=0 timeout=180 \
        op monitor interval=120 timeout=60
ms msl_SAPHana_HA1_HDB10 rsc_SAPHana_HA1_HDB10 \
        meta clone-max="2" clone-node-max="1" interleave="true"
clone cln_SAPHanaTopology_HA1_HDB10 rsc_SAPHanaTopology_HA1_HDB10 \
        meta clone-node-max="1" interleave="true"
colocation col_saphana_ip_HA1_HDB10 2000: \
        rsc_ip_HA1_HDB10:Started msl_SAPHana_HA1_HDB10:Master
order ord_SAPHana_HA1_HDB10 2000: \
        cln_SAPHanaTopology_HA1_HDB10 msl_SAPHana_HA1_HDB10
property cib-bootstrap-options: \
        have-watchdog=false \
        dc-version=1.1.15-21.1-e174ec8 \
        cluster-infrastructure=corosync \
        stonith-enabled=true \
        stonith-action=poweroff \
        stonith-timeout=600s \
        last-lrm-refresh=1518102942 \
        maintenance-mode=false
rsc_defaults $id="rsc_default-options" \
        resource-stickiness="1000" \
        migration-threshold="5000"
op_defaults $id="op_defaults-options" \
        timeout="600"</screen>
</section>
<section xml:id="id-example-for-etccorosynccorosync-conf">
<title>/etc/corosync/corosync.conf를 위한 예시</title>
<para>다음 파일은 링이 한 개인 일반적인 corosync 구성을 보여줍니다. 세부 정보 및 추가 링과 관련해서는 SUSE 제품 설명서를 참조하십시오.</para>
<screen># Read the corosync.conf.5 manual page

totem {

  version: 2
  rrp_mode: passive
  token: 30000
  consensus: 36000
  token_retransmits_before_loss_const: 6
  secauth: on
  crypto_hash: sha1
  crypto_cipher: aes256
  clear_node_high_bit: yes
  interface {
    ringnumber: 0
    bindnetaddr: 10.79.254.249
    mcastport: 5405
    ttl: 1
  }

  transport: udpu

}

nodelist {
  node {
  ring0_addr: 10.79.254.249
  ring1_addr: 10.79.253.249
  nodeid: 1
  }

  node {
  ring0_addr: 10.79.9.213
  ring1_addr: 10.79.10.213
  nodeid: 2
  }
}

logging {
        fileline: off
        to_logfile: yes
        to_syslog: yes
        logfile: /var/log/cluster/corosync.log
        debug: off
        timestamp: on
        logger_subsys {
            subsys: QUORUM
             debug: off
        }
}


quorum {
        # Enable and configure quorum subsystem (default: off)
        # see also corosync.conf.5 and votequorum.5
        provider: corosync_votequorum
        expected_votes: 2
        two_node: 1
}</screen>
</section>
<section xml:id="id-checklist-suse-cluster-setup-in-aws">
<title>체크리스트 - AWS에서의 SUSE 클러스터 설정</title>
<para>설치를 시작하기 전, 우선 AWS 구성을 확인한 후 다음 AWS 항목을 수집하십시오.</para>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="1">
<colspec colname="col_1" colwidth="100*"/>
<thead>
<row>
<entry align="left" valign="top">체크리스트 AWS 클러스터 설정</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="66.6666*"/>
<colspec colname="col_2" colwidth="33.3334*"/>
<thead>
<row>
<entry align="center" valign="top" namest="col_1" nameend="col_2">SLES 구독 및 업데이트 상태</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para><emphasis role="strong">항목</emphasis></para></entry>
<entry align="left" valign="top"><para><emphasis role="strong">상태/값</emphasis></para></entry>
</row>
<row>
<entry align="left" valign="top"><para>모든 시스템에 SAP 구독을 위한 SLES가 있습니다.</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>모든 시스템에서 퍼블릭 클라우드 모듈이 활성화되었습니다.</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>모든 시스템이 최신 패치 수준을 사용하도록 업데이트되었습니다.</para></entry>
<entry align="left" valign="top"> </entry>
</row>
</tbody>
</tgroup>
</informaltable>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="66.6666*"/>
<colspec colname="col_2" colwidth="33.3334*"/>
<thead>
<row>
<entry align="center" valign="top" namest="col_1" nameend="col_2">설치자를 위한 AWS 사용자 권한</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para><emphasis role="strong">항목</emphasis></para></entry>
<entry align="left" valign="top"><para><emphasis role="strong">상태/값</emphasis></para></entry>
</row>
<row>
<entry align="left" valign="top"><para>EC2 인스턴스 및 EBS 볼륨 생성</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>보안 그룹 생성</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>VPC 라우팅 테이블 수정</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>IAM 정책을 생성하여 IAM 역할에 연결</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>필요할 수 있는 사항: 서브넷 및 라우팅 테이블 만들기</para></entry>
<entry align="left" valign="top"> </entry>
</row>
</tbody>
</tgroup>
</informaltable>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="66.6666*"/>
<colspec colname="col_2" colwidth="33.3334*"/>
<thead>
<row>
<entry align="center" valign="top" namest="col_1" nameend="col_2">VPC 및 네트워크</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para><emphasis role="strong">항목</emphasis></para></entry>
<entry align="left" valign="top"><para><emphasis role="strong">상태/값</emphasis></para></entry>
</row>
<row>
<entry align="left" valign="top"><para>VPC ID</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>VPC의 CIDR 범위</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>AZ “A”에 있는 시스템의 서브넷 ID A</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>AZ “B”에 있는 시스템의 서브넷 ID “B”</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>서브넷 A 및 B의 VPC 라우팅 테이블 ID</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>VPC 라우팅 테이블이 관련 서브넷에 연결되었습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>대안: VPC에 연결되었습니까? 서브넷에 자체 서브넷이 없습니다.</para></entry>
<entry align="left" valign="top"> </entry>
</row>
</tbody>
</tgroup>
</informaltable>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="66.6666*"/>
<colspec colname="col_2" colwidth="33.3334*"/>
<thead>
<row>
<entry align="center" valign="top" namest="col_1" nameend="col_2">AWS 정책 만들기</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para><emphasis role="strong">항목</emphasis></para></entry>
<entry align="left" valign="top"><para><emphasis role="strong">상태/값</emphasis></para></entry>
</row>
<row>
<entry align="left" valign="top"><para>SAP IAM 정책을 위한 AWS Data Provider의 이름</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>STONITH IAM 정책의 이름</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>오버레이 IP IAM 정책의 이름</para></entry>
<entry align="left" valign="top"> </entry>
</row>
</tbody>
</tgroup>
</informaltable>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="66.6666*"/>
<colspec colname="col_2" colwidth="33.3334*"/>
<thead>
<row>
<entry align="center" valign="top" namest="col_1" nameend="col_2">첫 번째 클러스터 노드(초기 기본 서버)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para><emphasis role="strong">항목</emphasis></para></entry>
<entry align="left" valign="top"><para><emphasis role="strong">상태/값</emphasis></para></entry>
</row>
<row>
<entry align="left" valign="top"><para>EC2 인스턴스 ID</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>ENI ID</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>기본 IP 주소</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>보조 IP주소</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>호스트 이름</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>ECs 인스턴스 ID가 서브넷 A에 연결되어 있습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>EC2 인스턴스에 IAM 정책 세 개가 모두 연결되었습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>호스트 이름과 함께 EC2 태그 <emphasis>pacemaker</emphasis>가 설정되었습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>AWS CLI 프로파일 <emphasis>cluster</emphasis>가 생성되고 <emphasis>text</emphasis>로 설정되었습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>소스/대상 확인이 비활성화되었습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
</tbody>
</tgroup>
</informaltable>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="66.6666*"/>
<colspec colname="col_2" colwidth="33.3334*"/>
<thead>
<row>
<entry align="center" valign="top" namest="col_1" nameend="col_2">두 번째 클러스터 노드(초기 보조 서버)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para><emphasis role="strong">항목</emphasis></para></entry>
<entry align="left" valign="top"><para><emphasis role="strong">상태/값</emphasis></para></entry>
</row>
<row>
<entry align="left" valign="top"><para>EC2 인스턴스 ID</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>ENI ID</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>기본 IP 주소</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>보조 IP주소</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>호스트 이름</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>EC2 인스턴스가 서브넷 B에 연결되어 있습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>EC2 인스턴스에 IAM 정책 세 개가 모두 연결되었습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>호스트 이름과 함께 EC2 태그 <emphasis>pacemaker</emphasis>가 설정되었습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>AWS CLI 프로파일 <emphasis>cluster</emphasis>가 생성되고 <emphasis>text</emphasis>로 설정되었습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>소스/대상 확인이 비활성화되었습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
</tbody>
</tgroup>
</informaltable>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="66.6666*"/>
<colspec colname="col_2" colwidth="33.3334*"/>
<thead>
<row>
<entry align="center" valign="top" namest="col_1" nameend="col_2">오버레이 IP 주소: 데이터베이스 서비스</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para><emphasis role="strong">항목</emphasis></para></entry>
<entry align="left" valign="top"><para><emphasis role="strong">상태/값</emphasis></para></entry>
</row>
<row>
<entry align="left" valign="top"><para>IP 주소</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>라우팅 테이블에 추가되었습니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>첫 번째 노드의 ENI를 가리킵니까?</para></entry>
<entry align="left" valign="top"> </entry>
</row>
</tbody>
</tgroup>
</informaltable>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="66.6666*"/>
<colspec colname="col_2" colwidth="33.3334*"/>
<thead>
<row>
<entry align="center" valign="top" namest="col_1" nameend="col_2">인터넷 액세스</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para><emphasis role="strong">항목</emphasis></para></entry>
<entry align="left" valign="top"><para><emphasis role="strong">상태/값</emphasis></para></entry>
</row>
<row>
<entry align="left" valign="top"><para>모든 인스턴스가 인터넷에 액세스할 수 있습니까? 라우팅 테이블 확인</para></entry>
<entry align="left" valign="top"> </entry>
</row>
<row>
<entry align="left" valign="top"><para>대안: 데이터 공급자 및 클러스터 소프트웨어를 위한 HTTP 프록시 추가</para></entry>
<entry align="left" valign="top"> </entry>
</row>
</tbody>
</tgroup>
</informaltable></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<?pdfpagebreak?>
</section>
</section>
<section xml:id="id-legal-notice">
<title>사용권 고지사항</title>
<para>저작권 © 2006–2020 SUSE LLC 및 제공자. All rights reserved. </para>
<para>GNU 무료 설명서 라이선스, 버전 1.2 또는 (사용자 선택에 따라) 버전 1.3의 조항에 따라 본 문서를 복사, 배포 및/또는 수정하는 권한이 허가됩니다. 그리고 각 항목에는 본 저작권 표시 및 라이선스가 설명된 고정(Invariant) 섹션이 있습니다. 라이선스 버전 1.2의 복사본은 “GNU 무료 설명서 라이선스” 섹션에 포함되어 있습니다.</para>
<para>SUSE, SUSE 로고 및 YaST는 미국과 기타 국가에서 SUSE LLC의 등록 상표입니다. SUSE 상표는 <link xmlns:xl="http://www.w3.org/1999/xlink" xl:href="https://www.suse.com/company/legal/">https://www.suse.com/company/legal/</link>을 참조하십시오.</para>
<para>Linux는 Linus Torvalds의 등록 상표입니다. 본 문서에 언급된 기타 모든 이름 또는 상표는 해당 소유주의 상표 또는 등록 상표일 수 있습니다.</para>
<para>본 문서는 “SUSE 모범 사례”라는 문서 시리즈 중 일부입니다. 시리즈의 각 문서는 SUSE 직원 및 제3자가 자발적으로 기여하여 작성되었습니다. 문서의 목적은 특정 작업을 수행하는 방법의 한 가지 예만을 제공하는 것입니다.</para>
<para>또한, SUSE는 문서에서 설명되는 작업이 해당 기능을 수행하는지 또는 의도하지 않은 결과가 제공되지 않는지를 확인할 수 없습니다.</para>
<para>본 문서의 모든 정보는 최대한 주의를 기울여 작성되었습니다. 그러나 이것이 문서의 정확성을 보장하지는 않습니다. 따라서 SUSE LLC, 그 계열사, 저자, 번역자 중 어느 누구도 있을 수 있는 오류나 그에 따른 결과에 책임을 지지 않는다고 명확히 진술할 필요가 있습니다. 아래에 명시된 내용은 문서를 게시할 때 준수해야 할 라이선스에 대한 주의를 환기하기 위한 것입니다.</para>
<?pdfpagebreak?>
</section>
<xi:include href="license-gfdl.xml"/>
</article>
