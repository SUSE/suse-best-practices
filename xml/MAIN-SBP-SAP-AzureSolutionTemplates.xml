<?xml version="1.0" encoding="UTF-8"?>
<!--<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbook.rng" type="xml"?>-->
<!DOCTYPE article [
<!ENTITY % entity SYSTEM "entity-decl.ent">
%entity;
]>

<!--<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<?asciidoc-toc?>
<?asciidoc-numbered?>-->

<article role="sbp" xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
  xmlns:its="http://www.w3.org/2005/11/its"
  xml:id="art-sbp-sap-azure-templates" xml:lang="en">


  <info>
    <title>SUSE and Microsoft Solution Templates for SAP
      applications</title>
    <subtitle>Simplified Deployment on Microsoft Azure</subtitle>

    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:bugtracker>
        <dm:url>https://github.com/SUSE/suse-best-practices/issues/new</dm:url>
        <dm:product>SUSE and Microsoft Solution Templates for SAP
          applications</dm:product>
      </dm:bugtracker>
      <dm:editurl>https://github.com/SUSE/suse-best-practices/edit/main/xml/</dm:editurl>
    </dm:docmanager>

    <meta name="series" its:translate="no">Best Practices</meta>
    <meta name="category" its:translate="no">
      <phrase>SAP</phrase>
    </meta>
    <meta name="task" its:translate="no">
      <phrase>Automation</phrase>
      <phrase>Deployment</phrase>
      <phrase>Cloud</phrase>
    </meta>
    <meta name="title" its:translate="yes">SUSE and Microsoft Solution Templates for SAP applications</meta>
    <meta name="description" its:translate="yes">Predefined solution templates for SAP applications from
    SUSE and Microsoft for simplified deployment on Microsoft Azure.</meta>
    <meta name="social-descr" its:translate="yes">Predefined solution templates SLES for SAP on Azure</meta>
    <meta name="productname" its:translate="no">
      <productname version="12 SP3">SUSE Linux Enterprise Server for SAP applications</productname>
      <productname version="12 SP4">SUSE Linux Enterprise Server for SAP applications</productname>
      <productname version="12 SP5">SUSE Linux Enterprise Server for SAP applications</productname>
    </meta>

    <meta name="platform" its:translate="no">SUSE Linux Enterprise Server for SAP applications 12</meta>
    <meta name="platform" its:translate="no">Microsoft Azure</meta>

      <authorgroup>
      <author>
      <personname>
      <firstname>Peter</firstname>
      <surname>Schinagl</surname>
      </personname>
      <affiliation>
      <jobtitle>Technical Architect SAP</jobtitle>
      <orgname>SUSE</orgname>
      </affiliation>
      </author>
<!--       <editor>
      <orgname></orgname>
      </editor>
      <othercredit>
      <orgname></orgname>
      </othercredit>-->
      </authorgroup>

      <cover role="logos">
        <mediaobject>
          <imageobject role="fo">
            <imagedata fileref="suse.svg" width="5em" align="center" valign="bottom"/>
          </imageobject>
          <imageobject role="html">
            <imagedata fileref="suse.svg" width="152px" align="center" valign="bottom"/>
          </imageobject>
          <textobject><phrase>SUSE logo</phrase></textobject>
        </mediaobject>
      </cover>

    <revhistory xml:id="rh-art-sbp-sap-azure-templates">
      <revision>
        <date>2018-05-08</date>
        <revdescription>
          <para> </para>
        </revdescription>
      </revision>
    </revhistory>


    <abstract>

      <para>This document describes several predefined solution templates
        for SAP applications from SUSE and Microsoft for simplified
        deployment on Microsoft Azure.</para>

      <para>
        <emphasis role="strong">Disclaimer: </emphasis>
        Documents published as part of the SUSE Best Practices series have been contributed voluntarily
        by SUSE employees and third parties. They are meant to serve as examples of how particular
        actions can be performed. They have been compiled with utmost attention to detail. However,
        this does not guarantee complete accuracy. SUSE cannot verify that actions described in these
        documents do what is claimed or whether actions described have unintended consequences.
        SUSE LLC, its affiliates, the authors, and the translators may not be held liable for possible errors
        or the consequences thereof.
      </para>


    </abstract>
  </info>


  <sect1 xml:id="sec-overview">
    <title>Overview</title>

    <para>For every template there are four possible sizes available with
      the following naming convention:</para>
    <itemizedlist>
      <listitem>
        <para> Demo </para>
      </listitem>
      <listitem>
        <para> Small </para>
      </listitem>
      <listitem>
        <para> Medium </para>
      </listitem>
      <listitem>
        <para> Large </para>
      </listitem>
    </itemizedlist>

    <para>The <emphasis role="strong">Demo</emphasis> and <emphasis
        role="strong">Small</emphasis> sizes are targeted at non-production
      SAP HANA workloads. The <emphasis role="strong">Medium</emphasis> and
        <emphasis role="strong">Large</emphasis> sizes can be used for
      production systems, as they are built on M-SERIES/VM which are
      certified.</para>
    <para>One of the presumptions of this document is that you are familiar
      with SAP Netweaver and SAP HANA.</para>

    <para>Microsoft provides a good overview page about SAP deployments in
      Azure at <link
        xlink:href="https://docs.microsoft.com/en-us/azure/virtual-machines/workloads/sap/get-started"
        >https://docs.microsoft.com/en-us/azure/virtual-machines/workloads/sap/get-started</link></para>
    <para>For the High Availability (HA) scenario you should have in
      addition good knowledge of</para>
    <itemizedlist>
      <listitem>
        <para> High availability for SAP NetWeaver (ASCS/SCS/ERS) </para>
      </listitem>
      <listitem>
        <para> the SUSE High Availability Extension </para>
      </listitem>
      <listitem>
        <para> the best practice documents at <link
            xlink:href="https://www.suse.com/products/sles-for-sap/resource-library/sap-best-practices"
            >https://www.suse.com/products/sles-for-sap/resource-library/sap-best-practices</link>
        </para>
      </listitem>
    </itemizedlist>

    <para>For production systems you need to take care of the monitoring
      requirements of SAP:</para>
    <itemizedlist>
      <listitem>
        <para>
          <link
            xlink:href="https://launchpad.support.sap.com/#/notes/2191498/E"
            > https://launchpad.support.sap.com/#/notes/2191498/E</link>
          [SAP Note 2191498]. This note discusses SAP <quote>enhanced
            monitoring</quote> with Linux Virtual Machines (VMs) on
          Azure.</para>
      </listitem>
      <listitem>
        <para><link
            xlink:href="https://launchpad.support.sap.com/#/notes/1102124/E"
            >https://launchpad.support.sap.com/#/notes/1102124/E</link>
          [SAP Note 1102124]. This note discusses information about
          SAPOSCOL on Linux.</para>
      </listitem>
      <listitem>
        <para><link
            xlink:href="https://launchpad.support.sap.com/#/notes/2178632/E"
            >https://launchpad.support.sap.com/#/notes/2178632/E</link>
          [SAP Note 2178632]. This note discusses key monitoring metrics
          for SAP on Microsoft Azure.</para>
      </listitem>
    </itemizedlist>

    <para>You need to provide the SAP software and license by yourself. You
      can download SAP software from the SAP Service Marketplace (<link
        xlink:href="https://service.sap.com"
      >https://service.sap.com</link>)</para>

    <para>To prepare the Azure VM for the SAP Netweaver and HANA
      installation, follow the steps outlined in the section below.</para>

    <sect2 xml:id="sec-os-updates">
      <title>Operating System Updates</title>
      <para>Check for SUSE Linux Enterprise Server operating system updates
        and fixes before installing additional software. By installing a
        patch, you might be able to avoid calling the support desk.</para>
      <para>Here is an example of how to check for available patches for
        SUSE Linux Enterprise Server by using the <command>zypper</command>
        command:</para>
      <screen>sudo zypper list-patches</screen>

      <para>Depending on the kind of issue, patches are classified by
          <emphasis role="italic">category</emphasis> and <emphasis
          role="italic">severity</emphasis>.</para>

      <para>Commonly used values for <emphasis role="italic"
          >category</emphasis> are: <emphasis role="strong"
          >security</emphasis>, <emphasis role="strong"
          >recommended</emphasis>, <emphasis role="strong"
          >optional</emphasis>, <emphasis role="strong">feature</emphasis>,
        or <emphasis role="strong">yast</emphasis>.</para>

      <para>Commonly used values for <emphasis role="italic"
          >severity</emphasis> are: <emphasis role="strong"
          >critical</emphasis>, <emphasis role="strong"
          >important</emphasis>, <emphasis role="strong"
          >moderate</emphasis>, <emphasis role="strong">low</emphasis>, or
          <emphasis role="strong">unspecified</emphasis>.</para>
      <para>The <command>zypper</command> command searches only for the
        updates that your installed packages need. As an example, you could
        use the command:</para>
      <screen>sudo zypper patch --category=security,recommended --severity=critical,important</screen>
      <para>You can add the parameter <parameter>--dry-run</parameter> to
        test the update without actually updating the system.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="sec-sap-hana-2-tier-db-tier-template">
    <title>SAP HANA 2-tier (DB-tier) Template</title>
    <para>The template provides and deploys a VM that is customized for use
      with SAP HANA, using the latest pay-as-you-go (PAYG) version of the
      SUSE Linux Enterprise Server for SAP applications (SLES4SAP).</para>
    <para>It deploys one server on Premium Storage (Premium_LRS) and uses
      Managed Disks.</para>


    <figure>
      <title>SAP HANA 2-tier (DB-tier) Template Overview</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="azure_2tier.svg" width="100%" format="SVG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="azure_2tier.png" width="100%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <!--<figure>
      <title></title>
      <mediaobject>
        <imageobject>
          <imagedata fileref="azure_2tier.svg" width="100%" scalefit="1"/>
        </imageobject>
      </mediaobject>
    </figure>-->

    <sect2 xml:id="sec-os-configuration-for-sap-hana">
      <title>OS Configuration for SAP HANA</title>
      <para>SAP HANA requires specific Linux kernel settings, which are not
        part of the standard Azure images and must be set manually.</para>
      <screen>sudo saptune solution apply HANA</screen>
    </sect2>

    <sect2 xml:id="sec-disk-overview">
      <title>Disk Overview</title>
      <para>The template uses the following disks and mount points for the
        HANA machine:</para>

      <para>Demo</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>2,3</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>4</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>5</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>6</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/sapmnt</para>
              </entry>
              <entry align="left" valign="top">
                <para>7</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Small</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1,2</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>same disks as data</para>
              </entry>
              <entry align="left" valign="top">
                <para/>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>3</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>4</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>5</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/sapmnt</para>
              </entry>
              <entry align="left" valign="top">
                <para>6</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Medium</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1,2,3</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>4,5</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>6</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>7</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>8,9</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/sapmnt</para>
              </entry>
              <entry align="left" valign="top">
                <para>10</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Large</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1,2</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>3,4</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>5</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>6</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>7,8</para>
              </entry>
              <entry align="left" valign="top">
                <para>2048 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/sapmnt</para>
              </entry>
              <entry align="left" valign="top">
                <para>9</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>For the installation of SAP HANA there are different ways
        available. You can use the native SAP mechanism of using the SAP
        Software Provisioning Manager (SWPM) or the HANA database lifecycle
        manager (HDBLCM).</para>
      <para>For details, have a look at the SAP documentation at <link
          xlink:href="https://help.sap.com/viewer/p/SAP_HANA_PLATFORM"
          >https://help.sap.com/viewer/p/SAP_HANA_PLATFORM</link>.</para>
      <para>A very short description is in addition available at <link
          xlink:href="https://docs.microsoft.com/en-us/azure/virtual-machines/workloads/sap/hana-get-started"
          >https://docs.microsoft.com/en-us/azure/virtual-machines/workloads/sap/hana-get-started</link>
        .</para>
      <para>Another way would be to use the SUSE YaST based HANA install
        wizard, which simplifies the setup. It is discussed in a later
        section below.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="sec-sap-netweaver-3-tier-template">
    <title>SAP Netweaver 3-tier Template</title>
    <para>The template provides and deploys several VMs which are
      customized for use with SAP Netweaver and SAP HANA as database, using
      the latest pay-as-you-go (PAYG) version of the SUSE Linux Enterprise
      Server for SAP applications (SLES4SAP).</para>
    <para>It deploys all server on Premium Storage (Premium_LRS) and using
      Managed Disks.</para>


    <figure>
      <title>SAP Netweaver 3-tier Template Overview</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="azure_3tier.svg" width="100%" format="SVG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="azure_3tier.png" width="100%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <!--  <informalfigure>
      <mediaobject>
        <imageobject>
          <imagedata fileref="azure_3tier.svg" width="100%" scalefit="1"/>
        </imageobject>
        <textobject>
          <phrase>azure_3tier.svg</phrase>
        </textobject>
      </mediaobject>
    </informalfigure>-->

    <sect2 xml:id="sec-os-configuration-for-the-sap-netweaver-vm">
      <title>OS Configuration for the SAP Netweaver VM</title>
      <para>SAP Netweaver requires specific Linux kernel settings, which
        are not part of the standard Azure images and must be set
        manually.</para>
      <screen>sudo saptune solution apply NETWEAVER</screen>
    </sect2>

    <sect2 xml:id="sec-os-configuration-for-the-sap-hana-vm">
      <title>OS Configuration for the SAP HANA VM</title>

      <para>SAP HANA requires specific Linux kernel settings, which are not
        part of the standard Azure images and must be set manually.</para>

      <screen>sudo saptune solution apply HANA</screen>

      <para>For more details see the documentation at <link
        xlink:href="https://documentation.suse.com/sles-sap/12-SP5/html/SLES4SAP-guide/cha-tune.html"
        >https://documentation.suse.com/sles-sap/12-SP5/html/SLES4SAP-guide/cha-tune.html</link></para>
    </sect2>

    <sect2 xml:id="sec-disk-overview-2">
      <title>Disk Overview</title>
      <para>The template uses the following disks and mount points for the
        HANA machine:</para>

      <para>Demo</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>2,3</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>4</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>5</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>6</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/sapmnt</para>
              </entry>
              <entry align="left" valign="top">
                <para>7</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>The XSCS machine uses only the base OS disk.</para>
      <para>The APP server machines use an additional 128 GB disk for
        /usr/sap/&lt;SID&gt;.</para>

      <para>Small</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1,2</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>same disks as data</para>
              </entry>
              <entry align="left" valign="top">
                <para/>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>3</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>4</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>5</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>The XSCS machine uses only the base OS disk.</para>
      <para>The APP server machines use an additional 128 GB disk for
        /usr/sap/&lt;SID&gt;</para>

      <para>Medium</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1,2,3</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>4,5</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>6</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>7</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>8,9</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Large</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1,2</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>3,4</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>5</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>6</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>7,8</para>
              </entry>
              <entry align="left" valign="top">
                <para>2048 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </sect2>

    <sect2 xml:id="sec-other-settings-and-machines">
      <title>Other Settings and Machines</title>

      <para>All machines created with the template use the Azure feature
          <quote>Accelerated Network (AN)</quote> (only if the VM size
        supports AN).</para>
      <para>The XSCS machine gets a dynamic public IP address to be able to
        access all other machines in the private network and only uses the
        base OS disk. There is no additional disk.</para>
      <para>The APP server machines use an additional 128 GB disk for
        /usr/sap/&lt;SID&gt; and the machines are placed in an
          <emphasis role="strong">Availability Set</emphasis> with a
          <emphasis role="strong">FaultDomainCount</emphasis> of 2 and an
          <emphasis role="strong">UpdateDomainCount</emphasis> of
        20.</para>
      <note>
        <title>Availability Set</title>
        <para>An <emphasis role="strong">Availability Set</emphasis> is a
          logical group in Azure to ensure that the VM resources are
          isolated from each other when they are deployed within an Azure
          data center. It ensures that the VMs you place within such an
            <emphasis role="strong">Availability Set</emphasis> run across
          multiple physical servers, compute racks, storage units and
          network switches. The Virtual Machines are placed then into an
            <emphasis role="strong">Availability Set</emphasis> to minimize
          the chances that two of them fail or are updated at the same
          time. This is essential when you want to build reliable cloud
          solutions and clusters.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="sec-sap-netweaver-3-tier-ha-template">
    <title>SAP Netweaver 3-tier HA Template</title>

    <para>The template provides and deploys several VMs <emphasis
        role="strong">twice</emphasis> to be used in an HA configuration.
      They are customized for use with SAP Netweaver and SAP HANA as
      database, using the latest pay-as-you-go (PAYG) version of the SUSE
      Linux Enterprise Server for SAP applications (SLES4SAP).</para>
    <para>It deploys all servers on Premium Storage (Premium_LRS) and using
      Managed Disks.</para>


    <figure>
      <title>SAP Netweaver 3-tier HA Template Overview</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="azure_3tierha.svg" width="100%" format="SVG"
          />
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="azure_3tierha.png" width="100%" format="PNG"
          />
        </imageobject>
      </mediaobject>
    </figure>


    <!--<informalfigure>
      <mediaobject>
        <imageobject>
          <imagedata fileref="azure_3tierHA.svg" width="100%" scalefit="1"
          />
        </imageobject>
        <textobject>
          <phrase>azure_3tierHA.svg</phrase>
        </textobject>
      </mediaobject>
    </informalfigure>-->

    <sect2 xml:id="sec-os-configuration-for-the-sap-netweaver-vm-2">
      <title>OS Configuration for the SAP Netweaver VM</title>
      <para>SAP Netweaver requires specific Linux kernel settings, which
        are not part of the standard Azure images and must be set
        manually.</para>
      <screen>sudo saptune solution apply NETWEAVER</screen>
    </sect2>

    <sect2 xml:id="sec-os-configuration-for-the-sap-hana-vm-2">
      <title>OS Configuration for the SAP HANA VM</title>

      <para>SAP HANA requires specific Linux kernel settings, which are not
        part of the standard Azure images and must be set manually.</para>

      <screen>sudo saptune solution apply HANA</screen>

      <para>For more details see the documentation at <link
        xlink:href="https://documentation.suse.com/sles-sap/12-SP5/html/SLES4SAP-guide/cha-tune.html"
        >https://documentation.suse.com/sles-sap/12-SP5/html/SLES4SAP-guide/cha-tune.html</link></para>
    </sect2>

    <sect2 xml:id="sec-other-settings">
      <title>Other Settings</title>
      <para>The XSCS machine gets a dynamic public IP address to be able to
        access all other machines in the private network.</para>
      <para>All machines use the Azure feature <quote>Accelerated Network
          (AN)</quote> (only if the VM size supports AN).</para>
      <para>All AVSets for the APP machines use a <emphasis role="strong"
          >FaultDomainCount</emphasis> of 2 and an <emphasis role="strong"
          >UpdateDomainCount</emphasis> of 20.</para>
    </sect2>

    <sect2 xml:id="sec-disk-overview-3">
      <title>Disk Overview</title>
      <para>The template uses the following disks and mount points:</para>

      <para>Demo</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>2,3</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>4</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>5</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>6</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/sapmnt</para>
              </entry>
              <entry align="left" valign="top">
                <para>7</para>
              </entry>
              <entry align="left" valign="top">
                <para>128 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Small</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1,2</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>same disks as data</para>
              </entry>
              <entry align="left" valign="top">
                <para/>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>3</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>4</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>5</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Medium</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1,2,3</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>4,5</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB (W)</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>6</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>7</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>8,9</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>(w) uses Azure feature "writeAccelerator"</para>

      <para>Large</para>
      <informaltable rowsep="1" colsep="1">
        <tgroup cols="3">
          <colspec colname="col_1" colwidth="33*"/>
          <colspec colname="col_2" colwidth="33*"/>
          <colspec colname="col_3" colwidth="33*"/>
          <thead>
            <row>
              <entry align="left" valign="top">Mount Point </entry>
              <entry align="left" valign="top"> Disk </entry>
              <entry align="left" valign="top"> Size</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry align="left" valign="top">
                <para>/hana/data</para>
              </entry>
              <entry align="left" valign="top">
                <para>0,1,2</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/log</para>
              </entry>
              <entry align="left" valign="top">
                <para>3,4</para>
              </entry>
              <entry align="left" valign="top">
                <para>512 GB (W)</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/shared</para>
              </entry>
              <entry align="left" valign="top">
                <para>5</para>
              </entry>
              <entry align="left" valign="top">
                <para>1024 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/usr/sap</para>
              </entry>
              <entry align="left" valign="top">
                <para>6</para>
              </entry>
              <entry align="left" valign="top">
                <para>64 GB</para>
              </entry>
            </row>
            <row>
              <entry align="left" valign="top">
                <para>/hana/backup</para>
              </entry>
              <entry align="left" valign="top">
                <para>7,8</para>
              </entry>
              <entry align="left" valign="top">
                <para>2048 GB</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
      <para>(w) uses Azure feature "writeAccelerator"</para>
    </sect2>

    <sect2 xml:id="sec-other-settings-and-machines-2">
      <title>Other Settings and Machines</title>

      <para>All machines created with the template use the Azure feature
          <quote>Accelerated Network (AN)</quote> (only if the VM size
        supports AN).</para>
      <para>The XSCS machine gets a dynamic public IP address to be able to
        access all other machines in the private network and only use the
        base OS disk. There is no additional disk.</para>
      <para>The APP server machines use an additional 128 GB disk for
        /usr/sap/&lt;SID&gt; and the machines are placed in an
          <emphasis role="strong">Availability Set</emphasis> with a
          <emphasis role="strong">FaultDomainCount</emphasis> of 2 and an
          <emphasis role="strong">UpdateDomainCount</emphasis> of
        20.</para>

      <note>
        <title>Availability Set</title>
        <para>An <emphasis>Availability Set</emphasis> is a logical group
          in Azure to ensure that the VM resources are isolated from each
          other when they are deployed within an Azure data center. It
          ensures that the VMs you place within such an <emphasis
            role="strong">Availability Set</emphasis> run across multiple
          physical servers, compute racks, storage units and network
          switches. The Virtual Machines are placed then into an <emphasis
            role="strong">Availability Set</emphasis> to minimize the
          chances that two of them fail or are updated at the same time.
          This is essential when you want to build reliable cloud solutions
          and clusters.</para>
      </note>

      <para>The HA template provides two additional instances for an HA NFS
        server which has an additional disk as share of 32GB.</para>
    </sect2>

    <sect2 xml:id="sec-internal-load-balancer-and-ports">
      <title>Internal Load Balancer and Ports</title>
      <para>Special for the HA setup is the use of the Azure <emphasis
          role="italic">Internal Load Balancer</emphasis> (ILB) which is
        necessary to use virtual IP addresses in Azure. As such, the ILB
        allows the use of virtual host names and IPs for the xSCS, HA-NFS
        and SAP HANA pacemaker clusters. Additionally the ILB is providing
        Layer 4: TCP and HTTP health probes.</para>

      <para>
        <link
          xlink:href="https://docs.microsoft.com/en-us/azure/load-balancer/"
          >https://docs.microsoft.com/en-us/azure/load-balancer/</link>
      </para>
      <para>The selection <emphasis role="italic">ABAP</emphasis> uses the
        relevant <emphasis role="italic">ASCS ports</emphasis>, <emphasis
          role="italic">JAVA</emphasis> uses the relevant <emphasis
          role="italic">SCS ports</emphasis> and <emphasis role="italic"
          >ABAP+JAVA</emphasis> both of the ports.</para>

      <para>ASCS/SCS Internal Load Balancer ports (examples all with
        instance <emphasis role="strong">00</emphasis> in bold):</para>

      <itemizedlist>
        <listitem>
          <para> ASCS ERS ports : 33<emphasis role="strong">00</emphasis>,
              5<emphasis role="strong">00</emphasis>13, 5<emphasis
              role="strong">00</emphasis>14, 5<emphasis role="strong"
              >00</emphasis>16 </para>
        </listitem>
        <listitem>
          <para> SCS ERS ports : 33<emphasis role="strong">00</emphasis>,
              5<emphasis role="strong">00</emphasis>13, 5<emphasis
              role="strong">00</emphasis>14, 5<emphasis role="strong"
              >00</emphasis>16 </para>
        </listitem>
        <listitem>
          <para> ASCS Ports : 32<emphasis role="strong">00</emphasis>,
              36<emphasis role="strong">00</emphasis>, 39<emphasis
              role="strong">00</emphasis>, 81<emphasis role="strong"
              >00</emphasis>, 5<emphasis role="strong">00</emphasis>13,
              5<emphasis role="strong">00</emphasis>14, 5<emphasis
              role="strong">00</emphasis>16 </para>
        </listitem>
        <listitem>
          <para> SCS Ports : 32<emphasis role="strong">00</emphasis>,
              33<emphasis role="strong">00</emphasis>, 39<emphasis
              role="strong">00</emphasis>, 81<emphasis role="strong"
              >00</emphasis>, 5<emphasis role="strong">00</emphasis>13,
              5<emphasis role="strong">00</emphasis>14, 5<emphasis
              role="strong">00</emphasis>16 </para>
        </listitem>
        <listitem>
          <para> HANA Ports : 3<emphasis role="strong"
              >00</emphasis>15,3<emphasis role="strong">00</emphasis>17
          </para>
        </listitem>
        <listitem>
          <para> NFS Ports : 2049 </para>
        </listitem>
      </itemizedlist>
      <para>Probe Ports:</para>
      <itemizedlist>
        <listitem>
          <para> xSCS: 62000 </para>
        </listitem>
        <listitem>
          <para> ERS : 61000 </para>
        </listitem>
        <listitem>
          <para> HANA: 62500 </para>
        </listitem>
        <listitem>
          <para> NFS : 61000 </para>
        </listitem>
      </itemizedlist>
    </sect2>
  </sect1>

  <sect1
    xml:id="sec-quick-guide-to-install-sap-hana-on-a-suse-linux-enterprise-server-for-sap-applications">
    <title>Quick Guide to Install SAP HANA on a SUSE Linux Enterprise
      Server for SAP applications</title>
    <para>This section leads you through the installation of a default SAP
      HANA on SUSE Linux Enterprise Server.</para>
    <para>It does not replace the SAP documentation - <emphasis
        role="strong">PLEASE</emphasis> read the SAP HANA installation
      documentation.</para>

    <important>
      <title>Transfer</title>
      <para>You need to transfer the SAP media for SAP HANA to the Azure
        cloud environment.</para>
    </important>

    <sect2 xml:id="sec-file-share-for-sap-media">
      <title>File Share for SAP Media</title>

      <para>Azure Files offers shared storage for applications using the
        Server Message Block (SMB) protocol which is very useful to upload
        the SAP HANA Media to it and use it from both machines.</para>

      <para>
        <link
          xlink:href="https://docs.microsoft.com/en-us/azure/storage/files/storage-files-introduction"
          >https://docs.microsoft.com/en-us/azure/storage/files/storage-files-introduction</link>
      </para>
      <para>To use Azure Storage, you need to create first a storage
        account.</para>
      <para>In the example below, the Azure CLI v2 command line installed
        on our local machine is used. It is also possible to install it on
        the virtual machine you have created in Azure.</para>
      <para>For more details see <link
          xlink:href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-zypper?view=azure-cli-latest"
          >https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-zypper?view=azure-cli-latest</link>.</para>
      <para>Another way would be to follow the more general steps from
          <link
          xlink:href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/mount-azure-file-storage-on-linux-using-smb"
          >https://docs.microsoft.com/en-us/azure/virtual-machines/linux/mount-azure-file-storage-on-linux-using-smb</link></para>
      <para>or using the portal</para>
      <para>
        <link
          xlink:href="https://github.com/AzureCAT-GSI/SAP-HANA-ARM/blob/master/UploadToAzure.md"
          >https://github.com/AzureCAT-GSI/SAP-HANA-ARM/blob/master/UploadToAzure.md</link>
      </para>

      <sect3 xml:id="sec-steps-to-create-a-file-share-in-azure">
        <title>Steps to Create a File Share in Azure</title>

        <para>First you need a resource group where the storage should be
          placed in.</para>
        <para>Substitute the <emphasis role="italic">--location</emphasis>
          parameter with the azure region you have chosen:</para>
        <screen>az group create --name mytestRG <emphasis role="italic">--location westeurope</emphasis></screen>
        <para>Now you can create the storage account in your resource
          group:</para>
        <screen>az storage account create \
    --name hsrsa4sapmedia \
    --resource-group mytestRG \
    --sku Standard_LRS \
    --location westeurope</screen>

        <para>A good practice is to share the connection string using
          variables, as you need to add it to every following storage
          commands:</para>

        <screen>az storage account show-connection-string \
    --name hsrsa4sapmedia \
    --resource-group mytestRG</screen>
        <para>Set the AZURE_STORAGE_CONNECTION_STRING environment variable
          with the output value of the command. You should enclose the
          connection string in quotes.</para>
        <screen>export AZURE_STORAGE_CONNECTION_STRING="YOUR_connection_string"</screen>
      </sect3>
    </sect2>

    <sect2 xml:id="sec-sap-media">
      <title>SAP Media</title>

      <para>Installation media for SAP HANA should be downloaded and placed
        in the Azure file share created in the step before. For this we
        create an own directory called "SapBits".</para>
      <para>You need to download the SAP package 51052325, which should
        consist of four files:</para>
      <itemizedlist>
        <listitem>
          <para>51052325_part1.exe</para>
        </listitem>
        <listitem>
          <para>51052325_part2.rar</para>
        </listitem>

        <listitem>
          <para>51052325_part3.rar</para>
        </listitem>

        <listitem>
          <para>51052325_part4.rar</para>
        </listitem>
      </itemizedlist>

      <para>If you have the files in your download directory on your
        machine, the command looks as follows:</para>
      <screen>az storage share create --name mediashare
az storage directory create --name SapBits --share-name mediashare

az storage file upload --share-name mediashare/SapBits --source ~/Download/51052325_part1.exe
az storage file upload --share-name mediashare/SapBits --source ~/Download/51052325_part2.rar
az storage file upload --share-name mediashare/SapBits --source ~/Download/51052325_part3.rar
az storage file upload --share-name mediashare/SapBits --source /Download/51052325_part4.rar</screen>

      <para>The next steps need to be done on your virtual machine you
        created for HANA in Azure. Log in to this machine.nius.</para>
      <para>Mount it on the SUSE Linux Enterprise Server system in Azure
        with the command:</para>
      <screen>sudo zypper in cifs-utils unrar

mkdir -p /hana/shared/SapBits

sudo mount -t cifs //hsrsa4sapmedia.file.core.windows.net/mediashare/SapBits /mnt -o vers=3.0,username=storage-account-name,password=storage-account-key,dir_mode=0777,file_mode=0777,serverino

sudo cp -v /mnt/51052325* /hana/shared/SapBits

sudo umount /mnt</screen>
      <para>Extract the HANA software</para>
      <screen>cd /hana/shared/SapBits
unrar x 51052325_part1.exe</screen>
      <para>If you need the hana software later again, you do not need this
        step as it is extracted</para>
    </sect2>

    <sect2 xml:id="sec-hana-install">
      <title>HANA Install</title>

      <para>Hana requires a few packages installed within SUSE Linux
        Enterprise Server.</para>
      <screen>zypper in -t pattern sap-hana</screen>
      <para>and configuration settings</para>
      <screen>saptune daemon start
saptune solution apply HANA</screen>
      <para>There are several possibilities to install SAP HANA, which are
        detailed in the following sections.</para>

      <sect3 xml:id="sec-with-use-of-the-suse-installation-wizard">
        <title>Installation Using the SUSE Installation Wizard</title>
        <itemizedlist>
          <listitem>
            <para> Start YaST. </para>
          </listitem>
          <listitem>
            <para>Under <quote>Software</quote> choose the <quote>SAP
                Installation Wizard</quote>:</para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>YaST Control Center - SAP Installation Wizard</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="azure_hana_wizard1.png" width="100%"
                format="PNG"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="azure_hana_wizard1.png" width="80%"
                format="PNG"/>
            </imageobject>
          </mediaobject>
        </figure>

        <!--<informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata
                fileref="/home/pschinagl/AZURE/WizardSteps/HANA_Wizard1.png"
                width="100%" scalefit="1"/>
            </imageobject>
            <textobject>
              <phrase>/home/pschinagl/AZURE/WizardSteps/HANA_Wizard1.png</phrase>
            </textobject>
          </mediaobject>
        </informalfigure>-->


        <itemizedlist>
          <listitem>
            <para>Point the Installer to the directory with the SAP Media
              from the step above (for example
              /hana/shared/SapBits/51052325):</para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>SAP Installation Wizard - Directory</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="azure_hana_wizard3.png" width="100%"
                format="PNG"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="azure_hana_wizard3.png" width="80%"
                format="PNG"/>
            </imageobject>
          </mediaobject>
        </figure>

        <!--<informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata
                fileref="/home/pschinagl/AZURE/WizardSteps/HANA_Wizard3.png"
                width="100%" scalefit="1"/>
            </imageobject>
            <textobject>
              <phrase>/home/pschinagl/AZURE/WizardSteps/HANA_Wizard3.png</phrase>
            </textobject>
          </mediaobject>
        </informalfigure>-->

        <itemizedlist>
          <listitem>
            <para>The sap media get copied to the local machine:</para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>SAP Installation Wizard - Copying Media</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="azure_hana_wizard4.png" width="100%"
                format="PNG"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="azure_hana_wizard4.png" width="80%"
                format="PNG"/>
            </imageobject>
          </mediaobject>
        </figure>

        <!--<informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata
                fileref="/home/pschinagl/AZURE/WizardSteps/HANA_Wizard4.png"
                width="100%" scalefit="1"/>
            </imageobject>
            <textobject>
              <phrase>/home/pschinagl/AZURE/WizardSteps/HANA_Wizard4.png</phrase>
            </textobject>
          </mediaobject>
        </informalfigure>-->

        <itemizedlist>
          <listitem>
            <para>Say <quote>No</quote> if you asked for
              Supplement/3rd-party media share:</para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>SAP Installation Wizard - Medium</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="azure_hana_wizard5.png" width="100%"
                format="PNG"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="azure_hana_wizard5.png" width="80%"
                format="PNG"/>
            </imageobject>
          </mediaobject>
        </figure>

        <!-- <informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata
                fileref="/home/pschinagl/AZURE/WizardSteps/HANA_Wizard5.png"
                width="100%" scalefit="1"/>
            </imageobject>
            <textobject>
              <phrase>/home/pschinagl/AZURE/WizardSteps/HANA_Wizard5.png</phrase>
            </textobject>
          </mediaobject>
        </informalfigure>-->

        <itemizedlist>
          <listitem>
            <para>Click <quote>Next</quote> at the screen asking for SAP
              add-ons:</para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>SAP Installation Wizard - SAP Add-ons</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="azure_hana_wizard6.png" width="100%"
                format="PNG"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="azure_hana_wizard6.png" width="80%"
                format="PNG"/>
            </imageobject>
          </mediaobject>
        </figure>

        <!-- <informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata
                fileref="/home/pschinagl/AZURE/WizardSteps/HANA_Wizard6.png"
                width="100%" scalefit="1"/>
            </imageobject>
            <textobject>
              <phrase>/home/pschinagl/AZURE/WizardSteps/HANA_Wizard6.png</phrase>
            </textobject>
          </mediaobject>
        </informalfigure>
-->
        <itemizedlist>
          <listitem>
            <para> Fill out the four fields for HANA:</para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>SAP Installation Wizard - System Parameters</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="azure_hana_wizard7.png" width="100%"
                format="PNG"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="azure_hana_wizard7.png" width="80%"
                format="PNG"/>
            </imageobject>
          </mediaobject>
        </figure>
        <!--
        <informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata
                fileref="/home/pschinagl/AZURE/WizardSteps/HANA_Wizard7.png"
                width="100%" scalefit="1"/>
            </imageobject>
            <textobject>
              <phrase>/home/pschinagl/AZURE/WizardSteps/HANA_Wizard7.png</phrase>
            </textobject>
          </mediaobject>
        </informalfigure>-->

        <itemizedlist>
          <listitem>
            <para>Say <quote>No</quote> if you are asked for more products:
            </para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>SAP Installation Wizard - More SAP Products</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="azure_hana_wizard8.png" width="100%"
                format="PNG"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="azure_hana_wizard8.png" width="80%"
                format="PNG"/>
            </imageobject>
          </mediaobject>
        </figure>

        <!--<informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata
                fileref="/home/pschinagl/AZURE/WizardSteps/HANA_Wizard8.png"
                width="100%" scalefit="1"/>
            </imageobject>
            <textobject>
              <phrase>/home/pschinagl/AZURE/WizardSteps/HANA_Wizard8.png</phrase>
            </textobject>
          </mediaobject>
        </informalfigure>-->

        <itemizedlist>
          <listitem>
            <para> Agree with the question to continue the installation:
            </para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>SAP Installation Wizard - Continue Installation</title>
          <mediaobject>
            <imageobject role="fo">
              <imagedata fileref="azure_hana_wizard9.png" width="100%"
                format="PNG"/>
            </imageobject>
            <imageobject role="html">
              <imagedata fileref="azure_hana_wizard9.png" width="80%"
                format="PNG"/>
            </imageobject>
          </mediaobject>
        </figure>

        <!-- <informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata
                fileref="/home/pschinagl/AZURE/WizardSteps/HANA_Wizard9.png"
                width="100%" scalefit="1"/>
            </imageobject>
            <textobject>
              <phrase>/home/pschinagl/AZURE/WizardSteps/HANA_Wizard9.png</phrase>
            </textobject>
          </mediaobject>
        </informalfigure>-->

        <itemizedlist>
          <listitem>
            <para>HANA gets installed and started. </para>
          </listitem>
        </itemizedlist>
        <para>This installation process will take some time - be patient.
          You will see the log output in the window.</para>
      </sect3>

      <sect3 xml:id="sec-using-the-command-line">
        <title>Installation Using the Command Line</title>

        <para>The HANA installer will ask for some values.</para>
        <para>Answer the questions according to your well prepared sheet
          with all needed parameters. Do <emphasis role="strong"
            >NOT</emphasis> install HANA with a virtual host name,
            <emphasis role="strong">use</emphasis> the physical host name.
          Double-check before you type!</para>

        <orderedlist numeration="arabic">
          <listitem>
            <para> Install the SAP HANA Database as described in the SAP
              HANA Server Installation Guide on <emphasis role="strong"
                >both</emphasis> machines. </para>
            <orderedlist numeration="loweralpha">
              <listitem>
                <para> Change to the directory where you have downloaded
                    <emphasis role="strong">and unpacked</emphasis> the
                  installation medium ( in our example it should be
                  /hana/shared/SapBits ): </para>
                <screen>   cd /hana/shared/SapBits/51052325/DATA_UNITS/HDB_LCM_LINUX_X86_64</screen>
              </listitem>
              <listitem>
                <para> Start the SAP HANA database lifecycle manager
                  interactively at the command line: </para>
                <screen>   sudo ./hdblcm</screen>
              </listitem>
            </orderedlist>
          </listitem>
        </orderedlist>
      </sect3>
    </sect2>

    <sect2
      xml:id="sec-for-3-tier-templates-how-to-connect-to-the-other-systems">
      <title>For 3-tier Templates: How to Connect to the Other
        Systems</title>

      <para>Only the XSCS machine has a public IP address and needs to be
        used as intermediate hop (jumphost) between your actual SSH target
        and yourself.</para>
      <para>Instead of using something like <quote>insecure</quote> SSH
        agent forwarding, where the data gets exposed at every jump, you
        can use ProxyCommand to proxy all your commands through your
        jumphost.</para>
      <para>Consider the following scenario:</para>

      <screen>+--------+    +---------+    /------ | Host A |
| Laptop |--P-| XSCS    |---+
+--------+    +---------+    \-------| Host B |
                              ...
                              \------| Host X |</screen>

      <para>A configuration like this will allow you to proxy through the
        jumphost within the admin subnet to HOST A and B,
        &#8230;</para>

      <screen>on YOUR local system create a ssh config file:

$ cat .ssh/config
Host XSCS
   User <emphasis role="strong">adminuser used here as example</emphasis>
   Hostname <emphasis role="strong">public-ip-of-xscs</emphasis>
   Port 22 # a non-standard port would be a good idea

Host hosta
   User adminuser
   Hostname <emphasis role="strong">private-ip of host a</emphasis>
   Port 22
   ProxyCommand ssh -q -W %h:%p XSCS

Host hostb
   User adminuser
   Hostname <emphasis role="strong">private-ip of host b</emphasis>
   Port 22
   ProxyCommand ssh -q -W %h:%p XSCS

etc...</screen>

      <screen>ssh adminuser@hosta</screen>

      <para>or</para>

      <screen>ssh adminuser@<emphasis role="strong">private-ip-hosta</emphasis></screen>
    </sect2>
  </sect1>


  <?pdfpagebreak style="sbp" formatter="fop"?>

  <xi:include href="sbp-legal-notice.xml"/>

  <?pdfpagebreak style="sbp" formatter="fop"?>
  <xi:include href="license-gfdl.xml"/>

</article>
