<?xml version="1.0" encoding="UTF-8"?>
<!--<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbook.rng" type="xml"?>-->
<!DOCTYPE article [
<!ENTITY % entity SYSTEM "entity-decl.ent">
%entity;
]>

<article role="sbp" xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xmlns:its="http://www.w3.org/2005/11/its"
  xml:id="art-sbp-suma-ibmpowervm" xml:lang="en">

  <info>
    <title>Deploying SUSE Linux Enterprise Products with SUSE Manager on IBM PowerVM</title>

    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:bugtracker>
        <dm:url>https://github.com/SUSE/suse-best-practices/issues/new</dm:url>
        <dm:product>Deploying SUSE Linux Enterprise Products with SUSE Manager on IBM
          PowerVM</dm:product>
      </dm:bugtracker>
      <dm:editurl>https://github.com/SUSE/suse-best-practices/edit/main/xml/</dm:editurl>
    </dm:docmanager>


    <meta name="series" its:translate="no">Best Practices</meta>
    <meta name="category" its:translate="no">
      <phrase>Systems Management</phrase>
    </meta>
    <meta name="task" its:translate="no">
      <phrase>Deployment</phrase>
      <phrase>Installation</phrase>
      <phrase>Configuration</phrase>
    </meta>
    <meta name="title" its:translate="yes">Deploying SUSE Linux Enterprise Products with SUSE Manager on IBM
      PowerVM</meta>
    <meta name="description" its:translate="yes">Overview of how to deploy SUSE Linux Enterprise products with SUSE
    Manager on IBM Power Systems</meta>
    <meta name="social-descr" its:translate="yes">Deploying SLE products with SUMA on IBM Power Systems</meta>
    <meta name="productname" its:translate="no">
      <productname version="3.1">SUSE Manager</productname>
      <productname version="3.2">SUSE Manager</productname>
      <productname version="4.0">SUSE Manager</productname>
      <productname version="4.1">SUSE Manager</productname>
      <productname version="4.2">SUSE Manager</productname>
      <productname version="4.3">SUSE Manager</productname>
    </meta>

    <meta name="platform" its:translate="no">SUSE Manager</meta>


    <authorgroup>
      <author>
        <personname>
          <firstname>Olivier</firstname>
          <surname>Van Rompuy</surname>
        </personname>
        <affiliation>
          <jobtitle>Senior System Engineer and Technical Consultant</jobtitle>
          <orgname>IRIS</orgname>
        </affiliation>
      </author>
      <!--   <editor>
      <orgname></orgname>
      </editor>
      <othercredit>
      <orgname></orgname>
      </othercredit>-->
    </authorgroup>

    <cover role="logos">
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suse.svg" width="5em" align="center" valign="bottom"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suse.svg" width="152px" align="center" valign="bottom"/>
        </imageobject>
        <textobject><phrase>SUSE logo</phrase></textobject>
      </mediaobject>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="iris_canon-4c.jpg" width="3em" align="center" valign="bottom"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="iris_canon-4c.jpg" width="125px" align="center" valign="bottom"/>
        </imageobject>
        <textobject><phrase>Iris Canon logo</phrase></textobject>
      </mediaobject>
    </cover>

    <revhistory xml:id="rh-art-sbp-suma-ibmpowervm">
      <revision>
        <date>2018-08-14</date>
        <revdescription>
          <para> </para>
        </revdescription>
      </revision>
    </revhistory>

    <abstract>

      <para>The document at hand provides an overview of how to deploy SUSE Linux Enterprise
        products with SUSE Manager on IBM Power Systems. SUSE Manager enables you to manage and
        maintain your enterprise Linux system deployments across physical, virtual and cloud
        environments via one centralized tool. Described is a base deployment of SUSE Manager 3.1 on
        IBM PowerVM LPARs, including Autoinstallation, AutoYaST and Netboot Integration.</para>

      <para>
        <emphasis role="strong">Disclaimer: </emphasis> Documents published as part of the SUSE Best
        Practices series have been contributed voluntarily by SUSE employees and third parties. They
        are meant to serve as examples of how particular actions can be performed. They have been
        compiled with utmost attention to detail. However, this does not guarantee complete
        accuracy. SUSE cannot verify that actions described in these documents do what is claimed or
        whether actions described have unintended consequences. SUSE LLC, its affiliates, the
        authors, and the translators may not be held liable for possible errors or the consequences
        thereof. </para>

    </abstract>
  </info>

  <sect1 xml:id="sec-install-suma-power">
    <title>Installing SUSE Manager on IBM Power Systems</title>

    <para>First, you need to perform several actions related to the IBM PowerVM architecture (refer
      also to the IBM documentation at <link
        xlink:href="https://www.ibm.com/support/knowledgecenter/"
        >https://www.ibm.com/support/knowledgecenter/</link> ):</para>

    <procedure>
      <step>
        <para>Create a new Logical Partition (LPAR) for SUSE Manager on an IBM Power System with
          POWER8 or higher processors.</para>
      </step>
      <step>
        <para>Configure the infrastructure for this LPAR: LAN, SAN, storage LUNs, zoning,
          etc..</para>
      </step>
      <step>
        <para>Create a virtual DVD drive for this LPAR on one of the VIO servers (learn more about
          VIO servers here: <link
            xlink:href="https://www.ibm.com/support/knowledgecenter/en/POWER8/p8hb1/p8hb1_vios_virtualioserveroverview.htm"
            >https://www.ibm.com/support/knowledgecenter/en/POWER8/p8hb1/p8hb1_vios_virtualioserveroverview.htm</link>).</para>
      </step>
      <step>
        <para>Add the SUSE Linux Enterprise Server 12 ISO files to the virtual optical device (DVD)
          repository on this VIO server.</para>
      </step>
      <step>
        <para>Using the command <command>cfgassist</command> on the VIO server loads the first DVD
          in the virtual drive.</para>
      </step>
      <step>
        <para>Activate the LPAR, enter the <emphasis role="strong">System Management
            Services</emphasis> (SMS) menu and choose to boot from the DVD.</para>
      </step>
    </procedure>

    <para>When the YaST installation tool from SUSE Linux Enterprise Server appears, subscribe with
      the correct SUSE Customer Center (SCC) registration code (<quote>SUSE Linux Enterprise Server
        for IBM POWER</quote>). Collect your registration codes from the SCC portal site at <link
        xlink:href="https://scc.suse.com">https://scc.suse.com</link>.</para>

    <para>Now choose to add the SUSE Manager Server extension as shown on the screen below, and
      enter <emphasis role="strong">Next</emphasis>:</para>

    <figure>
      <title>YaST Installation - Extensions and Module Selection</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-extension-selection.png" width="70%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-extension-selection.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Accept the SUSE End User License Agreement (EULA) and enter <emphasis role="strong"
        >Next</emphasis>:</para>

    <figure>
      <title>YaST Installation - SUSE End User License Agreement</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-license-agreement.png" width="70%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-license-agreement.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Provide the correct registration code delivered with your SUSE Manager subscription, and
      enter <emphasis role="strong">Next</emphasis>:</para>

    <figure>
      <title>YaST Installation - SUSE Manager Registration Code</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-extension-regcodes.png" width="70%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-extension-regcodes.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>No additional <emphasis role="strong">Add-On Product</emphasis> needs to be installed.
      Skip this screen and enter <emphasis role="strong">Next</emphasis>:</para>

    <figure>
      <title>YaST Installation - Add-On Product</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-addon.png" width="70%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-addon.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>The next screen provides the partitioning options:</para>

    <figure>
      <title>YaST Installation - Partitioning Options</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-suggestedpartioning-1.png" width="70%" format="PNG"
          />
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-suggestedpartioning-1.png" width="80%" format="PNG"
          />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Select <emphasis role="strong">Expert Partitioner</emphasis>:</para>

    <figure>
      <title>YaST Installation - Expert Partitioner</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-expertpartinioneer.png" width="30%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-expertpartinioneer.png" width="70%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Execute <emphasis role="strong">Rescan Devices</emphasis> to clear the auto-suggested
      partitioning:</para>

    <figure>
      <title>YaST Installation - Rescan Devices</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-rescandevices.png" width="20%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-rescandevices.png" width="70%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>In the particular scenario at hand, a reinstallation has been performed. In this case,
      follow the steps below. If partitioning and/or LVM settings are already present, choose to
      import these settings into the installer, and select <emphasis role="strong">Import Mount
        Points</emphasis>:</para>

    <figure>
      <title>YaST Installation - Import Mount Points</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-importmount.png" width="30%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-importmount.png" width="70%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <note>
      <title>Fresh Installation</title>
      <para>If you perform an installation from scratch, configure your partitions and LVM settings
        following the recommendations below:</para>

      <simplelist>
        <member>Minimum 100 GB for root / partition</member>
        <member>Minimum 50 GB for <filename>/var/lib/pgsql</filename></member>
        <member>Minimum 50 GB per SUSE product and 100 GB per Red Hat product for
            <filename>/var/spacewalk</filename></member>
      </simplelist>
    </note>

    <para>When you are finished, continue with the partitioning step, and enter <emphasis
        role="strong">Next</emphasis>:</para>

    <figure>
      <title>YaST Installation - Suggested Partitioning</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-suggestedpartitionig-2.png" width="60%" format="PNG"
          />
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-suggestedpartitionig-2.png" width="80%" format="PNG"
          />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Provide the correct time zone settings, and confirm them with <emphasis role="strong"
        >Next</emphasis>:</para>

    <figure>
      <title>YaST Installation - Clock and Time Zone</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-timezone.png" width="60%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-timezone.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>At this stage you can choose to skip the creation of an initial user. Enter <emphasis
        role="strong">Next</emphasis>:</para>

    <figure>
      <title>YaST Installation - Local User</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-localuser.png" width="70%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-localuser.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Verify the settings overview and make further changes or customizations where needed.
      Start the installation with <emphasis role="strong">Install</emphasis>:</para>

    <figure>
      <title>YaST Installation - Installation Settings</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-installation-settings.png" width="70%" format="PNG"
          />
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-installation-settings.png" width="80%" format="PNG"
          />
        </imageobject>
      </mediaobject>
    </figure>

    <para>After the installation is finished, verify whether all aspects of the operating system
      have been installed correctly.</para>

  </sect1>

  <sect1 xml:id="sec-suma-setup">
    <title>SUSE Manager Setup</title>

    <important>
      <title>DNS</title>

      <para>After the installation make sure you configure your hosts DNS settings and add an entry
        to DNS. This ensures that the host name can be correctly resolved.</para>

    </important>

    <para>Open an <emphasis>SSH</emphasis> session to the new SUSE Manager host and start
      YaST:</para>

    <screen># yast2 susemanager_setup</screen>

    <para>Choose to configure SUSE Manager from scratch:</para>

    <figure>
      <title>YaST Installation - Setting up SUSE Manager</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-setupfromscratch.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-setupfromscratch.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Enter a correct administrator e-mail address:</para>

    <figure>
      <title>YaST Installation - E-mail Address</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-email.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-email.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Provide details for the certificate generation:</para>

    <figure>
      <title>YaST Installation - Certificate Generation</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-certifcatesetup.png" width="25%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-certifcatesetup.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Provide database authentication settings:</para>

    <figure>
      <title>YaST Installation - Database Settings</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-db-settings.png" width="25%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-db-settings.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Provide your SUSE Manager SCC organization user name and password:</para>

    <figure>
      <title>YaST Installation - SCC Settings</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-sccsettings.png" width="60%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-sccsettings.png" width="70%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Perform an authentication test toward the SUSE Customer Center:</para>

    <figure>
      <title>YaST Installation - Test Details</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-test-details.png" width="60%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-test-details.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Confirm to run the setup process with <emphasis role="strong">Yes</emphasis>:</para>

    <figure>
      <title>YaST Installation - Setup Process Confirmation</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-runsetupnow.png" width="60%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-runsetupnow.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Now the setup process is started:</para>

    <figure>
      <title>YaST Installation - Write Settings</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-writesettings.png" width="70%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-writesettings.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Wait until the setup process is completed. Then enter <emphasis role="strong"
        >Finish</emphasis>:</para>

    <figure>
      <title>YaST Installation - Setup Completed</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-setupcompleted.png" width="70%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-setupcompleted.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Verify that you can access the new SUSE Manager URL using a browser.</para>

    <important>
      <para>At time of writing this document, in SUSE Linux Enterprise Server 12 SP3 a minor
        workaround needs to be applied to the Apache configuration file to use spacewalk:</para>

      <para>Add the following file with the following line of content:</para>
      <screen># vi /etc/apache2/conf.d/zipp-fix.conf
HttpProtocolOptions Unsafe</screen>

      <para>Restart Apache to activate the change:</para>
      <screen># systemctl restart apache2.service</screen>

    </important>


  </sect1>

  <sect1 xml:id="sec-create-org">
    <title>Create and Configure the Organization</title>

    <para>After the SUSE Manager setup is finished, you must create your organization on the SUSE
      Manager Web user interface.</para>

    <para>Provide all the requested details including an initial administrator user and
      password:</para>

    <figure>
      <title>SUSE Manager Web UI - Create Organization</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-createorg.png" width="90%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-createorg.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Confirm with <emphasis role="strong">Create Organization</emphasis>. The following message
      appears on the screen:</para>

    <figure>
      <title>SUSE Manager Web UI - Organization Created Successfully</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-organization-created.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-organization-created.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Navigate to the <emphasis role="strong">Setup Wizard</emphasis> in the left pane:</para>

    <figure>
      <title>SUSE Manager Web UI - Setup Wizard</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-setupwizard.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-setupwizard.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Select the <emphasis role="strong">Organization Credentials</emphasis> tab:</para>

    <figure>
      <title>SUSE Manager Web UI - Organization Credentials</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-orgcredentials.png" width="30%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-orgcredentials.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Click <emphasis role="strong">Add a new credential</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Add Credential</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-newcredential.png" width="60%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-newcredential.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Enter your correct organization credentials from the SCC portal and save them:</para>

    <figure>
      <title>SUSE Manager Web UI - Edit Credentials</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-editcredentials.png" width="60%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-editcredentials.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Now navigate to the <emphasis role="strong">SUSE Products</emphasis> tab and select the
      SUSE products you need. In this example, SUSE Linux Enterprise Server for SAP applications 12
      SP3 has been selected:</para>

    <figure>
      <title>SUSE Manager Web UI - SUSE Products</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-suseproducts.png" width="60%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-suseproducts.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Do not forget to also check the sub-channels you need for each product:</para>

    <figure>
      <title>SUSE Manager Web UI - Sub-Channels</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-select-modules.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-select-modules.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>When your selection is done, confirm it with <emphasis role="strong">Add
        products</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Add Products</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-button-addproducts.png" width="20%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-button-addproducts.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Navigate to <emphasis role="strong">Manager Configuration</emphasis> in the left pane, and
      select <emphasis role="strong">Bare-metal systems</emphasis> as indicated below:</para>

    <figure>
      <title>SUSE Manager Web UI - Bare-metal Systems</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-baremetal.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-baremetal.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Now enable <emphasis role="strong">Bare-metal systems</emphasis>; click the green box
        <emphasis role="strong">Enable adding to this organization</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Enable Bare-metal Systems</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-sumaconfig-baremetal.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-sumaconfig-baremetal.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

  </sect1>

  <sect1 xml:id="sec-create-swchannel-hierarchy">
    <title>Create the Software Channel Hierarchy</title>

    <para>The following section describes how to create the software channel hierarchy.</para>

    <para>Log on as root using <emphasis>SSH</emphasis>. Install the
        <package>spacewalk-utils</package> package with the following command:</para>

    <screen># zypper install spacewalk-utils</screen>

    <para>Check whether the available channels correspond with selections made before:</para>

    <screen># spacewalk-manage-channel-lifecycle  --list-channels
Spacewalk Username: admin
Spacewalk Password:
Channel tree:

 1. sle12-sp2-sap-pool-ppc64le
      \__ ibm-dlpar-utils-sap-sp2
      \__ sle-12-sp2-sap-updates-ppc64le
      \__ sle-ha12-sp2-pool-ppc64le-sap-sp2
      \__ sle-ha12-sp2-updates-ppc64le-sap-sp2
      \__ sle-manager-tools12-pool-ppc64le-sap-sp2
      \__ sle-manager-tools12-updates-ppc64le-sap-sp2
      \__ sle-module-adv-systems-management12-pool-ppc64le-sap-sp2
      \__ sle-module-adv-systems-management12-updates-ppc64le-sap-sp2
      \__ sle-module-legacy12-pool-ppc64le-sap-sp2
      \__ sle-module-legacy12-updates-ppc64le-sap-sp2
      \__ sles12-sp2-pool-ppc64le-sap-sp2
      \__ sles12-sp2-updates-ppc64le-sap-sp2

 2. sle12-sp3-sap-pool-ppc64le
      \__ ibm-dlpar-utils-sap-sp3
      \__ sle-12-sp3-sap-updates-ppc64le
      \__ sle-ha12-sp3-pool-ppc64le-sap-sp3
      \__ sle-ha12-sp3-updates-ppc64le-sap-sp3
      \__ sle-manager-tools12-pool-ppc64le-sap-sp3
      \__ sle-manager-tools12-updates-ppc64le-sap-sp3
      \__ sle-module-adv-systems-management12-pool-ppc64le-sap-sp3
      \__ sle-module-adv-systems-management12-updates-ppc64le-sap-sp3
      \__ sle-module-legacy12-pool-ppc64le-sap-sp3
      \__ sle-module-legacy12-updates-ppc64le-sap-sp3
      \__ sles12-sp3-pool-ppc64le-sap-sp3
      \__ sles12-sp3-updates-ppc64le-sap-sp3
</screen>

    <para>Synchronize the <filename>ibm-dlpar</filename> repository and import the GPG key.</para>

    <screen># spacewalk-repo-sync --channel ibm-dlpar-utils-sap-sp2
14:38:14 ======================================
14:38:14 | Channel: ibm-dlpar-utils-sap-sp2
14:38:14 ======================================
14:38:14 Sync of channel started.
Do you want to import the GPG key 0x3E6E42BE "Linux on POWER (IBM Linux Technology Center) &lt;poweryum@linux.vnet.ibm.com>" from http://public.dhe.ibm.com/software/server/POWER/Linux/yum/OSS/SLES/12/ppc64le//repodata/repomd.xml.key? [y/n]:
<emphasis role="strong">y</emphasis>
14:38:20 Repo URL: http://public.dhe.ibm.com/software/server/POWER/Linux/yum/OSS/SLES/12/ppc64le/
14:38:20 Packages in repo:                36
14:38:20 Packages already synced:          0
14:38:20 Packages to sync:                30
14:38:20 New packages to download:        30
14:38:20 Downloading 30 files.
14:38:22 1/30 : DynamicRM-2.0.5-1.ppc64le.rpm
14:38:22 2/30 : IBMinvscout-3.1.0-2.ppc64le.rpm
…….
14:38:29 29/30 : rsct.core-3.2.2.3-17144.ppc64le.rpm
14:38:47 30/30 : esagent.pLinux-4.2.0-9.noarch.rpm
Importing packages:     |##################################################| 100.0%
14:38:54 Linking packages to channel.
14:38:55 Transferred 100 orphaned vendor packages to the default organization
14:38:55 Repo http://public.dhe.ibm.com/software/server/POWER/Linux/yum/OSS/SLES/12/ppc64le/ has 0 patches.
14:38:55 Sync completed.
14:38:55 Total time: 0:00:40

# spacewalk-repo-sync --channel ibm-dlpar-utils-sap-sp3
…

Synchronize the base channel :
# spacewalk-repo-sync --channel sle12-sp2-sap-pool-ppc64le
...

# spacewalk-repo-sync --channel sle12-sp3-sap-pool-ppc64le
…
</screen>

    <para>In the specific setup at hand, the lifecycle phases are limited to <quote>dev</quote> and
        <quote>prod</quote> (<quote>test</quote> has been removed).</para>

    <screen>vi ~/.spacewalk-manage-channel-lifecycle/settings.conf
phases = dev, prod
exclude channels =</screen>

    <para>This can be customized as required, which means you can add and remove phases at this
      stage of the procedure.</para>

    <para>Generate the <quote>dev</quote> channels by promoting the SUSE channels. The same command
      is used to fully synchronize the <quote>dev</quote> channels with the online
      repositories:</para>

    <screen># spacewalk-manage-channel-lifecycle -c sle12-sp2-sap-pool-ppc64le --init
INFO: Cloning dev-sle12-sp2-sap-pool-ppc64le from sle12-sp2-sap-pool-ppc64le
INFO: Cloning dev-ibm-dlpar-utils-sap-sp2 from ibm-dlpar-utils-sap-sp2
INFO: Cloning dev-sle-12-sp2-sap-updates-ppc64le from sle-12-sp2-sap-updates-ppc64le
INFO: Cloning dev-sle-ha12-sp2-pool-ppc64le-sap-sp2 from sle-ha12-sp2-pool-ppc64le-sap-sp2
INFO: Cloning dev-sle-ha12-sp2-updates-ppc64le-sap-sp2 from sle-ha12-sp2-updates-ppc64le-sap-sp2
INFO: Cloning dev-sle-manager-tools12-pool-ppc64le-sap-sp2 from sle-manager-tools12-pool-ppc64le-sap-sp2
INFO: Cloning dev-sle-manager-tools12-updates-ppc64le-sap-sp2 from sle-manager-tools12-updates-ppc64le-sap-sp2
INFO: Cloning dev-sle-module-adv-systems-management12-pool-ppc64le-sap-sp2 from sle-module-adv-systems-management12-pool-ppc64le-sap-sp2
INFO: Cloning dev-sle-module-adv-systems-management12-updates-ppc64le-sap-sp2 from sle-module-adv-systems-management12-updates-ppc64le-sap-sp2
INFO: Cloning dev-sle-module-legacy12-pool-ppc64le-sap-sp2 from sle-module-legacy12-pool-ppc64le-sap-sp2
INFO: Cloning dev-sle-module-legacy12-updates-ppc64le-sap-sp2 from sle-module-legacy12-updates-ppc64le-sap-sp2
INFO: Cloning dev-sles12-sp2-pool-ppc64le-sap-sp2 from sles12-sp2-pool-ppc64le-sap-sp2
INFO: Cloning dev-sles12-sp2-updates-ppc64le-sap-sp2 from sles12-sp2-updates-ppc64le-sap-sp2
</screen>

    <para>Now the <quote>dev</quote> channel can be promoted to generate and synchronize the
        <quote>prod</quote> channels with <command>dev</command>:</para>

    <screen># spacewalk-manage-channel-lifecycle -c dev-sle12-sp2-sap-pool-ppc64le --promote
INFO: Cloning prod-sle12-sp2-sap-pool-ppc64le from dev-sle12-sp2-sap-pool-ppc64le
INFO: Cloning prod-ibm-dlpar-utils-sap-sp2 from dev-ibm-dlpar-utils-sap-sp2
INFO: Cloning prod-sle-12-sp2-sap-updates-ppc64le from dev-sle-12-sp2-sap-updates-ppc64le
INFO: Cloning prod-sle-ha12-sp2-pool-ppc64le-sap-sp2 from dev-sle-ha12-sp2-pool-ppc64le-sap-sp2
INFO: Cloning prod-sle-ha12-sp2-updates-ppc64le-sap-sp2 from dev-sle-ha12-sp2-updates-ppc64le-sap-sp2
INFO: Cloning prod-sle-manager-tools12-pool-ppc64le-sap-sp2 from dev-sle-manager-tools12-pool-ppc64le-sap-sp2
INFO: Cloning prod-sle-manager-tools12-updates-ppc64le-sap-sp2 from dev-sle-manager-tools12-updates-ppc64le-sap-sp2
INFO: Cloning prod-sle-module-adv-systems-management12-pool-ppc64le-sap-sp2 from dev-sle-module-adv-systems-management12-pool-ppc64le-sap-sp2
INFO: Cloning prod-sle-module-adv-systems-management12-updates-ppc64le-sap-sp2 from dev-sle-module-adv-systems-management12-updates-ppc64le-sap-sp2
INFO: Cloning prod-sle-module-legacy12-pool-ppc64le-sap-sp2 from dev-sle-module-legacy12-pool-ppc64le-sap-sp2
INFO: Cloning prod-sle-module-legacy12-updates-ppc64le-sap-sp2 from dev-sle-module-legacy12-updates-ppc64le-sap-sp2
INFO: Cloning prod-sles12-sp2-pool-ppc64le-sap-sp2 from dev-sles12-sp2-pool-ppc64le-sap-sp2
INFO: Cloning prod-sles12-sp2-updates-ppc64le-sap-sp2 from dev-sles12-sp2-updates-ppc64le-sap-sp2
</screen>

    <para>The same steps need to be performed for any additional product or version:</para>

    <screen># spacewalk-manage-channel-lifecycle -c sle12-sp3-sap-pool-ppc64le –promote
…

# spacewalk-manage-channel-lifecycle -c dev-sle12-sp3-sap-pool-ppc64le –promote
…
</screen>

    <para>For all of the <filename>-ibm-dlpar-utils-</filename> child channels, deactivate the GPG
      check as it requires an external GPG key from IBM. To do so, navigate to <emphasis
        role="strong">Software</emphasis> in the left pan. Then go to <emphasis role="strong">Manage
        Software Channels</emphasis> and choose <emphasis role="strong">Overview</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Manage Software Channels</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-swchannels-overview.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-swchannels-overview.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>A list of all of the <filename>-ibm-dlpar-utils-</filename> child channels appears:</para>

    <figure>
      <title>SUSE Manager Web UI - List of Child Channels</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-devsle12.png" width="30%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-devsle12.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Make sure the check box for <emphasis role="strong">Enable GPG Check</emphasis> is not
      marked:</para>

    <figure>
      <title>SUSE Manager Web UI - Enable GPG Check</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-enablegpgcheck.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-enablegpgcheck.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Alternatively you can download the GPG key locally and configure a local URL.</para>

  </sect1>

  <sect1 xml:id="sec-create-system-groups">
    <title>Creating System Groups</title>

    <para>Optionally you can configure system groups to distinguish different types of systems. In
      this example the system groups <quote>development</quote> and <quote>production</quote> are
      configured.</para>

    <para>Navigate to <emphasis role="strong">Systems</emphasis> on the left pane, and select
        <emphasis role="strong">System Groups</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - System Groups</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-systemgroups.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-systemgroups.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Click <emphasis role="strong">Create Group</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Button Create Group</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-button-creategroup.png" width="25%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-button-creategroup.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Enter the required information and confirm by clicking <emphasis role="strong">Create
        Group</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Create System Groups</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-createsystemgroup.png" width="60%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-createsystemgroup.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Now you see the newly created groups:</para>

    <figure>
      <title>SUSE Manager Web UI - Show System Groups</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-showsystemgroups.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-showsystemgroups.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>


  </sect1>

  <sect1 xml:id="sec-bootstrap-config">
    <title>Bootstrap Configuration</title>

    <para>Navigate to <emphasis role="strong">Manager Configuration</emphasis> on the left pane, and
      select <emphasis role="strong">Bootstrap Script</emphasis>.</para>

    <figure>
      <title>SUSE Manager Web UI - Menu Manager Configuration</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-managerconfic.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-managerconfic.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Click the <emphasis role="strong">Bootstrap Script</emphasis> tab on top. Enter the
      required information to create the general client bootstrap script configuration:</para>

    <figure>
      <title>SUSE Manager Web UI - Tab Bootstrap Script</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-bootstrap-script.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-bootstrap-script.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Provide the correct <emphasis>Fully-Qualified Domain Name</emphasis> (FQDN) for the SUSE
      Manager host name.</para>

    <para>Now create the activation keys. Navigate to <emphasis role="strong">Systems</emphasis> on
      the left pane and choose <emphasis role="strong">Activation Keys</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Activation Keys</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-activationkeys.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-activationkeys.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Click <emphasis role="strong">Create Key</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Button Create Key</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-button-createkey.png" width="20%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-button-createkey.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Create a universal activation key first:</para>

    <figure>
      <title>SUSE Manager Web UI - Universal Key</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-createuniversalkey.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-createuniversalkey.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>After that, create a key you will use for the autoinstall procedure. For the example at
      hand, the <quote>dev</quote> channel has been selected as base channel.</para>

    <figure>
      <title>SUSE Manager Web UI - Create Key for <quote>dev</quote> Channel</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-createkey-devchannel.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-createkey-devchannel.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Click the <emphasis role="strong">Child Channels</emphasis> tab on top. The appropriate
      channels should be linked here:</para>

    <figure>
      <title>SUSE Manager Web UI - Child Channels</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-childchannels.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-childchannels.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Click the <emphasis role="strong">Packages</emphasis> tab on top, and add the following
      values as packages:</para>

    <figure>
      <title>SUSE Manager Web UI - Packages</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-packages.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-packages.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Click <emphasis role="strong">Update Activation Key</emphasis>.</para>

    <para>Now add the development group to this key. Click the <emphasis role="strong"
        >Groups</emphasis> tab on top and choose <emphasis role="strong">List /
      Leave</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Groups - List/Leave</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-list-systemgroups.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-list-systemgroups.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Optionally you can also create and add configuration channels.</para>

    <para>Perform the same configuration for a <emphasis role="strong">prod</emphasis> key:</para>

    <figure>
      <title>SUSE Manager Web UI - Create Key for <quote>prod</quote> Channel</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-create-activation-key.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-create-activation-key.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>You also need to create a bootstrap repository. Use the command:</para>

    <screen># mgr-create-bootstrap-repo -c SLES4SAP-12-SP2-ppc64le</screen>

    <para>Bootstrap scripts are usually generated automatically, but you can manually generate them
      for each key using the following CLI syntax:</para>

    <screen># mgr-bootstrap --activation-keys=1-dev-sle12-sp2-sap-pool-ppc64le --script bootstrap-dev-sle12-sp2-sap-pool-ppc64le.sh --no-up2date --allow-config-actions --allow-remote-commands</screen>

    <screen># mgr-bootstrap --activation-keys=1-prod-sle12-sp2-sap-pool-ppc64le --script bootstrap-prod-sle12-sp2-sap-pool-ppc64le.sh  --no-up2date --allow-config-actions –allow-remote-commands</screen>

    <para>The default path where the bootstrap scripts reside is
        <filename>/srv/www/htdocs/pub/bootstrap</filename>. </para>

    <para>The URL to access the scripts is <emphasis role="italic">https://hostname.domain/pub/bootstrap/bootstrap-scriptname.sh.</emphasis></para>

    <para>An already installed SUSE Linux Enterprise Server host can be bootstrapped using the
      following syntax from that host:</para>

    <screen>curl -Sks https://hostname.domain/pub/bootstrap/bootstrap-scriptname.sh |  /bin/bash</screen>

    <para>You can also copy and past the script below and execute it.</para>

    <bridgehead>Custom Bootstrap Script</bridgehead>

    <para>The following script blueprint can be used to create a custom bootstrap script. Modify the
      SUSE Manager host name and the activation key according to your requirements.</para>

    <screen>
#!/bin/bash
echo "SUSE Manager Server Client bootstrap script v4.0"
echo
echo
echo "MINOR MANUAL EDITING OF THIS FILE MAY BE REQUIRED!"
echo
echo "If this bootstrap script was created during the initial installation"
echo "of a SUSE Manager Server, the ACTIVATION_KEYS, and ORG_GPG_KEY values will"
echo "probably *not* be set (see below). If this is the case, please do the"
echo "following:"
echo "  - copy this file to a name specific to its use."
echo "    (e.g., to bootstrap-SOME_NAME.sh - like bootstrap-web-servers.sh.)"
echo "  - on the website create an activation key or keys for the system(s) to"
echo "    be registered."
echo "  - edit the values of the VARIABLES below (in this script) as"
echo "    appropriate:"
echo "    - ACTIVATION_KEYS needs to reflect the activation key(s) value(s)"
echo "      from the website. XKEY or XKEY,YKEY"
echo "    - ORG_GPG_KEY needs to be set to the name(s) of the corporate public"
echo "      GPG key filename(s) (residing in /srv/www/htdocs/pub) if appropriate. XKEY or XKEY,YKEY"
echo
echo "Verify that the script variable settings are correct:"
echo "    - CLIENT_OVERRIDES should be only set differently if a customized"
echo "      client-config-overrides-VER.txt file was created with a different"
echo "      name."
echo "    - ensure the value of HOSTNAME is correct."
echo "    - ensure the value of ORG_CA_CERT is correct."
echo
echo "Enable this script: comment (with #'s) this block (or, at least just"
echo "the exit below)"
echo
ACTIVATION_KEYS=1-dev-sle12-sp2-sap-pool-ppc64le
ORG_GPG_KEY=
CLIENT_OVERRIDES=client-config-overrides.txt
HOSTNAME=[SUMA FQDN]
ORG_CA_CERT=RHN-ORG-TRUSTED-SSL-CERT
ORG_CA_CERT_IS_RPM_YN=0
USING_SSL=1
USING_GPG=1
REGISTER_THIS_BOX=1
ALLOW_CONFIG_ACTIONS=1
ALLOW_REMOTE_COMMANDS=1
FULLY_UPDATE_THIS_BOX=0
PROFILENAME=""   # Empty by default to let it be set automatically.
DISABLE_LOCAL_REPOS=1
DISABLE_YAST_AUTOMATIC_ONLINE_UPDATE=1
Z_CLIENT_REPOS_ROOT=
MYNAME=`hostname -f`
LCMYNAME=`echo $MYNAME | tr '[:upper:]' '[:lower:]'`
LCHOSTNAME=`echo $HOSTNAME | tr '[:upper:]' '[:lower:]'`

if [ $LCMYNAME == $LCHOSTNAME ]; then
    echo "Name of client and of SUSE Manager server are the same."
    echo "Do not try to register a SUSE Manager server at itself!"
    echo "Aborting."
    exit 1
fi
if [ -f "/var/adm/autoinstall/cache/SUSE_Manager_keys" ]; then
    . /var/adm/autoinstall/cache/SUSE_Manager_keys
    if [ "x$redhat_management_key" != "x" ]; then
        ACTIVATION_KEYS="$ACTIVATION_KEYS,$redhat_management_key"
    fi

    if [ "x$registration_key" != "x" ]; then
        ACTIVATION_KEYS="$ACTIVATION_KEYS,$registration_key"
    fi

    ACTIVATION_KEYS=${ACTIVATION_KEYS#,}
fi
if [ -x /usr/bin/wget ] ; then
    output=`LANG=en_US /usr/bin/wget --no-check-certificate 2>&amp;1`
    error=`echo $output | grep "unrecognized option"`
    if [ -z "$error" ] ; then
        FETCH="/usr/bin/wget -nv -r -nd --no-check-certificate"
    else
        FETCH="/usr/bin/wget -nv -r -nd"
    fi
elif [ -x /usr/bin/curl ] ; then
    output=`LANG=en_US /usr/bin/curl -k 2>&amp;1`
    error=`echo $output | grep "is unknown"`
    if [ -z "$error" ] ; then
        FETCH="/usr/bin/curl -ksSOf"
    else
        FETCH="/usr/bin/curl -sSOf"
    fi
else
    echo "To be able to download files, please install either 'wget' or 'curl'"
    exit 1
fi

HTTP_PUB_DIRECTORY=http://${HOSTNAME}/pub
HTTPS_PUB_DIRECTORY=https://${HOSTNAME}/pub
if [ $USING_SSL -eq 0 ] ; then
    HTTPS_PUB_DIRECTORY=${HTTP_PUB_DIRECTORY}
fi

INSTALLER=up2date
if [ -x /usr/bin/zypper ] ; then
    INSTALLER=zypper
elif [ -x /usr/bin/yum ] ; then
    INSTALLER=yum
fi

if [ ! -w . ] ; then
    echo ""
    echo "*** ERROR: $(pwd):"
    echo "    No permission to write to the current directory."
    echo "    Please execute this script in a directory where downloaded files can be stored."
    echo ""
    exit 1
fi
echo
echo "UPDATING RHN_REGISTER/UP2DATE CONFIGURATION FILES"
echo "-------------------------------------------------"
echo "* downloading necessary files"
echo "  client_config_update.py..."
rm -f client_config_update.py
$FETCH ${HTTPS_PUB_DIRECTORY}/bootstrap/client_config_update.py
echo "  ${CLIENT_OVERRIDES}..."
rm -f ${CLIENT_OVERRIDES}
$FETCH ${HTTPS_PUB_DIRECTORY}/bootstrap/${CLIENT_OVERRIDES}

if [ ! -f "client_config_update.py" ] ; then
    echo "ERROR: client_config_update.py was not downloaded"
    exit 1
fi
if [ ! -f "${CLIENT_OVERRIDES}" ] ; then
    echo "ERROR: ${CLIENT_OVERRIDES} was not downloaded"
    exit 1
fi

echo
echo "PREPARE GPG KEYS AND CORPORATE PUBLIC CA CERT"
echo "-------------------------------------------------"
if [ ! -z "$ORG_GPG_KEY" ] ; then
    echo
    echo "* importing organizational GPG keys"
    for GPG_KEY in $(echo "$ORG_GPG_KEY" | tr "," " "); do
        rm -f ${GPG_KEY}
        $FETCH ${HTTPS_PUB_DIRECTORY}/${GPG_KEY}
        res=$(LC_ALL=C rpm -q --queryformat '%{version}' up2date | sed -e 's/\..*//g')
        if [ "x$res" == "x2" ] ; then
            gpg $(up2date --gpg-flags) --import $GPG_KEY
        else
            rpm --import $GPG_KEY
        fi
    done
else
    echo "* no organizational GPG keys to import"
fi

echo
if [ $USING_SSL -eq 1 ] ; then
    echo "* attempting to install corporate public CA cert"
    test -d /usr/share/rhn || mkdir -p /usr/share/rhn
    rm -f ${ORG_CA_CERT}
    $FETCH ${HTTP_PUB_DIRECTORY}/${ORG_CA_CERT}

    if [ $ORG_CA_CERT_IS_RPM_YN -eq 1 ] ; then
        rpm -Uvh --force --replacefiles --replacepkgs ${ORG_CA_CERT}
        rm -f ${ORG_CA_CERT}
    else
        mv ${ORG_CA_CERT} /usr/share/rhn/
    fi

    if [ "$INSTALLER" == zypper ] ; then
      function suseVersion() {
        rpm --eval "%{suse_version}"
      }

      function sslCertDir() {
        if [[ $(suseVersion) -ge 1315 ]]; then
          echo "/etc/pki/trust/anchors"
        else
          echo "/etc/ssl/certs"
        fi
      }

      function targetCertPath() {
        echo "$(sslCertDir)/${ORG_CA_CERT}.pem"
      }

      function updateCertificates() {
        if [[ $(suseVersion) -ge 1315 ]]; then
          test -x /usr/sbin/update-ca-certificates &amp;&amp; /usr/sbin/update-ca-certificates
        else
          test -x /usr/bin/c_rehash &amp;&amp; /usr/bin/c_rehash /etc/ssl/certs/ | grep "${ORG_CA_CERT}"
        fi
      }

      function symlinkCertificate() {
        if [  $ORG_CA_CERT_IS_RPM_YN -eq 1 ] ; then
          ORG_CA_CERT=$(basename $(sed -n 's/^sslCACert *= *//p' "${CLIENT_OVERRIDES}"))
        fi
        test -e "$(targetCertPath)" || {
          test -d $(sslCertDir) || mkdir -p $(sslCertDir)
          ln -s "/usr/share/rhn/${ORG_CA_CERT}" "$(targetCertPath)"
        }
      }

      symlinkCertificate
      updateCertificates
    fi
else
    echo "* configured not to use SSL: don't install corporate public CA cert"
fi

if [ "$INSTALLER" == zypper ]; then
  echo
  echo "CHECKING THE REGISTRATION STACK"
  echo "-------------------------------------------------"

  function getZ_CLIENT_CODE_BASE() {
    local BASE=""
    local VERSION=""
    local PATCHLEVEL=""
    test -r /etc/SuSE-release &amp;&amp; {
      grep -q 'Enterprise' /etc/SuSE-release &amp;&amp; BASE="sle"
      eval $(grep '^\(VERSION\|PATCHLEVEL\)' /etc/SuSE-release | tr -d '[:blank:]')
    }
    Z_CLIENT_CODE_BASE="${BASE:-unknown}"
    Z_CLIENT_CODE_VERSION="${VERSION:-unknown}"
    Z_CLIENT_CODE_PATCHLEVEL="${PATCHLEVEL:-0}"
  }

  function getZ_MISSING() {
    local NEEDED="spacewalk-check spacewalk-client-setup spacewalk-client-tools zypp-plugin-spacewalk"
    if [ "$Z_CLIENT_CODE_BASE" == "sle" -a "$Z_CLIENT_CODE_VERSION" == "10" ]; then
      which 'xsltproc' || NEEDED="$NEEDED libxslt"
    fi
    Z_MISSING=""
    for P in $NEEDED; do
      rpm -q "$P" || Z_MISSING="$Z_MISSING $P"
    done
  }

  function getZ_ZMD_TODEL() {
    local ZMD_STACK="zmd rug libzypp-zmd-backend yast2-registration zen-updater zmd-inventory suseRegister-jeos"
    if rpm -q suseRegister --qf '%{VERSION}' | grep -q '^\(0\.\|1\.[0-3]\)\(\..*\)\?$'; then
      # we need the new suseRegister >= 1.4, so wipe an old one too
      ZMD_STACK="$ZMD_STACK suseRegister suseRegisterInfo spacewalk-client-tools"
    fi
    Z_ZMD_TODEL=""
    for P in $ZMD_STACK; do
      rpm -q "$P" &amp;&amp; Z_ZMD_TODEL="$Z_ZMD_TODEL $P"
    done
  }

  echo "* check for necessary packages being installed..."
  getZ_CLIENT_CODE_BASE
  echo "* client codebase is ${Z_CLIENT_CODE_BASE}-${Z_CLIENT_CODE_VERSION}-sp${Z_CLIENT_CODE_PATCHLEVEL}"

  getZ_MISSING
  if [ -z "$Z_MISSING" ]; then
    echo "  no packages missing."
  else
    echo "* going to install missing packages..."
    Z_CLIENT_REPOS_ROOT="${Z_CLIENT_REPOS_ROOT:-https://${HOSTNAME}/pub/repositories}"
    Z_CLIENT_REPO_URL="${Z_CLIENT_REPOS_ROOT}/${Z_CLIENT_CODE_BASE}/${Z_CLIENT_CODE_VERSION}/${Z_CLIENT_CODE_PATCHLEVEL}/bootstrap"
    test "${Z_CLIENT_CODE_BASE}/${Z_CLIENT_CODE_VERSION}/${Z_CLIENT_CODE_PATCHLEVEL}" = "sle/11/1" &amp;&amp; {
      Z_CLIENT_REPO_URL="${Z_CLIENT_REPOS_ROOT}/susemanager-client-setup"
    }
    Z_CLIENT_REPO_NAME="susemanager-client-setup"
    Z_CLIENT_REPO_FILE="/etc/zypp/repos.d/$Z_CLIENT_REPO_NAME.repo"

    $FETCH $Z_CLIENT_REPO_URL/repodata/repomd.xml
    if [ ! -f "repomd.xml" ] ; then
        echo "Bootstrap repo '$Z_CLIENT_REPO_URL' does not exist."
        Z_CLIENT_REPO_URL=""
    fi
    rm -f repomd.xml
    if [ "$Z_CLIENT_CODE_BASE" == "sle" ]; then
      if [ "$Z_CLIENT_CODE_VERSION" = "10" ]; then
          echo "* check whether to remove the ZMD stack first..."
          getZ_ZMD_TODEL
          if [ -z "$Z_ZMD_TODEL" ]; then
            echo "  ZMD stack is not installed. No need to remove it."
          else
            echo "  Disable and remove the ZMD stack..."
            if [ -x /usr/sbin/rczmd ]; then
              /usr/sbin/rczmd stop
            fi
            rpm -e --nodeps $Z_ZMD_TODEL || {
              echo "ERROR: Failed remove the ZMD stack."
              exit 1
            }
          fi
      fi
    fi

    if rpm -q zypper --qf '%{VERSION}' | grep -q '^0\(\..*\)\?$'; then

      if [ -n "$Z_CLIENT_REPO_URL" ]; then
        echo "  adding client software repository at $Z_CLIENT_REPO_URL"
        zypper --non-interactive --no-gpg-checks sd $Z_CLIENT_REPO_NAME
        zypper --non-interactive --no-gpg-checks sa $Z_CLIENT_REPO_URL $Z_CLIENT_REPO_NAME
        zypper --non-interactive --no-gpg-checks refresh "$Z_CLIENT_REPO_NAME"
      fi
      zypper --non-interactive --no-gpg-checks in $Z_MISSING
      for P in $Z_MISSING; do
          rpm -q "$P" || {
            echo "ERROR: Failed to install all missing packages."
            exit 1
          }
      done
      if [ -n "$Z_CLIENT_REPO_URL" ]; then
        cat &lt;&lt;EOF >"$Z_CLIENT_REPO_FILE"
[$Z_CLIENT_REPO_NAME]
name=$Z_CLIENT_REPO_NAME
baseurl=$Z_CLIENT_REPO_URL
enabled=1
autorefresh=1
keeppackages=0
gpgcheck=0
EOF
      fi
    else

      if [ -n "$Z_CLIENT_REPO_URL" ]; then
        echo "  adding client software repository at $Z_CLIENT_REPO_URL"
        cat &lt;&lt;EOF >"$Z_CLIENT_REPO_FILE"
[$Z_CLIENT_REPO_NAME]
name=$Z_CLIENT_REPO_NAME
baseurl=$Z_CLIENT_REPO_URL
enabled=1
autorefresh=1
keeppackages=0
gpgcheck=0
EOF
        zypper --non-interactive --gpg-auto-import-keys refresh "$Z_CLIENT_REPO_NAME"
      fi
      zypper --non-interactive in $Z_MISSING || {
            echo "ERROR: Failed to install all missing packages."
            exit 1
          }

    fi
  zypper rr "$Z_CLIENT_REPO_NAME"
  fi
  if [ "$Z_CLIENT_CODE_BASE" == "sle" ]; then
    if [ "$Z_CLIENT_CODE_VERSION" = "10" ]; then
      test -e "/usr/share/zypp/migrate/10-11.migrate.products.sh" &amp;&amp; {
          echo "* check whether we have to to migrate metadata..."
          sh /usr/share/zypp/migrate/10-11.migrate.products.sh || {
            echo "ERROR: Failed to migrate product metadata."
            exit 1
          }
      }
    fi
  fi
fi

echo "* running the update scripts"
if [ -f "/etc/sysconfig/rhn/rhn_register" ] ; then
    echo "  . rhn_register config file"
    /usr/bin/python -u client_config_update.py /etc/sysconfig/rhn/rhn_register ${CLIENT_OVERRIDES}
fi
if [ -f "/etc/sysconfig/rhn/up2date" ] ; then
  echo "  . up2date config file"
  /usr/bin/python -u client_config_update.py /etc/sysconfig/rhn/up2date ${CLIENT_OVERRIDES}
fi

echo
echo "REGISTRATION"
echo "------------"
if [ -z "$ACTIVATION_KEYS" ] ; then
    echo "*** ERROR: in order to bootstrap SUSE Manager Server clients, an activation key or keys"
    echo "           must be created in the SUSE Manager Server web user interface, and the"
    echo "           corresponding key or keys string (XKEY,YKEY,...) must be mapped to"
    echo "           the ACTIVATION_KEYS variable of this script."
    exit 1
fi

if [ $REGISTER_THIS_BOX -eq 1 ] ; then
    echo "* registering"
    files=""
    directories=""
    if [ $ALLOW_CONFIG_ACTIONS -eq 1 ] ; then
        for i in "/etc/sysconfig/rhn/allowed-actions /etc/sysconfig/rhn/allowed-actions/configfiles"; do
            [ -d "$i" ] || (mkdir -p $i &amp;&amp; directories="$i $directories")
        done
        [ -f /etc/sysconfig/rhn/allowed-actions/configfiles/all ] || files="$files /etc/sysconfig/rhn/allowed-actions/configfiles/all"
        [ -n "$files" ] &amp;&amp; touch  $files
    fi
    if [ -z "$PROFILENAME" ] ; then
        profilename_opt=""
    else
        profilename_opt="--profilename=$PROFILENAME"
    fi
    /usr/sbin/rhnreg_ks --force --activationkey "$ACTIVATION_KEYS" $profilename_opt
    RET="$?"
    [ -n "$files" ] &amp;&amp; rm -f $files
    [ -n "$directories" ] &amp;&amp; rmdir $directories
    if [ $RET -eq 0 ]; then
      echo
      echo "*** this system should now be registered, please verify ***"
      echo
    else
      echo
      echo "*** Error: Registering the system failed."
      echo
      exit 1
    fi
else
    echo "* explicitly not registering"
fi

if [ $ALLOW_CONFIG_ACTIONS -eq 1 ] ; then
    echo
    echo "* setting permissions to allow configuration management"
    echo "  NOTE: use an activation key to subscribe to the tools"
    if [ "$INSTALLER" == zypper ] ; then
        echo "        channel and zypper install/update rhncfg-actions"
    elif [ "$INSTALLER" == yum ] ; then
        echo "        channel and yum upgrade rhncfg-actions"
    else
        echo "        channel and up2date rhncfg-actions"
    fi
    if [ -x "/usr/bin/rhn-actions-control" ] ; then
        rhn-actions-control --enable-all
        rhn-actions-control --disable-run
    else
        echo "Error setting permissions for configuration management."
        echo "    Please ensure that the activation key subscribes the"
        if [ "$INSTALLER" == zypper ] ; then
            echo "    system to the tools channel and zypper install/update rhncfg-actions."
        elif [ "$INSTALLER" == yum ] ; then
            echo "    system to the tools channel and yum updates rhncfg-actions."
        else
            echo "    system to the tools channel and up2dates rhncfg-actions."
        fi
        exit
    fi
fi

if [ $ALLOW_REMOTE_COMMANDS -eq 1 ] ; then
    echo
    echo "* setting permissions to allow remote commands"
    echo "  NOTE: use an activation key to subscribe to the tools"
    if [ "$INSTALLER" == zypper ] ; then
        echo "        channel and zypper update rhncfg-actions"
    elif [ "$INSTALLER" == yum ] ; then
        echo "        channel and yum upgrade rhncfg-actions"
    else
        echo "        channel and up2date rhncfg-actions"
    fi
    if [ -x "/usr/bin/rhn-actions-control" ] ; then
        rhn-actions-control --enable-run
    else
        echo "Error setting permissions for remote commands."
        echo "    Please ensure that the activation key subscribes the"
        if [ "$INSTALLER" == zypper ] ; then
            echo "    system to the tools channel and zypper updates rhncfg-actions."
        elif [ "$INSTALLER" == yum ] ; then
            echo "    system to the tools channel and yum updates rhncfg-actions."
        else
            echo "    system to the tools channel and up2dates rhncfg-actions."
        fi
        exit
    fi
fi

echo
echo "OTHER ACTIONS"
echo "------------------------------------------------------"
if [ $DISABLE_YAST_AUTOMATIC_ONLINE_UPDATE -eq 1 ]; then
    YAOU_SYSCFGFILE="/etc/sysconfig/automatic_online_update"
    if [ -f "$YAOU_SYSCFGFILE" ]; then
      echo "* Disable YAST automatic online update."
      sed -i 's/^ *AOU_ENABLE_CRONJOB.*/AOU_ENABLE_CRONJOB="false"/' "$YAOU_SYSCFGFILE"
      for D in /etc/cron.*; do
          test -L $D/opensuse.org-online_update &amp;&amp; rm $D/opensuse.org-online_update
      done
    fi
fi
if [ "$INSTALLER" == zypper ] ; then
  test -d /var/lib/suseRegister &amp;&amp; touch /var/lib/suseRegister/neverRegisterOnBoot
fi
if [ $DISABLE_LOCAL_REPOS -eq 1 ]; then
    if [ "$INSTALLER" == zypper ] ; then
          echo "* Disable all repos not provided by SUSE Manager Server."
          zypper ms -d --all
          zypper ms -e --medium-type plugin
          zypper mr -d --all
          zypper mr -e --medium-type plugin
          zypper mr -e "$Z_CLIENT_REPO_NAME"
    elif [ "$INSTALLER" == yum ] ; then
        echo "* Disable all repos not provided by SUSE Manager Server.";
          for F in /etc/yum.repos.d/*.repo; do
            test -f "$F" || continue
            awk '
              BEGIN           { saw=0 }
              /^ *[[]/        { if ( saw==1 ) print "enabled=0"; else saw=1 }
              /^ *enabled *=/ { print "enabled=0"; saw=2; next }
                                  { print }
              END             { if ( saw==1 ) print "enabled=0" }
            ' "$F" > "$F.bootstrap.tmp" &amp;&amp; mv "$F.bootstrap.tmp" "$F"
            test -f  "$F.bootstrap.tmp" &amp;&amp; {
              echo "*** Error: Failed to process '$F'; check manually if all repos inside are disabled."
              rm "$F.bootstrap.tmp"
            }
          done
    fi
fi
if [ $FULLY_UPDATE_THIS_BOX -eq 1 ] ; then
    if [ "$INSTALLER" == zypper ] ; then
        echo "zypper --non-interactive up zypper zypp-plugin-spacewalk; rhn-profile-sync; zypper --non-interactive up (conditional)"
    elif [ "$INSTALLER" == yum ] ; then
        echo "yum -y upgrade yum yum-rhn-plugin; rhn-profile-sync; yum upgrade (conditional)"
    else
        echo "up2date up2date; up2date -p; up2date -uf (conditional)"
    fi
else
    if [ "$INSTALLER" == zypper ] ; then
        echo "zypper --non-interactive up zypper zypp-plugin-spacewalk; rhn-profile-sync"
    elif [ "$INSTALLER" == yum ] ; then
        echo "yum -y upgrade yum yum-rhn-plugin; rhn-profile-sync"
    else
        echo "up2date up2date; up2date -p"
    fi
fi
echo "but any post configuration action can be added here.  "
echo "------------------------------------------------------"
if [ $FULLY_UPDATE_THIS_BOX -eq 1 ] ; then
    echo "* completely updating the box"
else
    echo "* ensuring $INSTALLER itself is updated"
fi
if [ "$INSTALLER" == zypper ] ; then
    zypper lr -u
    zypper --non-interactive ref -s
    zypper --non-interactive up zypper zypp-plugin-spacewalk
    if [ -x /usr/sbin/rhn-profile-sync ] ; then
        /usr/sbin/rhn-profile-sync
    else
        echo "Error updating system info in SUSE Manager Server."
        echo "    Please ensure that rhn-profile-sync in installed and rerun it."
    fi
    if [ $FULLY_UPDATE_THIS_BOX -eq 1 ] ; then
        zypper --non-interactive up
    fi
elif [ "$INSTALLER" == yum ] ; then
    yum repolist
    /usr/bin/yum -y upgrade yum yum-rhn-plugin
    if [ -x /usr/sbin/rhn-profile-sync ] ; then
        /usr/sbin/rhn-profile-sync
    else
        echo "Error updating system info in SUSE Manager Server."
        echo "    Please ensure that rhn-profile-sync in installed and rerun it."
    fi
    if [ $FULLY_UPDATE_THIS_BOX -eq 1 ] ; then
        /usr/bin/yum -y upgrade
    fi
else
    /usr/sbin/up2date up2date
    /usr/sbin/up2date -p
    if [ $FULLY_UPDATE_THIS_BOX -eq 1 ] ; then
        /usr/sbin/up2date -uf
    fi
fi
echo "-bootstrap complete"
</screen>

  </sect1>

  <sect1 xml:id="sec-bootstrap-protocol-support">
    <title>Configure the DHCP Server with Bootstrap Protocol Support</title>

    <para>Open an <emphasis>SSH</emphasis> session to the SUSE Manager server with <emphasis>X11
        Forwarding</emphasis> enabled (on Microsoft Windows, use <link
        xlink:href="https://www.putty.org/">
        <emphasis>PuTTY</emphasis>
      </link> and <link xlink:href="https://sourceforge.net/projects/xming/">
        <emphasis>Xming</emphasis>
      </link>):</para>

    <figure>
      <title>SUSE Manager Web UI - Administrator Settings</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-adminsettings.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-adminsettings.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Click the icon for the DHCP server:</para>

    <figure>
      <title>SUSE Manager Web UI - Icon DHCP Server</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-button-dhcpserver.png" width="10%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-button-dhcpserver.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>A window appears listing the packages that need to be installed:</para>

    <figure>
      <title>SUSE Manager Web UI - Packages to Install</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-dhcp.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-dhcp.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Install the required packages.</para>

    <para>Select the interface(s) for the DHCP service and click <emphasis role="strong"
        >Next</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - DHCP Server Wizard: Card Selection</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-dhcpcardselection.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-dhcpcardselection.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Provide the global settings and click <emphasis role="strong">Next</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - DHCP Server Wizard: Global Settings</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-dhcpglobalsettings.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-dhcpglobalsettings.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Provide the information for Dynamic DHCP and click <emphasis role="strong"
      >Next</emphasis>: </para>

    <figure>
      <title>SUSE Manager Web UI - DHCP Server Wizard: Dynamic DHCP</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-dynamicdhcp.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-dynamicdhcp.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Now select when and how to start the service:</para>

    <figure>
      <title>SUSE Manager Web UI - Start Service</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-servicestart.png" width="30%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-servicestart.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Finish the basic configuration. Continue by customizing the DHCP configuration file
      manually for <emphasis>bootp</emphasis> netboots.</para>

    <para>The example below shows how static netboot and DHCP can be configured:</para>

    <screen># vi /etc/dhcpd.conf
option domain-name "<emphasis role="strong">[Domain name]</emphasis>";
option domain-name-servers <emphasis role="strong">[DNS IP]</emphasis>;
option routers <emphasis role="strong">[Gateway ip]</emphasis>;
default-lease-time 60;
ddns-update-style none;
host <emphasis role="strong">[netboot client hostname]</emphasis> {
  hardware ethernet <emphasis role="strong">[MAC address lower case]</emphasis>;
  fixed-address <emphasis role="strong">[client ip]</emphasis>;
  next-server <emphasis role="strong">[suse manager ip]</emphasis>;
  allow bootp;
  server-name "<emphasis role="strong">[susemanager FQDN]</emphasis>";
  filename "boot/grub2/powerpc-ieee1275/core.elf";
}
subnet <emphasis role="strong">[Network]</emphasis> netmask <emphasis role="strong">[Subnet]</emphasis> {
  range dynamic-bootp <emphasis role="strong">[range lowest ip]</emphasis> <emphasis role="strong">[range highest ip]</emphasis>;
  default-lease-time 5;
  max-lease-time 3600;
  filename "boot/grub2/powerpc-ieee1275/core.elf";
  next-server <emphasis role="strong">[suse manager server]</emphasis>;
  }</screen>

    <para>Restart the DHCP daemon with the following command:</para>

    <screen># systemctl restart dhcpd.service</screen>

    <para>Add additional host entries for each new LPAR you want to be able to netboot.</para>

    <important>
      <title>IBM Power Systems Firmware </title>
      <para>When performing a <emphasis>bootp</emphasis> boot through the IBM Power Systems
        firmware, a static IP address is used to load the initial boot image. Because of the nature
        of the SUSE installation tool YaST, the network configuration in the first phase of the SUSE
        installer will use DHCP to acquire an IP.</para>
    </important>

  </sect1>

  <sect1 xml:id="sec-autoinstall-config">
    <title>Autoinstall Configuration</title>

    <para>To enable Autoinstallation, you first need to create a subdirectory where you copy the
      contents of the SUSE product installation DVDs:</para>

    <screen># mkdir -p /srv/www/htdocs/install/SLES12SP2SAP_PPC64LE
# mount /dev/sr0 /mnt
# cd /mnt
# cp -r * /srv/www/htdocs/install/SLES12SP2SAP_PPC64LE
…</screen>

    <para>Now navigate to <emphasis role="bold">Systems</emphasis> on the left pane. Select
        <emphasis role="bold">Autoinstallation</emphasis> and then <emphasis role="bold"
        >Distributions</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Autoinstallation</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-distributions.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-distributions.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Add a new distribution:</para>

    <figure>
      <title>SUSE Manager Web UI - Create Distribution</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-autoinstall-distribution.png" width="100%"
            format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-autoinstall-distribution.png" width="80%" format="PNG"
          />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Provide the following custom kernel options:</para>

    <screen>lang=en_US repo=http://[SUMA IP]/ks/dist/dev-sle12-sp2-sap-pool-ppc64le
install=http://[SUMA IP]/ks/dist/dev-sle12-sp2-sap-pool-ppc64le self_update=0
pt.options=+self_update</screen>

    <para>The <quote>Tree path</quote> is the local path where the SUSE install DVD content resides.
      The URLs should contain the name of the correct base channel.</para>

    <para>Navigate to <emphasis role="strong">Autoinstallation Snippets</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Autoinstallation Snippets</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-autoinstallsnippets.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-autoinstallsnippets.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para><quote>Autoinstallation Snippets</quote> is used to add the bootstrap process to the
      autoinstallation post-install process. Click <emphasis role="strong">Create
      Snippet</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Create Snippet</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-createsnippet.png" width="30%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-createsnippet.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Fill in the required information as shown on the screen below:</para>

    <figure>
      <title>SUSE Manager Web UI - Kickstart Snippet</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-kickstartsnippet.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-kickstartsnippet.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>In the <emphasis role="strong">Contents</emphasis> field, enter the following:</para>

    <screen>#raw
curl -Sks https://[SUMA FQDN]/pub/bootstrap/bootstrap-dev-sle12sp2-sap.sh |  /bin/bash

zypper ref -y;zypper -n patch -l -y;zypper -n patch -l -y;zypper -n up -l -y
#end raw
</screen>

    <para>This script will automatically execute the bootstrap script and directly perform all patch
      updates.</para>

    <para>You also created a <emphasis>Production</emphasis> snippet
        <quote>bootstrap-prod-sles12-sp2</quote> which points to the production bootstrap script.
      This is the custom bootstrap script you created earlier.</para>

    <para>Navigate to <emphasis role="strong">System</emphasis> on the left pane. Select <emphasis
        role="strong">Autoinstallation</emphasis> and then <emphasis role="strong">Profiles:</emphasis></para>

    <figure>
      <title>SUSE Manager Web UI - Profiles</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-profiles.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-profiles.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Now you can create an autoinstallation profile. Click <emphasis role="strong">Upload
        Kickstart/Autoyast File</emphasis>:</para>

    <figure>
      <title>SUSE Manager Web UI - Button Upload Kickstart/Autoyast File</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-uploadkickstart.png" width="30%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-uploadkickstart.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>The screen below opens. Provide the required details and an AutoYaST script:</para>

    <figure>
      <title>SUSE Manager Web UI - Create Autoinstallation Profile</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-autoinstall-profile.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-autoinstall-profile.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>To create a baseline AutoYaST profile, perform a reference manual install on an LPAR.
      Configure the Linux installation to the point where you are satisfied and where it can serve
      as a base setup for new LPARs. Then generate the <filename>autoyast.xml</filename> file using
      the command <command>yast2 clone_system</command>.</para>

    <para>This AutoYaST file can be used as is. However, for the document at hand, choose to add
      variables to it to easily customize an installation from the SUSE Manager GUI. Also, add the
      post install snippet.</para>

    <para>Below find <quote>copy and paste</quote> segments of the example profile. These segments
      indicate where changes need to be or can be applied. Parameterization must be customized in
      synchronization with the needs of the environment.</para>

    <screen>&lt;?xml version="1.0"?>
&lt;!DOCTYPE profile>
&lt;profile xmlns="http://www.suse.com/1.0/yast2ns" xmlns:config="http://www.suse.com/1.0/configns">
&lt;scripts>
&lt;init-scripts config:type="list">
      &lt;script>
        &lt;filename>postinstall.sh&lt;/filename>
        &lt;interpreter>shell&lt;/interpreter>
        &lt;debug config:type="boolean">false&lt;/debug>
        &lt;feedback config:type="boolean">true&lt;/feedback>
        &lt;source>&lt;![CDATA[
#!/bin/sh
$SNIPPET('spacewalk/1/bootstrap-dev-sles12-sp2')]]&gt;
        &lt;/source>
      &lt;/script>
&lt;/init-scripts>
&lt;/scripts>
…...
</screen>

    <para>To enforce a specific <emphasis>LUN</emphasis> to be formatted and used for the operating
      systems file systems, use a variable <varname>$lunserial</varname> that contains the actual
      serial number of the LUN as indicated on the storage controller interface.</para>

    <screen>
……...
  &lt;bootloader>
    &lt;global>
      &lt;activate>true&lt;/activate>
      &lt;append>splash=silent quiet showopts&lt;/append>
      &lt;boot_boot>false&lt;/boot_boot>
      &lt;boot_custom>/dev/disk/by-id/scsi-3<emphasis role="strong">$lunserial-part1</emphasis>&lt;/boot_custom>
      &lt;boot_extended>false&lt;/boot_extended>
…...
</screen>

    <para>Network settings are also replaced with variables:</para>

    <screen>
…...

  &lt;dns>
    &lt;dhcp_hostname config:type="boolean">true&lt;/dhcp_hostname>
    &lt;domain>mrbc-mbhg.intra.net&lt;/domain>
  <emphasis role="strong">&lt;hostname>$hostname&lt;/hostname></emphasis>
    &lt;nameservers config:type="list">
      <emphasis role="strong">&lt;nameserver>$dns1&lt;/nameserver></emphasis>
  <emphasis role="strong">&lt;nameserver>$dns2&lt;/nameserver></emphasis>
  <emphasis role="strong">&lt;nameserver>$dns3&lt;/nameserver></emphasis>
    &lt;/nameservers>
    &lt;resolv_conf_policy>auto&lt;/resolv_conf_policy>
    &lt;searchlist config:type="list">
      &lt;search>iriscorporate.com&lt;/search>
    &lt;/searchlist>
    &lt;write_hostname config:type="boolean">false&lt;/write_hostname>
  &lt;/dns>
  &lt;interfaces config:type="list">
    &lt;interface>
      &lt;bootproto>static&lt;/bootproto>
      &lt;device>eth1&lt;/device>
      &lt;ipaddr><emphasis role="strong">$ipaddr1</emphasis>&lt;/ipaddr>
      &lt;name>Virtual Ethernet card 1&lt;/name>
      &lt;netmask><emphasis role="strong">$subnet1</emphasis>&lt;/netmask>
      &lt;startmode>auto&lt;/startmode>
      &lt;usercontrol>no&lt;/usercontrol>
    &lt;/interface>
…...

    &lt;net-udev config:type="list">
      &lt;rule>
        &lt;name>eth1&lt;/name>
        &lt;rule>ATTR{address}&lt;/rule>
        &lt;value><emphasis role="strong">$mac1</emphasis>&lt;/value>
      &lt;/rule>
    &lt;/net-udev>
    &lt;routing>
      &lt;ipv4_forward config:type="boolean">false&lt;/ipv4_forward>
      &lt;ipv6_forward config:type="boolean">false&lt;/ipv6_forward>
      &lt;routes config:type="list">
        &lt;route>
          &lt;destination>default&lt;/destination>
          &lt;device>-&lt;/device>
          &lt;gateway><emphasis role="strong">$gateway</emphasis>&lt;/gateway>
          &lt;netmask>-&lt;/netmask>
        &lt;/route>
      &lt;/routes>
    &lt;/routing>
    &lt;/networking>
……
</screen>

    <para>Replace the NTP server addresses by variables:</para>

    <screen>
…...

      &lt;peer>
      &lt;address><emphasis>$ntp1</emphasis>&lt;/address>
        &lt;comment/>
        &lt;options> iburst&lt;/options>
        &lt;type>server&lt;/type>
      &lt;/peer>
      &lt;peer>
      &lt;address><emphasis>$ntp2</emphasis>&lt;/address>
        &lt;comment/>
        &lt;options> iburst&lt;/options>
        &lt;type>server&lt;/type>
      &lt;/peer>
     &lt;/peers>
…...
</screen>

    <para>Partitioning is done as follows:</para>

    <screen>
…...
&lt;partitioning config:type="list">
    &lt;drive>
    &lt;device>/dev/mapper/3<emphasis role="strong">$lunserial</emphasis>&lt;/device>
      &lt;disklabel>msdos&lt;/disklabel>
      &lt;enable_snapshots config:type="boolean">true&lt;/enable_snapshots>

…...

…...
&lt;/profile>
</screen>

    <para>You used variables to make ad-hoc customization of the AutoYaST profile easy through the
      SUSE Manager Web interface. As an overview, the following lines are affected in the above
      profile:</para>

    <screen>
&lt;boot_custom>/dev/disk/by-id/scsi-3$lunserial-part1&lt;/boot_custom>
&lt;hostname>$hostname&lt;/hostname>
&lt;nameserver>$dns1&lt;/nameserver>
&lt;nameserver>$dns2&lt;/nameserver>
&lt;nameserver>$dns3&lt;/nameserver>
&lt;ipaddr>$ipaddr1&lt;/ipaddr>
&lt;netmask>$subnet1&lt;/netmask>
&lt;value>$mac1&lt;/value>
&lt;gateway>$gateway&lt;/gateway>
&lt;address>$ntp1&lt;/address>
&lt;address>$ntp2&lt;/address>
&lt;device>/dev/mapper/3$lunserial&lt;/device>
</screen>

    <para>Now go to the <emphasis role="strong">Variables</emphasis> tab and provide the correct
      values:</para>

    <figure>
      <title>SUSE Manager Web UI - Variables</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-button-variables.png" width="20%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-button-variables.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <simplelist>
      <member>mac1=[MAC address in lowercase with : separators]</member>
      <member>hostname=[Hostname]</member>
      <member>ipaddr1=[IP address]</member>
      <member>subnet1=[Netmask]</member>
      <member>gateway=[GATEWAY]</member>
      <member>dns1=[DNS1]</member>
      <member>dns2=[DNS2]</member>
      <member>dns3=[DNS3]</member>
      <member>ntp1=[NTP1]</member>
      <member>ntp2=[NTP2]</member>
      <member>org=1</member>
      <member>lunserial=[Disk serial nr]</member>
    </simplelist>

    <para>In this particular example a Fibre Channel (FC) connected storage (IBM) is used which can
      be identified in <filename>/dev/disk/by-id</filename> and <filename>/dev/mapper</filename> by
      its LUN serial number.</para>

    <para>Verify that the syntax of the profile and variables is correct by checking the <emphasis
        role="strong">Autoinstallation File</emphasis> tab. It should show the final script where
      the variables and snippets have been replaced by their values. If this tab presents an error,
      you might have an issue in your syntax.</para>

  </sect1>

  <sect1 xml:id="sec-grub2-custom-config">
    <title>GRUB2 Custom Configuration for IBM PowerVM Netboot</title>

    <para>At this point you need to access a SUSE Linux Enterprise Server 12 ppc64le host with the
      same SP and kernel version as the one you want to deploy through autoinstallation. A good
      possibility is to use the reference installation host where you based the AutoYaST template
      on.</para>

    <para>Here you need to generate the GRUB2 netboot files. Connect via <emphasis>SSH</emphasis> to
      the host and type the following command:</para>

    <screen># grub2-mknetdir –net-directory=/srv/tftpboot</screen>

    <para>Copy the files to the <filename>/root</filename> home:</para>

    <screen># scp -r /srv/tftpboot/boot/grub2 root@[suse manager host]:/root/</screen>

    <para>On SUSE Manager, create a custom <filename>grub.cfg</filename> file to go with these
      netboot files :</para>

    <screen>
# vi /root/grub2/grub.cfg
with_gfx=0

gfxmode=auto
locale_dir=$prefix/locale
lang=en_US

set default='dev-sle12-sp2-sap-pool-ppc64le:1:IRIS'

insmod gettext

if sleep --interruptible 0 ; then
  timeout=30
fi

menuentry 'dev-sle12-sp2-sap-pool-ppc64le:1:IRIS' --class opensuse --class gnu-linux --class gnu --class os {
insmod http
insmod tftp
set root=tftp,[suma ip]
echo 'Loading kernel ...'
linux /images/dev-sle12-sp2-sap-pool-ppc64le_1_IRIS/linux ksdevice=bootif lang=en_US pt.options=+self_update repo=http://[suma ip]/ks/dist/dev-sle12-sp2-sap-pool-ppc64le install=http://[suma ip]/ks/dist/dev-sle12-sp2-sap-pool-ppc64le self_update=0 textmode=1 autoyast=http://[suma ip]/cblr/svc/op/ks/profile/dev-sle12-sp2-sap-pool-ppc64le:1:IRIS
echo 'Loading initial ramdisk ...'
initrd /images/dev-sle12-sp2-sap-pool-ppc64le_1_IRIS/initrd
}

menuentry 'local' {
  exit
}

submenu 'Other options...' {
 menuentry 'Reboot' {
 reboot
 }

 menuentry 'Exit to Open Firmware' {
 exit
 }
}
</screen>

    <para>You can base this configuration off the auto-generated
        <filename>/srv/tftpboot/grub/grub.cfg</filename>.</para>

    <para>Cobbler is a Linux installation server that allows for rapid setup of network installation
      environments (see <link xlink:href="http://cobbler.github.io/"
        >http://cobbler.github.io/</link>. It is used to generate the content of the
        <filename>/srv/tftpboot</filename> path. As it wipes the path every time a synchronization
      is triggered, you need to put in place the workaround below. This guarantees your custom GRUB
      files for IBM PowerVM are recopied in the <filename>tftpboot</filename> directory each time
      the configuration is resynchronized:</para>

    <screen>
# vi /var/lib/cobbler/triggers/sync/post/grub2.sh
#!/bin/sh
cp -r /root/grub2 /srv/tftpboot/boot/
</screen>

    <note>
      <title>Example Path</title>
      <para>In this example <filename>/root/grub2</filename> is only used as an example path to
        place your base versions of the GRUB configurations. You can choose a different
        location.</para>
    </note>

    <para>Next, enter the command:</para>

    <screen># chmod u+x /var/lib/cobbler/triggers/sync/post/grub2.sh</screen>

    <para>The Cobbler post-synchronization script now copies the GRUB2 files over to the TFTP boot
      directory with every synchronization. </para>

    <para>You can synchronize Cobbler with the command:</para>

    <screen># cobbler sync</screen>

    <para>Alternatively, you can use the SUSE Manager Web interface. Navigate to <emphasis
        role="strong">Manager Configuration</emphasis> and select <emphasis role="strong"
        >Cobbler</emphasis>: </para>

    <figure>
      <title>SUSE Manager Web UI - Cobbler</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-cobbler.png" width="40%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-cobbler.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Now run the Cobbler synchronization and click <emphasis role="strong">Update</emphasis>: </para>

    <figure>
      <title>SUSE Manager Web UI - Cobbler Synchronization</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-runcobblersync.png" width="60%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-runcobblersync.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Verify after a synchronization that the following files have been generated:</para>

    <itemizedlist>
      <listitem>
        <para>Subdirectory structure /srv/tftpboot/images with the Linux and initrd images is
          available</para>
      </listitem>
      <listitem>
        <para><filename>/srv/tftpboot/boot/grub2</filename> files have been copied over during
          synchronization</para>
      </listitem>
    </itemizedlist>

  </sect1>

  <sect1 xml:id="sec-netboot-autoinstall">
    <title>Netboot and Autoinstall Procedure</title>

    <para>First collect the following details:</para>

    <simplelist>
      <member>mac address=</member>
      <member>hostname=</member>
      <member>ipaddr1=</member>
      <member>subnet1=</member>
      <member>gateway=</member>
      <member>dns1=</member>
      <member>dns2=</member>
      <member>dns3=</member>
      <member>ntp1=</member>
      <member>ntp2=</member>
      <member>org=1</member>
      <member>lunserial=</member>
    </simplelist>

    <para>Via the SUSE Manager Web interface, customize the variables for the AutoYaST profile you
      created earlier using the collected values above. Go to <emphasis role="strong"
        >Systems</emphasis> on the left pane, select <emphasis role="strong">Autoinstallation</emphasis>, and
      then <emphasis role="strong">Profile</emphasis>. Choose <emphasis role="strong">specific
        profile</emphasis> and click the <emphasis role="strong">Variables</emphasis> tab. Here you
      can enter the variables.</para>

    <para>The LPAR details needed, which you can retrieve from the Hardware Management Console
      (HMC), are:</para>

    <simplelist>
      <member>LPAR id=</member>
      <member>LPAR name =</member>
      <member>LPAR profile =</member>
      <member>Power system name =</member>
    </simplelist>

    <para>Now you have all required details and you can launch the LPAR netboot via the HMC.</para>

    <para>Via <emphasis>SSH</emphasis> connection, log in to the correct HMC host. Use the following
      command to execute the LPAR netboot and immediately open the serial console:</para>

    <screen>> lpar_netboot -v -f -D -m <emphasis role="strong">[MAC]</emphasis> -i -t ent -T off -s auto -d auto -S <emphasis role="strong">[SUMA IP]</emphasis> -G <emphasis role="strong">[GATEWAY IP]</emphasis> -C <emphasis role="strong">[LPAR IP]</emphasis> -K <emphasis role="strong">[NETMASK]</emphasis> "<emphasis role="strong">[LPAR NAME]</emphasis>" "<emphasis role="strong">[LPAR PROFILE]</emphasis>" "<emphasis role="strong">[SYSTEM NAME]</emphasis>"; rmvterm -m <emphasis role="strong">[SYSTEM NAME]</emphasis> --id <emphasis role="strong">[LPAR ID]</emphasis> ; mkvterm -m <emphasis role="strong">[SYSTEM NAME]</emphasis> --id <emphasis role="strong">[LPAR ID]</emphasis></screen>

    <important>
      <title>Values</title>
      <para>Replace the above [...] fields in the command with the following values:</para>

      <simplelist>
        <member>[MAC] = bootp client mac address <emphasis role="strong">without ‘:’ separators and
            in uppercase</emphasis></member>
        <member>[SUMA IP] = SUSE Manager IP</member>
        <member>[GATEWAY IP] = default gateway ip</member>
        <member>[LPAR IP] = client lpar ip</member>
        <member>[NETMASK] = subnet mask</member>
        <member>[LPAR NAME] = lpar name as seen on the HMC</member>
        <member>[LPAR PROFILE] = default lpar profile configured on the HMC for this LPAR</member>
        <member>[SYSTEM NAME] = system name of the power server that hosts the lpar</member>
        <member>[LPAR ID] = the LPAR ID number (check the HMC)</member>
      </simplelist>
    </important>

    <para>If everything is correct, the GRUB menu should load:</para>

    <figure>
      <title>GRUB Menu</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-grub.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-grub.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>When the default <option>grub</option> option is loaded, the installation will start
      automatically and perform all the installation steps.</para>

    <figure>
      <title>Performing Installation</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-preparingautoinstall.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-preparingautoinstall.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>If the bootstrap section in the AutoYaST profile was successful, the new host should
      appear in the <quote>Physical Systems»</quote> list. Navigate to <emphasis role="strong"
        >Systems</emphasis> in the left pane, and select <emphasis role="strong">Physical
        Systems</emphasis>.</para>

    <figure>
      <title>SUSE Manager Web UI - Physical Systems</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-physicalsystems.png" width="50%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-physicalsystems.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>All physical systems are listed here:</para>

    <figure>
      <title>SUSE Manager Web UI - List of Physical Systems</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-ui-showphysicalsystems.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-ui-showphysicalsystems.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

    <para>Your installed host is now be available for use:</para>

    <figure>
      <title>SUSE Manager Web UI - Installed Host</title>
      <mediaobject>
        <imageobject role="fo">
          <imagedata fileref="suma-powervm-yast-raid.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
          <imagedata fileref="suma-powervm-yast-raid.png" width="80%" format="PNG"/>
        </imageobject>
      </mediaobject>
    </figure>

  </sect1>


  <sect1 xml:id="sec-conclusion">
    <title>Conclusion</title>

    <para>SUSE Manager was designed to manage Linux systems across a variety of hardware
      architectures, hypervisors and container and cloud platforms with a single tool. It helps your
      enterprise DevOps and IT Operations teams reduce complexity and regain control of your IT
      assets. It automates Linux server provisioning, patching and configuration for faster,
      consistent and repeatable server deployment. Thus you can optimize operations and reduce
      costs. With automated monitoring, tracking, auditing and reporting of your systems, VMs, and
      containers across your entire IT environment, you can ensure compliance with internal security
      policies and external regulations.</para>

    <para>SUSE Manager 3 is an ideal platform to centralize package repositories and configuration
      management on many platforms, including IBM Power. Through auto-deployment via AutoYaST and
      Netboot you can reduce hands-on time needed to perform deployments of new LPARs, reinstalls or
      even disaster-recovery scenarios without the need of an AIX based Network Install Manager.
      Also, the methodology displayed in this document allows you to netboot little-endian kernels
      through GRUB2 which is required to support SUSE Linux Enterprise Server 12 and up on IBM
      Power.</para>

    <para>When you run a production PowerVM environment with applications such as SAP HANA or other
      ERP or database systems, spread over several PowerVM LPARs (VMs) and physical IBM Power
      systems, SUSE Manager is tremendously useful to centrally manage Linux software levels and
      configurations to satisfy the changing requirements posed by the application vendors. </para>


  </sect1>

  <sect1 xml:id="sec-resources">
    <title>Resources</title>

    <para>For more information, refer to:</para>

    <itemizedlist>
      <listitem>
        <para>SUSE Corporate Web page: <link xlink:href="https://www.suse.com/"
            >https://www.suse.com/</link></para>
      </listitem>
      <listitem>
        <para>SUSE Manager documentation: <link
            xlink:href="https://documentation.suse.com/suma/3.2/"
            >https://documentation.suse.com/suma/3.2/</link></para>
      </listitem>
      <listitem>
        <para>IBM Knowledge Center: <link xlink:href="https://www.ibm.com/support/knowledgecenter/"
            >https://www.ibm.com/support/knowledgecenter/</link></para>
      </listitem>
      <listitem>
        <para>IBM Knowledge Center - Power Systems:</para>
        <itemizedlist>
          <listitem>
            <para>
              <link
                xlink:href="https://www.ibm.com/support/knowledgecenter/en/POWER8/p8hdx/POWER8welcome.htm"
                >https://www.ibm.com/support/knowledgecenter/en/POWER8/p8hdx/POWER8welcome.htm</link>
            </para>
          </listitem>
          <listitem>
            <para>
              <link
                xlink:href="https://www.ibm.com/support/knowledgecenter/en/POWER9/p9hdx/POWER9welcome.htm"
                >https://www.ibm.com/support/knowledgecenter/en/POWER9/p9hdx/POWER9welcome.htm</link>
            </para>
          </listitem>
        </itemizedlist>
      </listitem>
      <listitem>
        <para>IBM Knowledge Center - Linux on IBM Systems: <link
            xlink:href="https://www.ibm.com/support/knowledgecenter/en/linuxonibm/liaam/liaamoverview.htm"
            >https://www.ibm.com/support/knowledgecenter/en/linuxonibm/liaam/liaamoverview.htm</link></para>
      </listitem>
      <listitem>
        <para>Netbooting on POWER - An Introduction (IBM community article): <link
            xlink:href="https://www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/W51a7ffcf4dfd_4b40_9d82_446ebc23c550/page/Netbooting+on+POWER+-+An+Introduction"
            >https://www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/W51a7ffcf4dfd_4b40_9d82_446ebc23c550/page/Netbooting+on+POWER+-+An+Introduction</link></para>
      </listitem>
      <listitem>
        <para>Cobbler resources: <link xlink:href="http://cobbler.github.io/"
            >http://cobbler.github.io/</link></para>
      </listitem>
    </itemizedlist>

  </sect1>


  <?pdfpagebreak style="sbp" formatter="fop"?>
  <xi:include href="sbp-legal-notice.xml"/>

  <?pdfpagebreak style="sbp" formatter="fop"?>
  <xi:include href="license-gfdl.xml"/>

</article>
