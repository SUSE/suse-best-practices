<?xml version="1.0" encoding="utf-8"?>
<?asciidoc-toc?><?asciidoc-numbered?><article xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.0" xml:lang="en">
<info>
<title>アマゾン ウェブ サービス（AWS）におけるSAP HANAシステムレプリケーションスケールアウト高可用性</title>
<date>2020-05-13</date><!--<title>System Replication Scale-Out High Availability in Amazon Web Services</title>--><subtitle/><!-- <orgname>SUSE Best Practices</orgname>--><productname>SUSE Linux Enterprise Server for SAP Applications</productname>
    <productnumber>12 SP4以降</productnumber>
    <author>

        <personname>
            <firstname>Fabian</firstname>
            <surname>Herschel, Distinguished Architect SAP, SUSE</surname>
        </personname><!-- <personname>
            <firstname>Fabian</firstname>
            <surname>Herschel</surname>
            </personname>
            <affiliation>
            <jobtitle>Distinguished Architect SAP</jobtitle>
            <orgname>SUSE</orgname>
            </affiliation>--></author>
    <author>
        <personname>
            <firstname>Bernd</firstname>
            <surname>Schubert, SAP Solution Architect, SUSE</surname>
        </personname><!-- <personname>
            <firstname>Bernd</firstname>
            <surname>Schubert</surname>
            </personname>
            <affiliation>
            <jobtitle>SAP Solution Architect</jobtitle>
            <orgname>SUSE</orgname>
            </affiliation>--></author>

      <author>
        <personname>
            <firstname>Lars</firstname>
            <surname>Pinne, System Engineer, SUSE</surname>
        </personname><!-- <personname>
            <firstname><Lars</firstname>
            <surname>Pinne</surname>
            </personname>
            <affiliation>
            <jobtitle>System Engineer</jobtitle>
            <orgname>SUSE</orgname>
            </affiliation>--></author>


<author>
       <personname>
            <firstname>Guilherme</firstname>
            <surname>Felix, SAP Specialist, AWS</surname>
       </personname>
</author>

<author>
       <personname>
            <firstname>Sander</firstname>
            <surname>Bleijenbergh, SAP Specialist, AWS</surname>
       </personname>
</author>

<author>
       <personname>
            <firstname>Somckit</firstname>
            <surname>Khemmanivanh, SAP Specialist, AWS</surname>
       </personname>
</author><!-- <cover role="logos">
        <mediaobject>
            <imageobject>
                <imagedata fileref="suse.svg"/>
            </imageobject>
        </mediaobject>
        <mediaobject>
            <imageobject>
                <imagedata fileref="microsoft.svg"/>
            </imageobject>
        </mediaobject>
    </cover>--><date><?dbtimestamp format="B d, Y" ?></date>


    <abstract>

        <para>SUSE® Linux Enterprise Server for SAP Applicationsは、SAP *アプリケーション向けにさまざまな方法で最適化されています。このガイドは、アマゾン ウェブ サービス（AWS）クラウドにおける、自動化されたフェールオーバー機能を持つSAP HANAスケールアウトシステムレプリケーションに向けた、SUSE Linux Enterprise Server for SAP Applicationsのインストールとカスタマイズに関する詳細な情報を提供します。</para>

        <para>本ドキュメントはSUSE Linux Enterprise Server for SAP Applications 12 SP4に基づいています。ただしこの概念は新しいバージョンでも利用できます。</para>
    </abstract>

</info>
<section xml:id="_about_this_guide">
<title>このガイドについて</title>
<section xml:id="_introduction">
<title>はじめに</title>
<para>SUSE® Linux Enterprise Server for SAP Applicationsは、SAP *アプリケーション向けにさまざまな方法で最適化されています。このガイドは、アマゾン ウェブ サービス（AWS）クラウドにおける、自動化されたフェールオーバー機能を持つSAP HANAスケールアウトシステムレプリケーションに向けた、<emphasis>SUSE Linux Enterprise Server for SAP Applications</emphasis>のインストールとカスタマイズに関する詳細な情報を提供します。</para>
<para>高可用性はミッションクリティカルなSAP HANAサーバーの稼動における重要な側面です。</para>
<para>SAP HANAスケールアウトシステムレプリケーションは、1つのSAP HANAスケールアウトクラスター内のすべてのデータを、異なるAWSアベイラビリティゾーン内のセカンダリSAP HANAクラスターにレプリケーションします。SAP HANAは非同期および同期レプリケーションモードをサポートします。このガイドでは、プライマリシステムのメモリからセカンダリシステムのメモリへの同期レプリケーションについて説明します。これは、Pacemakerクラスターが、実装されたアルゴリズムに基づいて決定を行うことができる唯一の方法であるためです。</para>
<para>目標復旧時間（RTO）は、定期的なデータレプリケーションにより最小化されます。</para>
</section>
<section xml:id="_additional_documentation_and_resources">
<title>その他のドキュメントとリソース</title>
<para>このマニュアルの各章にLinuxマニュアルページまたはインターネットから入手可能なその他のドキュメントリソースへのリンクが掲載されています。</para>
<para>最新のドキュメントについては、<link xl:href="https://documentation.suse.com">https://documentation.suse.com</link>を参照してください。</para>
<para>SUSE Linux Enterprise Server for SAP Applicationsのリソースライブラリ:<link xl:href="https://www.suse.com/products/sles-for-sap/resource-library/">https://documentation.suse.com/sbp/all/</link>には、多数のホワイトペーパーやガイドなどもあります。</para>
</section>
<section xml:id="_feedback">
<title>フィードバック</title>
<para>次に示すフィードバックチャネルを利用できます。</para>
<variablelist>
<varlistentry>
<term>バグと拡張リクエスト</term>
<listitem>
<para>ご使用中の製品に関して利用可能なサービスとサポートについては、<link xl:href="http://www.suse.com/support/">http://www.suse.com/support/</link>をご参照ください。</para>
</listitem>
</varlistentry>
</variablelist>
<para>製品コンポーネントのバグを報告するには、<link xl:href="https://scc.suse.com/support/">https://scc.suse.com/support/</link>リクエストにアクセスしてログインし、 <emphasis>Submit New SR</emphasis> (Service Request)を選択します。</para>
<variablelist>
<varlistentry>
<term>メール</term>
<listitem>
<para>本製品のドキュメントへのフィードバックについては、<link xl:href="mailto:doc-team@suse.com">doc-team@suse.com</link>宛てにメールを送信してください。ドキュメントのタイトル、製品バージョン、およびドキュメントの発行日を必ず含めてください。エラーの報告または拡張の提案については、問題を簡潔に説明いただくとともに、各セクション番号とページ（またはURL）を示してください。</para>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
<section xml:id="_scope_of_this_documentation">
<title>本ドキュメントのスコープ</title>
<para>本ドキュメントでは、SUSE Linux Enterprise Server for SAP Applications 12 SP4またはSUSE Linux Enterprise Server for SAP Applications 15をベースとして、分離されたAWSアベイラビリティゾーンにインストールされたSAP HANAスケールアウトシステムレプリケーションクラスターの設定方法について説明します。</para>
<para>よりわかりやすい概要を提供するために、インストールと設定を7つのステップに分けます。</para>
<figure>
<title><xref linkend="Planning"/> <xref linkend="OsSetup"/> <xref linkend="SAPHanaInst"/> <xref linkend="SAPHanaHsr"/> <xref linkend="Integration"/> <xref linkend="Cluster"/> <xref linkend="Testing"/></title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase0.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase0</phrase></textobject>
</mediaobject>
</figure>
<itemizedlist>
<listitem>
<para>計画 (セクション <xref linkend="Planning"/>)</para>
</listitem>
<listitem>
<para>オペレーティングシステム (OS) の設定(セクション<xref linkend="OsSetup"/>)</para>
</listitem>
<listitem>
<para>SAP HANAのインストール (セクション<xref linkend="SAPHanaInst"/>)</para>
</listitem>
<listitem>
<para>SAP HANAシステムレプリケーションの構成 (セクション<xref linkend="SAPHanaHsr"/>)</para>
</listitem>
<listitem>
<para>SAP HANAクラスターの統合(セクション<xref linkend="Integration"/>)</para>
</listitem>
<listitem>
<para>SLES for SAPクラスターの構成 (セクション<xref linkend="Cluster"/>)</para>
</listitem>
<listitem>
<para>テスト(セクション<xref linkend="Testing"/>)</para>
</listitem>
</itemizedlist>
<para>設定プロセスを実行した結果、システムレプリケーション構成でSAP HANAスケールアウトノードの2つのグループを制御するSUSE Linux Enterprise Server for SAP Applicationsクラスターが構築されます。フェールオーバーがわずか数分で完了することから、このアーキテクチャは「パフォーマンス最適化シナリオ」と名付けられました。</para>
<figure>
<title>SAP HANA SRを使用したクラスター - パフォーマンス最適化</title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Cluster.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Cluster</phrase></textobject>
</mediaobject>
</figure>
</section>
<section xml:id="Planning">
<title>計画とインストール</title>
<para>インストール計画は、SAP HANAクラスターの設定を成功させるために不可欠です。</para>
<figure>
<title>計画 <xref linkend="OsSetup"/> <xref linkend="SAPHanaInst"/> <xref linkend="SAPHanaHsr"/> <xref linkend="Integration"/> <xref linkend="Cluster"/> <xref linkend="Testing"/></title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase1.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase1</phrase></textobject>
</mediaobject>
</figure>
<para>作業開始前に以下を準備する必要があります。</para>
<itemizedlist>
<listitem>
<para><emphasis>「SUSE Linux Enterprise Server for SAP Applications 12 SP4」</emphasis>または<emphasis>「SUSE Linux Enterprise Server for SAP Applications 15」</emphasis>以降を使用して、Amazonマシンイメージ（AMI）から作成されたEC2インスタンス。Bring Your Own Subscription（BYOS）AMIを使用する場合、有効なSUSE製品サブスクリプションが必要です。</para>
</listitem>
<listitem>
<para>SAP HANAインストールメディア</para>
</listitem>
<listitem>
<para>2つのAmazon Elastic File System（EFS） - 各アベイラビリティゾーンにつき1つずつ</para>
</listitem>
<listitem>
<para>入力済みのパラメータシート（下記参照）</para>
</listitem>
</itemizedlist>
<section xml:id="_environment_requirements">
<title>環境要件</title>
<para>このセクションでは、SAP HANAスケールアウトをインストールし、AWSにクラスターを作成するための最低要件を定義します。</para>
<note>
<para>ここで述べる最低要件にSAPサイジング情報は含まれません。サイジング情報については、公式のSAPサイジングツールおよびサービスをご利用ください。</para>
</note>
<note>
<para>AWSにSAP HANAスケールアウトクラスタをデプロイするには、AWSクイックスタートに従い、「単一のアベイラビリティゾーン（AZ）マルチノードアーキテクチャ」デプロイオプションを使用するのが推奨方法です。SAP HANAスケールアウトを手動でインストールする場合は、推奨のストレージ構成およびファイルシステムを含む詳細なインストール手順について、<link xl:href="https://docs.aws.amazon.com/sap/latest/sap-hana/welcome.html">AWS SAP HANAガイド</link>ドキュメントをご参照ください。</para>
</note>
<figure>
<title>2つのアベイラビリティゾーンにまたがるSAP HANAスケールアウトシステムレプリケーション向けに簡素化されたクラスターアーキテクチャ</title>
<mediaobject>
<imageobject>
<imagedata fileref="ScaleOutCluster-AWS.png" width="100%"/>
</imageobject>
<textobject><phrase>ScaleOutCluster AWS</phrase></textobject>
</mediaobject>
</figure>
<para>このガイドでは一例として、2つの3ノードSAP HANAスケールアウトクラスター（各アベイラビリティゾーンにつき1つずつ）と1つのマジョリティメーカー（mm）ノードで構成されるSUSEクラスターの実装について詳しく説明します。ただし、EC2インスタンスの数を除き、他のすべての要件は、次に示すとおり、SAP HANAノードの数にかかわらず同じです。</para>
<itemizedlist>
<listitem>
<para>AZ-a内の3つのHANA認定EC2インスタンス（ベアメタルまたは仮想化）</para>
</listitem>
<listitem>
<para>AZ-b内の3つのHANA認定EC2インスタンス（ベアメタルまたは仮想化）</para>
</listitem>
<listitem>
<para>AZ-c内の1つのEC2インスタンス。クラスターにおけるマジョリティメーカーとして使用。最低2つのvCPU、2GBのRAM、および50GBのディスク容量</para>
</listitem>
<listitem>
<para>/hana/shared用の2つのAmazon Elastic Filesystem（EFS）</para>
</listitem>
<listitem>
<para>プライマリ（アクティブ）HANAシステムクラスター用の1つのオーバーレイIPアドレス</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="_parameter_sheet">
<title>パラメータシート</title>
<para>クラスター実装の計画は非常に複雑になる可能性があります。このため、適切なインストール計画を策定することをお勧めします。デプロイを開始する前に必要なすべてのパラメータを準備しておくことが推奨されます。初めにパラメータシートを記入し、インストールを開始するとよいでしょう。</para>
<table frame="all" rowsep="1" colsep="1">
<title>NFSベースの設定を準備するためのパラメータシート </title><?dbhtml table-width="85%"?> <?dbfo table-width="85%"?> <?dblatex table-width="85%"?><tgroup cols="2">
<colspec colname="col_1" colwidth="180.625*"/>
<colspec colname="col_2" colwidth="180.625*"/>
<thead>
<row>
<entry align="center" valign="top">パラメータ</entry>
<entry align="center" valign="top">値</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para>SAP HANAメディアへのパス</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>ノード名（AZ-a）</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>ノード名（AZ-b）</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>ノード名（マジョリティメーカー）</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>すべてのクラスターノードのIPアドレス</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>SAP HANA SID</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>SAPインスタンス番号</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>オーバーレイIPアドレス</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>AWSルートテーブル</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>SAP HANAサイト名（サイト1）</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>SAP HANAサイト名（サイト2）</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>EFSファイルシステム（AZ-a）（/hana/shared）</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>EFSファイルシステム（AZ-b）（/hana/shared）</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>ウォッチドッグドライバ</para></entry>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><para>プレイスメントグループ名</para></entry>
<entry align="left" valign="top"/>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="_sap_scale_out_scenario_in_aws_with_suse_linux_enterprise_high_availability_extension">
<title>SUSE Linux Enterprise High Availability ExtensionによるAWSのSAPスケールアウトシナリオ</title>
<para>AWSのSAP HANAスケールアウトクラスターでは、3つ目のアベイラビリティゾーンでマジョリティメーカーノードを使用する必要があります。マジョリティメーカーは、タイブレーカーノードともいい、1つのアベイラビリティゾーンが失われてもクラスタークォーラムの維持を確保します。AWSでは、スケールアウトクラスターの機能を維持するために、少なくとも1つのアベイラビリティゾーンにあるすべてのノードとマジョリティメーカーノードが稼動している必要があります。それ以外の場合、クラスタークォーラムが失われ、残っているSAP HANAノードがある場合は自動的に再起動します。</para>
<para>クラスターノードの各セットは、「クラスター」モードを使用する独自の<link xl:href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/placement-groups.html">EC2プレイスメントグループ</link>を所有することも推奨されます。これは、スケールアウトデプロイにおけるSAP HANAで求められるノード間通信に必要な低レイテンシと高スループットのネットワーク性能をノード間で実現可能するために必要です。</para>
<para>フェールオーバーを自動化するために、<emphasis>SUSE Linux Enterprise Server for SAP Applications</emphasis>に組み込まれているSUSE Linux Enterprise High Availability Extension（HAE）が使用されます。SAP HANAスケールアウト高可用性をサポートするために作成された2つのリソースエージェントが含まれています。</para>
<para>最初のリソースエージェント（RA）は<emphasis role="strong">SAPHanaController</emphasis>で、SAP HANAデータベースインスタンスのチェックと管理を行います。このRAはマスター/スレーブリソースとして構成されます。</para>
<para>マスターはプライマリモードで稼動しているSAP HANAデータベースのアクティブなマスターネームサーバーに対して責任を負います。その他のすべてのインスタンスはスレーブモードで表されます。</para>
<para>2番目のリソースエージェントは<emphasis role="strong">SAPHanaTopology</emphasis>です。このRAはクラスターの構成を可能な限り単純化するために作成されています。SUSE Linux Enterprise High Availability Extension 12クラスターのすべてのSAP HANAノード（マジョリティメーカーを除く）で動作します。SAP HANAシステムレプリケーションのステータスと構成に関する情報を収集します。通常の（ステートレス）クローンリソースとして設計されています。</para>
<figure>
<title>クラスターリソースエージェントとマスター/スレーブステータスのマッピング</title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Cluster-Resources02-AWS.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Cluster Resources02 AWS</phrase></textobject>
</mediaobject>
</figure>
<para>スケールアウト向けのSAP HANAシステムレプリケーションは、次のシナリオまたはユースケースでサポートされています。</para>
<variablelist>
<varlistentry>
<term>パフォーマンス最適化、単一コンテナ（A &gt; B）</term>
<listitem>
<para>パフォーマンス最適化シナリオで、サイト「A」のSAP HANA RDBMSは2つ目のサイト「B」のSAP HANA RDBMSと同期します。2つ目のサイトのSAP HANA RDBMSはテーブルをプリロードするように構成されるので、通常、テイクオーバーの時間は非常に短くなります。</para>
</listitem>
</varlistentry>
<varlistentry>
<term>パフォーマンス最適化、マルチテナンシ（MDCともいう）（%A &gt; %B）</term>
<listitem>
<para>マルチテナンシは上記のすべてのシナリオとユースケースでサポートされています。このシナリオはSAP HANA 1 SPS12以降でサポートされています。クラスターから見た設定と構成は、マルチテナンシーもシングルコンテナも同様です。したがって、上記のドキュメントは両方のシナリオに適用できます。</para>
</listitem>
</varlistentry>
</variablelist>
<para>マルチテナンシはSAP HANA 2.0のデフォルトのインストールタイプです。</para>
</section>
<section xml:id="_the_concept_of_the_performance_optimized_scenario">
<title>パフォーマンス最適化シナリオの概念</title>
<para>AZ-aのプライマリSAP HANAスケールアウトクラスターに障害が発生した場合、High Availability Extensionはテイクオーバー処理の開始を試みます。これにより、AZ-bにあるSAP HANAスケールアウトで既にロード済みのデータを使用できます。一般にテイクオーバーはローカルの再起動に比べてはるかに高速です。</para>
<para><emphasis role="strong">LandscapeHostConfigurationステータス</emphasis>がこのことを反映すると（リターンコード1）、サイトは「停止」または「エラー」と通知されます。これは、ローカルのSAP HANAスタンバイノードが残っていない状態でワーカーノードが停止するときに発生します。</para>
<para>追加の操作はなく、リソースエージェントはSAP内部HAクラスターがローカルで状態を修復するまで待機します。追加の操作としては、SAP HANA 2.0 SPS01以降で利用可能なSAPプロバイダ<emphasis role="strong">srServiceStateChanged()</emphasis>を使用するカスタムのPythonフックが考えられます。</para>
<para>このリソース処理プロセスの自動化を実現するために、SUSE® Linux Enterprise Server for SAP Applicationsとともに提供されるSAPHanaSR-ScaleOut RPMパッケージに含まれるSAP HANAリソースエージェントを使用できます。</para>
<para>パラメータ<emphasis role="strong">AUTOMATED_REGISTER</emphasis>を設定することで、自動化のレベルを構成できます。自動化された登録が有効な場合、クラスターは新しいセカンダリになる、元の障害発生プライマリの登録も自動で行います。</para>
</section>
<section xml:id="_important_prerequisites">
<title>重要な前提条件</title>
<para><emphasis>SAPHanaSR-ScaleOut</emphasis>リソースエージェントソフトウェアパッケージは、次の構成とパラメータを使用して、スケールアウト（マルチノードからマルチノードへ）のシステムレプリケーションをサポートします。</para>
<itemizedlist>
<listitem>
<para>クラスターには有効なSTONITH手段が必要です。AWSで使用されるSTONITHメカニズムはウォッチドッグを使用したディスクレスSBDです。</para>
</listitem>
<listitem>
<para>HANAプライマリおよびセカンダリは異なる<link xl:href="https://aws.amazon.com/about-aws/global-infrastructure/regions_az/">アベイラビリティゾーン（AZ）</link>にあるため、<link xl:href="https://docs.aws.amazon.com/es_es/sap/latest/sap-hana/sap-ha-overlay-ip.html">オーバーレイIP</link>アドレスが必要です。</para>
</listitem>
<listitem>
<para>Linuxユーザーおよびグループ（<emphasis>&lt;sid&gt;adm</emphasis>など）は、Linux OSで<emphasis role="strong">ローカルに</emphasis>定義されます。</para>
</listitem>
<listitem>
<para>すべてのノードの時刻同期は、デフォルトでAmazonのTime Sync Serviceを利用します。</para>
</listitem>
<listitem>
<para>異なるアベイラビリティゾーンにあるSAP HANAスケールアウトグループは、同じSAP識別子（SID）およびインスタンス番号を持つ必要があります。</para>
</listitem>
<listitem>
<para>EC2インスタンスは異なるホスト名を持つ必要があります。</para>
</listitem>
<listitem>
<para>SAP HANAスケールアウトシステムは、1サイトにつきただ<emphasis role="strong">1つの</emphasis>アクティブなマスターネームサーバーを持つ必要があります。最大3つのマスターネームサーバー候補（構成済みのロール「master&lt;N&gt;」を持つSAP HANAノード）を持つ必要があります。</para>
</listitem>
<listitem>
<para>SAP HANAスケールアウトシステムは、ただ<emphasis role="strong">1つの</emphasis>フェイルオーバーグループを持つ必要があります。</para>
</listitem>
<listitem>
<para>本ドキュメントで説明しているクラスターは、Read-enabledに設定されたセカンダリサイト用のサービスIPアドレスは扱いません。</para>
</listitem>
<listitem>
<para>ただ1つのSAP HANAシステムレプリケーション設定（AZ-aからAZ-bへ）があります。</para>
</listitem>
<listitem>
<para>この設定はパフォーマンス最適化シナリオを実装しますが、コスト最適化シナリオは実装しません。</para>
</listitem>
<listitem>
<para>saphostagentはすべてのSAP HANAノードで稼動している必要があります。これは、SAP HANAのインストール時に使用されるシステムノード名とSAPホスト名の間の変換で必要になるためです。</para>
</listitem>
<listitem>
<para>レプリケーションモードは「sync」または「syncmem」のどちらかである必要があります。</para>
</listitem>
<listitem>
<para>クラスターによって制御されるすべてのSAP HANAインスタンスは、<emphasis>sapinit</emphasis>自動起動でアクティブ化しないでください。</para>
</listitem>
</itemizedlist>
<warning>
<para>テイクオーバー後に障害発生プライマリの自動登録が可能です。ただし、開始時に適切な構成として、障害発生プライマリの自動登録を<emphasis role="strong">オフにする</emphasis>ことが推奨されます。したがって、<emphasis>AUTOMATED_REGISTER=&quot;false&quot;</emphasis>が<emphasis role="strong">デフォルト</emphasis>で設定されます。</para>
<para>この場合、テイクオーバー後に障害発生プライマリを手動で登録する必要があります。<emphasis role="strong">hanastudio</emphasis>または<emphasis role="strong">hdbnsutil</emphasis>などのSAPツールをご利用ください。</para>
</warning>
<itemizedlist>
<listitem>
<para>システムブート時のSAP HANAインスタンスの自動起動は、いずれの場合も<emphasis role="strong">オフ</emphasis>にする必要があります。</para>
</listitem>
<listitem>
<para>記述しているすべての設定には、少なくともSAPHanaSR-ScaleOutバージョン0.161、<emphasis>「SUSE Linux Enterprise Server for SAP Applications 12 SP4」</emphasis>または<emphasis>「SUSE Linux Enterprise Server for SAP Applications 15」</emphasis>、SAP HANA 1.0 SPS12（122）またはSAP HANA 2.0 SPS03が必要です。SAPノート2235581をご参照ください。</para>
</listitem>
</itemizedlist>
<important>
<para>有効なSTONITH手段を実装する必要があります。有効なSTONITH手段がない場合は、クラスターのすべてはサポートされないため、正しく動作しません。当面のドキュメントでは、STONITHとしてディスクレスSBDが使用されます。</para>
</important>
<para>この設定ガイドでは、執筆時点でただ1つサポートされているシナリオとして、パフォーマンス最適化シナリオに焦点を当てます。</para>
<para>別のシナリオを実装したりクラスター構成をカスタマイズしたりする必要がある場合は、SUSEおよびAWSとともに概念実証（PoC）を定義することを強くお勧めします。このPoCはユーザーのシナリオで既存のソリューションをテストすることに焦点を当てます。</para>
</section>
</section>
<section xml:id="OsSetup">
<title>SUSE Linux Enterprise High Availability ExtensionクラスターによるAWSの使用</title>
<para>SUSE Linux Enterprise High Availability ExtensionクラスターはAWSリージョンにインストールされます。AWSリージョンは複数のアベイラビリティゾーン（AZ）で構成されています。アベイラビリティゾーン（AZ）は、AWSリージョン内で冗長な電源、ネットワーキング、および接続性を備えた1つ以上の別個のデータセンターです。AZではユーザーが、単一のデータセンターで実現可能なものと比べてより高い可用性、耐障害性、拡張性がある本稼働システムおよびデータベースを運用できます。AWSリージョン内のすべてのAZは、完全に冗長で、専用のメトロファイバーが提供する、高スループットで低レイテンシのAZ間ネットワークを通じて、高帯域幅で低レイテンシのネットワーキングにより相互接続されます。AZ間のすべてのトラフィックは暗号化されます。このネットワーク性能はAZ間の同期レプリケーションを実現するのに十分です。すべてのAZは互いに100km以内にありますが、他の任意のAZとかなりの距離（何kmも）を隔てて物理的に分離されています。個々のアベイラビリティゾーンの障害に耐えるため、AWSでは冗長なクラスターノードが異なるアベイラビリティゾーンにまたがって分散する<link xl:href="https://d0.awsstatic.com/enterprise-marketing/SAP/sap-hana-on-aws-high-availability-disaster-recovery-guide.pdf">アーキテクチャパターン</link>を推奨しています。</para>
<para>AWS仮想プライベートネットワーク（VPC）はすべてのアベイラビリティゾーンにまたがっています。ユーザーは以下を所有していることが前提となります。</para>
<itemizedlist>
<listitem>
<para>3つのアベイラビリティゾーン（AZ）</para>
</listitem>
<listitem>
<para>3つのAZ内に作成されたクラスタノード用のサブネット</para>
</listitem>
<listitem>
<para>それぞれのサブネットに属するルーティングテーブル</para>
</listitem>
</itemizedlist>
<para>HANAサービス向けの仮想IPアドレスは<link xl:href="https://docs.aws.amazon.com/es_es/sap/latest/sap-hana/sap-ha-overlay-ip.html">オーバーレイIPアドレス</link>です。これは、インスタンスが存在するアベイラビリティゾーン（およびサブネット）にかかわらず、ネットワークトラフィックをインスタンスに送信できる特定のルーティングエントリです。</para>
<para>クラスターはこのルーティングエントリを必要に応じて更新します。VPC内のすべてのSAPシステムコンポーネントは、このオーバーレイIPアドレスを通じて、VPC内にSAPシステムコンポーネントを持つAWSインスタンスに到達できます。</para>
<para>オーバーレイIPアドレスには1つの要件があり、VPCの外部にCIDR範囲を持つ必要があります。そうでない場合、サブネットと特定のアベイラビリティゾーンの一部になる可能性があります。</para>
<para>オンプレミスで、HANA StudioなどのユーザーはこのIPアドレスに到達できません。これは、AWS仮想プライベートネットワーク（VPN）ゲートウェイがトラフィックをそうしたIPアドレスにルーティングしないからです。</para>
<section xml:id="_aws_environment_configurations">
<title>AWS環境構成 </title>
<para>AWSでインストールを開始する前に満たす必要のある前提条件を以下に示します。</para>
<itemizedlist>
<listitem>
<para>AWSアカウントを保有していること</para>
</listitem>
<listitem>
<para>管理権限または以下の権限を持つAWSユーザーを保有していること。</para>
<itemizedlist>
<listitem>
<para>セキュリティグループの作成</para>
</listitem>
<listitem>
<para>AWSルーティングテーブルの変更</para>
</listitem>
<listitem>
<para>ポリシーの作成とIAMロールへのアタッチ</para>
</listitem>
<listitem>
<para>EC2インスタンスの送信元/送信先チェックの有効化/無効化</para>
</listitem>
<listitem>
<para>プレイスメントグループの作成</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para>ランドスケープについて以下を理解していること。</para>
<itemizedlist>
<listitem>
<para>使用するAWSリージョンとそのAWS名を知っている</para>
</listitem>
<listitem>
<para>使用するVPCとそのAWS VPC IDを知っている</para>
</listitem>
<listitem>
<para>使用するアベイラビリティゾーン（AZ）を知っている</para>
</listitem>
<listitem>
<para>各アベイラビリティゾーンにサブネットが存在する</para>
<itemizedlist>
<listitem>
<para>サブネットに暗黙的または明示的に付属するルーティングテーブルがある</para>
</listitem>
<listitem>
<para>サブネットにSAPインストール用のフリーIPアドレスがある</para>
</listitem>
<listitem>
<para>サブネット間のネットワークトラフィックを許可している</para>
</listitem>
<listitem>
<para>サブネットからの外部インターネットアクセスを許可している</para>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<note>
<para>AWS SAP HANAクイックスタートを使用すると、上記のすべての必須AWSリソースが自動的にデプロイされます。これは、該当するすべてのSAPノートおよび構成を確実にAWSリソースに適用するための最速で最も安全な方法です。</para>
</note>
</section>
<section xml:id="_security_groups">
<title>セキュリティグループ</title>
<para>クラスターノードによる相互通信を可能にするために、次のポートおよびプロトコルを構成する必要があります。</para>
<itemizedlist>
<listitem>
<para>インバウンドUDP用のポート5405。Corosync通信レイヤを構成するために使用され、ポート5405がよく使用されます。Corosync構成に応じて別のポートを使用できます。</para>
</listitem>
<listitem>
<para>インバウンドTCP用のポート7630。Web GUI であるSUSE「HAWK」で使用されます。</para>
</listitem>
</itemizedlist>
<note>
<para>このセクションでは、SUSE Linux Enterprise HAEクラスターで使用可能にする必要があるポートのみを示しています。SAP関連のポートは含まれていません。</para>
</note>
</section>
<section xml:id="_placement_group">
<title>プレイスメントグループ</title>
<para>SAP HANAノードがSAP HANAで要求される高いネットワークスループットを確実に実現するために、アベイラビリティゾーン毎に1つのクラスタープレイスメントグループが必要です。プレイスメントグループについて詳しくは、AWSのドキュメントをご参照ください（<link xl:href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/placement-groups.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/placement-groups.html</link>）。</para>
</section>
<section xml:id="_aws_ec2_instance_creation">
<title>AWS EC2インスタンスの作成 </title>
<para>SUSE Linux Enterprise HAEクラスターを構成するために、すべてのEC2インスタンスを作成します。EC2インスタンスは、互いに独立させるために、3つの異なるアベイラビリティゾーンに配置されます。</para>
<para>本ドキュメントでは、SAP HANA（プライマリサイト）向けにAZ-a内の3つのEC2インスタンス、SAP HANA（セカンダリサイト）向けにAZ-b内の3つのEC2インスタンス、クラスターのマジョリティメーカー（MM）としてAZ-c内の1つのインスタンスを対象とします。</para>
<para>AMIの選択は次のとおりです。</para>
<itemizedlist>
<listitem>
<para>「SUSE Linux Enterprise Server for SAP」AMIを使用します。AMIのリストで、「suse-sles-sap-12-sp4」または「suse-sles-sap-15」を検索します。使用可能ないくつかのBYOS（Bring Your Own Subscription）AMIがあります。有効なSUSEサブスクリプションを保有している場合は、これらのAMIを使用します。SUSEのSubscription Management Tool（SMT）、SUSE Manager、または直接SUSE Customer Centerを使用して、システムを登録します。</para>
</listitem>
<listitem>
<para>あらかじめSUSEサブスクリプションとHAEソフトウェアコンポーネントを含んでいる、AWS Marketplace AMI
<emphasis>SUSE Linux Enterprise Server for SAP Applications 15</emphasis>を使用します。</para>
</listitem>
</itemizedlist>
<para>アベイラビリティゾーン（AZ）固有のサブネットおよびプレイスメントグループにすべてのEC2インスタンスを起動します。これらのサブネットは互いに通信可能である必要があります。</para>
</section>
<section xml:id="_host_names">
<title>ホスト名</title>
<para>デフォルトで、EC2インスタンスは自動生成されたホスト名を持ちます。ただし、SAP要件に合ったホスト名を割り当てることが推奨されます。SAPノート611361をご参照ください。ホスト名に関して、次のように/etc/cloud/cloud.cfgを編集する必要があります。</para>
<screen>preserve_hostname: true</screen>
<note>
<para>SUSE Linux Enterpriseを実行しているEC2インスタンスのデフォルトのホスト名を変更する方法については、 <link xl:href="https://aws.amazon.com/premiumsupport/knowledge-center/linux-static-hostname-suse/">https://aws.amazon.com/premiumsupport/knowledge-center/linux-static-hostname-suse/</link>にあるAWSの公開ドキュメントを参照してください。</para>
</note>
</section>
<section xml:id="_aws_cli_profile_configuration">
<title>AWS CLI プロファイル構成 </title>
<para>クラスターのリソースエージェントはAWSコマンドラインインターフェース（CLI）を使用します。すべてのインスタンスで<emphasis>root</emphasis>ユーザー用に作成する必要があるAWS CLIプロファイルを使用します。SUSEクラスターリソースエージェントでは、出力をテキスト形式で生成するプロファイルが必要です。</para>
<para>プロファイルの名前は任意で、後でクラスター構成に追加されます。この例で選択されている名前は<emphasis>cluster</emphasis>です。インスタンスのリージョンも追加する必要があります。次の例で、文字列<emphasis>region-name</emphasis>を目的のリージョンで置き換えます。</para>
<para>こうしたプロファイルを作成する1つの方法は、次の内容を含むファイル<emphasis>/root/.aws/config</emphasis>を作成することです。</para>
<screen>[default]
region = region-name
[profile cluster]
region = region-name
output = text</screen>
<para>別の方法は、<emphasis>aws configure</emphasis> CLIコマンドを次のように使用することです。</para>
<screen># aws configure
AWS Access Key ID [None]:
AWS Secret Access Key [None]:
Default region name [None]: _region-name_
Default output format [None]:

# aws configure --profile cluster
AWS Access Key ID [None]:
AWS Secret Access Key [None]:
Default region name [None]: region-name
Default output format [None]: text</screen>
<para>上記のコマンドはデフォルトのプロファイルとクラスタープロファイルという2つのプロファイルを作成します。</para>
<note>
<para>AWSでは、これらのプロファイルにAWSユーザー資格情報またはAPI署名キーのいずれも格納<emphasis>しない</emphasis>ことを推奨しています。これらのフィールドを空白のままにして、必要な権限が付いたEC2 IAMプロファイルをEC2インスタンスにアタッチします。</para>
</note>
</section>
<section xml:id="_configure_httphttp_proxies_optional">
<title>HTTP/HTTPプロキシの構成（オプション） </title>
<para>システムがインターネットに直接アクセスできる場合、この操作は不要です。</para>
<para>クラスターリソースエージェントはクラスターライフサイクルを通じてAWS API呼び出しを実行するため、AWS APIエンドポイントへのHTTP/HTTPSアクセスが必要です。透過的なインターネットアクセスを提供しないシステムでは、HTTP/HTTPSプロキシが必要になる場合があります。プロキシアクセスの構成については、AWSのドキュメントに詳しい説明があります。</para>
<para>次の環境変数をrootユーザーの<emphasis>.bashrc</emphasis>ファイルに追加します。</para>
<screen>export HTTP_PROXY=http://a.b.c.d:n
export HTTPS_PROXY=http://a.b.c.d:m
export NO_PROXY=&quot;169.254.169.254&quot;</screen>
<para>AWSのSAP用データプロバイダーはインスタンスのメタデータサービスに直接到達する必要があります。次の環境変数をrootユーザーの<emphasis>.bashrc</emphasis>ファイルに追加します。</para>
<screen>export NO_PROXY=&quot;127.0.0.1,localhost,localaddress,169.254.169.254&quot;</screen>
<para>SUSE Linux Enterprise HAEでは、プロキシ構成を<emphasis>/etc/sysconfig/pacemaker</emphasis>構成ファイルに次の形式で追加する必要もあります。</para>
<screen>export HTTP_PROXY=http://username:password@a.b.c.d:n
export HTTPS_PROXY=http://username:password@a.b.c.d:m
export NO_PROXY=&quot;127.0.0.1,localhost,localaddress,169.254.169.254&quot;</screen>
<section xml:id="_verify_http_proxy_settings_optional">
<title>4.71 HTTPプロキシ設定の検証（オプション） </title>
<para>SUSEインスタンスがEC2インスタンスメタデータアドレスURL <link xl:href="http://169.254.169.254/latest/meta-data">http://169.254.169.254/latest/meta-data</link>に到達可能であることを確認してください。これは、複数のシステムコンポーネントがアクセスする必要があるためです。したがって、制限するファイアウォールルールが存在する場合は無効化し、このURLへのプロキシアクセスを無効化することが推奨されます。</para>
<para>EC2インスタンスメタデータサーバーについて詳しくは、AWSのドキュメント（<link xl:href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html</link>）をご参照ください。</para>
</section>
</section>
<section xml:id="_disable_the_sourcedestination_check_for_the_cluster_instances">
<title>クラスターインスタンスの送信元/送信先チェックの無効化</title>
<para>クラスターの一部であるすべてのEC2インスタンスで、送信元/送信先チェックを無効化する必要があります。これは、AWSコマンドラインインターフェース（AWS-CLI）を使用するスクリプトまたはAWSコンソールの利用によって実行できます。クラスターの一部であるすべてのEC2インスタンスで、次のコマンドを<emphasis>一度</emphasis>だけ実行する必要があります。</para>
<screen># aws ec2 modify-instance-attribute --instance-id EC2-instance-id --no-source-dest-check</screen>
<para>変数<emphasis>EC2-instance-id</emphasis>をAWS EC2インスタンスのインスタンスIDで置き換えます。このコマンドの実行対象となるシステムでは、次のポリシーを持つロールが一時的に必要です。</para>
<screen>{
   &quot;Version&quot;: &quot;2012-10-17&quot;,
   &quot;Statement&quot;: [
   {
      &quot;Sid&quot;: &quot;Stmt1424870324000&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Action&quot;: [ &quot;ec2:ModifyInstanceAttribute&quot;],
      &quot;Resource&quot;: [
      &quot;arn:aws:ec2:region-name:account-id:instance/instance-a&quot;,
      &quot;arn:aws:ec2:region-name:account-id:instance/instance-b&quot;
      ]
   }
   ]
}</screen>
<para>次の個別パラメータを適切な値に置き換えます。</para>
<itemizedlist>
<listitem>
<para>region-name（例: us-east-1）</para>
</listitem>
<listitem>
<para>account-id（例: 123456789012）</para>
</listitem>
<listitem>
<para>instance-a、instance-b（例: i-1234567890abcdef）</para>
</listitem>
</itemizedlist>
<note>
<para>ポリシーに含まれる文字列「instance」は固定文字列です。置き換えが必要な変数ではありません。</para>
</note>
<para>送信元/送信先チェックはAWSコンソールから無効化することもできます。両方のEC2インスタンスのコンソールで、次のドロップダウンボックスから実行します（下図参照）。</para>
<figure>
<title>コンソールで送信元/送信先チェックを無効化 </title>
<mediaobject>
<imageobject>
<imagedata fileref="SourceDestinationCheck.png"/>
</imageobject>
<textobject><phrase>PNG</phrase></textobject>
</mediaobject>
</figure>
</section>
<section xml:id="_avoid_deletion_of_overlay_ip_address_on_the_eth0_interface">
<title>eth0インターフェースにおけるオーバーレイIPアドレスの削除回避 </title>
<para>SUSEのcloud-netconfig-ec2パッケージは、クラスターエージェントによって管理されるセカンダリIPアドレスを誤ってeth0インターフェースから削除する可能性があります。これによりクラスターサービスのユーザー向けのサービスが中断する場合があります。すべてのクラスターノードで次のタスクを実行します。</para>
<para>次のコマンドを使用して、パッケージcloud-netconfig-ec2がインストールされているかどうかを確認します。</para>
<screen># zypper info cloud-netconfig-ec2</screen>
<para>パッケージがインストールされている場合、ファイル<emphasis>/etc/sysconfig/network/ifcfg-eth0</emphasis>を更新して次の行を「no」設定に変更するか、パッケージがまだインストールされていない場合は次の行を追加します。</para>
<screen>CLOUD_NETCONFIG_MANAGE='no'</screen>
</section>
<section xml:id="_aws_roles_and_policies">
<title>AWSロールおよびポリシー </title>
<para>SUSE Linux Enterprise HAEクラスターソフトウェアとそのエージェントは、クラスターを操作するためにいくつかのAWS IAM権限が必要です。クラスターの一部であるEC2インスタンスにIAMセキュリティロールをアタッチする必要があります。単一のIAMロールをクラスター全体で使用し、すべてのEC2インスタンスに関連付けることができます。</para>
<para>このIAMセキュリティロールには、ロールは、以下に説明するIAMセキュリティポリシーが必要です。</para>
<section xml:id="_aws_data_provider_policy">
<title>AWSデータプロバイダーポリシー </title>
<para>AWS上のSAPシステムには「AWS Data Provider for SAP」のインストールが必要で、AWSリソースにアクセスするためのポリシーが必要です。<link xl:href="https://docs.aws.amazon.com/sap/latest/general/aws-data-provider.html">「AWS Data Provider for SAP Installation and Operations Guide」</link>に示されているポリシーを使用し、クラスターEC2インスタンスによって使用されるIAMセキュリティロールにアタッチします。このポリシーはすべてのSAPシステムによって使用できます。「AWS Data Provider for SAP」では、1つのAWSアカウントにつきただ1つのポリシーが必要です。したがって、「AWS Data Provider for SAP」用のIAMセキュリティポリシーが既に存在する場合、それを使用できます。</para>
<screen>{
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;EC2:DescribeInstances&quot;,
                &quot;EC2:DescribeVolumes&quot;
            ],
            &quot;Resource&quot;: &quot;*&quot;
        },
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: &quot;cloudwatch:GetMetricStatistics&quot;,
            &quot;Resource&quot;: &quot;*&quot;
        },
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: &quot;s3:GetObject&quot;,
            &quot;Resource&quot;: &quot;arn:aws:s3:::aws-data-provider/config.properties&quot;
        }
    ]
}</screen>
</section>
<section xml:id="_overlay_ip_agent_policy">
<title>オーバーレイIPエージェントポリシー </title>
<para>オーバーレイIPエージェントはAWSルーティングテーブル中のルーティングエントリを変更します。次に示すように、<emphasis>Manage-Overlay-IP-Policy</emphasis>などの名前を持つポリシーを作成し、クラスターインスタンスのIAMセキュリティロールにアタッチします。</para>
<screen>{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
           &quot;Sid&quot;: &quot;Stmt1424870324000&quot;,
           &quot;Action&quot;: &quot;ec2:ReplaceRoute&quot;,
           &quot;Effect&quot;: &quot;Allow&quot;,
           &quot;Resource&quot;: &quot;arn:aws:ec2:region-name:account-id:route-table/rtb-XYZ&quot;
        },
        {
           &quot;Sid&quot;: &quot;Stmt1424870324000&quot;,
           &quot;Action&quot;: &quot;ec2:DescribeRouteTables&quot;,
           &quot;Effect&quot;: &quot;Allow&quot;,
           &quot;Resource&quot;: &quot;*&quot;
        }
    ]
}</screen>
<para>このポリシーによって、エージェントは使用されるルーティングテーブルを更新できます。次の変数を適切な名前に置き換えます。</para>
<itemizedlist>
<listitem>
<para>region-name : AWSリージョンの名前</para>
</listitem>
<listitem>
<para>account-id : ポリシーが使用されるAWSアカウントの名前</para>
</listitem>
<listitem>
<para>rtb-XYZ : 更新する必要があるルーティングテーブルの識別子</para>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="_add_overlay_ip_addresses_to_routing_table">
<title>ルーティングテーブルへのオーバーレイIPアドレスの追加 </title>
<para>EC2クラスターインスタンスによって使用される2つのサブネットに割り当てられるルーティングテーブル中のルートエントリを作成します。このIPアドレスはHANAクラスターの仮想サービスIPアドレスです。オーバーレイIPアドレスは、VPCのCIDR範囲の外部にある必要があります。AWSコンソールを使用し、「VPC」を検索します。</para>
<itemizedlist>
<listitem>
<para>VPCを選択</para>
</listitem>
<listitem>
<para>左側の列で「Route Tables」をクリック</para>
</listitem>
<listitem>
<para>使用するSAP EC2インスタンスとそのアプリケーションサーバーのいずれかからサブネットで使用されるルートテーブルを選択</para>
</listitem>
<listitem>
<para>「Routes」タブをクリック</para>
</listitem>
<listitem>
<para>「Edit」をクリック</para>
</listitem>
<listitem>
<para>リストの最後までスクロールし、「Add another route」をクリック</para>
</listitem>
</itemizedlist>
<para>HANAデータベースのオーバーレイIPアドレスを追加します。フィルタとして/32を使用します（例: 192.168.10.1/32）。SAP HANAマスターになるEC2インスタンスにElastic Network Interface（ENI）名を追加します。リソースエージェントは、この後者を必要に応じて自動的に変更します。「Save」をクリックして変更内容を保存します。</para>
<note>
<para>ルーティングエントリを含むルーティングテーブルが、サービスのコンシューマを持つVPC内のすべてのサブネットに継承される必要があることは重要です。ルーティングテーブルの継承について詳しくは、AWS VPCのドキュメント（<link xl:href="http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html">http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Introduction.html</link>）をご参照ください。</para>
</note>
</section>
<section xml:id="_create_efs_file_systems">
<title>EFSファイルシステムの作成 </title>
<para>SAP HANAスケールアウトクラスターの各セットは、独自のAmazon Elastic Filesystem（EFS）を持つ必要があります。EFSファイルシステムを作成するには、作成およびマウントの方法に関するステップバイステップのガイドを含む、AWSの公開ドキュメントをご確認ください（<link xl:href="https://docs.aws.amazon.com/efs/latest/ug/getting-started.html">https://docs.aws.amazon.com/efs/latest/ug/getting-started.html</link>参照）。</para>
</section>
<section xml:id="_configure_the_operating_system_for_sap_hana">
<title>SAP HANA向けのOSの構成 </title>
<para>使用するSAP HANAバージョンに対してOS（モジュール、パッケージ、カーネル設定など）を構成するには、以下のSAPノートを考慮してください。</para>
<para>SUSE Linux Enterprise Server for SAP Applications 12を使用する場合: - <emphasis role="strong">1984787</emphasis> SUSE LINUX Enterprise Server 12: Installation Notes
- <emphasis role="strong">2205917</emphasis> SAP HANA DB: Recommended OS settings for SLES 12 / SLES for SAP Applications 12</para>
<para>SUSE Linux Enterprise Server for SAP Applications 15を使用する場合: - <emphasis role="strong">2578899</emphasis> SUSE Linux Enterprise Server 15: Installation Notes
- <emphasis role="strong">2684254</emphasis> SAP HANA DB: Recommended OS settings for SLES 15 / SLES for SAP Applications 15</para>
<para>その他の関連SAPノート: - <emphasis role="strong">1275776</emphasis> Linux: Preparing SLES for SAP environments
- <emphasis role="strong">2382421</emphasis> Optimizing the Network Configuration on HANA- and OS-Level</para>
<section xml:id="_install_sap_hana_scale_out_cluster_agent">
<title>SAP HANAスケールアウトクラスターエージェントのインストール </title>
<para>SUSEは、SLES for SAPとともに、SAP HANA用の特殊なリソースエージェントを提供します。パターン「sap-hana」のインストールに伴い、SAP HANAスケールアップ用のリソースエージェントがインストールされますが、スケールアウトシナリオのためには特殊なリソースエージェントが必要です。既存のAWS Amazonマシンイメージ（AMI）に基づいてシステムをインストールしたか、AWSクイックスタートを使用してSAP HANAノードをデプロイした場合、各ノードで以下の手順に従ってください。パターン<emphasis>High Availability</emphasis>は、マジョリティメーカーノードなど、<emphasis role="strong">すべての</emphasis>ノードにインストールを推奨しているすべてのツールを要約します。</para>
<itemizedlist>
<listitem>
<para>パッケージの削除: SAPHanaSR SAPHanaSR-doc yast2-sap-ha</para>
</listitem>
<listitem>
<para>パッケージのインストール: SAPHanaSR-ScaleOut SAPHanaSR-ScaleOut-doc</para>
</listitem>
</itemizedlist>
<example>
<title>スケールアップ用にSAPHanaSRエージェントをアンインストールする </title>
<para>rootユーザーとして、以下を実行します。</para>
<screen>zypper remove SAPHanaSR SAPHanaSR-doc yast2-sap-ha</screen>
</example>
<example>
<title>スケールアウト用にSAPHanaSRエージェントをインストールする </title>
<para>rootユーザーとして、以下を実行します。</para>
<screen>zypper in SAPHanaSR-ScaleOut SAPHanaSR-ScaleOut-doc</screen>
<para>パッケージがまだインストールされていない場合、次のような出力が得られます。</para>
<screen>Refreshing service 'Advanced_Systems_Management_Module_12_x86_64'.
Refreshing service 'SUSE_Linux_Enterprise_Server_for_SAP_Applications_12_SP3_x86_64'.
Loading repository data...
Reading installed packages...
Resolving package dependencies...

The following 2 NEW packages are going to be installed:
  SAPHanaSR-ScaleOut SAPHanaSR-ScaleOut-doc

2 new packages to install.
Overall download size: 539.1 KiB. Already cached: 0 B. After the operation, additional 763.1 KiB will be used.
Continue? [y/n/...? shows all options] (y): y
Retrieving package SAPHanaSR-ScaleOut-0.161.1-1.1.noarch                                                                            (1/2),  48.7 KiB (211.8 KiB unpacked)
Retrieving: SAPHanaSR-ScaleOut-0.161.1-1.1.noarch.rpm ....................................[done]
Retrieving package SAPHanaSR-ScaleOut-doc-0.161.1-1.1.noarch                                                                        (2/2), 490.4 KiB (551.3 KiB unpacked)
Retrieving: SAPHanaSR-ScaleOut-doc-0.161.1-1.1.noarch.rpm ................................[done (48.0 KiB/s)]
Checking for file conflicts: .............................................................[done]
(1/2) Installing: SAPHanaSR-ScaleOut-0.161.1-1.1.noarch ..................................[done]
(2/2) Installing: SAPHanaSR-ScaleOut-doc-0.161.1-1.1.noarch ..............................[done]</screen>
<para>SUSEのHigh Availabilityパターンをインストール</para>
<screen>zypper in --type pattern ha_sles</screen>
</example>
</section>
<section xml:id="_install_the_latest_available_updates_from_suse">
<title>4.13.2 SUSEから入手可能な最新のアップデートをインストール</title>
<para>以前にパッケージをインストールしたことがある場合、リソースエージェントとその他のパッケージの最新バージョンを得るために、必ず<emphasis role="strong">すべての</emphasis>マシンに最新のパッケージアップデートをインストールしてください。アップデートの入手には、SUSE Manager、SMT、またはSCC（SUSE Costumer Center）への直接接続など、複数の方法があります。</para>
<para>所属する会社またはユーザールールに応じて、<emphasis>zypper update</emphasis>または<emphasis>zypper patch</emphasis>を使用します。</para>
<example>
<title>ソフトウェアアップデートは各ノードからトリガする必要がある </title>
<para><emphasis>zypper patch</emphasis>は、入手可能で必要なパッチをすべてインストールします。rootユーザーとして、以下を実行します。</para>
<screen>zypper patch</screen>
<para><emphasis>zypper update</emphasis>は、可能な場合、すべてまたは特定のインストール済みパッケージを新しいバージョンで更新します。rootユーザーとして、以下を実行します。</para>
<screen>zypper update</screen>
</example>
</section>
</section>
<section xml:id="_configure_sles_for_sap_to_run_sap_hana">
<title>SAP HANAを実行するためのSLES for SAPの構成 </title>
<section xml:id="_tuning_modification">
<title>チューニング/修正</title>
<para>必要なすべてのオペレーティングシステムチューニングは、SAPノート2684254とSAPノート2205917に説明があります。これらのSAPノートで述べられている各パラメータを手動で検証することをお勧めします。これは、SAP HANAのすべてのパフォーマンスチューニングが正しく設定されていることを確認するためです。</para>
<para>SAPノートで説明されている項目は次のとおりです。</para>
<itemizedlist>
<listitem>
<para>SLES 15またはSLES 12</para>
</listitem>
<listitem>
<para>追加のサードパーティ製カーネルモジュール</para>
</listitem>
<listitem>
<para>sapconfまたはsaptuneの構成</para>
</listitem>
<listitem>
<para>NUMAバランシングの停止</para>
</listitem>
<listitem>
<para>透過的なHugePagesの無効化</para>
</listitem>
<listitem>
<para>Linuxにおける低レイテンシ用C-Stateの構成（インテルベースシステムにのみ適用）</para>
</listitem>
<listitem>
<para>CPU 周波数/電圧スケーリング（インテルベースシステムにのみ適用）</para>
</listitem>
<listitem>
<para>エネルギーパフォーマンスバイアス（EPB、インテルベースシステムにのみ適用）</para>
</listitem>
<listitem>
<para>Kernel Samepage Merging（KSM）の停止</para>
</listitem>
<listitem>
<para>Linux Pagecache Limit</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="_enable_ssh_access_via_public_key_optional">
<title>公開鍵によるSSHアクセスの有効化（オプション） </title>
<para>公開鍵認証は、サーバーに対するパスワードなしのSSHアクセスを実現します。</para>
<para>この設定は、すべてのクラスターノードへのSSHアクセスを可能にする、ただ1つのSSHキーペアに基づいています。</para>
<example>
<title>SSHキーの作成と交換 </title>
<para>rootユーザーとして、1つのノードのSSHキーを作成します。</para>
<screen>ssh-keygen -t rsa</screen>
<para>ssh-key生成により、不足しているパラメータが求められます。</para>
<screen>Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:ip/8kdTbYZNuuEUAdsaYOAErkwnkAPBR7d2SQIpIZCU root@&lt;host1&gt;
The key's randomart image is:
+---[RSA 2048]----+
|XEooo+ooo+o      |
|=+.= o=.o+.      |
|..B o. + o.      |
|   o  . +... .   |
|        S.. *    |
|     . o . B o   |
|    . . o o =    |
|     o . . +     |
|      +.. .      |
+----[SHA256]-----+</screen>
<para><emphasis>ssh-keygen</emphasis>が設定されると、<emphasis>/root/.ssh/</emphasis>の下に新しいファイルが2つ生成されます。</para>
<screen>ls /root/.ssh/
id_rsa  id_rsa.pub</screen>
<para>他のすべてのノードから公開ホストキーを収集します。ここでは<emphasis>ssh-keyscan</emphasis>コマンドを使用しました。</para>
<screen>ssh-keyscan</screen>
<para>最初のSSH接続時に、SSHホストキーは自動的に収集され、ファイル<emphasis>/root/.ssh/known_host</emphasis>に格納されます。初回ログインの際に、ホストキーを受け入れる「yes」で確認することを避けるために、あらかじめホストキーを収集して格納します。</para>
<screen>ssh-keyscan -t ecdsa-sha2-nistp256 &lt;host1&gt;,&lt;host1 ip&gt; &gt;&gt;.ssh/known_hosts
ssh-keyscan -t ecdsa-sha2-nistp256 &lt;host2&gt;,&lt;host2 ip&gt; &gt;&gt;.ssh/known_hosts
ssh-keyscan -t ecdsa-sha2-nistp256 &lt;host3&gt;,&lt;host3 ip&gt; &gt;&gt;.ssh/known_hosts
...</screen>
<para>すべてのホストキーを収集した後で、<emphasis>authorized_keys</emphasis>という名前のファイルに格納します。完全なディレクトリ/root/.ssh/を最初のノードからすべてのクラスターメンバーにプッシュします。</para>
<screen>rsync -ay /root/.ssh/ &lt;host2&gt;:/root/.ssh/
rsync -ay /root/.ssh/ &lt;host3&gt;:/root/.ssh/
rsync -ay /root/.ssh/ &lt;host4&gt;:/root/.ssh/
....</screen>
</example>
</section>
<section xml:id="_set_up_disk_layout_for_sap_hana">
<title>4.14.3 SAP HANA用のディスクレイアウトの設定</title>
<para><link xl:href="https://docs.aws.amazon.com/quickstart/latest/sap-hana/planning.html">https://docs.aws.amazon.com/quickstart/latest/sap-hana/planning.html</link>で説明されているストレージレイアウトに従うことを強く推奨します。このWebサイトの表には、使用するEC2インスタンスタイプに対して最低限必要なEBSボリュームの数、ボリュームサイズ、およびIOPS（IO1用）が示されています。ワークロードの要件に応じて、より大きなストレージまたはより高いIOPSを選択できます。次のEBSボリュームを構成します。</para>
<itemizedlist>
<listitem>
<para>/hana/data</para>
</listitem>
<listitem>
<para>/hana/log</para>
</listitem>
</itemizedlist>
<para>ファイルシステムは次のとおりです。</para>
<variablelist>
<varlistentry>
<term>/hana/shared/&lt;SID&gt;</term>
<listitem>
<para>SAP HANAスケールアウトで、このディレクトリは同じスケールアウトクラスターのすべてのノードにマウントされ、AWSでこのディレクトリはEFSを使用します。バイナリ、トレース、ログファイルなどの共有ファイルを含みます。</para>
</listitem>
</varlistentry>
<varlistentry>
<term>/hana/log/&lt;SID&gt;</term>
<listitem>
<para>このディレクトリは、SAP HANAホストのredoログファイルを含みます。AWSでこのディレクトリはインスタンスに対してローカルです。</para>
</listitem>
</varlistentry>
<varlistentry>
<term>/hana/data/&lt;SID&gt;</term>
<listitem>
<para>このディレクトリは、SAP HANAホストのデータファイルを含みます。AWSでこのディレクトリはインスタンスに対してローカルです。</para>
</listitem>
</varlistentry>
<varlistentry>
<term>/usr/sap</term>
<listitem>
<para>これはローカルのSAPシステムのインスタンス用のディレクトリへのパスです。/usr/sapに対して別のボリュームを持つことをお勧めします。</para>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
<section xml:id="_configure_host_name_resolution">
<title>ホスト名解決の構成 </title>
<para>ホスト名解決を構成するために、DNSサーバーを使用するか、 <emphasis role="strong">すべての</emphasis>クラスターノードで<emphasis>/etc/hosts</emphasis>ファイルを変更することができます。</para>
<para><emphasis>/etc/hosts</emphasis>ファイルを管理することで、DNSサービスの障害による影響が最低限に抑えられます。<emphasis role="strong">すべての</emphasis>クラスターノードで<emphasis>/etc/hosts</emphasis>ファイルを編集し、すべてのクラスターノードのホスト名とIPを追加します。</para>
<screen>vi /etc/hosts</screen>
<para>次の行を<emphasis>/etc/hosts</emphasis>に挿入します。使用する環境に合わせてIPアドレスとホスト名を変更します。</para>
<screen><emphasis role="strong"><emphasis>192.168.201.151</emphasis></emphasis> <emphasis><emphasis role="strong">suse01</emphasis></emphasis>
<emphasis role="strong"><emphasis>192.168.201.152</emphasis></emphasis> <emphasis><emphasis role="strong">suse02</emphasis></emphasis>
...</screen>
</section>
<section xml:id="_enable_chronyntp_service_on_all_nodes">
<title>すべてのノードでChrony/NTPサービスを有効化</title>
<para>デフォルトで、すべてのノードは自動的にAmazon Time Sync Serviceと同期します。すべてのノードのNTP/chrony構成<emphasis>/etc/chrony.conf</emphasis>を参照し、タイムソースサーバーが169.254.169.123であることを確認します。</para>
</section>
</section>
<section xml:id="SAPHanaInst">
<title>両サイトでのSAP HANAデータベースのインストール</title>
<para>インフラストラクチャの設定が終わったので、両サイトでSAP HANAデータベースをインストールできます。クラスター内のマシンは<emphasis>ノード</emphasis>ともいいます。</para>
<figure>
<title><xref linkend="Planning"/> <xref linkend="OsSetup"/> SAPHanaInst <xref linkend="SAPHanaHsr"/> <xref linkend="Integration"/> <xref linkend="Cluster"/> <xref linkend="Testing"/></title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase3.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase3</phrase></textobject>
</mediaobject>
</figure>
<para>この例では、ドキュメントをよりわかりやすくするために、マシン（つまりノード）に<emphasis>suse01</emphasis>、…​ <emphasis>suseXX</emphasis>という名前を付けています。奇数が付いているノード（suse01、suse03、suse05、…​）はサイト「A」（WDF1）の部分で、偶数が付いているノード（suse02、suse04、suse06、…​）はサイト「B」（ROT1）の部分です。</para>
<para>次のユーザーは、SAP HANAのインストール時に自動で作成されます。</para>
<variablelist>
<varlistentry>
<term>&lt;sid&gt;adm</term>
<listitem>
<para>ユーザー&lt;sid&gt;admは、システムの開始および停止などの管理タスクに必要なOSユーザーです。</para>
</listitem>
</varlistentry>
<varlistentry>
<term>sapadm</term>
<listitem>
<para>SAPホストエージェントの管理者です。</para>
</listitem>
</varlistentry>
<varlistentry>
<term>SYSTEM</term>
<listitem>
<para>SAP HANAデータベースのスーパーユーザーです。</para>
</listitem>
</varlistentry>
</variablelist>
<section xml:id="_preparation">
<title>準備</title>
<itemizedlist>
<listitem>
<para>SAPマーケットプレイスで入手可能なSAPインストールおよび設定ガイドを読みます。</para>
</listitem>
<listitem>
<para>SAPマーケットプレイスからSAP HANAソフトウェアをダウンロードします。</para>
</listitem>
<listitem>
<para>SAP HANAデータベースソフトウェアおよびデータベースコンテンツ（データ、ログ、共有ファイル）をインストールするためにファイルシステムをマウントします。</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="_installation">
<title>インストレーション</title>
<para>SAP HANAサーバーインストールガイドの説明に従って、SAP HANAデータベースをインストールします。これを行うために、初めにHANAプライマリマスターサーバーを単一のスケールアップシステムとしてインストールします。完了したら、global.iniのパラメータ
persistence/basepath_sharedを「no」に変更します。</para>
<screen>ALTER SYSTEM ALTER CONFIGURATION ('global.ini', 'SYSTEM') SET ('persistence','basepath_shared')='no';</screen>
<para>これでHANAデータベースはすべてのノードにまたがって共有されるlog/dataディレクトリを必要としなくなります。この設定を適用した後で、データベースにホストを追加できます。同じアベイラビリティゾーン（プライマリサイト）にあるスケールアウトクラスターのすべてのHANAノードを追加します。</para>
<para>SAPノート<emphasis role="strong">2369981 - Required configuration steps for authentication with HANA System Replication</emphasis>に従って、セカンダリサイトと暗号化キーを交換してください。</para>
<para>セカンダリサイトのマスターで同じ手順を繰り返し、SAP HANAデータベースをインストールします。persistence/basepath_sharedパラメータを変更し、セカンダリスケールアウトクラスターにノードを追加します。</para>
</section>
<section xml:id="_checks">
<title>チェック</title>
<para><emphasis role="strong">両方の</emphasis>データベースサイトが起動状態で、これらのデータベースのすべてのプロセスが正しく動作していることを確認します。</para>
<orderedlist numeration="arabic">
<listitem>
<para>Linuxユーザー<emphasis>&lt;sid&gt;adm</emphasis>として、SAPコマンドラインツール<emphasis>HDB</emphasis>を使用し、動作中のSAP HANAプロセスの概要を把握します。<emphasis>HDB</emphasis> infoの出力は、<emphasis role="strong">両方の</emphasis>サイトとも以下のスクリーンショットのように表示されます。</para>
<example>
<title>HDB infoの呼び出し（ユーザー&lt;sid&gt;admとして）</title>
<screen>HDB info</screen>
<para><emphasis>HDB info</emphasis>コマンドは、該当のSIDに対して現在稼動中のプロセスを表示します。</para>
<screen>USER           PID  ...  COMMAND
ha1adm         6561 ...  -csh
ha1adm         6635 ...    \_ /bin/sh /usr/sap/HA1/HDB00/HDB info
ha1adm         6658 ...        \_ ps fx -U HA1 -o user,pid,ppid,pcpu,vsz,rss,args
ha1adm         5442 ...  sapstart pf=/hana/shared/HA1/profile/HA1_HDB00_suse01
ha1adm         5456 ...   \_ /usr/sap/HA1/HDB00/suse01/trace/hdb.sap{sidlc}_HDB00 -d -nw -f /usr/sap/ha1/HDB00/suse
ha1adm         5482 ...       \_ hdbnameserver
ha1adm         5551 ...       \_ hdbpreprocessor
ha1adm         5554 ...       \_ hdbcompileserver
ha1adm         5583 ...       \_ hdbindexserver
ha1adm         5586 ...       \_ hdbstatisticsserver
ha1adm         5589 ...       \_ hdbxsengine
ha1adm         5944 ...       \_ sapwebdisp_hdb pf=/usr/sap/HA1/HDB00}/suse01/wdisp/sapwebdisp.pfl -f /usr/sap/SL
ha1adm         5363 ...  /usr/sap/HA1/HDB00/exe/sapstartsrv pf=/hana/shared/HA1/profile/HA1_HDB00_suse02 -D -u s</screen>
</example>
</listitem>
<listitem>
<para>Pythonスクリプト<emphasis>landscapeHostConfiguration.py</emphasis>を使用して、SAP HANAサイト全体の状況を表示します。</para>
<example>
<title>ホスト役割の照会（ユーザー&lt;sid&gt;admとして）</title>
<screen>HDBSettings.sh landscapeHostConfiguration.py</screen>
<para>ランドスケープホスト構成は、1つのSAP HANAホストにつき1行ずつ表示されます。</para>
<screen> | Host   | Host   |... NameServer  | NameServer  | IndexServer | IndexServer
 |        | Active |... Config Role | Actual Role | Config Role | Actual Role
 | ------ | ------ |... ----------- | ----------- | ----------- | -----------
 | suse01 | yes    |... master 1    | master      | worker      | master
 | suse03 | yes    |... master 2    | slave       | worker      | slave
 | suse05 | yes    |... master 3    | slave       | standby     | standby

 overall host status: ok</screen>
</example>
</listitem>
<listitem>
<para>該当サイトのインスタンスの概要を把握します（ユーザー&lt;sid&gt;admとして）。</para>
<example>
<title>インスタンスのリストを表示 </title>
<screen>sapcontrol -nr &lt;Inst&gt; -function GetSystemInstanceList</screen>
<para>該当サイトに属するSAP HANAインスタンスのリストが表示されます。</para>
<screen>12.06.2018 17:25:16
GetSystemInstanceList
OK
hostname, instanceNr, httpPort, httpsPort, startPriority, features, dispstatus
suse01, 00, 50013, 50014, 0.3, HDB|HDB_WORKER, GREEN
suse05, 00, 50013, 50014, 0.3, HDB|HDB_WORKER, GREEN
suse03, 00, 50013, 50014, 0.3, HDB|HDB_WORKER, GREEN</screen>
</example>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="SAPHanaHsr">
<title>SAP HANAシステムレプリケーションの設定</title>
<para>このセクションでは、SAP HANAが正しくインストールされた後のシステムレプリケーション（HSR）の設定について説明します。</para>
<para><emphasis role="strong">手順</emphasis></para>
<orderedlist numeration="arabic">
<listitem>
<para>プライマリデータベースをバックアップする</para>
</listitem>
<listitem>
<para>プライマリデータベースを有効化する</para>
</listitem>
<listitem>
<para>セカンダリデータベースを登録する</para>
</listitem>
<listitem>
<para>システムレプリケーションを検証する</para>
</listitem>
</orderedlist>
<figure>
<title><xref linkend="Planning"/> <xref linkend="OsSetup"/> <xref linkend="SAPHanaInst"/> SAPHanaHsr <xref linkend="Integration"/> <xref linkend="Cluster"/> <xref linkend="Testing"/></title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase4.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase4</phrase></textobject>
</mediaobject>
</figure>
<para>詳しくはSAP HANA Administration Guideのセクション「<emphasis>Setting Up System Replication</emphasis>」をご参照ください。</para>
<section xml:id="_back_up_the_primary_database">
<title>プライマリデータベースをバックアップする</title>
<para>初めに、<emphasis>SAP HANA Administration Guideのセクション「SAP HANA Database Backup and Recovery」</emphasis>の説明に従って、プライマリデータベースをバックアップしてください。</para>
<para>SQLコマンドを使用してSAP HANAをバックアップする例をご紹介します。</para>
<example>
<title>単一のバックアップ呼び出しを使用したシステムデータベースとすべてのテナントの単純なバックアップ </title>
<para>ユーザー&lt;sid&gt;admとして、次のコマンドを入力します。</para>
<screen>hdbsql -u SYSTEM -d SYSTEMDB \
   &quot;BACKUP DATA FOR FULL SYSTEM USING FILE ('backup')&quot;</screen>
<para>次のコマンド出力（または類似する出力）が得られます。</para>
<screen>0 rows affected (overall time 15.352069 sec; server time 15.347745 sec)</screen>
</example>
<example>
<title>シングルコンテナ（非MDC）データベースの単純なバックアップ</title>
<para>ユーザー&lt;sid&gt;admとして、次のコマンドを入力します。</para>
<screen>hdbsql -i &lt;Inst&gt; -u &lt;dbuser&gt; \
   &quot;BACKUP DATA USING FILE ('backup')&quot;</screen>
</example>
<important>
<para>有効なバックアップがないと、SAP HANAをシステムレプリケーション構成に移行<emphasis role="strong">できません</emphasis>。</para>
</important>
</section>
<section xml:id="_enable_primary_database">
<title>プライマリデータベースを有効化する</title>
<para>Linuxユーザー<emphasis>&lt;sid&gt;adm</emphasis>として、プライマリノードでシステムレプリケーションを有効化します。システムレプリケーションを通じて接続されるすべてのSAP HANAデータベースに対して一意である必要があるサイト名（<emphasis>WDF1</emphasis>など）を定義する必要があります。つまり、セカンダリは異なるサイト名を持つ必要があります。</para>
<example>
<title>プライマリサイトでシステムレプリケーションを有効化 </title>
<para>ユーザー&lt;sid&gt;admとして、次のようにプライマリを有効化します。</para>
<screen>hdbnsutil -sr_enable --name=HAP</screen>
<para>コマンド出力が以下のようになるか確認します。</para>
<screen>nameserver is active, proceeding ...
successfully enabled system as system replication source site
done.</screen>
</example>
<para>コマンドラインツール<emphasis>hdbnsutil</emphasis>を使用して、システムレプリケーションモードとサイト名をチェックできます。</para>
<example>
<title>プライマリでユーザー&lt;sid&gt;admとしてシステムレプリケーション構成状況をチェック </title>
<screen>hdbnsutil -sr_stateConfiguration</screen>
<para>プライマリでシステムレプリケーションの有効化に成功した場合、出力は以下のようになります。</para>
<screen>checking for active or inactive nameserver ...
System Replication State
~~~~~~~~~~~~~~~~~~~~~~~~

mode: primary
site id: 1
site name: HAP
done.</screen>
</example>
<para>モードは「none」から「primary」に変わります。サイトはサイト名とサイトIDを持つようになります。</para>
</section>
<section xml:id="_register_the_secondary_database">
<title>セカンダリデータベースを登録する</title>
<para>システムレプリケーションのためのシステム登録を行う前に、セカンダリ側のSAP HANAデータベースインスタンスを停止する必要があります。インスタンスを停止するために好みの方法を使用できます（<emphasis>HDB</emphasis>または<emphasis>sapcontrol</emphasis>など）。データベースインスタンスが正常に停止した後で、<emphasis>hdbnsutil</emphasis>を使用してインスタンスを登録できます。</para>
<example>
<title>Linuxユーザー<emphasis>&lt;sid&gt;adm</emphasis>としてセカンダリを停止</title>
<screen>sapcontrol -nr &lt;Inst&gt; -function StopSystem</screen>
</example>
<example>
<title>Linuxユーザー<emphasis>&lt;sid&gt;adm</emphasis>としてセカンダリを登録</title>
<screen>hdbnsutil -sr_register --name=&lt;site2&gt; \
     --remoteHost=&lt;node1-siteA&gt; --remoteInstance=&lt;Inst&gt; \
     --replicationMode=syncmem --operationMode=logreplay</screen>
<screen>adding site ...
checking for inactive nameserver ...
nameserver suse02:30001 not responding.
collecting information ...
updating local ini files ...
done.</screen>
</example>
<para><emphasis>remoteHost</emphasis>は今回のプライマリノードで、<emphasis>remoteInstance</emphasis>はデータベースインスタンス番号（ここでは00）です。</para>
<para>ここで、セカンダリデータベースインスタンスを再び起動し、システムレプリケーション状況を検証します。セカンダリサイトで、モードは「SYNC」、「SYNCMEM」、「ASYNC」のいずれかである必要があります。モードは、セカンダリの登録時に定義される同期オプションに依存します。</para>
<example>
<title>セカンダリサイトでユーザー&lt;sid&gt;admとしてシステムを起動 </title>
<screen>sapcontrol -nr &lt;Inst&gt; -function StartSystem</screen>
<para>SAP HANAデータベースが完全に起動するまで待機します。</para>
</example>
<example>
<title>ユーザー&lt;sid&gt;admとしてシステムレプリケーション構成をチェック </title>
<screen>hdbnsutil -sr_stateConfiguration</screen>
<para>出力は次のようになります。</para>
<screen>System Replication State
~~~~~~~~~~~~~~~~~~~~~~~~
mode: sync
site id: 2
site name: HAS
active primary site: 1

primary masters: suse01 suse03 suse05
done.</screen>
</example>
</section>
<section xml:id="_verify_the_system_replication">
<title>システムレプリケーションを検証する</title>
<para>SAP HANAクラスター全体のレプリケーション状態を表示するには、 プライマリサイトで、<emphasis>&lt;sid&gt;adm</emphasis>ユーザーとして次のコマンドを使用します。</para>
<example>
<title>プライマリサイトでシステムレプリケーション状況をチェック（&lt;sid&gt;admとして）</title>
<screen>HDBSettings.sh systemReplicationStatus.py</screen>
<para>このスクリプトは、システムレプリケーションのチャネルとそれぞれのステータスを人間が読み取れる表形式で出力します。最も興味深い列は<emphasis role="strong">Replication Status</emphasis>で、<emphasis role="strong">ACTIVE</emphasis>になっている必要があります。</para>
<screen>| Database | Host   | .. Site Name | Secondary | .. Secondary | .. <emphasis role="strong">Replication</emphasis>
|          |        | ..           | Host      | .. Site Name | .. <emphasis role="strong">Status</emphasis>
| -------- | ------ | .. --------- | --------- | .. --------- | .. ------
| SYSTEMDB | suse01 | .. HAP      | suse02    | .. HAS      | .. <emphasis role="strong">ACTIVE</emphasis>
| HA1      | suse01 | .. HAP      | suse02    | .. HAS      | .. <emphasis role="strong">ACTIVE</emphasis>
| HA1      | suse01 | .. HAP      | suse02    | .. HAS      | .. <emphasis role="strong">ACTIVE</emphasis>
| HA1      | suse03 | .. HAP      | suse04    | .. HAS      | .. <emphasis role="strong">ACTIVE</emphasis>

status system replication site &quot;2&quot;: ACTIVE
overall system replication status: ACTIVE

Local System Replication State
<subscript>~</subscript><subscript>~</subscript><subscript>~</subscript><subscript>~</subscript><subscript>~</subscript><subscript>~</subscript><subscript>~</subscript><subscript>~</subscript><subscript>~</subscript><subscript>~</subscript>

mode: PRIMARY
site id: 1
site name: HAP</screen>
</example>
</section>
</section>
<section xml:id="Integration">
<title>SAP HANAとクラスターの統合</title>
<figure>
<title><xref linkend="Planning"/> <xref linkend="OsSetup"/> <xref linkend="SAPHanaInst"/> <xref linkend="SAPHanaHsr"/> 統合 <xref linkend="Cluster"/> <xref linkend="Testing"/></title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase5.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase5</phrase></textobject>
</mediaobject>
</figure>
<para>次のステップを進める必要があります。</para>
<para><emphasis role="strong">手順</emphasis></para>
<orderedlist numeration="arabic">
<listitem>
<para>PythonフックSAPHanaSRを実装する</para>
</listitem>
<listitem>
<para>システムレプリケーション動作モードを構成する</para>
</listitem>
<listitem>
<para>&lt;sid&gt;admがクラスターにアクセスできるようにする</para>
</listitem>
<listitem>
<para>SAP HANAを起動する</para>
</listitem>
<listitem>
<para>フック統合をテストする</para>
</listitem>
</orderedlist>
<section xml:id="_implement_the_python_hook_saphanasr">
<title>PythonフックSAPHanaSRを実装する</title>
<para>SUSEのSAPHanaSR-ScaleOutリソースエージェントには、SAP HANAレプリケーションの障害を処理し、同期していないSAP HANAノードへのクラスターフェイルオーバーを防いでデータ損失を避けるためのSAP HANA統合スクリプトが含まれています。</para>
<para>この統合スクリプトは、SAP HANAの「srConnectionChanged」フックを監視します。いずれかの複製サービスでシステムレプリケーション接続の損失またか確立が発生し、クラスターに通知されると、マスターネームサーバーでsrConnectionChanged()メソッドが呼び出されます。</para>
<para>このステップは両方のサイトで完了する必要があります。global.iniを変更して、SAP HANAが起動時にHA/DRフックスクリプトを統合可能にするには、SAP HANAを停止する必要があります。</para>
<itemizedlist>
<listitem>
<para>HA/DRフックスクリプトを読み取り/書き込み可能なディレクトリにインストールする</para>
</listitem>
<listitem>
<para>フックをglobal.iniに統合する（オフラインで行うためにSAP HANAを停止する必要がある）</para>
</listitem>
<listitem>
<para>起動時にフックの統合をチェックする</para>
</listitem>
</itemizedlist>
<para>SAPHanaSR-scaleOutパッケージからフックを取得し、/hana/share/myHooksなど、任意のディレクトリにコピーします。フックはすべてのSAP HANAノードで使用可能である必要があります。</para>
<screen>suse01~ # mkdir -p /hana/shared/myHooks
suse01~ # cp /usr/share/SAPHanaSR-ScaleOut/SAPHanaSR.py /hana/shared/myHooks
suse01~ # chown -R &lt;sid&gt;adm:sapsys /hana/shared/myHooks</screen>
<para>SAP HANAを停止</para>
<screen>sapcontrol -nr &lt;Inst&gt; -function StopSystem</screen>
<example>
<title>global.iniによりSAPHanaSRを追加 </title>
<screen>[ha_dr_provider_SAPHanaSR]
provider = SAPHanaSR
path = /hana/shared/myHooks
execution_order = 1

[trace]
ha_dr_saphanasr = info</screen>
</example>
</section>
<section xml:id="_configure_system_replication_operation_mode">
<title>システムレプリケーション動作モードを構成する</title>
<para>使用するシステムがSAPHanaSRターゲットとして接続されると、<emphasis>global.ini</emphasis>に動作モードを定義するエントリが見つかります。現時点では2つのモードを使用できます。</para>
<itemizedlist>
<listitem>
<para><emphasis>delta_datashipping</emphasis></para>
</listitem>
<listitem>
<para><emphasis>logreplay</emphasis></para>
</listitem>
</itemizedlist>
<para>テイクオーバーと逆方向の再登録が発生するまで、プライマリサイトでの動作モードのエントリは存在しません。「古典的な」動作モードはdelta_datashippingです。HAで推奨されるモードは<emphasis>logreplay</emphasis>です。logreplay動作モードを使用すると、SAP HANAシステムレプリケーションのセカンダリサイトがHotStandbyシステムになります。両方のモードについて詳しくは、「How To Perform System Replication for SAP HANA」など、入手可能なSAPドキュメントをご参照ください。</para>
<para>両方の<emphasis>global.ini</emphasis>ファイルをチェックし、必要に応じて動作モードを追加します。</para>
<variablelist>
<varlistentry>
<term>セクション</term>
<listitem>
<para>[ system_replication ]</para>
</listitem>
</varlistentry>
<varlistentry>
<term>キー</term>
<listitem>
<para>operation_mode = logreplay</para>
</listitem>
</varlistentry>
</variablelist>
<para><emphasis>global.ini</emphasis>のパス: /hana/shared/&lt;SID&gt;/global/hdb/custom/config/</para>
<screen>[system_replication]
operation_mode = logreplay</screen>
</section>
<section xml:id="_allow_sidadm_to_access_the_cluster">
<title>&lt;sid&gt;admがクラスターにアクセスできるようにする</title>
<para>SAPHanaSR Pythonフックの現行バージョンは、「sudo」コマンドを使用して、&lt;sid&gt;admがクラスター属性にアクセスできるようにします。Linuxでは、「visudo」を使用して、「/etc/sudoers」構成ファイル用にviエディタを起動できます。</para>
<para>ユーザー&lt;sid&gt;admは、クラスター属性hana_&lt;sid&gt;_glob_srHook_*を設定できる必要があります。SAP HANAシステムレプリケーションフックには、パスワード不要のアクセスが必要です。次の例では、sudoアクセスを必要な属性の設定のみに制限しています。</para>
<para>&lt;sid&gt;を<emphasis role="strong">小文字</emphasis>のSAPシステムIDに置き換えます。</para>
<para>この変更はすべてのクラスターノードで必要です。</para>
<example>
<title>sudo権限/etc/sudoersファイルのエントリ</title>
<para>&lt;sidadm&gt;がsrHookを使用可能にするための基本的なパラメータオプション。</para>
<screen># SAPHanaSR-ScaleOut needs for srHook
&lt;sid&gt;adm ALL=(ALL) NOPASSWD: /usr/sbin/crm_attribute -n hana_&lt;sid&gt;_glob_srHook -v *</screen>
<para>高いセキュリティレベルを満たすためのより特殊なパラメータオプション。</para>
<screen># SAPHanaSR-ScaleOut needs for srHook
Cmnd_Alias SOK   = /usr/sbin/crm_attribute -n hana_&lt;sid&gt;_glob_srHook -v SOK   -t crm_config -s SAPHanaSR
Cmnd_Alias SFAIL = /usr/sbin/crm_attribute -n hana_&lt;sid&gt;_glob_srHook -v SFAIL -t crm_config -s SAPHanaSR
&lt;sid&gt;adm ALL=(ALL) NOPASSWD: SOK, SFAIL</screen>
</example>
<example>
<title>&lt;sid&gt;をha1で置き換えた結果</title>
<screen># SAPHanaSR-ScaleOut needs for srHook
hd1adm ALL=(ALL) NOPASSWD: /usr/sbin/crm_attribute -n hana_ha1_glob_srHook -v *</screen>
</example>
</section>
<section xml:id="_start_sap_hana">
<title>SAP HANAを起動する</title>
<para>SAP HANA統合の構成が完了し、SAP HANA間の通信が確立したら、クラスターが両サイトでSAP HANAデータベースを起動できるようになります。</para>
<example>
<title>&lt;sid&gt;admとして完全なSAP HANAサイトを起動</title>
<screen>sapcontrol -nr &lt;Inst&gt; -function StartSystem</screen>
<para>sapcontrolサービスはOKで要求をコミットします。</para>
<screen>11.06.2018 18:30:16
StartSystem
OK</screen>
<para>次のように、SAP HANAの起動完了をチェックします。</para>
<screen>sapcontrol -nr &lt;Inst&gt; -function WaitforStarted 300 20</screen>
</example>
</section>
<section xml:id="_test_the_hook_integration">
<title>フック統合をテストする</title>
<para>変更後にSAP HANAデータベースが再起動したら、フックスクリプトが正しく呼び出されることをチェックします。</para>
<para>次のように、&lt;sid&gt;admとして、SAP HANAトレースファイルをチェックします。</para>
<screen>suse01:ha1adm&gt; cdtrace
suse01:ha1adm&gt; awk  '/ha_dr_SAPHanaSR.*crm_attribute/ \
     { printf &quot;%s %s %s %s\n&quot;,$2,$3,$5,$16 }' nameserver_suse01.*
2018-05-04 12:34:04.476445 ha_dr_SAPHanaSR SFAIL
2018-05-04 12:53:06.316973 ha_dr_SAPHanaSR SOK</screen>
<para>「ha_dr_SAPHanaSR」メッセージが表示される場合、フックスクリプトは呼び出され、実行されています。</para>
</section>
</section>
<section xml:id="Cluster">
<title>クラスターとSAP HANAリソースの構成</title>
<para>この章では、SUSE Linux Enterprise High Availability（SLE HA）クラスターの構成について説明します。SUSE Linux Enterprise High Availabilityは、SUSE Linux Enterprise Server for SAP Applicationsの一部です。さらに、SUSE Linux Enterprise High AvailabilityクラスターによるSAP HANAシステムレプリケーションの統合について説明します。この統合は、同様にSUSE Linux Enterprise Server for SAP Applicationsの一部である、SAPHanaSR-ScaleOutパッケージを使用して行われます。</para>
<figure>
<title><xref linkend="Planning"/> <xref linkend="OsSetup"/> <xref linkend="SAPHanaInst"/> <xref linkend="SAPHanaHsr"/> <xref linkend="Integration"/> クラスター <xref linkend="Testing"/></title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase6.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase6</phrase></textobject>
</mediaobject>
</figure>
<para><emphasis role="strong">手順</emphasis></para>
<orderedlist numeration="arabic">
<listitem>
<para>基本的なクラスター構成</para>
</listitem>
<listitem>
<para>クラスタープロパティおよびリソースの構成</para>
</listitem>
<listitem>
<para>最終ステップ</para>
</listitem>
</orderedlist>
<section xml:id="_basic_cluster_configuration">
<title>基本的なクラスター構成</title>
<section xml:id="_set_up_watchdog_for_sbd_fencing">
<title>SBDフェンシング用のウォッチドッグの設定</title>
<para>すべてのインスタンスは、SUSEのディスクレスSBDフェンシングメカニズムを使用します。この方式では、SBDがAWS API呼び出しを発行しないので、追加のAWS権限は必要ありません。その代わりに、SBDは（ハードウェア/ソフトウェア）ウォッチドッグタイマーを利用します。</para>
<para>ほとんどのAWSベアメタルインスタンスはハードウェアウォッチドッグを備えており、こうしたインスタンスではハードウェアウォッチドッグを使用するために追加の操作はなく、非ベアメタルインスタンスはソフトウェアウォッチドッグを使用します。</para>
<para>SBDが使用される場合は常に、正しく動作するウォッチドッグが非常に重要です。最近のシステムは、ソフトウェアコンポーネントによる「くすぐり」、つまり「入力」が必要なウォッチドッグをサポートしています。ソフトウェアコンポーネント（通常はデーモン）が定期的にサービスパルスをウォッチドッグに書き込みます。デーモンがウォッチドッグへの入力を停止した場合、ハードウェアがシステム再起動を強制します。これにより、SBDプロセス自体の障害（停止など）またはI/Oエラーによる動作不能から保護されます。</para>
<para>適切なウォッチドッグモジュールを特定します。使用するカーネルバージョンとともにインストールされているドライバのリストを確認することもできます。</para>
<screen>ls -l /lib/modules/$(uname -r)/kernel/drivers/watchdog</screen>
<para>ウォッチドッグモジュールが既にロード済みかどうかをチェックします。</para>
<screen>lsmod | egrep &quot;(wd|dog|i6|iT)&quot;</screen>
<para>結果が表示される場合、システムにはロード済みのウォッチドッグが存在します。</para>
<para>ウォッチドッグを使用しているソフトウェアがあるかどうかをチェックします。</para>
<screen>lsof /dev/watchdog</screen>
<para>使用可能なウォッチドッグがない場合（仮想化されたEC2インスタンス上）、<emphasis>softdog</emphasis>を有効化できます。</para>
<para>再起動した後も永続的にsoftdogを有効化するには、クラスターの一部になる<emphasis role="strong">すべての</emphasis>EC2インスタンスで（マジョリティメーカーノードを含む）、次のステップを実行します。</para>
<screen>echo softdog &gt; /etc/modules-load.d/watchdog.conf
systemctl restart systemd-modules-load</screen>
<para>これにより、システムブート時に、ソフトウェアウォッチドッグカーネルモジュールもロードされます。</para>
<para>ウォッチドッグモジュールが正しくロードされているかチェックします。</para>
<screen>lsmod | grep dog</screen>
<para>ウォッチドッグのテストは、簡単な操作で実行できます。ウォッチドッグはシステムのクリーンでないリセットまたはシャットダウンを強制するので、始めにSAP HANAをオフにするよう注意してください。</para>
<para>ハードウェアウォッチドッグの場合、ウォッチドッグのタイムアウトに到達した後の適切な動作があらかじめ定義されています。ウォッチドッグモジュールがロードされており、他のアプリケーションによって制御されていない場合、下記のコマンドを実行します。</para>
<important>
<para>ウォッチドッグへの継続的な入力が無いまま、ウォッチドッグをトリガすると、システムのリセットまたはシャットダウンが発生します。これは意図されたメカニズムです。次のコマンドは、システムのリセットまたは電源オフを強制します。</para>
</important>
<screen>touch /dev/watchdog</screen>
<para>softdogモジュールが使用される場合は、以下を実行できます。</para>
<screen>echo 1&gt; /dev/watchdog</screen>
<para>テストが正常終了したら、<emphasis role="strong">すべての</emphasis>クラスターメンバーにウォッチドッグを実装できます。下記の例はsoftdogモジュールに適用されます。</para>
<screen>for i in suse{02,03,04,05,06,-mm}; do
 ssh -T $i &lt;&lt;EOSSH
 hostname
 echo softdog &gt; /etc/modules-load.d/watchdog.conf
 systemctl restart systemd-modules-load
 lsmod |grep -e dog
EOSSH
done</screen>
<para>すべてのクラスターノードが/dev/watchdogにあるハードウェア/ソフトウェアウォッチドッグデバイスにアクセスできたら、<emphasis role="strong">すべての</emphasis>クラスターノードの/etc/sysconfig/sbdで、次に示すSBD構成の属性をチェックします。</para>
<screen>#SBD_DEVICE=&quot;&quot;
SBD_PACEMAKER=yes
SBD_STARTMODE=always
SBD_DELAY_START=no
SBD_WATCHDOG_DEV=/dev/watchdog
SBD_WATCHDOG_TIMEOUT=5
SBD_TIMEOUT_ACTION=flush,reboot
SBD_OPTS=</screen>
<para>ここで、すべてのクラスターノードでディスクレスSBDを有効化します。</para>
<screen>systemctl enable sbd</screen>
</section>
<section xml:id="_initial_cluster_setup">
<title>クラスターの初期設定</title>
<para>AWS VPCはマルチキャストトラフィックをサポートしないため、Corosync通信にはユニキャストUDPが必要です。最初のクラスターノードで、次のようにクラスター通信用の暗号化キーを作成します。</para>
<screen>corosync-keygen</screen>
<para>上記のコマンドはファイル<emphasis>/etc/corosync/authkey</emphasis>を生成します。次に示すように、UNIXファイル所有者および権限を変更せず、このキーを<emphasis role="strong">すべての</emphasis>ノードにコピーします。</para>
<screen>ls -l /etc/corosync/authkey
-r-------- 1 root root 128 Feb  5 19:47 /etc/corosync/authkey</screen>
<para>暗号化キーの配布が済んだら、クラスタータイミング、トランスポートプロトコル、および暗号化のパラメータを使用して、初期の<emphasis>/etc/corosync/corosync.conf</emphasis>構成を作成します。使用するネットワークトポロジに従って、ノードリスト中のすべてのクラスターノードの<emphasis>bindnetaddr</emphasis>および<emphasis>ring0_addr</emphasis>（IPv4アドレス）を交換します。</para>
<para>corosync.confファイルの例:</para>
<screen># Read the corosync.conf.5 manual page
totem {
   version: 2
   token: 30000
   consensus: 32000
   token_retransmits_before_loss_const: 6
   secauth: on
   crypto_hash: sha1
   crypto_cipher: aes256
   clear_node_high_bit: yes
   interface {
      ringnumber: 0
      bindnetaddr: &lt;&lt;local-node-ip-address&gt;&gt;
      mcastport: 5405
      ttl: 1
   }
   transport: udpu
}
logging {
   fileline: off
   to_logfile: yes
   to_syslog: yes
   logfile: /var/log/cluster/corosync.log
   debug: off
   timestamp: on
   logger_subsys {
      subsys: QUORUM
      debug: off
   }
}
nodelist {
   node {
      ring0_addr: &lt;&lt;ip-node01-AZ-a&gt;&gt;
      nodeid: 1
   }
   node {
      ring0_addr: &lt;&lt;ip-node02-AZ-a&gt;&gt;
      nodeid: 2
   }
   node {
      ring0_addr: &lt;&lt;ip-node03-AZ-a&gt;&gt;
      nodeid: 3
   }
   node {
      ring0_addr: &lt;&lt;ip-node01-AZ-b&gt;&gt;
      nodeid: 4
   }
   node {
      ring0_addr: &lt;&lt;ip-node02-AZ-b&gt;&gt;
      nodeid: 5
   }
   node {
      ring0_addr: &lt;&lt;ip-node03-AZ-b&gt;&gt;
      nodeid: 6
   }
   node {
      ring0_addr: &lt;&lt;ip-majority-maker-node&gt;&gt;
      nodeid: 7
   }
}
quorum {
# Enable and configure quorum subsystem (default: off)
# see also corosync.conf.5 and votequorum.5
   provider: corosync_votequorum
}</screen>
<para>構成を/etc/corosync/corosync.confの<emphasis role="strong">すべての</emphasis>ノードに配布</para>
</section>
<section xml:id="_start_the_cluster">
<title>クラスターを起動する</title>
<para>すべてのノードでクラスターを起動</para>
<screen>systemctl start pacemaker</screen>
<note>
<para>すべてのノードは並行して起動する必要があります。そうしないと、確認されないノードがフェンシングされる場合があります。</para>
</note>
<para><emphasis>crm_mon</emphasis>を使用して、クラスターステータスをチェックします。ここではオプション「-r」を使用して、構成済みではあるが停止していないリソースも確認します。</para>
<screen>crm_mon -r</screen>
<para>このコマンドは「空の」クラスターを表示し、次の画面出力のようになります。ここで最も興味深い情報は、ステータスが「online」で「partition with quorum」というメッセージのノードが2つあることです。</para>
<screen>Stack: corosync
Current DC: suse05 (version 1.1.18+20180430.b12c320f5-3.15.1-b12c320f5) - partition with quorum
Last updated: Fri Nov 29 14:23:19 2019
Last change: Fri Nov 29 12:31:06 2019 by hacluster via crmd on suse03

7 nodes configured
0 resource configured

Online: [ suse-mm suse01 suse02 suse03 suse04 suse05 suse06 ]

No resources</screen>
</section>
</section>
<section xml:id="_configure_cluster_properties_and_resources">
<title>クラスタープロパティおよびリソースの構成</title>
<para>このセクションでは、<emphasis>crm</emphasis>構成シェルコマンドを使用して、クラスターリソース、STONITH、および制約を構成する方法について説明します。このことは、SUSE Linux Enterprise High Availability Administration Guideのセクション<emphasis>Configuring and Managing Cluster Resources</emphasis>（コマンドライン）、SUSE Linux Enterprise High Availability（<link xl:href="https://www.suse.com/documentation/sle-ha-12/singlehtml/book_sleha/book_sleha.html#cha.ha.manual_config"><link xl:href="https://www.suse.com/documentation/sle-ha-12/singlehtml/book_sleha/book_sleha.html#cha.ha.manual_config">https://www.suse.com/documentation/sle-ha-12/singlehtml/book_sleha/book_sleha.html#cha.ha.manual_config</link></link>）にも詳しい説明があります。</para>
<para>コマンド<emphasis>crm</emphasis>を使用して、オブジェクトをCluster Resource Management（CRM）に追加します。以下の例をローカルファイルにコピーした後、構成をCluster Information Base（CIB）にロードします。ここで便利なのは、設定がスクリプト化され、構成のバックアップが得られることです。</para>
<para>すべての<emphasis>crm</emphasis>コマンドをただ<emphasis role="strong">1つの</emphasis>ノード（たとえばマシンsuse01）で実行します。</para>
<para>初めに構成を含むテキストファイルを作成して、2番目のステップでクラスターにロードします。このステップは次のとおりです。</para>
<screen>vi crm-file&lt;XX&gt;
crm configure load update crm-file&lt;XX&gt;</screen>
<section xml:id="_cluster_bootstrap_and_more">
<title>クラスターブートストラップなど </title>
<para>最初の例は、リソースと動作のデフォルトを含むクラスターブートストラップオプションを定義します。</para>
<para>stonith-timeoutは、SBD msgwaitタイムアウトの1.2倍よりも大きくする必要があります。</para>
<screen>vi crm-bs.txt</screen>
<para>以下をcrm-bs.txtに入力</para>
<screen>property $id=&quot;cib-bootstrap-options&quot; \
            no-quorum-policy=&quot;freeze&quot; \
            stonith-enabled=&quot;true&quot; \
            stonith-action=&quot;reboot&quot; \
            stonith-watchdog-timeout=&quot;10&quot; \

op_defaults $id=&quot;op-options&quot; \
            timeout=&quot;600&quot;

rsc_defaults rsc-options: \
            resource-stickiness=&quot;1000&quot; \
            migration-threshold=&quot;5&quot;</screen>
<para>構成をクラスターに追加します。</para>
<screen>crm configure load update crm-bs.txt</screen>
</section>
<section xml:id="_stonith">
<title>STONITH</title>
<para>本ドキュメントの要件セクションで説明したように、サポートされるクラスター設定にSTONITHは非常に重要です。有効なフェンシングメカニズムがない場合、クラスターはサポート対象外になります。</para>
<para>標準のSTONITHメカニズムとして、ディスクレスSBDフェンシングが実装されます。SBD STONITH手法は安定性と信頼性が非常に高く、非常に優れたロード機能であることが実証されています。</para>
<para>利用可能な他のフェンシング方式を使用することができます。ただし、あらゆる状況下でサーバーフェンシングを徹底的にテストすることが不可欠です。</para>
<para>ディスクレスSBDが構成済みで有効化されている場合、クラスターとともにSBDデーモンが自動的に起動します。これは以下のように確認できます。</para>
<screen># systemctl status sbd
● sbd.service - Shared-storage based fencing daemon
   Loaded: loaded (/usr/lib/systemd/system/sbd.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2019-02-15 08:12:57 UTC; 1 months 22 days ago
     Docs: man:sbd(8)
  Process: 10366 ExecStart=/usr/sbin/sbd $SBD_OPTS -p /var/run/sbd.pid watch (code=exited, status=0/SUCCESS)
 Main PID: 10374 (sbd)
    Tasks: 3 (limit: 4915)
   CGroup: /system.slice/sbd.service
           ├─10374 sbd: inquisitor
           ├─10375 sbd: watcher: Pacemaker
           └─10376 sbd: watcher: Cluster</screen>
</section>
<section xml:id="_cluster_in_maintenance_mode">
<title>メンテナンスモードのクラスター</title>
<para>リソースと制約の構成をステップバイステップでクラスターにロードします。予期しないクラスター反応を避けるための最適な方法は、初めに完全なクラスターをメンテナンスモードに設定することです。次に、必要なすべての変更を行った後、最後のステップとして、クラスターをメンテナンスモードから解除できます。</para>
<screen>crm configure property maintenance-mode=true</screen>
</section>
<section xml:id="_saphanatopology">
<title>SAPHanaTopology</title>
<para>次に、SAP HANAインスタンスを起動する前に、必要なリソースのグループを定義します。変更内容をテキストファイル（たとえば<emphasis>crm-saphanatop.txt</emphasis>など）に準備し、<emphasis>crm</emphasis>コマンドを使用してロードします。</para>
<para><emphasis role="strong">SID</emphasis>と<emphasis role="strong">インスタンス番号</emphasis>（太字）を実際の値に変更する必要があります。</para>
<example>
<title>SAPHanaTopologyの構成</title>
<screen>suse01:~ # vi crm-saphanatop.txt</screen>
<para>以下をcrm-saphanatop.txtに入力</para>
<screen>primitive rsc_SAPHanaTop_&lt;SID&gt;_HDB&lt;Inst&gt; ocf:suse:SAPHanaTopology \
        op monitor interval=&quot;10&quot; timeout=&quot;600&quot; \
        op start interval=&quot;0&quot; timeout=&quot;600&quot; \
        op stop interval=&quot;0&quot; timeout=&quot;300&quot; \
        params SID=&quot;<emphasis role="strong">&lt;SID&gt;</emphasis>&quot; InstanceNumber=&quot;<emphasis role="strong">&lt;Inst&gt;</emphasis>&quot;

clone cln_SAPHanaTop_&lt;SID&gt;_HDB&lt;Inst&gt; rsc_SAPHanaTop_&lt;SID&gt;_HDB&lt;Inst&gt; \
        meta clone-node-max=&quot;1&quot; interleave=&quot;true&quot;</screen>
<screen>primitive rsc_SAPHanaTop_<emphasis role="strong">HA1</emphasis>_HDB<emphasis role="strong">00</emphasis> ocf:suse:SAPHanaTopology \
        op monitor interval=&quot;10&quot; timeout=&quot;600&quot; \
        op start interval=&quot;0&quot; timeout=&quot;600&quot; \
        op stop interval=&quot;0&quot; timeout=&quot;300&quot; \
        params SID=&quot;<emphasis role="strong">HA1</emphasis>&quot; InstanceNumber=&quot;<emphasis role="strong">00</emphasis>&quot;

clone cln_SAPHanaTop_<emphasis role="strong">HA1</emphasis>_HDB<emphasis role="strong">00</emphasis> rsc_SAPHanaTop_<emphasis role="strong">HA1</emphasis>_HDB<emphasis role="strong">00</emphasis> \
        meta clone-node-max=&quot;1&quot; interleave=&quot;true&quot;</screen>
<para>すべてのパラメータに関する追加情報は、コマンド
<emphasis>man ocf_suse_SAPHanaTopology</emphasis>を使用して確認できます。</para>
<para>再度、構成をクラスターに追加します。</para>
<screen>crm configure load update crm-saphanatop.txt</screen>
</example>
<para>ここで最も重要なパラメータは、<emphasis>SID</emphasis>（HA1）と<emphasis>InstanceNumber</emphasis>（00）であり、SAPのコンテキストでは自明です。</para>
<para>これらのパラメータのほかに、タイムアウト値または動作（start、monitor、stop）が実際の環境に合わせる必要がある代表的な値です。</para>
</section>
<section xml:id="_saphanacontroller">
<title>SAPHanaController</title>
<para>次に、SAP HANAインスタンスを起動する前に、必要なリソースのグループを定義します。変更内容をテキストファイル（たとえば<emphasis>crm-saphanacon.txt</emphasis>など）で編集し、<emphasis>crm</emphasis>コマンドを使用してロードします。</para>
<screen>vi crm-saphanacon.txt</screen>
<example>
<title>SAPHanaControllerの構成</title>
<para>以下をcrm-saphanacon.txtに入力</para>
<screen>primitive rsc_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt; ocf:suse:SAPHanaController \
        op start interval=&quot;0&quot; timeout=&quot;3600&quot; \
        op stop interval=&quot;0&quot; timeout=&quot;3600&quot; \
        op promote interval=&quot;0&quot; timeout=&quot;3600&quot; \
        op monitor interval=&quot;60&quot; role=&quot;Master&quot; timeout=&quot;700&quot; \
        op monitor interval=&quot;61&quot; role=&quot;Slave&quot; timeout=&quot;700&quot; \
        params SID=&quot;&lt;SID&gt;&quot; InstanceNumber=&quot;&lt;Inst&gt;&quot; \
        PREFER_SITE_TAKEOVER=&quot;true&quot; \
        DUPLICATE_PRIMARY_TIMEOUT=&quot;7200&quot; AUTOMATED_REGISTER=&quot;false&quot;

ms msl_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt; rsc_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt; \
        meta clone-node-max=&quot;1&quot; master-max=&quot;1&quot; interleave=&quot;true&quot;</screen>
<para>ここで最も重要なパラメータは、SID（HA1）と&lt;Inst&gt;（00）であり、SAPのコンテキストでは自明です。これらのパラメータのほかに、タイムアウト値または動作（start、monitor、stop）が代表的な調整可能値です。</para>
<screen>primitive rsc_SAPHanaCon_<emphasis role="strong">HA1</emphasis>_HDB<emphasis role="strong">00</emphasis> ocf:suse:SAPHanaController \
        op start interval=&quot;0&quot; timeout=&quot;3600&quot; \
        op stop interval=&quot;0&quot; timeout=&quot;3600&quot; \
        op promote interval=&quot;0&quot; timeout=&quot;3600&quot; \
        op monitor interval=&quot;60&quot; role=&quot;Master&quot; timeout=&quot;700&quot; \
        op monitor interval=&quot;61&quot; role=&quot;Slave&quot; timeout=&quot;700&quot; \
        params SID=&quot;<emphasis role="strong">HA1</emphasis>&quot; InstanceNumber=&quot;<emphasis role="strong">00</emphasis>&quot; PREFER_SITE_TAKEOVER=&quot;true&quot; \
        DUPLICATE_PRIMARY_TIMEOUT=&quot;7200&quot; AUTOMATED_REGISTER=&quot;false&quot;

ms msl_SAPHanaCon_HA1_HDB00 rsc_SAPHanaCon_HA1_HDB00 \
        meta clone-node-max=&quot;1&quot; master-max=&quot;1&quot; interleave=&quot;true&quot;</screen>
<para>構成をクラスターに追加します。</para>
<screen>crm configure load update crm-saphanacon.txt</screen>
</example>
<table frame="all" rowsep="1" colsep="1">
<title>重要なリソースエージェントパラメータの説明表 </title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="66.6667*"/>
<thead>
<row>
<entry align="left" valign="top">名前</entry>
<entry align="left" valign="top">説明</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para>PREFER_SITE_TAKEOVER</para></entry>
<entry align="left" valign="top"><para>RAで障害発生プライマリをローカルで再起動するよりもセカンダリインスタンスへのテイクオーバーが優先されるかどうかを定義します。</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>AUTOMATED_REGISTER</para></entry>
<entry align="left" valign="top"><para>元のプライマリが新しいプライマリのセカンダリに自動登録される必要があるかどうかを定義します。このパラメータにより、システムレプリケーション自動化のレベルを適応できます。</para><para>falseに設定されている場合、元のプライマリは手動で登録する必要があります。プライマリが二重に稼動する状況を回避するために、登録が済むまで、クラスターはこのSAP HANA RDBMSを起動しません。</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>DUPLICATE_PRIMARY_TIMEOUT</para></entry>
<entry align="left" valign="top"><para>二重プライマリ状況が発生した場合に、2つのプライマリタイムスタンプ間に必要な時差。この時差が時間のギャップよりも小さい場合、クラスターは一方または両方のサイトを「WAITING」ステータスで保留します。これにより、管理者はフェールオーバーに対処する機会が得られます。元のプライマリのノードが完全にクラッシュした場合、この時差が経過した後で元のプライマリが登録されます。SAP HANA RDBMS「のみ」がクラッシュした場合、元のプライマリはすぐに登録されます。この新しいプライマリへの登録後、システムレプリケーションによってすべてのデータが上書きされます。</para></entry>
</row>
</tbody>
</tgroup>
</table>
<para>すべてのパラメータに関する追加情報は、コマンド
man ocf_suse_SAPHanaControllerを使用して確認できます。</para>
</section>
<section xml:id="_overlay_ip_address">
<title>オーバーレイIPアドレス</title>
<para>クラスターに追加する最後のリソースは、オーバーレイIPアドレスを扱います。太字を実際のインスタンス番号、SAP HANAシステムID、AWS VPCルーティングテーブル、およびオーバーレイIPアドレスで置き換えます。</para>
<example>
<title>IPアドレスの構成 </title>
<screen>vi crm-oip.txt</screen>
<para>以下をcrm-oip.txtに入力</para>
<screen>primitive rsc_ip_&lt;SID&gt;_HDB&lt;Inst&gt; ocf:heartbeat:aws-vpc-move-ip \
        op start interval=0 timeout=180 \
        op stop interval=0 timeout=180 \
        op monitor interval=60 timeout=60 \
        params ip=&lt;overlayIP&gt; routing_table=&lt;aws-route-table&gt;[,&lt;2nd-route-table&gt;] \
        interface=eth0 profile=&lt;aws-cli-profile&gt;</screen>
<para>ファイルをクラスターにロードします。</para>
<screen>crm configure load update crm-oip.txt</screen>
</example>
<para>オーバーレイIPアドレスは、VPCのCIDR範囲の外部にある必要があります。</para>
</section>
<section xml:id="_constraints">
<title>制約</title>
<para>制約は、クライアントデータベースアクセスのための仮想IPアドレスの正しい配置と2つのリソースエージェント<emphasis>SAPHana</emphasis>および<emphasis>SAPHanaTopology</emphasis>間の起動順序を整理します。ルールは、<emphasis>crm_mon</emphasis>コマンドからのフォールスポジティブメッセージを除去するのに役立ちます。</para>
<example>
<title>必要な制約の構成 </title>
<screen>vi crm-cs.txt</screen>
<para>以下をcrm-cs.txtに入力</para>
<screen>colocation col_saphana_ip_&lt;SID&gt;_HDB&lt;Inst&gt; 2000: rsc_ip_&lt;SID&gt;_HDB&lt;Inst&gt;:Started \
 msl_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt;:Master
order ord_SAPHana_&lt;SID&gt;_HDB&lt;Inst&gt; Optional: cln_SAPHanaTop_&lt;SID&gt;_HDB&lt;Inst&gt; \
 msl_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt;
location OIP_not_on_majority_maker rsc_ip_&lt;SID&gt;_HDB&lt;Inst&gt; -inf: &lt;majority maker&gt;
location SAPHanaCon_not_on_majority_maker msl_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt; -inf:
 &lt;majority maker&gt;
location SAPHanaTop_not_on_majority_maker cln_SAPHanaTop_&lt;SID&gt;_HDB&lt;Inst&gt; -inf:
 &lt;majority maker&gt;</screen>
<para>「&lt;SID&gt;」をSAP SIDで、「&lt;Inst&gt;」をSAP HANAインスタンス番号で、「&lt;majority maker&gt;」をマジョリティメーカーノードのホスト名でそれぞれ置き換えます。</para>
<screen>colocation col_saphana_ip_HA1_HDB00 2000: rsc_ip_HA1_HDB00:Started \
 msl_SAPHanaCon_HA1_HDB00:Master
order ord_SAPHana_HA1_HDB00 Optional: cln_SAPHanaTop_HA1_HDB00 \
 msl_SAPHanaCon_HA1_HDB00
location OIP_not_on_majority_maker rsc_ip_HA1_HDB00 -inf: suse-mm
location SAPHanaCon_not_on_majority_maker msl_SAPHanaCon_HA1_HDB00 -inf: suse-mm
location SAPHanaTop_not_on_majority_maker cln_SAPHanaTop_HA1_HDB00 -inf: suse-mm</screen>
<para>ファイルをクラスターにロードします。</para>
<screen>crm configure load update crm-cs.txt</screen>
</example>
</section>
</section>
<section xml:id="_final_steps">
<title>最終ステップ</title>
<section xml:id="_end_the_cluster_maintenance_mode">
<title>クラスターメンテナンスモードの終了</title>
<para>クラスターを構成するためにメンテナンスモードが有効化されている場合は、最後のステップとして、クラスターのメンテナンスモードを解除する必要があります。</para>
<para>必要なノードでSAP HANAおよびその他のクラスターサービスを起動する必要がある場合があるので、クラスターが安定するまでに数分かかることがあります。</para>
<screen>crm configure property maintenance-mode=false</screen>
</section>
<section xml:id="_verify_the_communication_between_the_hook_and_the_cluster">
<title>フックとクラスター間の通信の検証</title>
<para>ここで、HA/DRプロバイダが適切なクラスター属性hana_&lt;sid&gt;_glob_srHookを設定できるかどうかチェックします。&lt;sid&gt;を<emphasis role="strong">小文字</emphasis>のSAPシステムID（ha1など）に置き換えます。</para>
<example>
<title>srHookクラスター属性の照会 </title>
<screen>crm_attribute -G -n hana_&lt;sid&gt;_glob_srHook</screen>
<para>次のような出力が得られます。</para>
<screen>scope=crm_config  name=hana_&lt;sid&gt;_glob_srHook value=SOK</screen>
</example>
<para>この場合、HA/DRプロバイダーは、SAP HANAレプリケーションステータスについてクラスターに通知するため、属性をSOKに設定します。</para>
</section>
<section xml:id="_using_special_virtual_host_names_or_fqhn_during_installation_of_sap_hana">
<title>SAP HANAのインストール時に特殊な仮想ホスト名つまりFQHNを使用</title>
<para>短いノード名の代わりに特殊な仮想ホスト名つまり完全修飾ホスト名（FQHN）を使用した場合、リソースエージェントはこれらの名前をマッピングする必要があります。短いノード名と使用されたSAP「仮想ホスト名」を一致させるには、次のように、saphostagentがインストール済みのインスタンスのリストを正しく報告する必要があります。</para>
<example>
<title>今回の設定では仮想ホスト名とノード名が一致 </title>
<screen><emphasis role="strong">suse01</emphasis>:ha1adm&gt; /usr/sap/hostctrl/exe/saphostctrl -function ListInstances
 Inst Info : HA1 - 00 - <emphasis role="strong">suse01</emphasis> - 749, patch 418, changelist 1816226</screen>
</example>
</section>
</section>
</section>
<section xml:id="Testing">
<title>クラスターのテスト</title>
<para>テストはクラスターの実装で最も重要なプロジェクトタスクの1つです。適切なテストが不可欠です。プロジェクトまたはユーザーの期待から導き出されるすべてのテストケースが定義され、完全に合格することを確認してください。<emphasis role="strong">テストなしでは、プロジェクトが本稼働で失敗する可能性があります。</emphasis></para>
<figure>
<title><xref linkend="Planning"/> <xref linkend="OsSetup"/> <xref linkend="SAPHanaInst"/> <xref linkend="SAPHanaHsr"/> <xref linkend="Integration"/> <xref linkend="Cluster"/> テスト</title>
<mediaobject>
<imageobject>
<imagedata fileref="SAPHanaSR-ScaleOut-Plan-Phase7.svg" width="100%"/>
</imageobject>
<textobject><phrase>SAPHanaSR ScaleOut Plan Phase7</phrase></textobject>
</mediaobject>
</figure>
<para>特に明記されていない限り、テストの前提条件は常に、すべてのクラスターノードがブートされれていること、すべてのクラスタ-ノードが既にクラスターの正規メンバーであること、およびSAP HANA RDBMSが稼動中であることです。システムレプリケーションは、「SOK」で表される同期中です。クラスターはアイドルで、保留中のアクションはなく、移行制約は残っておらず、フェイルカウントは残っていません。</para>
<para>本バージョンの設定ガイドでは、テストケースの計画リストを提供します。将来はテストケースをより詳細に記述する予定です。本ガイドの更新版でこれらの詳細を提供するか、テストケースを抽出して別のテスト計画ドキュメントとします。</para>
<section xml:id="_generic_cluster_tests">
<title>一般的なクラスターテスト </title>
<para>この種類のクラスターテストは、動作中のクラスター反応を扱います。この中には、完全なクラスターの起動と停止、SBD障害のシミュレーションなどが含まれます。</para>
<itemizedlist>
<listitem>
<para>すべてのクラスターノードの並行起動（systemctl start pacemakerは短い時間枠で実行する必要があります）。</para>
</listitem>
<listitem>
<para>完全なクラスターの停止。</para>
</listitem>
<listitem>
<para>2つあるSAP HANAサイトの一方を分離。</para>
</listitem>
<listitem>
<para>マジョリティメーカーを電源オフ。</para>
</listitem>
<listitem>
<para>クラスターを連続稼動させた状態でメンテナンス手順をシミュレート。</para>
</listitem>
<listitem>
<para>クラスターを再起動した状態でメンテナンス手順をシミュレート。</para>
</listitem>
<listitem>
<para>いずれかのクラスターノードのCorosyncプロセスを停止。</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="_tests_on_the_primary_site">
<title>プライマリサイトでのテスト </title>
<para>この種類のテストは、プライマリサイトのいくつかの障害に対する反応をチェックします。</para>
<section xml:id="_tests_regarding_cluster_nodes_of_the_primary_site">
<title>プライマリサイトのクラスターノードに関するテスト </title>
<para>ここに示すテストは、プライマリサイトの1つ以上のノードが障害を起こすか、クラスターに復帰する場合のSAP HANAおよびクラスターの反応をチェックします。</para>
<itemizedlist>
<listitem>
<para>プライマリのマスターネームサーバーを電源オフ。</para>
</listitem>
<listitem>
<para>プライマリのいずれかのワーカーノードを電源オフ（ただしマスターネームサーバーは除く）。</para>
</listitem>
<listitem>
<para>以前に電源オフしたクラスターノードの復帰。</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="_tests_regarding_the_complete_primary_site">
<title>完全なプライマリサイトに関するテスト </title>
<para>このテストカテゴリは完全なサイト障害をシミュレートします。</para>
<itemizedlist>
<listitem>
<para>プライマリのすべてのノードを並行して電源オフ。</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="_tests_regarding_the_sap_hana_instances_of_the_primary_site">
<title>プライマリサイトのSAP HANAインスタンスに関するテスト </title>
<para>ここに示すテストは、停止したSAP HANAインスタンスなどのアプリケーション障害によって引き起こされるSAP HANAおよびクラスターの反応に関するチェックです。</para>
<itemizedlist>
<listitem>
<para>プライマリのマスターネームサーバーのSAP HANAインスタンスを停止。</para>
</listitem>
<listitem>
<para>プライマリのいずれかのワーカーノードのSAP HANAインスタンスを停止（ただしマスターネームサーバーは除く）。</para>
</listitem>
<listitem>
<para>プライマリのいずれかのSAP HANAインスタンスのsapstartrvを停止。</para>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="_tests_on_the_secondary_site">
<title>プライマリサイトでのテスト</title>
<para>この種類のテストは、セカンダリサイトのいくつかの障害に対する反応をチェックします。</para>
<section xml:id="_tests_regarding_cluster_nodes_of_the_secondary_site">
<title>プライマリサイトのクラスターノードに関するテスト</title>
<para>ここに示すテストは、セカンダリサイトの1つ以上のノードが障害を起こすか、クラスターに復帰する場合のSAP HANAおよびクラスターの反応をチェックします。</para>
<itemizedlist>
<listitem>
<para>セカンダリのマスターネームサーバーを電源オフ。</para>
</listitem>
<listitem>
<para>セカンダリのいずれかのワーカーノードを電源オフ（ただしマスターネームサーバーは除く）。</para>
</listitem>
<listitem>
<para>以前に電源オフしたクラスターノードの再参加。</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="_tests_regarding_the_complete_secondary_site">
<title>完全なプライマリサイトに関するテスト</title>
<para>このテストカテゴリは完全なサイト障害をシミュレートします。</para>
<itemizedlist>
<listitem>
<para>セカンダリのすべてのノードを並行して電源オフ。</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="_tests_regarding_the_sap_hana_instances_of_the_secondary_site">
<title>プライマリサイトのSAP HANAインスタンスに関するテスト</title>
<para>ここに示すテストは、停止したSAP HANAインスタンスなどのアプリケーション障害によって引き起こされるSAP HANAおよびクラスターの反応に関するチェックです。</para>
<itemizedlist>
<listitem>
<para>セカンダリのマスターネームサーバーのSAP HANAインスタンスを停止。</para>
</listitem>
<listitem>
<para>セカンダリのいずれかのワーカーノードのSAP HANAインスタンスを停止（ただしマスターネームサーバーは除く）。</para>
</listitem>
<listitem>
<para>セカンダリのいずれかのSAP HANAインスタンスのsapstartrvを停止。</para>
</listitem>
</itemizedlist>
</section>
</section>
</section>
<section xml:id="_administration">
<title>管理</title>
<section xml:id="_dos_and_donts">
<title>注意事項</title>
<para>プロジェクトで<emphasis role="strong">行うべき</emphasis>ことを以下に示します。</para>
<itemizedlist>
<listitem>
<para>クラスターに他のリソースを追加する<emphasis role="strong">前に</emphasis>STONITHの定義（およびテスト）を行う。</para>
</listitem>
<listitem>
<para><emphasis role="strong">徹底的な</emphasis>テストを行う。</para>
</listitem>
<listitem>
<para>SAPHanaControllerおよびSAPHanaTopologyの動作のタイムアウトを<emphasis role="strong">微調整</emphasis>する。</para>
</listitem>
<listitem>
<para><emphasis role="strong">PREFER_SITE_TAKEOVER=true</emphasis>、<emphasis role="strong">AUTOMATED_REGISTER=false</emphasis>、および<emphasis role="strong">DUPLICATE_PRIMARY_TIMEOUT=”7200”</emphasis>で開始する。</para>
</listitem>
<listitem>
<para>クラスター構成にクライアント優先ロケーションの制約またはフェイルカウントが残っていないことを常に確認する。</para>
</listitem>
<listitem>
<para>テスト実行またはメンテナンス手順を開始する前に、クラスターがアイドル状態であるかチェックする。</para>
</listitem>
</itemizedlist>
<para>プロジェクトで<emphasis role="strong">避けるべき</emphasis>ことを以下に示します。</para>
<itemizedlist>
<listitem>
<para>クラスター構成を急激に変更したり変更を元に戻したりすること。例: ノードをスタンバイに設定して再びオンラインに設定する、マスター/スレーブリソースを停止/開始する、など。</para>
</listitem>
<listitem>
<para>ホスト、ユーザー、グループの適切な時刻同期をしなかったり、不安定な名前解決でクラスターを作成する。</para>
</listitem>
<listitem>
<para>クローン、マスター/スレーブ、またはIPリソースのロケーションルールの追加。この設定ガイドで述べられているロケーションルールのみが許容されます。</para>
</listitem>
<listitem>
<para>CRMシェルでリソースを「migrate」または「move」すると、HAWKなどのツールがクライアント優先ロケーションを追加する場合があります。この動作は完全に<emphasis role="strong">禁止</emphasis>されています。</para>
</listitem>
</itemizedlist>
</section>
<section xml:id="_monitoring_and_tools">
<title>監視とツール </title>
<para>クラスターステータス要求には、High Availability Web Konsole（HAWK）、SAP HANA Studio、およびその他のコマンドラインツールを使用できます。</para>
<section xml:id="_hawk_cluster_status_and_more">
<title>HAWK – クラスターステータスなど </title>
<para>インターネットブラウザを使用して、クラスターステータスをチェックできます。次のURLを使用します。 <link xl:href="https://&lt;node&gt;:7630">https://&lt;node&gt;:7630</link></para>
<para>ログイン資格情報は、ha-cluster-initのインストールダイアログで提供されます。Linuxユーザー<emphasis>hacluster</emphasis>のデフォルトのパスワードを変更することに留意してください。</para>
<figure>
<title>HAWKにおけるクラスターステータス </title>
<mediaobject>
<imageobject>
<imagedata fileref="cluster_status_hawk_1.png" width="95%"/>
</imageobject>
<textobject><phrase>cluster status hawk 1</phrase></textobject>
</mediaobject>
</figure>
<para><emphasis>ha-cluster-init</emphasis>を使用してクラスターを設定し、前述したすべてのパッケージをインストールした場合、システムは非常に便利なWebインターフェースを提供します。このグラフィカルなWebインターフェースを使用して、完全なクラスターステータスの概要の把握、管理タスクの実行、リソースおよびクラスターブートストラップパラメータの構成を行うことができます。</para>
<para>この強力なユーザーインターフェースの完全なドキュメントについては、製品マニュアルをお読みください。</para>
</section>
<section xml:id="_sap_hana_studio">
<title>SAP HANA Studio</title>
<para>データベース固有の管理とチェックは、SAP HANA Studioを使用して行うことができます。</para>
<figure>
<title>SAP HANA Studio – スケールアウトシステムのランドスケープ </title>
<mediaobject>
<imageobject>
<imagedata fileref="hana_studio_landscape.png" width="95%"/>
</imageobject>
<textobject><phrase>hana studio landscape</phrase></textobject>
</mediaobject>
</figure>
<para>システムレプリケーションのパラメータまたはトポロジの変更は、クラスターリソース管理に干渉する場合があるため、細心の注意が必要です。</para>
<para>肯定的な例としては、元のプライマリを新しいセカンダリとして登録することが挙げられ、AUTOMATED_REGISTER=falseを設定します。</para>
<para>否定的な例としては、セカンダリの登録解除、プライマリでのシステムレプリケーションの無効化などの操作が挙げられます。</para>
<para>システムレプリケーションを変更するすべての操作について、最初にメンテナンス手順をチェックすることをお勧めします。</para>
</section>
<section xml:id="_cluster_command_line_tools">
<title>クラスターコマンドラインツール</title>
<variablelist>
<varlistentry>
<term>crm_mon</term>
<listitem>
<para>概要は、<emphasis>crm_mon</emphasis>を呼び出すことで得ることができます。<emphasis>_-rオプションを使用</emphasis>すると、停止しているが既に構成済みのリソースも表示されます。<emphasis>-1</emphasis>オプションを使用すると、crm_monによるステータスの出力が周期的ではなく一度だけになります。</para>
</listitem>
</varlistentry>
</variablelist>
<screen>Stack: corosync
Current DC: suse05 (version 1.1.16-4.8-77ea74d) - partition with quorum
Last updated: Mon Jun 11 16:55:04 2018
Last change: Mon Jun 11 16:53:58 2018 by root via crm_attribute on suse02

7 nodes configured
16 resources configured

Online: [ suse-mm suse01 suse02 suse03 suse04 suse05 suse06 ]

Full list of resources:

stonith-sbd     (stonith:external/sbd): Started suse-mm
rsc_ip_HA1_HDB00        (ocf::heartbeat:IPaddr2):       Started suse02
 Master/Slave Set: msl_SAPHanaCon_HA1_HDB00 [rsc_SAPHanaCon_HA1_HDB00]
     Masters: [ suse02 ]
     Slaves: [ suse01 suse03 suse04 suse05 suse06 ]
     Stopped: [ suse-mm ]
 Clone Set: cln_SAPHanaTop_HA1_HDB00 [rsc_SAPHanaTop_HA1_HDB00]
     Started: [ suse01 suse02 suse03 suse04 suse05 suse06 ]
     Stopped: [ suse-mm ]</screen>
<para>詳しくはマニュアルページcrm_mon(8)をご参照ください。</para>
<variablelist>
<varlistentry>
<term>SAPHanaSR-showAttr</term>
<listitem>
<para>SAPHanaControllerおよびSAPHanaTopologyリソースエージェント内部値の一部を表示するために、プログラム<emphasis>SAPHanaSR-showAttr</emphasis>を呼び出すことができます。内部値、保管場所、およびそれらのパラメータ名は、次のバージョンで変更になる場合があります。<emphasis>SAPHanaSR-showAttr</emphasis>コマンドは、常に正しい保管場所から値を取得します。</para>
</listitem>
</varlistentry>
</variablelist>
<important>
<para><emphasis>crm_attribute</emphasis>などのクラスターコマンドを使用して、クラスターから直接値を取得<emphasis role="strong">しない</emphasis>でください。そうした場合、属性を別の保管場所またはクラスターの外部に移動する必要が生じると、方式が壊れてしまいます。</para>
</important>
<para>最初の<emphasis>SAPHanaSR-showAttr</emphasis>はテストプログラムのみで、自動化されたシステム監視に使用しないでください。</para>
<example>
<title>rootユーザーとしてSAPHanaSR-showAttrをチェック </title>
<screen>suse-mm:~ # SAPHanaSR-showAttr --sid=&lt;SID&gt;</screen>
<para>このツールは、3つの領域の興味深いすべてのクラスター属性を表示します。</para>
<itemizedlist>
<listitem>
<para><emphasis role="strong">global</emphasis>セクションには、CIBタイムスタンプに関する情報とシステムレプリケーションのステータスを扱う属性が含まれます。</para>
</listitem>
<listitem>
<para><emphasis role="strong">site</emphasis>セクションには、サイト毎の属性が含まれ、どのサイトがプライマリであるか、およびlandscapeHostConfiguration.pyスクリプトのリターンコードが表示されます。さらに、サイト毎にアクティブなマスターネームサーバーが表示されます。</para>
</listitem>
<listitem>
<para><emphasis role="strong">hosts</emphasis>セクションには、ノードのステータス、SAP HANAデータベース内部のホストのロール、プライマリマスターネームサーバーを取得するための計算されたスコア、およびホストが属するサイト名が含まれます。</para>
</listitem>
</itemizedlist>
<screen>Global cib-time                 prim sec  srHook sync_state
------------------------------------------------------------
global Tue Jun 12 15:02:58 2018 WDF1 ROT1 SOK    SOK


Site lpt        lss mns    srr
-------------------------------
WDF1 1528808568 4   suse02 P
ROT1 30         4   suse01 S


Hosts   clone_state node_state roles                        score site
-----------------------------------------------------------------------
suse-mm online
suse01  DEMOTED     online     master1:master:worker:master 100 ROT1
suse02  PROMOTED    online     master1:master:worker:master 150 WDF1
suse03  DEMOTED     online     master3:slave:worker:slave   80  ROT1
suse04  DEMOTED     online     master2:slave:worker:slave   110 WDF1
suse05  DEMOTED     online     master2:slave:worker:slave   80  ROT1
suse06  DEMOTED     online     master3:slave:worker:slave   110 WDF1</screen>
</example>
<para>マジョリティメーカーsuse-mmはSAP HANAインスタンスを実行しません。したがって、ロール属性もスコアまたはサイト値もありません。</para>
</section>
<section xml:id="_sap_hana_landscapehostconfiguration">
<title>SAP HANA LandscapeHostConfiguration </title>
<para>SAP HANAデータベースのステータスをチェックし、クラスターが反応する必要があるかどうかを調べるために、<emphasis>landscapeHostConfiguration.py</emphasis>を使用できます。</para>
<example>
<title>ユーザー&lt;sid&gt;admとしてランドスケープステータスをチェック </title>
<screen>HDBSettings.sh landscapeHostConfiguration.py</screen>
<para>ランドスケープホスト構成は、1つのSAP HANAホストにつき1行ずつ表示されます。</para>
<screen> | Host   | Host   | ... NameServer  | NameServer  | IndexServer | IndexServer |
 |        | Active | ... Config Role | Actual Role | Config Role | Actual Role |
 | ------ | ------ | ... ----------- | ----------- | ----------- | ----------- |
 | suse01 | yes    | ... master 1    | master      | worker      | master      |
 | suse03 | yes    | ... master 2    | slave       | worker      | slave       |
 | suse05 | yes    | ... master 3    | slave       | standby     | standby     |

 overall host status: ok</screen>
</example>
<para>SAP HAガイドラインに従って、SAPHanaリソースエージェントは次のようにリターンコードを解釈します。</para>
<table frame="all" rowsep="1" colsep="1">
<title>リターンコードの解釈表 </title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="75*"/>
<thead>
<row>
<entry align="left" valign="top">リターンコード</entry>
<entry align="left" valign="top">説明</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><para>4</para></entry>
<entry align="left" valign="top"><para>SAP HANAデータベースは稼動中で、OKステータスです。クラスターはこれを正しく稼動中のデータベースと解釈します。</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>3</para></entry>
<entry align="left" valign="top"><para>SAP HANAデータベースは稼動中で、INFOステータスです。クラスターはこれを正しく稼動中のデータベースと解釈します。</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>2</para></entry>
<entry align="left" valign="top"><para>SAP HANAデータベースは稼動中で、警告ステータスです。クラスターはこれを正しく稼動中のデータベースと解釈します。</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>1</para></entry>
<entry align="left" valign="top"><para>SAP HANAデータベースは停止しています。データベースは稼動中である必要があり、意図的に停止されていない場合、テイクオーバーがトリガされる可能性があります。</para></entry>
</row>
<row>
<entry align="left" valign="top"><para>0</para></entry>
<entry align="left" valign="top"><para>内部スクリプトエラー – 無視されます。</para></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
</section>
</section>
<section xml:id="_useful_links_manuals_and_sap_notes">
<title>役に立つリンク、マニュアル、およびSAPノート</title>
<section xml:id="_suse_best_practices_and_more">
<title>SUSEベストプラクティスなど </title>
<variablelist>
<varlistentry>
<term>SUSE Linux Enterprise上のSAPに関するベストプラクティス</term>
<listitem>
<para><link xl:href="https://www.suse.com/products/sles-for-sap/resource-library/sap-best-practices.html">https://www.suse.com/products/sles-for-sap/resource-library/sap-best-practices.html</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>SAP HANA*のフェイルセーフ運用: SUSEが拡張する高可用性ソリューション</term>
<listitem>
<para><link xl:href="http://scn.sap.com/community/hana-in-memory/blog/2014/04/04/fail-safe-operation-of-sap-hana-suse-extends-its-high-availability-solution">http://scn.sap.com/community/hana-in-memory/blog/2014/04/04/fail-safe-operation-of-sap-hana-suse-extends-its-high-availability-solution</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>コスト最適化されたSAP HANA SRシナリオでSAPHanaSRを設定する方法</term>
<listitem>
<para><link xl:href="http://scn.sap.com/docs/DOC-65899">http://scn.sap.com/docs/DOC-65899</link></para>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="_suse_product_documentation">
<title>SUSE製品ドキュメント </title>
<para>SUSE製品マニュアルおよびドキュメントは、<link xl:href="https://www.suse.com/documentation">https://www.suse.com/documentation</link>でダウンロードできます。</para>
<variablelist>
<varlistentry>
<term>SLES for SAP Applicationsの最新のオンラインドキュメント</term>
<listitem>
<para><link xl:href="https://www.suse.com/documentation/sles-for-sap-12/">https://www.suse.com/documentation/sles-for-sap-12/</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>SUSE Linux Enterprise High Availabilityの最新のオンラインドキュメント</term>
<listitem>
<para><link xl:href="https://www.suse.com/documentation/sle-ha-12/index.html">https://www.suse.com/documentation/sle-ha-12/index.html</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>Tuning guide for SUSE Linux Enterprise Server</term>
<listitem>
<para><link xl:href="https://www.suse.com/documentation/sles-12/book_sle_tuning/data/book_sle_tuning.html">https://www.suse.com/documentation/sles-12/book_sle_tuning/data/book_sle_tuning.html</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>Storage admin guide for SUSE Linux Enterprise Server</term>
<listitem>
<para><link xl:href="https://www.suse.com/documentation/sles-12/stor_admin/data/stor_admin.html">https://www.suse.com/documentation/sles-12/stor_admin/data/stor_admin.html</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>リリースノート</term>
<listitem>
<para><link xl:href="https://www.suse.com/releasenotes/">https://www.suse.com/releasenotes/</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>TID aws-cli throwing Error on fresh SLES 15 Installation in AWS Cloud</term>
<listitem>
<para><link xl:href="https://www.suse.com/support/kb/doc/?id=7023686">https://www.suse.com/support/kb/doc/?id=7023686</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>TID multipath system unable to boot after installing dracut-037-98.2.x86_64</term>
<listitem>
<para><link xl:href="https://www.suse.com/support/kb/doc/?id=7020912">https://www.suse.com/support/kb/doc/?id=7020912</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>TID Systemd-udev-settle timing out</term>
<listitem>
<para><link xl:href="https://www.suse.com/support/kb/doc/?id=7022681">https://www.suse.com/support/kb/doc/?id=7022681</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>TID How to load the correct watchdog kernel module</term>
<listitem>
<para><link xl:href="http://www.suse.com/support/kb/doc.php?id=7016880">http://www.suse.com/support/kb/doc.php?id=7016880</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>TID rpcbind won’t start after upgrade from SLES 11 to SLES 12</term>
<listitem>
<para><link xl:href="https://www.suse.com/support/kb/doc/?id=7017144">https://www.suse.com/support/kb/doc/?id=7017144</link></para>
</listitem>
</varlistentry>
</variablelist>
<variablelist>
<varlistentry>
<term>TID Memory, I/O and DefaultTasksMax related considerations for SLES for SAP servers with huge memory</term>
<listitem>
<para><link xl:href="https://www.suse.com/support/kb/doc/?id=7021211">https://www.suse.com/support/kb/doc/?id=7021211</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>TID XFS metadata corruption and invalid checksum on SAP Hana servers</term>
<listitem>
<para><link xl:href="https://www.suse.com/support/kb/doc/?id=7022921">https://www.suse.com/support/kb/doc/?id=7022921</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>SUSE Linux Enterprise Server技術情報</term>
<listitem>
<para><link xl:href="https://www.suse.com/products/server/technical-information/">https://www.suse.com/products/server/technical-information/</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>XFS file system</term>
<listitem>
<para><link xl:href="https://www.suse.com/communities/conversations/xfs-the-file-system-of-choice/">https://www.suse.com/communities/conversations/xfs-the-file-system-of-choice/</link></para>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="_sap_product_documentation">
<title>SAP製品ドキュメント</title>
<variablelist>
<varlistentry>
<term>SAP HANA Installation and Update Guide</term>
<listitem>
<para><link xl:href="http://help.sap.com/hana/SAP_HANA_Server_Installation_Guide_en.pdf">http://help.sap.com/hana/SAP_HANA_Server_Installation_Guide_en.pdf</link></para>
</listitem>
</varlistentry>
<varlistentry>
<term>SAP HANA Administration Guide</term>
<listitem>
<para><link xl:href="http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf">http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf</link></para>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="_sap_notes">
<title>SAPノート</title>
<para>SAPノートは時間経過とともに変更されるため、このリストは出発点にすぎません。</para>
<itemizedlist>
<listitem>
<para>611361 Hostnames of SAP servers</para>
</listitem>
<listitem>
<para>1275776 Preparing SLES for Sap Environments</para>
</listitem>
<listitem>
<para>1514967 SAP HANA: Central Note</para>
</listitem>
<listitem>
<para>1523337 SAP In-Memory Database 1.0: Central Note</para>
</listitem>
<listitem>
<para>1501701 Single Computing Unit Performance and Sizing</para>
</listitem>
<listitem>
<para>1846872 &quot;No space left on device&quot; error reported from HANA</para>
</listitem>
<listitem>
<para>1876398 Network configuration for System Replication in HANA SP6</para>
</listitem>
<listitem>
<para>1888072 SAP HANA DB: Indexserver crash in strcmp sse42</para>
</listitem>
<listitem>
<para>1890444 Slow HANA system due to CPU power save mode</para>
</listitem>
<listitem>
<para>1944799 SAP HANA Guidelines for SLES Operating System Installation</para>
</listitem>
<listitem>
<para>1984787 SUSE LINUX Enterprise Server 12: Installation notes and</para>
</listitem>
<listitem>
<para>1999993 How-To: Interpreting SAP HANA Mini Check Results</para>
</listitem>
<listitem>
<para>2000000 FAQ: SAP HANA Performance Optimization</para>
</listitem>
<listitem>
<para>2100040 FAQ: SAP HANA CPU</para>
</listitem>
<listitem>
<para>2205917 SAP HANA DB: Recommended OS settings for SLES 12 / SLES for SAP Applications 12.</para>
</listitem>
<listitem>
<para>2382421 Optimizing the Network Configuration on HANA- and OS-Level</para>
</listitem>
<listitem>
<para>2470289 FAQ: SAP HANA Non-Uniform Memory Access (NUMA)</para>
</listitem>
<listitem>
<para>2578899 SUSE Linux Enterprise Server 15: Installation Note</para>
</listitem>
<listitem>
<para>2684254 SAP HANA DB: Recommended OS settings for SLES 15 / SLES for SAP Applications 15</para>
</listitem>
<listitem>
<para>2647673 HANA Installation Failure</para>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="_legal_notice">
<title>法的通知</title>
<para>Copyright © 2006–2020 SUSE LLC and contributors.全著作権所有</para>
<para>本書は、GNU Free Documentation Licenseのバージョン1.2または（オプションとして）バージョン1.3の条項に従って、複製、頒布、および/または改変が許可されています。ただし、この著作権表示およびライセンスは変更せずに記載してください。ライセンスバージョン1.2のコピーは、「GNU Free Documentation License」セクションに含まれています。</para>
<para>SUSE、SUSEのロゴ、およびYaSTは、米国およびその他の国におけるSUSE LLCの登録商標です。SUSEの商標については、<link xl:href="https://www.suse.com/company/legal/">https://www.suse.com/company/legal/</link>を参照してください。</para>
<para>Linuxは、Linus Torvaldsの登録商標です。本書に記載されているその他の名称や商標はすべて、それぞれの所有者の商標または登録商標の可能性があります。</para>
<para>この記事は、「SUSE Best Practices」と呼ばれる一連の文書の一部です。個々の文書は、SUSE社員および第三者が自主的に作成したものです。これらの記事は、特定の操作をどのように行うかの一例を示しているにすぎません。</para>
<para>また、SUSEは、これらの記事に記載された操作が主張どおりに機能し、予期せぬ結果をもたらさないことを確認していません。</para>
<para>この記事のすべての情報は、細心の注意を払って編集されています。しかし、このことは絶対に正確であることを保証するものではありません。SUSE LLC、その関係者、著者、翻訳者のいずれも誤りまたはその結果に対して一切責任を負いかねます。参考までに、これらの記事の基になったライセンスを以下に示します。</para>
</section><?pdfpagebreak style="suse2013-sbp" formatter="fop"?><xi:include href="license-gfdl.xml"/>
</article>