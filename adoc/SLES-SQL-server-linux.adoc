:docinfo:

// defining article ID
[#art-sles15-sql-server]

// = {title}
= Microsoft SQL Server on SUSE Linux Enterprise Server
// SUSE Linux Enterprise Server 15 SP6+, SQL Server 2022
// :author: Bernd Schubert, Gereon Vey
:revnumber: 0.0.2
:toc2:
:toc-title: Microsoft SQL Server on SUSE Linux Enterprise Server
:toclevels: 4

:sles: SUSE Linux Enterprise Server
:sqls: SQL Server

== Motivation

=== Background

Since Microsoft released {sqls} for Linux in 2017 footnote:[https://cloudblogs.microsoft.com/sqlserver/2017/10/02/sql-server-2017-on-windows-linux-and-docker-is-now-generally-available], 
the feature gap footnote:[https://learn.microsoft.com/en-us/sql/sql-server/what-s-new-in-sql-server-2022?view=sql-server-ver16&viewFallbackFrom=sql-server-linux-ver16] for SQL Server between 
Windows and Linux has been closing quickly with each update. With the 2022 release footnote:[https://learn.microsoft.com/en-us/sql/sql-server/sql-server-2022-release-notes?view=sql-server-ver16&preserve-view=true],
it is now extremely viable to consider running {sqls} workloads on Linux, aside from some niche features 
footnote:[https://learn.microsoft.com/en-us/sql/sql-server/what-s-new-in-sql-server-2022?view=sql-server-ver16&viewFallbackFrom=sql-server-linux-ver16]
.

=== Business case: Why SQL on SUSE Linux Enterprise Server

SUSE has a long history of been used as a host for commercial databases within the Linux world. Many of the initial developments and ports of well know commercial databases to Linux where done on and with SUSE.
SUSE Linux Enterprise Server was first with many Linux features used by modern databases like memory handling, file systems and provides a rock solid base for business workloads.

Microsoft makes SQL Server a platform that gives you choices of development languages, data types, on-premises or cloud deployments, and operating systems by bringing the power of SQL Server to Linux, Linux-based containers, and Windows. 
Many organizations, particularly those that have used SQL Server on Windows, are moving to Linux and now have the advantage of having their database available there.
SQL on SUSE is Enterprise-ready with great performance. The TPC-H benchmark results done by HP show that SQL Server on Linux delivers amazing performance. SUSE Linux Enterprise Server proved to be faster than Windows in that benchmark too. 
This really showcases that SQL Server’s functionality, its' performance, and scaleability are also there when deployed to SUSE Linux Enterprise Server.
Second, there is no difference when running SQL Server on Linux. For example, the tools you use as developer on Windows are the same as on Linux. 
As Linux administrator you feel at home too, as SQL Server is installed and updated like any other Linux package using Zypper or YaST.

=== Audience

This guide is intended for {sqls} DBAs, developers, and DevOps/SRE engineers who are familiar with SQL Server on Windows and are looking 
to migrate to Linux. Operators who are adding an {sqls} requirement into a primarily Linux environment for consistency and simplicity may prefer tools that run only on Linux servers. 
Another reason may be lower negotiated pricing for Linux subscriptions to replace existing {sqls} on Windows machines.

=== Scope

The guide covers a basic installation of {sqls} on {sles} including the OS tuning specific for {sqls}.
It is meant to be agnostic of underlying infrastructure excepting the nuance of registering your server discussed in <<server_registration>> <<Server registration>>.

=== Important notice

include::SLES-SQL-support.adoc[tags=mvs-general;mvs-sql]

== Installation

At first the manual installation for a standalone {sqls} is described by starting at <<man_inst>>.

// The automated installation based on Ansible is described in<<ansi_inst>>.

[id="man_inst"]
=== System requirements
.SQL Server has the following system requirements for Linux:
* 2 GHz CPU with 2 cores
* x64-compatible only
* 2 GB¹ RAM
* XFS or Ext4 file system for the SQL DB files
** other file systems, such as Btrfs, are not support
* 6 GB disk space (not including data)
* swap space >= 2 GB 

¹ 2 GB is the minimum required memory to start SQL Server on Linux, which accommodates system threads and internal processes. You must take this amount into consideration when setting *max server memory* and *MemoryLimitMB*.

//-

.If you use Network File System (NFS) remote shares in production, note the following support requirements:
* Use NFS version 4.2 or higher. Older versions of NFS do not support required features, such as fallocate and sparse file creation, common to modern file systems.
* Locate only the /var/opt/mssql directories on the NFS mount. Other files, such as the SQL Server system binaries, are not supported.


[id="server_registration"]
=== Server registration

To gain access to SUSE repositories, you first need to register your server with `SUSEConnect`. If you are launching an On-Demand (or Pay-As-You-Go) 
instance and not a BYOS (Bring Your Own Subscription) instance at a public cloud provider, skip this step.

Usage of SUSE SCC if you have Internet access.

* SUSE https://scc.suse.com[SCC] (SUSE Customer Center)

[source,shell]
----
sudo SUSEConnect --regcode ${REGISTRATION_CODE} --email ${EMAIL_ADDRESS}
----

Alternatively, if you have access to a

* SUSE https://documentation.suse.com/sles/15-SP6/single-html/SLES-rmt/#book-rmt[RMT] (Repository Mirroring Tool) 

server you want to use, use the `--url` option instead.

[source,shell]
----
sudo SUSEConnect --url ${REGISTRATION_SERVER_URL}
----

The registration procedure for SUSE Multi-Linux Manager client's are different.

* SUSE https://www.suse.com/products/multi-linux-manager[Multi-Linux Manager] (former known as SUMA)
** https://documentation.suse.com/suma/5.0/en/suse-manager/client-configuration/registration-overview.html[Client Registration]

More information about registering can be found in the https://documentation.suse.com/sles/15-SP6/single-html/SLES-deployment/#sec-yast-install-scc-registration[{sles} 15 SP6 Deployment Guide].


=== Repositories
Configure repositories for installation and upgrade of {sqls} 2022 on Linux.
To verify packages from Microsoft’s {sqls} repositories, first add their package signing key:
As non privileged user the `sudo` must be added in front of each command.

[source,shell]
----
sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc
----

Then add the repository.

[source,shell]
----
sudo zypper ar https://packages.microsoft.com/config/sles/15/mssql-server-2022.repo
sudo zypper ar https://packages.microsoft.com/config/sles/15/prod.repo
sudo zypper --gpg-auto-import-keys refresh
----

The `mysql-server` package requires `gdb` from the development tools module (which in turn needs desktop applications module):

[source,shell]
----
sudo SUSEConnect -p sle-module-desktop-applications/15.6/x86_64
sudo SUSEConnect -p sle-module-development-tools/15.6/x86_64
----

Optional: the sle-ha module is needed for a High Availability (HA) setup:

[source,shell]
----
sudo SUSEConnect -p sle-ha/15.6/x86_64
----

=== Package Installation

To install the {sqls} package non-interactively, and the add-ons, run the following command:

[source,shell]
----
sudo ACCEPT_EULA=Y zypper install -y  mssql-server mssql-tools18 unixODBC-devel glibc-locale-base sqlcmd tuned
----

////
[id="ansi_inst"]
=== Automated Deployment with Ansible
////

== Configuration

=== Initial configuration

This section is covering the OS modification, the NIC configuration, the recommended storage setup and the {sqls} configuration.

==== OS configuration (CPU, Kernel, Memory)

[discrete]
==== CPU | sysctl | disk | memory setting
{sles} contains a `TuneD` profile for mssql (within the `tuned` package), but it's not according to the {sqls} best practices guide. The next steps describe and line out the changes recommended for {sqls}.
Using TuneD it automatically configures CPU frequency governor, ENERGY_PERF_BIAS, and min_perf_pct settings appropriately due to the `throughput-performance` profile being used as base for the `mssql profile`. 
C-States parameter must be configured manually. The disk readahead section is also covered by including the file `throughput-performance`, please check the settings if they are equal and skip them if not needed.

[source,shell]
----
mkdir -p /etc/tuned/mssql
cat >/etc/tuned/mssql/tuned.conf <<EOF
[main]
summary=Optimize for Microsoft SQL Server
include=throughput-performance
 
[cpu]
force_latency = 5
 
[vm]
transparent_hugepages = always
 
[sysctl]
vm.swappiness = 1
vm.dirty_background_ratio = 3
vm.dirty_ratio = 80
vm.dirty_expire_centisecs = 500
vm.dirty_writeback_centisecs = 100
vm.max_map_count = 1600000
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576
kernel.numa_balancing = 0
[disk]
# Comma separated list of devices, all devices if commented out.
# devices = md125,md126,md127
readahead = 4096
EOF
 
chmod +x /etc/tuned/mssql/tuned.conf
----

Alternative settings are:

[source,shell]
----
# For multi-instance SQL deployments, use
transparent_hugepages = madvise
# Multi-instance only. Can be configured by TuneD profile Set host variable
mssql_is_multi_instance: true
----

Depending on the infrastructure it might be necessary that the CPU setting must be disabled (e.g. log message: `cpu0: 'energy_perf_bias' = 'None', expected 'performance'`). 

This can be achieved by copying the source file `throughput-performance` and modifying it. 

Comment the line `energy_perf_bias=performance`, this will avoid error messages (like mentioned before) if `TuneD` is started and can't set this parameter.
[source,shell]
----
mkdir -p /etc/tuned/throughput-performance
cp /usr/lib/tuned/throughput-performance/tuned.conf /etc/tuned/throughput-performance/tuned.conf

vi /etc/tuned/throughput-performance/tuned.conf
...
[cpu]
governor=performance
# energy_perf_bias=performance
min_perf_pct=100
...
----

IMPORTANT: The final step to make the changes permanent is to disable `sysctl` re-execution after TuneD has modified the system. Otherwise, sysctl resets the settings to a value that is not expected in the above configuration.  
Disable `reapply_sysctl` by changing the 1 to 0.

[source,shell]
----
vi /etc/tuned/tuned-main.conf
...
# Whether to reapply sysctl from the e.g /etc/sysctl.conf, /etc/sysctl.d, ...
# If enabled these sysctls will be re-appliead after Tuned sysctls are
# applied, i.e. Tuned sysctls will not override system sysctls.
reapply_sysctl = 0
#reapply_sysctl = 1
...
----

Starting `TuneD` and activate the start during reboot.

[source,shell]
----
systemctl enable --now tuned
----

Load and verify the new profile. Checking the log file will show settings with are not executed or have failed.

[source,shell]
----
tuned-adm profile mssql
tuned-adm active
tuned-adm verify
cat /var/log/tuned/tuned.log
----

[discrete]
==== Intel CPU C-state

Adapting the Intel C-state setting by appending intel_idle.max_cstate and processor.max_cstate to the kernel command line. The appropriate BIOS settings are essential.

[source,shell]
----
vi /etc/default/grub
...
GRUB_CMDLINE_LINUX_DEFAULT=".... intel_idle.max_cstate=1 processor.max_cstate=1"
----

Update the boot loader and reboot the system.
(To avoid multiple reboots, a final reboot can be scheduled at this point <<final_reboot>>)

[source,shell]
----
update-bootloader --refresh
reboot
----

After the reboot verify the setting is persistent.
[source,shell]
----
cat /proc/cmdline
----

[discrete]
==== Tuning storage IO

INFO: As multipath I/O is often used for {sqls} deployments, configure the device mapper (DM) multi-queue target to use the blk-mq infrastructure, by enabling the dm_mod.use_blk_mq=y kernel boot option. The default value is n (disabled). This setting, when the underlying SCSI devices are using blk-mq, reduces locking overhead at the DM layer. For more information on how to configure multipath I/O, can be found at https://documentation.suse.com/sles/15-SP6/single-html/SLES-storage/#cha-multipath or https://www.suse.com/support/kb/doc/?id=000021020

SCHEDULER is one of bfq, none, kyber, or mq-deadline. DEVICE is the block device (sda for example). For permanent I/O scheduler change (reboot persistent) for a particular device, copy `/usr/lib/udev/rules.d/60-io-scheduler.rules` to `/etc/udev/rules.d/60-io-scheduler.rules`, and edit the copied file to suit the needs.

.Copy `60-io-scheduler.rules`
[source,shell]
----
cp /usr/lib/udev/rules.d/60-io-scheduler.rules /etc/udev/rules.d/60-io-scheduler.rules
----

Unchanged file:

[source,shell]
----
...
# 1. BFQ scheduler for single-queue HDD
ATTR{queue/rotational}!="0", TEST!="%S%p/mq/1", ATTR{queue/scheduler}="bfq", GOTO="scheduler_end"
 
# 2. BFQ scheduler for every HDD, including "real" multiqueue
# ATTR{queue/rotational}!="0", ATTR{queue/scheduler}="bfq", GOTO="scheduler_end"
 
# 3. For "real" multiqueue devices, the kernel defaults to no IO scheduling
# Uncomment this (and select your scheduler) if you need an IO scheduler for them
# TEST=="%S%p/mq/1", ATTR{queue/scheduler}="kyber", GOTO="scheduler_end"
 
# 4. BFQ scheduler for every device (uncomment if you need ionice or blk-cgroup features)
# ATTR{queue/scheduler}="bfq", GOTO="scheduler_end"
 
# 5. mq-deadline is the kernel default for devices with just one hardware queue
# ATTR{queue/scheduler}="mq-deadline"
----

The example above shows option 1 uncommented. Depending on the disk type, choose between option 1 to 5 or add a personal one.
The old default must be deactivated by comment the line with a `#`.

New setting:

[source,shell]
----
...
# 1. BFQ scheduler for single-queue HDD
# ATTR{queue/rotational}!="0", TEST!="%S%p/mq/1", ATTR{queue/scheduler}="bfq", GOTO="scheduler_end"
 
# 2. BFQ scheduler for every HDD, including "real" multiqueue
# ATTR{queue/rotational}!="0", ATTR{queue/scheduler}="bfq", GOTO="scheduler_end"

# 3. For "real" multiqueue devices, the kernel defaults to no IO scheduling
# Uncomment this (and select your scheduler) if you need an IO scheduler for them
# TEST=="%S%p/mq/1", ATTR{queue/scheduler}="kyber", GOTO="scheduler_end"

# 4. BFQ scheduler for every device (uncomment if you need ionice or blk-cgroup features)
# ATTR{queue/scheduler}="bfq", GOTO="scheduler_end"

# 5. mq-deadline is the kernel default for devices with just one hardware queue
# ATTR{queue/scheduler}="mq-deadline"
### new entry
ATTR{queue/scheduler}="kyber"
----

Activate the setting during runtime and check the configuration for all devices starting with `sd`:

*udevadm* usage:
[source,shell]
----
udevadm control --reload
udevadm trigger
cat /sys/block/sd?/queue/scheduler
----

==== Network configuration

The network setting depend on the used NIC hardware. Some of the following configuration changes maybe cannot be made or have different possible values as shown.
In the following step the execution as root user is described. If the root access is not possible the `sudo` command must be added in front of each command.

[discrete]
==== Configuring network port buffer size 
In the example below, the NIC is named eth1, which is an Intel-based NIC. 
For Intel based NIC, the recommended buffer size is 4 KB (4096). The value to use here depends on the maximum values recommended for each NIC type and vendor.
Make the `ethtool` option persistent by adding them to the ifcfg file for each interface (last line).

Read the current setting:

[source,shell]
----
ethtool -g eth1
Ring parameters for eth1:
Pre-set maximums:
RX:			4096
RX Mini:		n/a
RX Jumbo:		n/a
TX:			4096
TX push buff len:	n/a
Current hardware settings:
RX:			256
RX Mini:		n/a
RX Jumbo:		n/a
TX:			256
RX Buf Len:		n/a
CQE Size:		n/a
TX Push:		off
RX Push:		off
TX push buff len:	n/a
TCP data split:		n/a
----

Set the new values:

[source,shell]
----
vi /etc/sysconfig/network/ifcfg-eth1
IPADDR='192.168.1.11/24'
BOOTPROTO='static'
STARTMODE='auto'
ZONE=internal
ETHTOOL_OPTIONS='-G iface rx 4096 tx 4096'
----

Restart the NIC and validate the setting or do all the changes in once and restart the network later.
[id="nic-restart"]

NIC restart:

[source,shell]
----
ifdown eth1
 
ifup eth1
 
ethtool -?? eth1
----

For the concrete example it looks like this:

[source,shell]
----
ethtool -g eth1
...
Current hardware settings:
RX:         4096
RX Mini:        n/a
RX Jumbo:       n/a
TX:         4096
...
----

Enable the network port buffer temporarily using the command below and check the settings:

[source,shell]
----
ethtool -G eth1 rx 4096 tx 4096
ethtool -g eth1
----

[discrete]
==== Enabling jumbo frames

Before enabling jumbo frames, verify that all the network switches, routers, and anything else essential in the network packet path between the clients and the {sqls} support jumbo frames. 
Add a line in the ifcfg file and set the MTU size.

[source,shell]
----
vi /etc/sysconfig/network/ifcfg-eth1
...
MTU=9000
...
----

Restart your NIC, for example with <<nic-restart>> and validate the setting.
[source,shell]
----
ip addr |grep 'mtu 9'
----

Enable jumbo frames temporarily using the command `ip`.
[source,shell]
----
ip link set eth1 mtu 9000
ip addr |grep 'mtu 9'
----

If your {sqls} is running to this point in time, than the {sqls} needs to be configured for jumbo frames as well.
After jumbo frames are enabled, connect to SQL Server and change the network packet size to 8060 using `sp_configure` as shown.
(How to connect to the database? <<login_db>>)

[id="sql-jumbo"]
Jumbo frames for {sqls}:
[source,sql]
----
EXEC sp_configure 'network packet size', '8060';
GO
RECONFIGURE WITH OVERRIDE;
GO
----

[discrete]
==== Setting the port for adaptive RX/TX IRQ coalescing

Meaning interrupt delivery is adjusted to improve latency when the packet rate is low and to improve throughput when the packet rate is high. 
This setting might not be available across all the different network infrastructures. Thus review the existing network infrastructure and confirm that this is supported. 
The example below is for the NIC named `eth1`, which is an Intel-based NIC.

[source,shell]
----
vi /etc/sysconfig/network/ifcfg-eth1
...
ETHTOOL_OPTIONS_rx='-C iface adaptive-rx on adaptive-tx on'
----

Restart the NIC <<nic-restart>> and validate the settings.
[source,shell]
----
ethtool -c eth1
----

Enable the RX/TX IRQ coalescing temporarily using the command `ethtool`.
[source,shell]
----
ethtool -C eth1 adaptive-rx on adaptive-tx on
ethtool -c eth1
----

[discrete]
==== Enabling RX and TX side of RSS queues

It is recommended to enable receive-side scaling (RSS) and combine the RX and TX sides of RSS queues by default.
When working with Microsoft Support, there have been scenarios where disabling RSS has improved the performance as well. 
Test this setting in test environments before applying it on production environments. The following example is for Intel NICs.
[source,shell]
----
vi /etc/sysconfig/network/ifcfg-eth1
...
ETHTOOL_OPTIONS_com='-L iface combined 8'
----

Restart the NIC <<nic-restart>> and validate the settings.
[source,shell]
----
ethtool -l eth1
----

Enable combining the RX and TX side of RSS queues temporarily using the command `ethtool` and verify the setting.
[source,shell]
----
ethtool -L eth1 combined 8
ethtool -l eth1
----

==== Firewall configuration

The connection to the {sqls} needs two ports opened in the firewall.
* 135/tcp  MSDTC
* 1433/tcp {sqls}

//-

Optional:
* 9100/tcp Prometheus node_exporter
* 9664/tcp ha_cluster_exporter

[source,shell]
----
firewall-cmd --permanent --add-port=135/tcp  --add-port=1433/tcp && firewall-cmd --reload
----

Check the configuration
[source,shell]
----
firewall-cmd --list-ports
----

==== Storage configuration

Use storage subsystem with appropriate IOPS, throughput, and redundancy. Based on the Microsoft {sqls} recommendation splitting the storage into 5 parts is the best approach.

* OS + swap (mount point / and /swap)
* data (mount point /data)
* transaction log (mount point /log)
* tempdb (mount point /tempdb)

The default filesystem for OS will be btrfs all others will have xfs. Based on the database sizing the required disk must be provided. The example will describe a Linux Software RAID based setup.
The disks `sdb - sdi` are the partitions from the NVME storage underneath. The command `lsblk` helps to find the right partition name to build a reasonable RAID setup later and avoid having all partitions 
from only one NVME in the same RAID configuration.

.Example for `lsblk`
[source,shell]
----
# lsblk
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS
sda      8:0    0  50G  0 disk 
├─sda1   8:1    0   8M  0 part 
├─sda2   8:2    0  48G  0 part /var
│                              /opt
│                              /home
│                              /srv
│                              /root
│                              /usr/local
│                              /tmp
│                              /boot/grub2/x86_64-efi
│                              /boot/grub2/i386-pc
│                              /.snapshots
│                              /
└─sda3   8:3    0   2G  0 part [SWAP]
sdb      8:16   0  10G  0 disk 
sdc      8:32   0  10G  0 disk 
sdd      8:48   0  10G  0 disk 
sde      8:64   0  10G  0 disk 
sdf      8:80   0  11G  0 disk 
sdg      8:96   0  11G  0 disk 
sdh      8:112  0  12G  0 disk 
sdi      8:128  0  12G  0 disk 
----

INFO: The following chapter is done as `root` user, if this is not possible the `sudo` must be put in front of each command.

Create the database storage RAID:

[source,shell]
----
# For Data volume, using 4 devices, in RAID 5 configuration with 8KB stripes
mdadm --create --verbose /dev/md0 --level=raid5 --chunk=8K --raid-devices=4 /dev/sdb /dev/sdc /dev/sdd /dev/sde
 
# For Log volume, using 2 devices in RAID 10 configuration with 64KB stripes
mdadm --create --verbose /dev/md1 --level=raid10 --chunk=64K --raid-devices=2 /dev/sdg /dev/sdf
 
# For tempdb volume, using 2 devices in RAID 0 configuration with 64KB stripes
mdadm --create --verbose /dev/md2 --level=raid0 --chunk=64K --raid-devices=2 /dev/sdi /dev/sdh
----

The Ext4 and XFS file systems are supported, therefore format the volumes with XFS (case-sensitive).
[source,shell]
----
mkfs.xfs /dev/md0 -f -n version=ci -L datavolume
mkfs.xfs /dev/md1 -f -n version=ci -L logvolume
mkfs.xfs /dev/md2 -f -n version=ci -L tempdb
----

Use the `noatime` attribute with any file system that stores {sqls} data and log files. Creating the mount point: 

[source,shell]
----
mkdir -p /data /log /tempdb
----

Mounting the disks during boot requires an entry in the `/etc/fstab`. The `blkid` helps to find the right `UUID` for each disk.

[source,shell]
----
blkid |grep md

vi /etc/fstab
...
UUID="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" /data xfs rw,attr2,noatime 0 0
UUID="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" /log xfs rw,attr2,noatime 0 0
UUID="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" /tempdb xfs rw,attr2,noatime 0 0

mount -a
----

Create subdirectories for the {sqls}:
[source,shell]
----
mkdir -p /data/masterdata /log/masterlog 
----

Prepare file system permission for the dedicated storage partition:

[source,shell]
----
chown -R mssql.mssql /data /tempdb /log
----

Check the disk are mounted and have the right permissions:

[source,shell]
----
df -hT
ls -l /
----

INFO: This would be a good point in time to reboot your system to activate all the configuration changes and settings before the {sqls} is started the first time. This would also help to check if all settings made before are reboot persistent.

[id="final_reboot"]
.server reboot
[source,shell]
----
reboot
----

==== {sqls} configuration

To configure and start {sqls}, `mssql-conf` can be used to accept the EULA, set the {sqls} Edition, the SA password and many more details.

Add `mssql-tools18` to your `PATH` environment variable in a Bash shell:
[source,shell]
----
echo 'export PATH="$PATH:/opt/mssql-tools18/bin"' >> ~/.bash_profile
echo 'source ~/.bash_profile"' >> ~/.bashrc
source ~/.bash_profile
----

Running the command `/opt/mssql/bin/mssql-conf list` will a list of all possible parameter what can be set.

[source,shell]
----
/opt/mssql/bin/mssql-conf list
control.alternatewritethrough                           Enable optimized write through flush for O_DSYNC requests
control.hestacksize                                     Host extension stack size in KB
control.stoponguestprocessfault                         Stops the process if any guest process reports unhandled exception
control.writethrough                                    Use O_DSYNC for file flag write through requests
coredump.captureminiandfull                             Capture both mini and full core dumps
coredump.coredumptype                                   Core dump type to capture: mini, miniplus, filtered, full
coredump.disablecoredump                                SQL Server disable core dump
distributedtransaction.allowonlysecurerpccalls          Configure secure only rpc calls for distributed transactions
distributedtransaction.fallbacktounsecurerpcifnecessary Configure security only rpc calls for distributed transactions
distributedtransaction.maxlogsize                       DTC log file size in MB. Default is 64MB
distributedtransaction.memorybuffersize                 Circular buffer size in which traces are stored. This size is in MB and default is 10MB
distributedtransaction.servertcpport                    MSDTC rpc server port
distributedtransaction.trace_cm                         Traces in the connection manager
distributedtransaction.trace_contact                    Traces the contact pool and contacts
distributedtransaction.trace_gateway                    Traces Gateway source
...
----

The following options are used to do a simple setup for a host with 1TB RAM.

[source,shell]
----
/opt/mssql/bin/mssql-conf set sqlagent.enabled true
/opt/mssql/bin/mssql-conf set sqlagent.errorlogfile /log/sqlagent.log
/opt/mssql/bin/mssql-conf set sqlagent.errorlogginglevel 2
/opt/mssql/bin/mssql-conf set telemetry.customerfeedback false
/opt/mssql/bin/mssql-conf set filelocation.defaultdatadir /data
/opt/mssql/bin/mssql-conf set filelocation.defaultlogdir /log
/opt/mssql/bin/mssql-conf set filelocation.masterdatafile /data/masterdata/master.mdf
/opt/mssql/bin/mssql-conf set filelocation.masterlogfile /log/masterlog/mastlog.ldf
/opt/mssql/bin/mssql-conf set network.rpcport 135
/opt/mssql/bin/mssql-conf set control.writethrough 1
/opt/mssql/bin/mssql-conf set control.alternatewritethrough 0
# for example using 950GB of 1048576MB available RAM for MSSQL DB instead of 80% default, example for 1TB
/opt/mssql/bin/mssql-conf set memory.memorylimitmb 950000
----

[discrete]
==== Initial setup and start of {sqls}

Finally configure and start `msql-server` (`mssql-conf` starts the `msql-server` immediately after configuring),
run the following command:

[source,shell]
----
ACCEPT_EULA='Y' MSSQL_PID='Developer' MSSQL_SA_PASSWORD='Strong!Passw0rd' /opt/mssql/bin/mssql-conf setup
#alternatively
MSSQL_MEMORY_LIMIT_MB='<some value here>' ACCEPT_EULA='Y' MSSQL_PID='Developer' MSSQL_SA_PASSWORD='Strong!Passw0rd' /opt/mssql/bin/mssql-conf setup
----

* `ACCEPT_EULA` accepts the SQL Server EULA
* `MSQL_SA_PASSWORD` sets the SA user password. Ensure password requirements as outlined in <<password_requirements>> are followed.
* `MSQL_PID` sets the SQL Server edition, acceptable values are:
** Evaluation
** Developer
** Express
** Web
** Standard
** Enterprise
** EnterpriseCore
** A product key 

WARNING: It is recommended to change the SA password later with `mssql-conf set-sa-password` 
or disable the history prior to configuring SQL Server with `set +o history`, and re-enabling it afterward with `set -o history` (Bash).

:hash: #
:hash5: #####

If you specify a `product key`, it must be in the format of `{hash5}`-`{hash5}`-`{hash5}`-`{hash5}`-`{hash5}`, where `{hash}` is a number or a letter in summary 25.

- {sqls} should be started at this point. You can verify this with `systemctl status mssql-server.service`. 
- By default, {sqls} listens for connections on port `1433`, providing a second method to verify the {sqls} is up and running.
- {sqls} should be accessible with `sqlcmd`. 

*systemd* check:

[source,shell]
----
systemctl status mssql-server.service
 
● mssql-server.service - Microsoft SQL Server Database Engine
     Loaded: loaded (/usr/lib/systemd/system/mssql-server.service; enabled; preset: disabled)
     Active: active (running) since Thu 2024-10-17 17:21:22 CEST; 7min ago
       Docs: https://docs.microsoft.com/en-us/sql/linux
   Main PID: 12965 (sqlservr)
      Tasks: 180
        CPU: 16.947s
     CGroup: /system.slice/mssql-server.service
             ├─12965 /opt/mssql/bin/sqlservr
             └─12970 /opt/mssql/bin/sqlservr
----

Open port:

[source,shell]
----
ss -tulpan |grep 1433
tcp   LISTEN 0      128                           0.0.0.0:1433               0.0.0.0:*     users:(("sqlservr",pid=23066,fd=102))                  
tcp   ESTAB  0      0                           127.0.0.1:53189            127.0.0.1:1433  users:(("sqlservr",pid=23066,fd=137))                  
tcp   ESTAB  0      0                           127.0.0.1:35775            127.0.0.1:1433  users:(("sqlservr",pid=23066,fd=122))                  
tcp   ESTAB  0      0                           127.0.0.1:1433             127.0.0.1:53189 users:(("sqlservr",pid=23066,fd=135))                  
tcp   ESTAB  0      0                           127.0.0.1:1433             127.0.0.1:35775 users:(("sqlservr",pid=23066,fd=134))                  
tcp   ESTAB  0      0                           127.0.0.1:33679            127.0.0.1:1433  users:(("sqlservr",pid=23066,fd=108))                  
tcp   ESTAB  0      0                           127.0.0.1:1433             127.0.0.1:33679 users:(("sqlservr",pid=23066,fd=139))                  
tcp   LISTEN 0      128                                 *:1433                     *:*     users:(("sqlservr",pid=23066,fd=105))
----

[id="login_db"]
*sqlcmd* login with `sqlcmd -S <hostname> -U SA -P <password>`:

[source,shell]
----
sqlcmd -S mssql -U SA -P Strong\!Passw0rd -Q "SELECT @@VERSION" 2>/dev/null
                                                                                                                                                                                                                                                                                                            
----------------------------------------------------------------------------------
Microsoft SQL Server 2022 (RTM-CU15-GDR) (KB5046059) - 16.0.4150.1 (X64) 
	Sep 25 2024 17:34:41 
	Copyright (C) 2022 Microsoft Corporation
	Developer Edition (64-bit) on Linux (SUSE Linux Enterprise Server 15 SP6) <X64>                                                                                 

(1 row affected)
----

[discrete]
==== Moving `tempdb` files to a dedicate storage area

By default, a new installation of SQL Server on Linux creates multiple `tempdb` data files, based on the number of logical cores (with up to eight data files).
One of our preparation steps for the storage component involved setting up a dedicated RAID array for the `tempdb` files. This setting can only be modified from inside the {sqls}.
The following example moves `tempdb` from its current default location on the disk to another disk location. Because `tempdb` is re-created each time the 
MSSQLSERVER service is started, you do not need to physically move the data and log files. The files are created when the service is restarted. 
Until the service is restarted, `tempdb` continues to function in its existing location. Determine the logical file names of the `tempdb` database and their current location on the disk.

.Check the current location with `sqlcmd -S <hostname> -U SA -P <password>`

(decide if a move is required or not) 
[source,sql]
----
sqlcmd -S mssql -U SA -P Strong\!Passw0rd
SELECT name, physical_name
FROM sys.master_files
WHERE database_id = DB_ID('tempdb');
GO
----

INFO: If this is the first time the database is up and running enable the jumbo frames for the {sqls} if needed.
<<sql-jumbo>>

If all the preparation are made in the right order the `/tempdb` directory should already be in use and set as default location. In that situation the next step can be skipped.

Change the location of each file by using `ALTER DATABASE` with `sqlcmd -S <hostname> -U SA -P <password>`:
[source,sql]
----
sqlcmd -S mssql -U SA -P Strong\!Passw0rd
USE master;
GO
ALTER DATABASE tempdb
MODIFY FILE (NAME = tempdev, FILENAME = '/tempdb/tempdb.mdf');
GO
ALTER DATABASE tempdb
MODIFY FILE (NAME = templog, FILENAME = '/tempdb/templog.ldf');
GO
ALTER DATABASE tempdb
MODIFY FILE (NAME = tempdev2, FILENAME = '/tempdb/tempdb2.ndf');
GO
ALTER DATABASE tempdb
MODIFY FILE (NAME = tempdev3, FILENAME = '/tempdb/tempdb3.ndf');
GO
ALTER DATABASE tempdb
MODIFY FILE (NAME = tempdev4, FILENAME = '/tempdb/tempdb4.ndf');
GO
----

Stop and restart the instance of {sqls}.

Verify the file change with `sqlcmd -S <hostname> -U SA -P <password>`:

[source,sql]
----
sqlcmd -S mssql -U SA -P Strong\!Passw0rd
SELECT name, physical_name
FROM sys.master_files
WHERE database_id = DB_ID('tempdb');
GO
----

[source,shell]
----
ls -lh /tempdb/*
-rw-rw---- 1 mssql mssql 8,0M 11. Nov 11:05 /tempdb/tempdb2.ndf
-rw-rw---- 1 mssql mssql 8,0M 11. Nov 11:05 /tempdb/tempdb3.ndf
-rw-rw---- 1 mssql mssql 8,0M 11. Nov 11:05 /tempdb/tempdb4.ndf
-rw-rw---- 1 mssql mssql 8,0M 11. Nov 11:05 /tempdb/tempdb.mdf
-rw-rw---- 1 mssql mssql 8,0M 11. Nov 11:09 /tempdb/templog.ldf
----

Delete the `tempdb.mdf` and `templog.ldf` files from their original location.

With {sqls} 16 more memory specific improvements are made with can be enabled. For more details and {sqls} specific internal tunings follow the official documentation from Microsoft.
https://learn.microsoft.com/en-us/sql/relational-databases/in-memory-database?view=sql-server-linux-ver16#memory-optimized-tempdb-metadata

[discrete]
==== Further {sqls} configuration modification

For further configuration, use `mssql-conf` to set additional parameters. Changes will take effect after a restart:

[source,shell]
----
mssql-conf set ${parameter}
systemctl restart mssql-server
----

Available `mssql-conf` options are described in https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-configure-mssql-conf?view=sql-server-ver16[Configure SQL Server on Linux with the mssql-conf tool].

An alternative way to configure {sqls} is using the `/var/opt/mssql/mssql.conf` file. 
Settings are stored in the `mssql.conf` format https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-configure-mssql-conf?view=sql-server-ver16#mssqlconf-format[mssql.conf].

A sample `mssql.conf` file is shown below. Edit the `mssql.conf` file and restart `mssql-server` to apply changes.

[source,ini]
----
[sqlagent]
enabled = true
errorlogginglevel = 2
errorlogfile = /log/sqlagent.log

[telemetry]
customerfeedback = false

[filelocation]
defaultdatadir = /data
defaultlogdir = /log
masterdatafile = /data/masterdata/master.mdf
masterlogfile = /log/masterlog/mastlog.ldf

[network]
rpcport = 135

[EULA]
accepteula = Y

[control]
writethrough = 1
alternatewritethrough = 0
----

////
== High Avaibility Setup
////

== Tools

Now that SQL Server is running, you can query it. The `mssql-tools` package includes `sqlcmd`, which is a shell to query SQL Server. 
Install it similarly to the `mssql-server` package. (skip the step if it was done in the chapter Repositories)

Add the repository:
[source,shell]
----
zypper addrepo --refresh --check https://packages.microsoft.com/config/sles/15/prod.repo
----

Install the `mssql-tools` package:
[source,shell]
----
ACCEPT_EULA=Y zypper install --no-confirm mssql-tools
----

Add the tools to your `PATH`:
[source,shell]
----
vi ~/.bashrc
echo 'export PATH="$PATH:/opt/mssql-tools18/bin"' >> ~/.bash_profile
source ~/.bash_profile
----

Then start `sqlcmd` and make a query. The `-S` option designates the server. The `-U` option specifies the user. 
Available options can be found at https://docs.microsoft.com/en-us/sql/tools/sqlcmd-utility?view=sql-server-ver16#syntax[sqlcmd Utility Syntax]. 

Log in with `sqlcmd`
[source,shell]
----
sqlcmd -S localhost -U SA
----

[source,shell]
----
1> SELECT name from sys.databases
2> GO
name                                                                                                                            
--------------------------------------------------------------------------------------------------------------------------------
master                                                                                                                          
tempdb                                                                                                                          
model                                                                                                                           
msdb                                                                                                                            
tpcc                                                                                                                            

(5 rows affected)
----

`GO` is required here to execute the previous statements.

To exit `sqlcmd`, input `quit` or `exit`:

The full `sqlcmd` documentation can be found at https://docs.microsoft.com/en-us/sql/tools/sqlcmd-utility?view=sql-server-ver16[sqlcmd Utility].

=== Azure Data Studio

Azure Data Studio is a lightweight, cross-platform data management and development tool with connectivity to popular cloud and on-premises databases. 
Azure Data Studio supports Linux, with immediate capability to connect to Azure SQL and SQL Server. 
https://learn.microsoft.com/en-us/azure-data-studio/what-is-azure-data-studio[What is Azure Data Studio?]

Download the *Azure Data Studio* RPM from https://learn.microsoft.com/en-us/azure-data-studio/download-azure-data-studio?view=sql-server-ver16&tabs=linux-install%2Cwin-user-install%2Csuse-install%2Cwindows-uninstall%2Credhat-uninstall#download-azure-data-studio[Download Azure Data Studio].
[source,shell]
----
curl --location --request GET 'https://go.microsoft.com/fwlink/?linkid=2282380' --output azure-data-studio.rpm
----

Install Azure Data Studio using .rpm:
[source,shell]
----
zypper install <name given before>.rpm
----

To start Azure Data Studio run the command on your shell:
[source,shell]
----
azuredatastudio
----

image:azure-data-studio.png[Azure Data Studio,480,360,float="right",align="center"]

With `Create a connection` the {sqls} can be added. A pop-up window is asking for the required parameter. The connection can be established to a single node or the virtual IP of a cluster setup.

image:azure-data-studio-connection.png[Azure Data Studio with a connected system,320,240,scaledwidth=90%]

== Administration

=== `systemd`

The `mssql-server` package installs and configures SQL Server as a https://systemd.io/[systemd] service. 
`systemd` provides a framework for managing services, mounts, and system states. 
You can find more details about `systemd` unit files at https://www.freedesktop.org/software/systemd/man/systemd.unit.html[systemd.unit — Unit configuration]. 
To control the `mssql-server` service, use `systemctl` to retrieve the `status`, `start`, `stop`, `restart`, `enable`, and `disable` the service.

Display `mssql-server` status as root user:
[source,shell]
----
systemctl status mssql-server.service 
● mssql-server.service - Microsoft SQL Server Database Engine
     Loaded: loaded (/usr/lib/systemd/system/mssql-server.service; enabled; preset: disabled)
     Active: active (running) since Mon 2024-11-11 11:05:43 CET; 1 week 0 days ago
       Docs: https://docs.microsoft.com/en-us/sql/linux
   Main PID: 23061 (sqlservr)
      Tasks: 195
        CPU: 3h 18min 15.202s
     CGroup: /system.slice/mssql-server.service
             ├─23061 /opt/mssql/bin/sqlservr
             └─23066 /opt/mssql/bin/sqlservr

Nov 11 11:05:58 mssql sqlservr[23066]: [75B blob data]
Nov 11 11:05:58 mssql sqlservr[23066]: [96B blob data]
Nov 11 11:05:58 mssql sqlservr[23066]: [100B blob data]
Nov 11 11:05:58 mssql sqlservr[23066]: [71B blob data]
Nov 11 11:05:58 mssql sqlservr[23066]: [124B blob data]
Nov 11 11:05:59 mssql sqlservr[23066]: [157B blob data]
Nov 11 11:05:59 mssql sqlservr[23066]: [193B blob data]
Nov 11 11:05:59 mssql sqlservr[23066]: [155B blob data]
Nov 11 11:05:59 mssql sqlservr[23066]: [204B blob data]
Nov 11 12:05:49 mssql sqlservr[23066]: [97B blob data]
----

Start `mssql-server` as root user:
[source,shell]
----
systemctl start mssql-server
----

Stop `mssql-server` as root user:
[source,shell]
----
systemctl stop mssql-server
----

Restart `mssql-server` as root user:
[source,shell]
----
systemctl restart mssql-server
----

Enable `mssql-server` to start on boot (`mssql-server` is enabled by default on installation):
[source,shell]
----
systemctl enable mssql-server

Created a symlink from `/etc/systemd/system/multi-user.target.wants/mssql-server.service` to `/usr/lib/systemd/system/mssql-server.service`.
----

Disable `mssql-server` to present starting on boot:
[source,shell]
----
systemctl disable mssql-server

Removed symlink /etc/systemd/system/multi-user.target.wants/mssql-server.service.
----

Check the `journalctl` log for `mssql-server.service`:
[source,shell]
----
journalctl -fu mssql-server.service
----

The parameter `-f` is to follow the log entries. If a static non updates list is preferred, use `journalctl -u mssql-server.service` 

Check if the network port is active as root user:
[source,shell]
----
ss -tulpan |grep 1433
----

=== Logs

For troubleshooting, the logs and crash dumps are written to `/var/opt/mssql/log` by default. 
Notable logs are the *errorlogs* (+errorlog*+), *trace logs* (+*.trc+), *sqlagent logs* (+sqlagent*+), 
and the *extended events logs* (*.xel). Core dumps are written with the `.tar.gz2` extension and SQL dumps with the `.mdmp` extension. 
To view these resources, you need `root` or the `mssql` user access.

[source,shell]
----
ls /var/opt/mssql/log
errorlog    errorlog.6                                  HkEngineEventFile_0_133741652559190000.xel  log_5.trc            system_health_0_133736403350200000.xel  system_health_0_133752031587310000.xel
errorlog.1  FDLAUNCHERRORLOG                            HkEngineEventFile_0_133742310585270000.xel  log_6.trc            system_health_0_133736403551080000.xel  system_health_0_133753552568770000.xel
errorlog.2  HkEngineEventFile_0_133736403215340000.xel  HkEngineEventFile_0_133752031521550000.xel  log_7.trc            system_health_0_133740616123760000.xel  system_health_0_133757931534220000.xel
errorlog.3  HkEngineEventFile_0_133736403466300000.xel  HkEngineEventFile_0_133753552495030000.xel  log_8.trc            system_health_0_133741585411750000.xel
errorlog.4  HkEngineEventFile_0_133740616015550000.xel  HkEngineEventFile_0_133757931472470000.xel  mssql-conf           system_health_0_133741652635900000.xel
errorlog.5  HkEngineEventFile_0_133741585328790000.xel  log_4.trc                                   sqlagentstartup.log  system_health_0_133742310655250000.xel
----

=== {sqls} starting issues

If the database does not start, check the `journalctl -u mssql-server.service` logs. If the example below is shown, verify the right ownership for the directories and files.

[source,shell]
----
systemd[1]: mssql-server.service: Main process exited, code=exited, status=229/SELINUX_CONTEXT
...
systemd[1]: mssql-server.service: Main process exited, code=exited, status=229
----

Check the ownership for the files in /data, /tempdb and /log. All of them must be owned by `mssql` (UID and GID).

=== Loading sample data

Microsoft has provided some https://github.com/microsoft/sql-server-samples[sample databases] 
you can use to seed your `mssql-server` instance with some data. 

Here is an example of loading our SQL server instance with the sample database `WideWorldImporters`.

Download the `WideWorldImporters` database:

[source,shell]
----
curl --location https://github.com/Microsoft/sql-server-samples/releases/download/wide-world-importers-v1.0/WideWorldImporters-Full.bak \
    --output /tmp/WideWorldImporters-Full.bak
----

Restore full backup into `mssql-server` with `sqlcmd` while updating paths for the data, user data, transaction log, and in-memory data:
(Adapt the password and storage location to your setup)

[source,sql]
----
sqlcmd -S localhost \
    -U sa \
    -P Strong\!Passw0rd \
    -Q "RESTORE DATABASE WideWorldImporters \
        FROM DISK ='/tmp/WideWorldImporters-Full.bak' WITH \
        MOVE 'WWI_Primary' TO '/data/WideWorldImporters.mdf', \
        MOVE 'WWI_UserData' TO '/data/WideWorldImporters_UserData.ndf', \
        MOVE 'WWI_Log' TO '/data/WideWorldImporters.ldf', \
        MOVE 'WWI_InMemory_Data_1' TO '/data/WideWorldImporters_InMemory_Data_1'"

Processed 1464 pages for database 'WideWorldImporters', file 'WWI_Primary' on file 1.
Processed 53096 pages for database 'WideWorldImporters', file 'WWI_UserData' on file 1.
Processed 33 pages for database 'WideWorldImporters', file 'WWI_Log' on file 1.
Processed 3862 pages for database 'WideWorldImporters', file 'WWI_InMemory_Data_1' on file 1.
Converting database 'WideWorldImporters' from version 852 to the current version 904.
Database 'WideWorldImporters' running the upgrade step from version 852 to version 853.
Database 'WideWorldImporters' running the upgrade step from version 853 to version 854.
...
Database 'WideWorldImporters' running the upgrade step from version 902 to version 903.
Database 'WideWorldImporters' running the upgrade step from version 903 to version 904.
RESTORE DATABASE successfully processed 58455 pages in 37.388 seconds (12.214 MB/sec).
----

When loaded, project ten table names from the `WideWorldImporters` database to test it:

[source,sql]
----
sqlcmd -S localhost \
    -U sa \
    -P Strong\!Passw0rd \
    -Q "SELECT TOP(10) table_name FROM \
        WideWorldImporters.information_schema.tables \
        WHERE table_type = 'BASE TABLE'"

table_name
--------------------------------------------------------------------------------------------------------------------------------

Colors
Colors_Archive
OrderLines
PackageTypes
PackageTypes_Archive
StockGroups
StockItemStockGroups
StockGroups_Archive
StateProvinces
CustomerTransactions

(10 rows affected)
----

== Summary

Businesses around the world look to SUSE to help them simplify and optimize their IT environments, 
modernize their applications and infrastructure, and accelerate innovation on-premises, in the cloud, and at the edge. 
With {sles} support for Microsoft SQL Server, businesses can streamline their IT landscape and operations 
without changing their preferred enterprise database management system.

At this point, you should have a fair understanding of how to install SQL Server on {sles}, 
install SQL Server tools, query SQL Server and perform basic administration. 
To stay up to date on the latest SQL Server on Linux features, bookmark https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-release-notes-2022?view=sql-server-ver16[Release notes for SQL Server 2022 on Linux].


== Appendix

[id="password_requirements"]
=== SQL Server password requirements

Password complexity policies are designed to thwart brute-force attacks by expanding the range of potential password combinations.
When the password complexity policy is enforced, new passwords must adhere to the following guidelines:

* The password does not contain the account name of the user.
* The password is at least eight characters long.
* The password contains characters from three of the following four categories:
** Latin uppercase letters (A through Z)
** Latin lowercase letters (a through z)
** Base 10 digits (0 through 9)
** Non-alphanumeric characters such as: exclamation point (!), dollar sign ($), number sign (#), or percent (%).

Passwords can be up to 128 characters long. Use passwords that are as long and complex as possible.

=== Security limitations of SQL Server on Linux

SQL Server on Linux currently has the following limitations:

* A standard password policy is provided. `MUST_CHANGE` is the only option you might configure. The `CHECK_POLICY` option is not supported.
* Extensible Key Management is not supported.
* SQL Server authentication mode cannot be disabled.
* Password expiration is hard-coded to 90 days if you use SQL Server authentication.
* Using keys stored in the Azure Key Vault is not supported.
* SQL Server generates its own self-signed certificate for encrypting connections. SQL Server can be configured to use a user-provided certificate for TLS.

Find more detailed information at https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-security-overview?view=sql-server-ver16
and at https://learn.microsoft.com/en-us/sql/t-sql/statements/alter-login-transact-sql?view=sql-server-ver16.

=== Disabling the `sa account` as a best practice

Follow the instructions from Microsoft:
https://learn.microsoft.com/en-us/sql/linux/quickstart-install-connect-suse?view=sql-server-linux-ver16#disable-the-sa-account-as-a-best-practice[Disable SA user]

=== Virtual machines and dynamic memory

If you are running {sqls} on Linux in a virtual machine, make sure you select options to fix the amount of memory reserved for the virtual machine. Do not use features like Hyper-V Dynamic Memory.
The feature for KVM is called memballoon and can be set to none in the VM configuration. The default is virtio.

.KVM memballoon
[source,shell]
----
virsh edit --domain mssql
...
   <memballoon model='none'>
      <address type='pci' domain='0x0000' bus='0x05' slot='0x00' function='0x0'/>
    </memballoon>
...
----

The VM must be powered off to activate the changes. A reboot is not enough. 

.before
[source,shell]
----
lspci |grep balloon

05:00.0 Unclassified device [00ff]: Red Hat, Inc. Virtio 1.0 memory balloon (rev 01)
----

.after
[source,shell]
----
lspci |grep balloon
----

=== References

* https://documentation.suse.com/sles/15-SP6/[SUSE Linux Enterprise Server 15 SP6]
* https://www.suse.com/products/multi-linux-manager[SUSE Multi-Linux Manager]
* https://documentation.suse.com/sles/15-SP6/single-html/SLES-rmt/#book-rmt[Repository Mirroring Tool Guide]
* https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-setup?view=sql-server-ver16[Installation guidance for SQL Server on Linux]
* https://docs.microsoft.com/en-us/sql/linux/quickstart-install-connect-suse?view=sql-server-ver16[Quickstart: Install SQL Server and create a database on SUSE Linux Enterprise Server]
* https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-configure-mssql-conf?view=sql-server-ver16[Configure SQL Server on Linux with the mssql-conf tool]
* https://docs.microsoft.com/en-us/sql/tools/sqlcmd-utility?view=sql-server-ver16[sqlcmd Utility]
* https://learn.microsoft.com/en-us/sql/relational-databases/security/password-policy?view=sql-server-ver16[Password Policy]
* https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-security-overview?view=sql-server-ver16[Security limitations for SQL Server on Linux]
* https://learn.microsoft.com/en-us/sql/samples/sql-samples-where-are?view=sql-server-ver16[SQL DB samples]
** https://github.com/microsoft/sql-server-samples[sql-server-samples] 


:leveloffset: 0
// Standard SUSE Best Practices includes
== Legal notice
include::common_sbp_legal_notice.adoc[]

++++
<?pdfpagebreak?>
++++

// Standard SUSE Best Practices includes
// include::common_gfdl1.2_i.adoc[]

:leveloffset: 0
include::common_gfdl1.2_i.adoc[]
